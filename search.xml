<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Android 实现自签名 HTTPS 教程</title>
    <url>/contents/Android%E5%AE%9E%E7%8E%B0%E8%87%AA%E7%AD%BE%E5%90%8DHTTPS%E6%95%99%E7%A8%8B.html</url>
    <content><![CDATA[<p>本文使用 <a href="https://github.com/square/okhttp">okhttp</a> 的封装类 <a href="https://github.com/hongyangAndroid/okhttputils">okhttp-utils</a> 实现 https 通讯<br>
okhttp-utils 对应 okhttp 版本 3.3.1.<br>
<span id="more"></span></p>
<h1 id="安装">安装</h1>
<ul>
<li>Android Studio<br>
<code>compile 'com.zhy:okhttputils:2.6.2'</code></li>
<li>Eclipse<br>
下载最新 jar:<a href="okhttputils-2_6_2.jar?raw=true">okhttputils-2_6_2.jar</a>。<br>
注：需要同时导入 okhttp 和 okio 的 jar，下载见：<a href="https://github.com/square/okhttp">https://github.com/square/okhttp</a>。</li>
</ul>
<h1 id="配置okhttpclient和ssl证书">配置 OkhttpClient 和 SSL 证书</h1>
<p>在 onCreate 函数中<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">InputStream certification = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    certification = getAssets().open(<span class="string">"xxxxx.cer"</span>);</span><br><span class="line">} <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br><span class="line">HttpsUtils.SSLParams sslParams = HttpsUtils.getSslSocketFactory(<span class="keyword">new</span> InputStream[]{certification}, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">    .hostnameVerifier(<span class="keyword">new</span> HostnameVerifier() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(String hostname, SSLSession session)</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">    .sslSocketFactory(sslParams.sSLSocketFactory, sslParams.trustManager)</span><br><span class="line">    .build();</span><br><span class="line">OkHttpUtils.initClient(okHttpClient);</span><br></pre></td></tr></tbody></table></figure><br>
其中xxxxx.cer为所连接服务器的证书，可从浏览器导出。<br>
也可以通过OpenSSL工具自签名生成，生成方法详见文章<a href="https://lxmymjr.github.io/2017/09/19/Python-Web%E6%A1%86%E6%9E%B6-CherryPy/#全局配置-global">Python Web 框架 - CherryPy</a><p></p>
<h1 id="通过https发送json消息">通过 HTTPS 发送 Json 消息</h1>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">String url = <span class="string">"https://xxxxx"</span>;</span><br><span class="line">String json = <span class="string">"{\"key1\":\"value1\", \"key1\":\"value1\"}"</span>;</span><br><span class="line">OkHttpUtils</span><br><span class="line">    .postString()</span><br><span class="line">    .url(url)</span><br><span class="line">    .content(json)</span><br><span class="line">    .mediaType(MediaType.parse(<span class="string">"application/json; charset=utf-8"</span>))</span><br><span class="line">    .build()</span><br><span class="line">    .execute(<span class="keyword">new</span> MyStringCallback());</span><br></pre></td></tr></tbody></table></figure>
<h1 id="通过https发送同步post请求">通过 HTTPS 发送同步 POST 请求</h1>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        String url = <span class="string">"https://xxxxx"</span>;</span><br><span class="line">        Response response;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            response = OkHttpUtils</span><br><span class="line">                    .post()</span><br><span class="line">                    .url(url)</span><br><span class="line">                    .addParams(<span class="string">"abc"</span>, <span class="string">"xxx"</span>)</span><br><span class="line">                    .addParams(<span class="string">"def"</span>, <span class="string">"yyy"</span>)</span><br><span class="line">                    .build()</span><br><span class="line">                    .execute();</span><br><span class="line">            <span class="keyword">if</span> (response.isSuccessful()) {</span><br><span class="line">                Log.d(<span class="string">"OkHTTP"</span>,<span class="string">"OkHTTP is request success"</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                Log.e(<span class="string">"OkHTTP"</span>, <span class="string">"OkHTTP is request error"</span>);</span><br><span class="line">            }</span><br><span class="line">            String data=response.body().string();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}.start();</span><br></pre></td></tr></tbody></table></figure>
<p>同步的 HTTPS 请求不能再主线程中进行，所以要新建一个线程处理同步请求。</p>
<h1 id="通过https发送异步post请求">通过 HTTPS 发送异步 POST 请求</h1>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">String url = <span class="string">"https://xxxxx"</span>;</span><br><span class="line">OkHttpUtils</span><br><span class="line">    .post()</span><br><span class="line">    .url(url)</span><br><span class="line">    .addParams(<span class="string">"abc"</span>, <span class="string">"xxx"</span>)</span><br><span class="line">    .addParams(<span class="string">"def"</span>, <span class="string">"yyy"</span>)</span><br><span class="line">    .build()</span><br><span class="line">    .execute(<span class="keyword">new</span> MyStringCallback());</span><br></pre></td></tr></tbody></table></figure>
<h1 id="post表单形式上传文件">Post 表单形式上传文件</h1>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">OkHttpUtils.post()</span><br><span class="line">    .addFile(<span class="string">"file"</span>, <span class="string">"filename"</span>, file)</span><br><span class="line">    .url(url)</span><br><span class="line">    .params(params)</span><br><span class="line">    .headers(headers)</span><br><span class="line">    .build()</span><br><span class="line">    .execute(<span class="keyword">new</span> MyStringCallback());</span><br></pre></td></tr></tbody></table></figure>
<p>支持上传多个文件，addFile 的第一个参数为文件的 key，即类别表单中 <code>&lt;input type="file" name="file"/&gt;</code> 的 name 属性。<br>
params (params) 和 headers (headers) 可以省略。其中 params (params) 为参数格式，类似 addParams ()。<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Map&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">params.put(<span class="string">"abc"</span>, <span class="string">"xxx"</span>);</span><br><span class="line">params.put(<span class="string">"def"</span>, <span class="string">"yyy"</span>);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="处理返回消息">处理返回消息</h1>
<p>新建类 MyStringCallback：<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyStringCallback</span> <span class="keyword">extends</span> <span class="title">StringCallback</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Call call, Exception e, <span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(String response, <span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        Log.i(<span class="string">"HTTP"</span>, <span class="string">"onResponse："</span> + response);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>Backpropagation</title>
    <url>/contents/Backpropagation.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="cb2a545b753350aac33dbb9904f284d94e8aa7a893e29a509d37526eb3802e6e">0995c6aa457762375935b1a6315531ef60f5e144f24c557f8675a42381c5ec9c101c45ef86da96cb63edde21758bb0eb84e6854f93088320b49e7cf592a22fbcabd6e0a2f707cc6dfba2ead1d1150dcb6249fb4453ed7a5abce7b441e5acaeb360eb0463cb92576ccfea53dc4e7243b6be22e884c8886f8a1321ce38de4820080fac27424da25e7c75ad5fef5b4deec41daaed949aa5ffb52fab103ae5506fd09aae47c580554d38e59ce7932497a57054c8c09b1c9df9b96c2be00b8cc75fdd639c2001dee85bfa019285acd23df2cd11986aed643f00178156de817a20869e46e02592707a15926e37cecfa401ae94e35de0ecfd2c4fc2f7cb91ccf36f69fc5c673b67cdce9348c0a00126d12e3e3b5554a0b751ff9577afa4ffc6a624d8b74d6d57cb793bf1a2d1ef4d1a4e997b2ff4acfe7b8de032a17b5b77f98c328cc84d134052a6dd693978747e1a9431b87a0ac3f189534f35309ca0f9bfb699f5b1db1a6c08d445f7ac1b8df7094d8eef5ae30dc7a2a8c912af7c8e57f0dcaab80edc018583bd6872feb71796b4a0d54b273249a45d381dd9606b318e4b4a3a60cbaf8b09e3829305e7aaff916045804d106318067d42c412b7abc0e95b3fee0fb4c4cf400942adc575f3ba38ced52aeb85e0786eb4c272b5929829525a5b5f3fa58ca98c3ad25c10c2ad428187ed15c1f05446c39fd29c56a1efe6551c7a324656aa7dcf4941f03a3a8f3cf4f72efa907ed2e08d58bc21bbef1ee78e3ad1263effe5ee95beb3d3681d783b9d91e1e48552a0313298d5f0b4c0fffb4466bc305b0e920d606d2f85a6f015444fd86136cf1f825133f78ec69c574f15b1373fc22e73b0be96796ab3e3edab0f24cb1dad12dee8f3391c4532b4114bf213bfff4c9dd4d51f665909e9a1c8ed1adfcb67c1737cb591a6312aeb7e348b7f8a888d4434934bc8223b5e882a81a5f09ce67240999d19eeffd807e9f7dd1abfb1cac112a6b85df76698cf2b73a655034adf518929e1c248094a2e35ab63312931b59cc890e8d41d933a280c800a6ce1a4ae67b1d1b6a53a6ddabe64dada7c5d4f296e10ca1558bf3f4b52cd8ea7bbe050cfb8f91bf8dc9edde0c2b7eb8e91e1fc938be318c35263d54d9e5d820445ed77317522b43c8934472afc2ce04bde5f5de2a979aef541275dc8f5a8d0eab1189e81e2344cb40a78e1d80f4890bf09b03d4ce7bb05975ee6b4d3ad2657c78da663454aa6dffdea761e85dd2dbdcd071f465b363c5b2779b15c01b5bd696cd4a9fb605e987e0782598fd256430d40d2167dbefe8d67aca186bf55370b618deba359876dc89135a559cc654e5d146cfc4eeff171a1ed102028981b7360e7015e201b69b5af172b9958de80fe91a95a5ef377b40834ea96feeb939302d6a8996d92ad36ec48e9f528dff9909f51650ade38ef6f6eaab2b45931921cf9fe7963e843f9addc08694029502d78462a86dfed1fb722cfcd3cfb69478de213b6efb6d5491b0bdd2385dc21476f2695a0f7977d6601f99c4bf80c85364d2c9c2498528a0dbd6060172a0d6cb94390c819b77bd91a1b7b8e97f5ba5139c87b899fee679293ed0f50a7fcfe613daad33007fb00913f7e66ddef7336afe4df8fc77a416fe8f9c11ffda8f776a9ebd1382d07ba029c78ce2ec0ecfe6374693a90c0edd8cd0ee6499277a6a776cb724149fdcda830f39383fa0ff5a55cb95204c72603466f0ec029bb7389a363be4bf4952bb8f5361c47b0583110587ed5e0f990e146e4e7f192690aa1927aa520c4ee25b906116d9073609347278be1ac1053e7ae5fb1e25f3fdc6c09fe6d135a6ec1f5a9a392373054752ef4e1aa697e1fa8b351cd99dc6516fd59e21b8815606a3c882556fdd73b45c673d879fe852a520035d771d6a1eaa41a7c3b3bda57240f31f0fe88f5d2193dfd23c4a24947dcb0b73644e2be08377d670404851d51b8824461edadc90cdbdc69c5f17087a11b9af920e45bd963c8220062721f07d7276e367b269ef1468d07079ed1c9175b1e97b94ecb739b3f4117038396fc70257a04761b0ad5485a286da51f91934b579ae5cd3558330db44f6aaaf05dae3dcc6624f958f2309e9c0c91f790e7d9373d1c76787d1c7ad085547ce1e1a840d6fffc4b7df43fb8f0e083bb019b690cc15b32f6be72d8ef4a88af57d1826c7f0316087a5b6184b780b5a32aeaa598ac85d6161b5a1af70c7237f03260043d7d15de51ca177c3e5deaa9e33089870080e1ee1916aa25ec1c018fef5546ba7bb29d81d42ae9f3db492ddd1edc389400368e0dc060b48159c87067c3a987d62e2589c04c2ba0db8c34339b8fb97f3bc88ce420cd3b359a2863ba46a94c0ef42898b0f19a7021ef85fe4b1bbccd1f676ce924ddaea86ea5e4ae91616f95e1bbc341f4e58a186a798063ae8d2baf6af519f1928a26eefd53ac130684b49c57f9774db424a2e9e171f4d569204744963752bb227af8116af24fe651ab1728f647ed12fb99a86eb55717ff8a6be1a094c0a920440154d6765fc3875dd80f1a24d2d7e23b02be8a413b7664e1ce4ef31ecc2196b6ea4672f67d419c3b16ab3604af4ffec91d13ad2f27294fb47edab33b7611452d9a03a7178e3d1a380eda68168b1da30086d502e0b2ce94ab61b1c790f239a73c396ed0607fcd1695403cc5f2a6fcc2f2dda878eac01f7aebaa32fa31500641118fba7b36af32906dbd1fd8545aa168a476f50355f4ee748c4013d9aeb6a903e4d8de03d51e3843b392c03004863344e6217bcf5015009149884b9b5076440863c6ea1321f4d95cf8bc0cd01a19c9d153849af0c20c6fb86f0ec1bdac71417d39d9843ad20b534a193aa9b354398865c6b3899bb1ce5adba43f8a88cc423a024b5e10daae88453a4fe37a69631b093fcd120d8e8dbce2c8014f3a51a2bb09db274e394efb6eb12289043908bc6f6bee792f7f058b81a3053dfe286a022354a2c98f8b5b28b72c7428ac533ec52dc7d6144dfcfa22e72e2a8434fe2f56e0a4b538de8a6b4f6518284fb6a117f97d788ee6e5846193717f29e8896668f49881a4c0f24f30f64ef69f6bacbd13c29f8befbb0c234fe639bccc698604e8046aab64b63a2e8b5dd8c01df331c52a3c36180d87664af7aa27fdc124c658a135fd6c6307a8190aad9e0e4ef341cb384eea90b79b6918ef2b3a537546497fdf626a9b68812494c51f33d9ab9d359c4366b83b6fa1b23ca3f815a8a6d8cf9097572784157da321d546c96a7e6c75c4ffbaac71bad1e1d4b52912785f306c2ead6ac842b3840f84d06a3172fafb9a1a0ba4e52b170cee90920e150171b1285e908fb99e175913655e6ceb832bb911c64714e54e3f7dc8d71b2a00db7e30100d8c37735d9ed2f3cd0392bb94f96e1fd10ca2175e95b6592bf447c448ac4a5866e292671d111eb97a2d0beb4bfd2eaea14f81e69c41345224c7c5bb70a161564f3761c427fa12bcc1b469ff9b16c42bf5f23bf227c5b992c51c3882d50f39b5a0fd8048beec369f458e0da2ddc828913633644a6b14e4ba15739949cf29224401aab7e1f8f41fabd8d50913509e44abd9ba77686aac820994b8c54c75dcaad4bd82461df6fc8d015faba09e1aaf56007e3788393424607b57752672680b978749b067f915c63b33593fef9d1140a5a844f4b77a0b30f58be8beb98f90d8cf0e0dd6bc4b67f9aad446eb40280b7886a240a550b44325dea161e9d7184ca859734d32085b2fcc1c026f092928f5640a83003fc3c20fa8bcaa85b889d64b3d2bf6c1541d6cb03739f86fbbc913b50cd4a3408a8c5ed189a0fb804c919493d3d7f0eae4ae6fe65c03a08e308c84824d047256130b2bb68178fe298139160e6ca430f8f431d515baf8042b2c20ee657da1313a13fea18507db30fdfd7a904fc3dce46f841c2a402c1cffc3a275e4be94b06048879a0d1ac5b8a69ef4e39cc51f6f07ac2113c4abdfa217e25f5e7801c1633b79b032367146e633773213933299ae938404deff39af586e3574e0c21c8e757571f7af5af476d7c756886e785ad37a2a5ff78623e748ba60173991af2aa5547261ae4b017c89a105321b6d11c73fbbc6adcca0e9c1dccaefaf25a2c7885b5116db4651918d0dbd3875fa6e0d4b50c1850c4dc5a0055c215835dfb7132728f66b98ef858ccff815aa84073abcc7f4a971fcd73709467cf7eec3b8bd86666d1472136bf1d4a8cd81d6f8a17330e56cb9e443d11480325ceaffae489bf7ee8fa1a57a550e72dbc9e145ab2f2a140e81e0038566c65ce4bb1dad7b88f0696ed4271aaa6decce6448f971ae3cb71262999ccaa2a5007261eb1044ed84eceb81da718580037c84d223a69a45a5b02f854cb5a30c52ddb616761c1f0ebf47891de3f888601dd02e64728f2dd3594934ca1a80f7b46ba6026d67fea2303d9e1ecfc4d80b59fd5900b0e54d329a59296abddca355758acedbb66b983f761b1d47c30d79f1fbdcbaa435e98eba8d4832c0bdda996968823e3309401b421b1a802a775a0f8981e867a7b1f1eae7835e04113eaa4ff66ec8ef30c698ffd60414a463745709213ceb9bf0be8b5eba5575385faad00f7ac2f971b32270036516a90207f67783716113b89f2cbc9806b70cfe6aebdecbab573b64ade9e93afb1b4c154c8712ab73a38ac365b4e35262c76dec80006f1c2f573fe212df0cf652e9909366ddf632f00021231d745bb2f653d7d541d26445416d210f5871d5efb0b46ccdd5f06aebf8b9ec214ae091ab9b5b469639da97dfe3a1e52afb3a8c7506853120afc78d4fe0a64ac77679b16382179ed95023ab8382a0968d663802130a6ab7008a2a989d4f2f0e230527852a6916fc203fa6e9f3e1989f8d721b25ae7765541864281ab42a4d6d44b688a18a06e936ce3354dc78e4f06a62ee182e3dff298f65c7505c51be6e2d39b90c1fc88d26110a3ec1d0c0ecf3e49d83e634830102841fdbb3fb62a3b7dd9ee9ed2464e409fa588dd2296831cf58a7945c862c7d09de642a16f35f8e8a06e3cbde57e771b564e9befe9bd883f2eb105101813e2d42cc52bd362f326eaa8771e3e92cb6b4d5ed46fabbeb013ec9d02af4274f02a375720bff9b5f471eae0e02a69e6662cd2c4d09409dfbfc8153a1ead587a52fdba1a05560c846a70db4a538330c06169ccdcc9b34546fe3329208d7c7a919abdc970e7c2113d8ef09e91a7da6581aba46eae57e0e6b95ddda77adca658cf12d261f29f1fa25eba26c2cdcd8233e82a48449e2c738902e9531c4175b28cc704f35eac601c18e7cf753aa02e90b3e12019f3aad8924e8fc6c012253d3f8cbea5120ee49397ace39ee279504ef80994181a482a2aa8789385cd6a6483fef4e6597e68cae69114d35b9fc170cc07c89772e7029ba1c7b1d27d64c2d17624b04d99a713c74aeedf4fa850a600074c8d18af0ae574af5e88440ed3855fd471937105235b13deb547be10823f9dc227ea181af1ec92c38575f673fb0a7719b6bfe082a9092558bbe1435443e327624e9bac9829f3038de4ea3220df441d328e435ef4c69abed5d99d485b13f98ad086e6164e1d3d4b60643c7446ae530766c5ba9553f3f9a77bdcf403217efb3b106d56493bafa51af323223ccb8353fe7a63b3d376a766376c2365aafbc51d0c163e758dcbe2e202e2166a97eb545a893c24b882857853b67eece02e90b8e02439fd5373d8f3ffea77ad6537df975ca411b6d2ce8098f38d0d4fd52e00e4f87822b484b51df48a580b7e11a555248daed2a828aacd0190e78f79a6177d95c195a2dd9dcd0444dba2f120317717c1cc964ec4270481b3ee052e4eb28d59f0fcf0437188e7fdc677cb57579443c81dbd7bbf87de6336e3404f220cf4715cef17f8211b0597371183592de9b6fdb0dae5bbd9cb6a9892211a2fda96928b1dbe9bcd208e7b9fedc48ea60a6ef3eb63b07d8a8661f9865883c8dea95be29fc02b16f0fc8bb273189fe52fd5142022b45d23bc0264ab1e9ee4c3ccfe8609fcb6724ad3244dfd77af6ebbe457e3a954a7f68940f5cfeecaab7f7f45e8819f64ee18938643fc40c6aef91c9c120f80586bc4a4f62ec825a4b53ea6cf2ff8d0aaeabb6063af385df84c7a5aa7be3c39ef9fdd8a3f3d90a31a49d43ba645809161fc72a41924d1423ba87b084ac67776ef89395b596288db1bdb5a1a27eadad4df58c8afeb34eaf9c805cac8127e9f62f7f1645d0c692e2fcbdac891ba64e2fda2adaf6318037edbe688d4d0ca2a0e3d0892fd3bf300fca4e43918be47908c771d5ef27dfa004e502ab4abb6a19ed593fdb4b7a51e42d8c7b17c06c3434c39fdec313794e7e301393b95f904f397b825f0415ccd6667469d6636b63462234c197d68d8da46038890bb131ce15e69565a438f13a8a921dc7a4d521fd0a53b4a237f8b9d90d4f7ebd3d463633c88693996569c55c668e5bd60662494302ae4eb8297ec2dfa23ef10491b07f6f02a524c3fee19b628ca49346757db66d5a40bb115a92ab4cbb54af9777277457cd7cf1d661acb30cbfcffff1060e05205b50a1e3aa702f69a01321b708675df5ce88f9c3d234cce0e5fe9ec6f16ec75fe3149e836fbb6e5fd069126a53438a4b6338a50aad37d57bae8dbb32909125b53da059f749e6cd3e00d2f8601a4e9304d8e9cd9a2104780c45679f80854a1fd4b01598d586fb80d91695b93da99375a1c81a8dec47621846d28a7c78f9024dc2604e2548a4643226b03f0715bae0cbbded62a6ee18acc4ee600e2174f7b1489c228daebf640e969930464ad5e29ac2a5b016e48870510b147c172807b43dc82c13f0cda588cbb092897a9c7cb4293e02cc634083e7a05b562e9c706fb48f64a337e5ea042a4809a5b95d632852191b01915ead470a4181487812ad6893f47dae252f5c2f4fbccea1b2c8aec2f464902cf6d478d8e1486323aad84b8c7a74c82d370c600d5f5d08aa330068afefc31d45bea5c5c1245c8d8554de422065b88e1b054969c53956663a7d37fcafcb1998ae9948a03a06f6a90aa2217a383f02846975d6b1edbd4778081c4b899f7c62addf95fc258042f9976466c7e160aeff2a8dfdfa2b6c0552d4148b4face0b2d73b8e4f2c0c0616da6a9b2e8b932844be1b9ea5257eb0560b3b9184a76647424a319191e67c23ea78ecaf5947884284034b684120a30fdba7a0cf6f12da4d201b23b242b03d14b01436815eda62f6a98e26592470280234828ba5d0e8e21ae7ea43d67a61ef78d6425d0aec6cdb61b41fd57ef427410e2bdb9bada1862e0a3caf4babbb7665b6deeb77ee4c27c43cff89431c6ef36de9ee6a456949a8f06aac1fe3361dbcc6ea5caf1d09623bfd1aaf06a850461c9b1f215e36bedad70ca02c56705c367ebc76266d87ffe56c5b7b21909a56f6302fea73d57d8cc17ac3544b565a3664b241b8eb2b0731a80a91ec412c05ae49c35aee0853a28e8e9986d0859e9e75263aa9ae94d23688bc20928402657e4d6bb0b9a79cecaa2851cf0533f36bf409dd642fb5b989eeabdb193b06b437694dbadf2d7d68d494a0f13b9104ce6605a8cff70348d28d0abc05fc3ee4d719ca5cd6027b14353813210baf172994dd09b7736a61399e6aa0e1a582266d67f2270d3d97bf9bd207fa0626d1a674443a0a0ea8726b7971f6c1d92d466372471b7ed39beceb89c04b29b25b0226b9f9588036843c1884dbcbd46fdd07ab9903a72b99b6825211f435a4b73fb7f8df89d5784bf31678914d07315f45f672f4c305dba93a8713b272f144ae4c782df9a920ce912d251bdfb7d798b899fedb42f4fe36bda9ef4c8460e080c4d89ecf5992f0c0f686aa8586824b8e0b1ca865379d62c1ca9be58ce53ef5ab8b447bb5b8116b49594121fcf9b321c68b590299b8d35675f8c02f85a750dbb08a81f365a4430c9e676b771736b0e50362241f681fd2c46b09770c4379c0b55e8d96975648b180dc7591a50cc521eec5be678ff5a9dabd6f190213d3bc46ddd48a8b981f9a6b66390bc297bcbecdcd39326b68669feeffdfe408d93e96ccd62280ad3493746f3db38141015c79369ee7a2e1fbbcafce86d4aed2a993785a8f13725ec06a7388c21407ffbe2a6598c7a8e78e9fdbb7ac6c918b7f06d2d96f1d4e657e22a5cc9775bd002137e90180d29c5fb4d03500b4bd253c48d9190ac2c43e30a7576118733b6e724114598f268b590fd22ed22003519cc9a746ad3af0975898a33ad7105c9ebc132a0bdbb350510d91f3da3af4bf3959efffab2dda3f375c8cdffce4e1ba65ce14701285c2fdeef251e9b0c8e9bdbfedff8ff851be42cefd825ec5cd81ca11bdec52c5f357a6cf41e3b0f7dcee61eaafb37cd7580382b3c84cdcf46f22be4b0d6a3fddb3b6fe99f965d9ba4b8c8a2010dbef0922a7c713f31da069045e4875f9b3c94cbfad7a2504dd34cd7961fb035b5b419bc42c0c2d0978ac9c204ad0b476def750f9fb8ca38edc485ddb6ff3b9770773849a8211665b73d59f5171a706ee085a35658b6d6ebccfb78aa437bc2d60733db3a3366d4e74a9d3f39f6fe582a24e3eed15fa36658c55214000e42e7c026e3db2920efea78f242c335233280fb7e6e3212a5d89fb842802d07e06582359388c14f844e426c0424297f28c19178d54671ac9b23af333194ba91ac6a45dbebb309b6f88002c66c25c986b2e305e14a99d2476a65d1dbe150b13c0da6276a3200d58a751ab4ea4871e4bfb25e59069aae324f094b724e1915e44306601b19dc15dfb33437b6904acf6bde7c99b8015c14a162c604e1d67195da8bcbd9f0da350fd0e1a649e82762a69d0e594be6e34224b8f4800b31e1e336484899c64320c44dcf6a5139c460c60392fcf8d288cdc0bfd03be0a695b3d9f4f09918d21789c89a49a4e2a002f9004921725bc78ca0cd7942b5db07c105543f2a584d61c6f3c571693995aa0da92ed185e91c761980ad608ab1691482d9c72b98b59c67d10a5c1a8e667db16460033554d47fbe1d77067153605d48f0ac6319d29ad315d7dfa127f8d21a3b30415485df34e470c27bdab636f240ed4249d3cb72e6f7f2e5194ca1476c621d2b87cdf09e2e434606bb0a67a51de2b6241b3e9818b5a1415d45889346ee4eb182492a9ed34c0faadb79cd3467aeb7debda0ab591452c63dca582f61afd15b4ebd06bda6386767af37d9870623d7f3f6388b414dd921276870dfe24befa538886ae597d3c8f5ab80c5584fb5c70deed5dcf33881b3ed729102af2973b690f4a21851a8e8a931f43f5a3839f9c2cc0f0e6991c30b8d58a880747cdd374e60521245258ade93eeddb61dfeed89a0f31311dc6dc7e47b27af0ac368de7f23d8f0402f018e48324b3755b8d6d3d06a7b26a3131b4eb7b245b7c8354fafedf2e2343652d6ab4b721f591591b7ea560a00b995e7451292821c5e8f2f6a6ad82b0ad86fc32145437733d882296061eaf2e60f6c4fa8fceeee5866496dad12ae977a93fbd44dd81801b89b7da64485d2eaf1ff74bf10da7b43dc341a7938fc6f1a0c0e679b8f77b47b642899e89e8ae3db96ae84170c2ac073d921fe9cd00b6ee9f9296decf616b3cdc164d9624497a659077e96bf9af0a02fde22794a2ad9eb242b7d1690ea82cc9c8eee6b677b9132813037286b793f5db2dc3c5e609252e55aca77e6009ce7e076d62354e6d44013d4cc4171e706bf98a1172df6426a42e327867edab3ecf1b7335857a0969378130912785292896f42ddc6f63ee2b86a34343728eb0df9ede8d4b3b41d3f211b57f7c80d0c5a53dff95eea97a40dc600f85466766fc63a49a507c7f1d11138dee42738f827b2256935e94347f5f44ae2210875f706f4c33c03189654f947fa424cfcb40fb8c1b88015398c541b3106f6edc7bcc03ea66b569bf52f3d65c3b80479b6598e91889612b90bd0dfda0d257627a7a4f70134db7dc963fadb06c8f1854f157c48dd28927897279a5bdcc0bc77fcb0e3639ff37a749ab9f23cee059c378eff4ef35a4d59de652a77725a9ad567ddbe3188e8282beb11f4b56170f184a9338a2401fd0826256293b97ff42c8da2ec4394dcb2268903f2512057140dd56e155d1d925f3d76f917b35b31f4dfa935ff769bc16f7c0a06cd999e68c69e43934ad6964e45f75b1ba8bd64ca133ffb9031a52ba49bdf926531691adb1b756609c06728cd844c6fcdf5dae5ff89a97d156fb8611e6fff66f552f7e03bdafd8771b378aa6d0321a6ba6908b75bbc08d7c7eab1195fb3cd1dae8fdd181399eb1366854864b802b31e99c38b7f830c661ae6100288894acd7b9b0ee1a330dd17a07119cc631216a1e54a17c573dc1e1e960f96aaf6a5c85edd50e3b1491319256d3a3f23104f2538b0c91539950ec5e9bccbb3d89b9a99b25a3c4d81ef086155bc6ede1a23e3041f7b0210774fc87fcabf295bf9de5dbf23dcb7ca0b4e351b709ee42aaaf8137200cfa8684352b36a000acd36d28557e1fe2e8e110b9975a069028e66ace03acb4176a826fb30857c53d7a04e50dbf5525166d426b4ff2ceb2d6cbbade9043d186680cae566f60b9bdf1c55e8ba45c1e41dfc61bf92e7d5d1a626a8d14a2f72b7d5a3c68f83ae5ad0952cd9417eb25bfd7a3ccfcf8714feb47307b8f0832935da7fbc890925d38933e21a81324c28a35e678f44f4ae01d14e7e1d1ac807f08e733b8c07507f43e767afb04a621191a91c97a9763195181efaed23cc8696ec99114ea5716a7eeeb14c56c20bfa4bff517c751ec8f235ac8c2062c560c981f15a2dd11d0c423fb1877d1e9d84d37939a75192b005385f71a2aed6d841c13e3ddb117e5fe211bda45c1d286622fb0894d89151e1d47dbf3be3ee0d9e9fc2d80fd3c4b251168d669dba0ce9b76a820fed871fcf5d3b672121108679026f2a8c3af9cd9601c408196492292c09eab4b9c00d8d23a41bb565cfc848d6a933978fa55db701d207b6b312eb41da4520026e0712b1fc9a2d7e702d575c4c9cf7f2fbaccc7f524d5a2d33d1744b95a25ae8a2ca7da24cacc3e838dd53eb18a39838e7fa65bb5e5f06f890b74fc8f523216f97b1503393270177982eb9b0839f40a4f1fb9caa6f05540910221098d1f3b4ed7d601fbc4dd8dbe5bdde4de19fc75b408d91c096b9b9251a7bd053709e3b0955bacfb4ed1a8844cd950230e1b8457464432abb5d62db14bc70428394bb769574777036e3df0960ef4cf6b9dee66fe6b27854f8b76df77963e4f2cc65b1a1e60ca55bce5514eb821adb80d1c6a387b5b464e26207e6b37490ff109d0b9263fe3bd21d84ae46d0f1dc6ac0ee1779c183c9afadacb8414274791b01c00d5bca93f63b4a6deef7acfbb617a8fe857502a77e53cc20696852b5c2f343be6d417788a794af251b8f62a1a00d250fca5be4f8dd2199fda46cc2d2b268892d848de611c3977c41158fe20c860023fc90eb2cda787f9eb0408b6a15845834bf288c6b6417e449ecb02b6d176cf71d6957d4569dd2dae78d117275923975f15160b22862c93890f4d6963fb2afcfbfe4d9043e32cd94bf9795a9f490031b7f058818ba76e85851bf05e8d04573d3d0eafb7f88096c2deac7732c6b8c0f0d878ad90331ad8586a54b192cc73004cd885cbc6546dd6b3793ab1f5d93330ee9ca363a98421aad11e8585257959d13dcb528125b46ab85af0c1bf42d97bf7d491eaf355e70f9fc5947f1dd0e7f2381bdebf73cb74df92307a9210bc892094c5d0fa25432c385033a33c5edcb4068cf30d16ff429d984b737a26e8e9d4dd7b56dbc948aa28fe83f6b5818a4989e51c968eac7ad7cd6f6bd50ccbd37781b4dbb2c6a0cbf7f9c8854bdc462b89be0c8e1b732188425f21c3b94fb9d064a1d000761c478a67c97405f2fb34f30bf245fd41a55f202dba108187dece30bd546041242001892001d8e87cf540ac395df333088592710e567cd78800cf03a6ec3b266967a541930b83da2897b36290e8abfb8bd632528c13049ab7de7ba67ddfda8e4e0709198e3d7a422d42b75ac1853d697d5d854eeec122e42acde44e4be2df7bd1e03b15bac16aa5ec6d541470d8de407a280c30a27f5b112543c27a64cf169dfaf47528b2bda2616674f9c760ceef32895f4a76ac9f5f6781798d7effbc0da131deef235363740c74fa97339e199f8f32803bf373aa491c5e57077887a503ebb2ae502799c86691fcfdd8d28923714cb1d968418dbc446bef9aa007dd76241d49422a0e0c3798cd8b901602928795a400bf43dccdb3b8295a3be6e802b2aadb3919e3be18a86a4b38934deb98bc2b561df884166b228816bb4fd55ea082c69f1e939f949b8676636e43645f0fa530c57197fc1cc0c71057d544a77a89720a0c2c6cfd7237aded1a48fcb818b9a4a29e719a1c6de8147bc58b543bc21252904d6492fd353c28ceee6902102dcad925b2b68c4c80318b2bc1778c9b2b8dd4ae9be9b571e2f6380e4a78caa1d1769b9775f365893a5d393b73a937da19547df475c69586fb5ffb50ebb87bd37f577b5a4c81a38e0831830308986da9749eb4fd7d91551dfbffc3fdff32b6a1d50464b29854d85261c359879638a781b981cb653a28ff98c517fbc25dc0d1d29ffb88cf55dad6f1f9f33bde7e0e28dcb77e6beb13a621c1a21bad36ed958542a2e839505eda2de6a22c0183a73c1a8793aac7f802d370af0f3b1da0b91d3920b247e958621d61123d0768bceeb11104cba0cc2adcaf1c87cf566259d7821c4c9d163ce308216b53bc91413ec30c055fcbb283f0a7ea1ce6ec2423bf3d7ab6077f6d79c6687d4c9e56f0d0dd01a4e7aba83395753735c36c7c6a325351546c2c00e100f219fbdb1a2b19508f7ea843d82e598ddb57ee96fffef7d166a65c95d6ab2fbbe4e05361341ef84a07f4136d80a396f1c62fdddf7098c8b275fa5ee5aaa9aacff4afc6149020c1ae3b760f5de1345dd6b5a743d844f71e3b7725a35f15ed56ec702b2c9d88c2c11023d6c790c9f5547f49e92f46a8f3b92ea1949c861d3a40d6d28bd12a0a133f530846781e46048d64d3090fae3efe22a38e3558bdd369c96343ab4cbc2b6a168956f732b7bc39cffd04ffa0098733a8fe2fd1f6691c1778480114ee9ee59be14c4ae3948524a3e9a910712e7e5a797705361af8310d22a0eb7d55ea304ee3c84fce4a09c190c8231d24c521b3586f61a8a7b84e7212ddf67de217c448bba33720804826ffef8824c913751ade66db7239972aab1e24bdee8e020d7181d44da2057eb87e28870be345243e7b0375d61ec8b6a06d3f84ebb5d9823c549ff79ba6f7799def4c074b7b8451ab03ee7f60a7632d92b676350efa1f7bbeb580c4f3ddeaf2be66e11751991aecb1b6472c8990828f7d6d9c6e3bc2c00c0e6aa1b7586ccf7d9c066669fb5d341d6856939612613bf7e5d4865b12bc6294b62aa8a0d961af260c571391b1383a232d816347b59daa9fa881cdd0d4056774c13a6c451fb56cdad3c1e179bf0291fa63c7b687aaa6ead0bb1024471c2420df1b0943e0348a584f322cbd1cc79e6970aed927d3738626952287977df9e58be5368d2b8814d7bbfbacb84268a80b57bb8edb2cc5c3ca675d937000cc324a0fdd7dc36c22b4c520cd0b56ae0c939a815b4bc9d46057fde41be6b850e658d634ff9268e45db297a42f57b9891ae495e0e7f5e65721e8817692eaebcd08091bd59c960824ad16feb073ba9c32610b0681bbd38cf9623f6a182eacd7eac2b0231adb31f4e3f56f87ea7080b59c2f6518bff2c84a65a09e9050a4b50044a94e0a2a93c1e0eef74ce552bbeb207694eb6d0e634829444b2331aa851488c6afc13977212b7604d945f3fac26c2d2bd72b13fceb557d0a6ba7e88f2487adc5c91547cef9be48d0d7675fa9b1888b6c062d4f7e14239117f6b086aa72d4b06021c9d3ad6473baba1c37570e98a7b138655c393e534910398aef19bc8275d7f4bbbd1bd80ac2fa6f296ea9774507e05a7b602457420496ea8c55308a2c2c27662afb55310e7c9c4aec6129b1814a4b4ee50e0b155ea957d4d41e64a9a716cf9b64a5e89cc2aedc6daa700923df3c3a2a281860156c20754767b61535e8906002d09cb0a4d46dfac74a506e6da8a11552097c74f609e697830b00ea1c5d4d8895f73e3c6cc808cea18e114f6fe501e87df5dc0151afe21924909cd38cc1d9f666b9fba6980d97132337c895a5b59fb8cd680b09cb4df5d3ca6d33dca35a18a99b1f01bf0f06496086538caeccc75651241b7681668e0877fbefcd50d56dfcdbe825ad49b39de2f1b21f57a280207ef92bff1fbb9c532e055fc4e17bb7188dafaeea2af7f82f4632fa1931278f945efc2eb59193b6c3b3570d4ab3420724be8b2c3891c41e73c934e19a8b1a677c009e13626872bd13b4921e885ade857bca16fe429d810fceefa9ff4a91f419ff1befd74cacc887dd1c8baab76b7747d11c72d17dd744679f9e84835ad3ca86e3a04a9e47925c731ca68e509a0f1d2198c64af92160c7b4689c2ff626e00b7c54bcb639b0f347c953b008f8529be480e5d8bf19edd2092a52a650419ec6c87b02fb6c40c671b099f0e8a12d7a6fcd8517b3ee8dadf5fb73f8b08012d107c1fd176203a4265c42a247df5adae87f5c4c59af9f8daa8fc2c8b5e1fe9dc414cd96db3e03dddb1c3e1b4cb8057a7de510d987d995157ffcb3511f6558c46647c912859e6b2821b5352598bec8b19a00c65fa4a9b83b1f55357070b6bee844dbc24ae170cc3c7f1b80d0783acc412d0ec1628b5fc991aafe317e1fb21035a6cb66c01c1817dafcbbbb35d685065bea98ccfe27449336e877d29dce946c0a48350d3d3850cb946edab5887cafffbf05e58acaeb06a3ce93d675e5d0f6d8687ec880f13054eb18f93d622c67f2a27fd4d970fcf605c6652bbe6399d5e2cc9faa448082c98ee09c7c58a48dce8cfdaa99d40b37d17ae491bd6275d41fdc3394022b50fb06b3400505f9e42849c94535e703b169f18ffdbf77e205d302afb0452f73a1da48bea6116d4682cc0ca918083b9490bf56d88e98f2217c60043b57539c7913fc8edacc769b6461bf452a446383ac3cf0d19a127a13148fb49bda7bc9c339d7f6c771284c867eae784667d194c776f8d5bdd4e137d6101533e97c075d4bdc9e4d00519f9b2eee0913e479135b71d953d5a9c7d2091f0f6b22a3f4bdd7928c962bb57abb8494e8fba0ae11e8bf712dc38334f9e2e15d0d2388da8a9eb82ae7d81f4bece01d01c66eb236a468dab837637dc96e17798eb664d4d0edb3df6efcc28a21b25e2c654b2ccfb89e50ef50c54656f56e7b2a9b9c89aae81f1164268566c15687656e7ba0054231c42281900e3c4308483ab04fc73f3de2c8fb7fe3d767fbdae9b8b500b90ee49ce775eda429be1d14bec8bbfb384999cc14be2c4db99937b8b6a7cf0a782528e3f15856328132a02e11979a934d116556204522d18b690bb83e3ff280b3e4296ca9d62deebe5feb7bfeaf03baa42903fcbaefd9793b6299ef5d2205cc28156f52cf5989d80426005d4b97108edd441f9b78dc2631051fd047c34e4f778d31daa5ee303be4e14510a44d248e0349d7b2b46c58616ffc0b7d2679a4e7f782faeb9d131dd6cefc6ead11752d8fdcce3c4aca6ba2322f2498a5314d6554da285b3e78f6a8540c20ce19d7b57ac73b182c574f4c0bf6d256102d0dad9e6208bdf03b6ca6212ca63a26b966281c01102969785f699e6d6574c44a5a794c3eaef0f40d7bb74a1798b10f9297a5fb4a1ccc956d4fb15eb66cacbc29756985200de364e1cd9941d786bd08bec1ef7fb7d9986e7b86da0a7e4adcbecdc91e0289ba4fb36440ef11cf0a8b6187a73e46077cfe8ae6d8e9b8623fb3528c1000654f74c0b9a5192036c6aabe59d471a9c459aa6c1d0b28532622c2362c37755cd379f2c9528c6885a77791ffa91263828206702fdb935bd6d9056b7d0f7aef1e0b4637792687f414980bb137c952e8ca487c5079aff1570ea4b92a7507102059b2c00048f64dd63727f2e2e99b3e8d74f609cecef9b3f5e2f2febe20ca07d564815e2650c4eb36f4bb7b6f62d27e80feeb6cfb018f013aa99e2d8b5be5787c38bdbff4060432e06a22a8872f5d7e7f6ba79c4cc31bfabae6cd7ae028aae1c1086f81c3c170b4ccd53e8fe2f4eeecd909844c08b5c37d39d758b0b62803d0e729f19f95bd1ae019c01ecc5ba053781d313f6967db9dfb3e2c8ffa57402788333f836586254e96e61b87cab3964f3e909071e18895ecff6238fe9fdeb9a1f6d75c3f73d0b1f55d41b43a61d15fc173a1170a1dc03393b6ebaae2be3860d96a016c7f2ecb158372eff54c729e8714190c6b7acafa2c630e334ebf6b9321750b07bf6f231b4f7a36a0edb087db081aec3f4d73dbca64a0a4890af05a874f8efbe1bdc0c3240bb94d97f01d18e066372200d4816e287411f699d8a1d4de31227d6452341762bd19cac6ae8c8675cb4bcc460d0f152c00d464c452734ce2762959ace6f3c8a0494cfd0a0ffd758b0b83143e10fe8963f1ce7d109a93c831111b3f9575d5692c580dd4a8d593d2ec4471c07a3781aad06d84a053c371dc321bcbd84d102abbbd6bb1d9ddffcd92be79de004039c7e0b0d6e352513b3d9344d4d573389c708d3c9b24029455dcdd664670a9a4ab19f653e9bd08a7e9bb318d3976fc13a50b40f0416fe238de5ebe847c94ecf6680dc5d57e37e220943a4233b7c46eb9ded93b7ea15c43d5d1816421e308380839b924c4d64965b5de694b5fb58139115010d7d480213ab9d381d1d300d4c7304ccec5304d287d25f065139ab6a5289e2ad1ce71006928395f94892eb1d7533b60e48595427b741a260b572f2b2a326e93687c9e82767412adfd6669599807d70bd7ce9a5738c05e931d32f47c1b23d0dab4fecc710804e331d7db3fe6c44ebca6943eeb8f95ac9b1c5251415bb0f79e58e8a0de5ff866d2f5beaf70a693c6c3d7f9967e0591fd5465397116f260837ebb2c6c5f8ed672e3ed7615faef978f74268e6306b15b07ccc48db48c7d782b991307332ec5590441c76838249cd07b284599ba95258e25ee4e508c28beac1e4f92172f4d154f63d4b9859f0a9cbc5e91fcc5e0e4c3767443ea1ed00ed4bb71bb7678df3eeff9e6ceb3fa8691a2ac1991dbd9e11eb0248675cd05ade7cb2ad4fc88d9f05339b944445d7b8f8d932d3720a23496b3c35cfaba097fe0328f46086038161e387d9e5944c28b49ab0ccddd707cf9e63091e79b5c5219e2564852cd60d9943947393647495651b233c672b56315b0638a498dc11e8bace29731ce83b0ae60cf1052c28b24283755f28bd3be10abe26fd5ea9846a124cc352c05b59af9a95238f4f3deab5b43b8e9be8fa34b83a1c3e4b191957464547e909497e33ca52f5651a04d748121bce4ba8d27da011baa7dbe9e5e88af805060d031ef846a4c28871821fc58bf792a11dc7bf9226fa42955bfbdb91bb9390f1badca93343304aa0bc2b6fc778f9093c424bb7528eafd1aa262e5d41c3c826f86eff00d16a7e606a91e1ea39810cd4827852f432ee95aabf585872b3d69a25548dc9d255dff1f4f590e03042ccee267dff25d7a730871d89b208ce4541f9c8b9e959df376f60d24abcb1739866553b3604cd657c8f69b17e1e95b52da50352b6a993527e0150c9fe23b58d14896a4e88f386d6f61fe6dcea616fdd5411ed7d0d9a2e656d596a91a47b2332f17d0e6ef8ab8dd2b7de6a3f8aefb1227b514a42dc3437f64b1a6535026e7928c64fff271d6d874ade2445c6b200ecdc6505d49aabf5a45e2f58966d5cb2613d8e7800c5f6545d5392ac422fff7c7716d00cdb1984a1d88ac58d2aedf260ab7a926a2c5038d46761173e246abb9484ddf49c9c81ce1c6e55ce9488ba1ec74f5f90538642837a4c86e46b91196e4b5d741173d973a1dc52f4c7c461c6d471453686452f5985374d4bb85569e7242fa8787556fb4f0ffd752c52f29c43c6ed9bc6a1b9b259c1d64890358beaa0fc4128296c7166f03ed78c3b2ca2cdcf6706f3c23f8bcac71cfc3d06b53cab3228f889c4bf195421ef45fdb7fadb8694c659343b261b2f653cdea29422a735c3834b11f42d05919e08e016595b5cbbf6b64d49e4d1346cd67d459ebc91206affb8a40440ac4b4620b8c824e7391842d7d20d3916a26d266c0fbc6fc96ee3a6fe9a92b36d283d6c6f110e9d9b03bcc418bfbb011bfebd0dc6a1de45201865134cef19c2627917406978de88bc9d2ff478e7e662f7c247472ad7bc28e266bf0bd0e4b5ea985c8a3a1d3c1da3142cc371e8fce46265a60e1a9a5bbf59d5dde767a57ebbb0f388ca078669ae4b1cf0292fc1ff9448492b80a19245060836b37e8c895e90834abab57c3b3e0f429fb140a062ecd403e660de83a014dda2b5bfe8aeee07f6246f4cfe538e8dc5d6f338aad639034e9751383b1a12b2c8890024aa002b9b66388ba216867bb19e98e8db69daa00ef141787f0ec0bb9f7c2a6751241f73d2e979f6141dc15512deb504d7dae5655b0d59ce162cc68fa5327280a0b5d89dbf39b53950a75575ae435c452dd780a4f32d0045f36ba8b0828c795b944329825fd9a5c907a9ab16734b0dfff8cf449c1772b0893fea94b0f3042a27194fbcc18677f1eed6dc3215709adcb019d13c434b88b2d468a9a3c3abe2b95c5932dbc4001166768c86e54074534657fb962e8dc818bf482f62de99da166f2745de0c5f6ba2eb9f0b9a5011bc252dddd7af8cdb8432b3260075a19f6d56b4caf76a5440835531a4429a08f40746aa7f4f1954803d71162808ee15e31c814ecf6ed7f7443701f4039aafa593be3c6c9f157a0f7dcd024d13b143287b36cfd465a5bdb529baa396e566c685b0b73f2bd7cb59e38ad52804be1f54eae6969b1a205a76aa107bd1a8d7cc31491e66e8fcac31d87b4daf68bc1f877ae05bd2925369541a1da3f7b745821483ecfaf7a77017115be5efe8e8036ab833a3b92eb5e72ff9950ed5f44195214f1a6b03998369e783e6fae201ea3e3d38155f2900395160f2ecec656cec9df1c5a95de1f9433979bba00b2a071b448a4825a6a5504886565f309abb372463787e84d0c9b2adb0a9a4a563d55eef27a41eb1d8bacdb72a605e829e72e57b6f5eca42a2428b41620645d310e547865f3cc795d519d8860f17e91b8b95dbfcaa94a6ac85853034e07f546772d4700a2cab0ebda38437131b4f0781efb4a1876484c5f47be6c01ea065740a0cc6288c545f8d9c79053ba0f4739cde1d17c24dacf0beef4f4703d09a111506ce9f263e93083ad4c9e20683721de00febeef907bc2716ea3cf2bb69f8139c0e5b0371f88223efc91e9e6494017ac82b84d0241a0a88c14ee5ddd3945812701b53c6569c6735ba44d28b667e4b3951b260154b2070526e675a802303bbd9b66a7a3e90d22a95543dfab6a8328ea1f07c4a647989bd05ad734d84f39805d28c60c8e4a8255422397505bfc9d8eec811bc7fab2368689f65caebd2be2c1bd174af34ec67c49b64c9bdc0580d582dacbb19c2a40583fffcce56988ef49323acd5b12ffce3b77daf60db2e819914c1fcb4c2bfbcf27ce85f56032b4f9de7836c7fd50594b76bc214a22052b5534a028ef4c7a57035202e37010508835db12ef1fa2fbd58fad2773d6b33e3d6d7bd937040cc0154ed401be47c82d79bfbbf68707684f3351576a0e1073d50858ce594fbad772e16edfa976059eb82b361039d99511caa637c3aaaffac683fdb76b7ca93904c89d20215eeabf398959507046dd5e1e90307d98b25b0da74b514efa09cb3a09813bb34ea9c595202d4d544c44a93d4683c0330ca4cea336e7d9077744a73032b42bc2aec2d0451857b4942b283145498ac4d0b1de086a671badf2a2fff6b24d98a81830cf5f9dc9ba1ca6a760cef5dc4617019e37fdd8c9ccc9ff07d6d24378b502de3cdfa643cfbba348426bc3d704d468860e2d161e66b5999296d0c95dc64bd22de367d87ee2273cf39f26613dae8e40f89d2f34646d67cde8033fead8693f71aad8afd6f191463e13428da25c43aad0fa635efe0d3f3356bd6b823406303577725eb684c4ccba8df774224f3d284d66f7282c9085c6ac8848cefb6ecd0754ba0ff5051870a7e9465603e72a3a4184818dbf09f09285f03de6d47dcf77fe9dafa5b1c0f35c24aa26ad32e4402b1d3715e97be3f592d0db8454e38fa83635aa9a1029fc066be8e41906fcdbaf688b7aabbae943322b23977822d945e58346a83ee29b00f335ebc00d8b5238beee978b1cf5c1dbd92fd4bf55b8621254293a19bbae3e5c517cc972f25f77d7d0788a61580792114c681d49aabffe6038188a006060f1035e5f77b14d6a2fefb5e9a18bf5811b91944cb3a3e3756113fb03935744da6dff4dec71ed24bd7a2899bf29c6505beb08ec6b85c8caa83b8d91ebf4e9cfb3efc10a9be6b12bac0d854e99f9b23b008b8382e55eafbc22dc64e7d17e412f555413090ed3e5583440594f98f32cfe17b1d77eb782c3ac36a1d323e8d34a52e73a8868bab8b4326b3673a9c5a77ade16d41de7e074ac8ff2928b534cbebde0922cb1e031c166bf5cbd327125452c1a88dc76c4db30aab008ea13fc7152a0d23fabf683f0747110d1d74652cd9892a9b1c246a29c2ec9361ad75e25ce176f40e60ecdef5028ca878c831ea14fad8a78ab4358e23bc580ab681580ab08d8cb6422a364a8d18fa5d58e358b63ca538d3b372e7aad4e7def546b8f26aad6d97ef6ece797597fbc47f55e270aac104dc81d8e8f1ddf56c2e912f73ce0e7c34c9c1f301519937580f470007727eb7cf8b3abf624ebcab967859e2063a2d88e119da8f97dd6c58ad83323683ab82ecb905559cdf280517f346408890b8a2e17c5170e76ad796c16095303e53020c9f9634587f48ad676952351e5927dd6f3c80a96ca01f1c8270cc3bd1cbe7aab6fca6661abdeee8094616945517078af5d1302b64fb55a7706c1c79c385831a6e2afe39948c2aff29fffcbf87ad009f9ec1076902c01e129e6cbbcbea83639634e7aac695a46b2b22a3a82be46ef1ba3e5733f95fe6046f4bb97fab390f3d3aa4ab87a8cf8d2b305af79a27593cee7b0de96f80074ab15cd955cc118812f9e77c9fa85053244d126d8f15a0cf3aba3038feed41cc581277cfacad113e0a9e7212ccc8867d4bf93f384c94ca78d7004c008b8c627528442e075b5d65491197f29c31adbb431ac0c43eb6227646d67078d93593aa36b027ae8d951fde6fffca1dd376e4a5a367be04b27e13c99e502ae479770dde6d0578380b302f02aed01d30e6eb0ed2e6a72f94257e1569d66b5ee9bb235041d43a3c1235455333c578bddac3d2aba44d3209aebc3d53c9bf36600c20774ed26fc747ff9a3f7b8d8e7d846c2d258723cf8e876ce2ac82d7422aa188d2ce46707de9056e24d58fdc11355fce921a560b5060542fa2210128caa4bd05b463ede884ca0b89aa21dfb34a1a6c4bf8c00c4e9bd8c3039f7c205469bd83d5624a59f5404a705e24987a9bd29db87a4cefa6bb51c819e731929d30bebfc1f8d4eda42c08902594764846e133ef9e3845e74644e6ac8952e8f725e715dc6773779acc1ba5e7b92dea32678f66b3f1bf93af755af0fb1bfa63a35a9bc11a1fdf2b717d58013f5ac6141ee916e26f57a5a75a4eb6dff0429f5772de2961b933dac830d8b2e7745bbbd9bd04920d819dc0ab4486ece2315ca062c13687f96a147f37a12a6bbd1fb2d02c4fa9c3fca00cc2162abc866694a5e3a063b3ae77dc700fe8a2c52fd283db59d64b1a2415270a3e68eb3c11c7276e0aa639a3023c1196574189dbc00b7c2befbf15de691b2aea1e2b9a11fabf19ab36df9a943c000b91d65c49324344ad9305ad603968f064d6b4fe21f8a32955e882281668e2012c89d0cc04a60a7993c8816d59747b045a0f576aea6e28a843045ff1af254b9e06d31b490a25047edb08e8e9ec395b68230170e6300a9c0ac5f7cd5c074b01eab22cbc9de407ba470d77b3d5b02d78f4be12d74ab66c52f0cbc7918d8e6f0caeaebf21c4369b19ba975de8d14d159231186d4fdb87df133316faf3fe14fa83ac777096dc93a292315886ac1d59b7176f0c2299f45b6e5086b923f3a38a2a37c79188ccc0df87500a554be7174d1563b4b0d0a724ce7ebe1d466587c79e0011fab05e419624cb9d436b0ebe8210f5c182c3ae8d671a96f2eb43c04563623397ea8d62ea3e4f6ec0168779db3839a90f1e63faaff690e59d5d0c80c5b07b925da7b79d8d8b23aa260e79d48dde7b50620d8980c454bbd65d00c154d0423f51f6809745457dc5ed5361fc5a4467b7b3a4e86278c9807adcf6fb6c4f3038d4c9ec81a33c832537045e25559ea35c84b54dee2b21d4499e2de381f1a5b35b6f17baf72684717a5aea421119bb1d2926b96accb41af4a4c75a6c3bf291b442e13c0a5d4d727596240364cc0c681501f3819c7538c8b5582df74a48e6415a1ffbde6fc5955bc4dadb4ab8e9f18b388231f5a68a869ceae9fc3925c5026c2bfb40fb0cd2202b4cfb612354147b698cb04a759a88c6bad6376eda2c64c453cae4bc848b5d88525c41f503997f35fbf95866fa4cdb99fd700f821a2a775491892c7c690ea92fa73bc3fb02a1d615478dd4b0e5d53c863fa1f996cd6b04b1b3588fd67db66371c1a09bad0214ab263c60d46a418916107793d00e5520afb0be16cc644aa1df05d2752d5a33dcfe4959c4cf9dcf437c05f45bb365bac162cd6c1e608550b1c7b5abca05573ff780ad701bb2fcfce7f0e079095350fe79d664a5da913b811583d7b250fcb3e8b070dc74cb49151a4baddd1f828680863d44b1331bdda893fe1b054223d9feb00f39675fb9fe2079b0993749cf40d0578278ae1501f02336b0763e9e1e68e10bc30bd61c4ad18334ef14b02e96fc72edfcac8e397d724b29b834cc46feef61a5ab3489d7d7ddc056ad1cddb3a302538072cdc78d0781a2125f83ea121b9388fc2d566cb022c31baea4c9c68201ebdeaa884bcb5f92534ab980bcd10401aa69d4a30ddc112d9541c93775c3aa1be11dbd7ddb968c278bcaa6439869a2119b724263e4da5e0901549f648c8a3212617b2a9af513158c2f1f6ec9691f4b1e5a28476ae0dfed11d66cbc96f857766a10e1f99973db037ee7e01faceca5ba029820e0bd9ef6dcdeb05f0b7508c4cf3fb5c15cca2769d0916b78eb2f3c25124d76c3df8f00c6a41bd50b5d07ab063bb6a4b15d26e67aa683954339033cf4100d51b1c2c58f63ad837509091a865d60afa6cabb90ce516a77efdf940927c9dc22ff34cdeba12a2afd61e878a8cc113703f12916ef61e556fce615e6625502d92fc78a84b174913c01161586689533acd49ef7e66d3ab6fc3f0414dec71da59133dec17b33a303620cdd99d2a950041708344072f4bb281aa113e65a3ba21b58904f67cfde690fefa4eb2e5c9bde614077c42fed0ca24ef479f04eb82748dcb47db70c5ddf7516d75ba1f861deb006b31b26c978c23b6ae4ecd61db509c5c012ed2ae454edc8100f9f5031674550ba44e32234c920c7f71f8e631b871719a63df6301f22442a47226948631351ea760aa9c16cba81cb4acabdcb05b9062d487bf0f91da8e538dc327150c518a6dc83018b13112024360b2e7bbe5ea8b51c3b679c018626e07ecde7aec37f54ba2a10b8126799bbb046581dddc7e4cbd489d58457e566faf714f65b2b74b0a9f55322e2a36fc09a992c6a4afa69e4182c7f71d734162433c6d250a29ad8845d006c82d16c461231a73277422091045cb8f0e1a68061224811035dfc8d3f7b7adc70d9302c176ce51d0165a336345285c60a69b53318bea91827ccd393353dbd7ab879715350e128e91abec31f0d7ddc9c5dc514648e1bb264591bbff3ee25a96a256559ce7beee89fa3d88dbf4f6ac3011496887f869504001229986169056a73e3479f768d828826cc0f0d4d49746c07dd0a712adad4cd499800a4ff6455055781e4cb6d2f45f7498acbf0b010f1ff8f3b8d438916777903cdfe3828a3a61a3914a6a55fad404e6d0fac0b72c814b1fafdd4987a32898e8dc0f42a9085b96dac82d3eabd22e199f503cae4a31aa33018f793102029944b1203b8cb81beb8160061e05ba41bcf90af4f295fd7c03cd43a5c4087a1ae793881c0f0b1fbdea9863515474eb3514d08831d4aa389754c819bddcefbc0594a762ca782ba1fae04c06a98ef96afe9ae3c8ab3bcca0e3f5b31fc8556d69261e85f5103167c882a6332894b2c5480ea3f89088e6df515a2a8586eb82fb70861e6d6556fa03eb75d58f609c6ec1afcab2174566f5cea79841b7ae5175b50a5c917542aaaab0e51b791e0d0d0dd8fb70ccf18aa1aa7afb9ed7f4387b01259f23f41512f85e0288f4c139001e648b3ca201fb0b8e0ceae36273ed65dbe3f1872b0e78e4f53e0b5dedc24eea4dced4c1473910895356ae2005756e21f7899a33b4f7351c78d857489c1b0fe0fbf6b16c20da5949810029b4b1e1d71fd4657b3551abadeacdb7d707a245fa3c7ebefff34a7841aa99b41fd9d8815219dbd6223ad1c2c98a8beac945967a6943d6887f7d2c9a2d5a35d61f2d31ee6f4f70fb75eb728926f89e18034962086e81145322126e9c6541ba51e7b14ccd7e62e6a72085cd96a3cef853ddc3368b613f965d7fd7653c7c721a52cb5ec97f75404e9b1861589d1ab128c53ecd14815fcb86a9ad7ac87479e2dd237e8361fd8d3493e6c1866cbb16c7d0544911f0621e348dfef0542ce752ca0b01424412dfefad1a42ff52609a4f80c7b3dd4cf0a27049c8a66c6f82f68fb4ee11e3fc034f6bfc20ee61c20f1411100f5a7f27fc146fcd368d6e3976ca4276ddca3b04398c28a5d37b5ae4577ee0ac9d233b6f37c88a3d246d9c845033aa16327eb783db96f920e940cded31f58845f1d98830b9177a0605d9e2ab06d24d7fa37e7d0a7ad1f7798702d2235baebe6288d625db2dc9190a76acc642b0aae9b79681d02b4b2371da5189f915897e3f4ebc181d1bbc7fff700c6232e7afdea6270f9abe7c746e3a8d137623698ae0043a9247d360f9bece3188a4b3614fbc493debc2ab1a16fda3f543cfde6dc26663e33f516d73e3a76bcdb56724683b69c84de3b134457a1775f6b5a39c3655051878cb3cd97419c5b7e670f722dc4169883453ddc7d6a862ccbc1ad54af0d36868e819a697ac45df7476b43f35b7b1b145f02499fcf4f8f2c6bf84d63cbb951b4d739f6748f2a27ce12d8613082cd9e3a0cbeebcc8af9714f3760ca9636cdb4b79d0d1050f7c7c8e535c43116e514ea5574887e541969129fd379197d8fec73cff9c009ac81ad9f5b8e7dd0bf6bd60d60d447d5b97cd258ccfd29d442445373212d529ef17dee7c6f29638a5b102ecf94589cf5b407ee99f8f5759bfb641adf1ecf7ded0a86523ea6f9a04122d56d28768e2b668f44fad7d99f1948284d013fad00298c331419813947e5b8356dfc8dc08f249b5e8cd9e43f034b5843742cae66bf5ef98b88608f578bcf7f4c6d02e2cf607a6085075d35de869ca5baa071ef4cb0446669570857a819530e80b8f7de21b649f3bf5df9c72a155b0f1fbebba8685e6f5577451359be56b7a07f5dc4e3124c0fd84224d55749915550139412cce707febb16605495d1b209a213a0b77481a9e7bd8f220eb622bb5c9945b0e9c9372dee7088ab95f8f03fb429267073587337b8f617540511ce3a740ad3e3dad6e7b25ce9948e3670d34fc577809b1b6ae06150f4461da22d41cbdc981e40e52fcc47315f401bc5fa783b17eac4cbc8a3834f96e5cc1c2b115be9f3c5bc520e547994a3d9f4b2dbd7bd453fd798163cbf6907d0b102e88daf32d35fb26fd0e8f234a077f3e78c473f3afc1b7cfd0f543301b3598398380886ce54d71ee691307c3dca7aacd6b246f555a8a309ce542e5ffc756a7c3ab89394208b53b88d030c44ef56850ff5848f6c4465616b9ddfea3817da47154afbcef2b5db5ed900a8086d7f83e80c1ac40310d550bcb74e3517be2805e4b86e43622e6b555edb17f8e09ac1e20347db39c668a83cf9ef53e7784eb951291943f8a969ed21a63a87c45b12001bb11384dc72014431d68591cc5070bdc5720baaea3144ed7e5149a0fd96c8ab9ab057bda2ca7df5485acfd948ca4878f83cb9df79783610ecac1c257bf9fef87c293a0fa7d65f44b65cda17f22485006a82213bc3653be90c6628e27de2216f555000b88b2a009b40cbdadd91fb920c8fac9c95f77302f810ae53b39318498041c01e154283920016647453ff04b6cf5f77c1df8797603ad3180bbbeca4daf3947d90a76b0081197ebb4d26e4db7fbe06c3a2c691cfd85089512633dd1b2ba50fbbd4f0167d6f0833c66a42fdaae86d6fb3e5c40e73334d2307a3efcdcc53bc97e7b6bdb4341101bc9e5e6da21f17ffda2d58fcc178a93a64d35b7f78ec57268a671abc6c52b1c3ca07124c8ce42e47848efd8f6f48d466a3c30908c56c2bf5ea9fdd0ec4b56c8ac3cc82f39d562afb5084fe5e0cce35ee6bc740f2db2ce75276825e93bc5a19119c4c0118606243033c922c71da3d6ec66a15f54567491632716b1038bcdc427437acaa45e9262d04320d4324339e0dd91270e6de887ab2a520b8b93aa438da838f5f262ce4ed023a949d6fb937701dc8f2e15b5494c26ddd2f9ee0bc7bdb2653f1997f48fa4bdf93dc8a11fca7c2055571089696539a4b6d87efd197335f069042b40362d5aa1c4512e10bc913f9ea5a8ce3b34e17186373e13928302253de645f536f067146baf1c9b63fc2055aa2e70fd0e506b012f8bbfeacd36a4fecdb7962d4a67e723e8469924df53b6719874275fb973bbcb693176f02b24d0a4310454e80cbefcab2a4dc620e31115badc2fa7457a37bb0b8fd7c40e0d7f45618aff861bd519bf1876606b88151ab34bace2b5e159846121fc03634cf116fb28831b6dfd63b0a0170dd20d13092ce41cb86c5682b4bca60587c8a0c7920cf8d6366bea110195db4c07e7c2d290bae694bce6251b839d718c47c3e8d191ff563989e9423c74dcf09c438b0b98abc8ec0622bdf0346dea5a9f9ae30173299626024cbe54ececab8fa75a42bcf8b9e77296f62be64d79c350ecb7a00a51ea87d88e2788915431622fd253c9e76a3e60002a824b1dcdd223d77fb6982c367d1b4d3cf4d260acfc98e4a5aaaef3054666cc798733345e6a2ed234079cb1d3be1e4d9ecd20e6b7613ddfecc915aae44ef7d41197c6d38c3f9f33d2f1b21b89cdc58dc9b6237a98ea21894a7683a147d0f647ec525aea59de5b328e1090d3f352c4a30368de369134d4b7817d9d63f14ba1721436d2d4e29863407b63fdd831980a796ced39eb02ce723ed77c052ebf0ab17e2dd2e15dad32caf3f660e5cf5179d0ebe3b36004fddd7151fcd5a8ed17f269cea34e7a61d15fec3bc0ef44b8a9ee0017ea5c93569b7508ecc0bfa83bea4ba7e85be1b609a2710f8d5a17516b10cf22e67232efcf2071657457b8835eb6c490d7bc73421d5c610ffec662ef5610cc1b645de7b82c93689e1aab9f4505e4bd36c866952f88911b7c63ee34ff5bc41d6d9683acf8e15b5cd3f5a55c729caa33cd451abb005a11dd9e0ec1dee97cee080284afcb681182895ff29d765be0e80ef870944cdd4a08bae3092c6238445560a1560b33ce32b53cb76848b69f022e34c65b4868d399d674edc652d907aaf2069453ae9744a5c6b0ed78543cd9d4d2cfb2731dc92d6ac9abb06da84db6728f5cae420b748c1a572f36ed9c1ba61667f26ea825308884d59efead8d04f3c2793aeee29cea425bea5a7aa41e44e6524247a21122898f6f349f9778d6e7a9ff46a30b6540ae436ccaa6e9a0d5a10bd1efe6d0b1561e6f32ad0f1de1eb03b72d855627c535360e98f15429ade08cc8c4b6c7d24d08ef99ad10a80dc3b435ae2ce31f6a8c0780efe5e81f89aa683ceee1ea05d5cea7570b04397c6fe70985f5600d09a9c509c3bce2af715b109a2746dfb77d5a69a8a659fe2b626be815ece3ad80c1e8a835645675c4e51c49c20d4675491830c04339fc337ac8885eb3d5c9cd2989be0c244d363e0168213289e1eb9cb164bca96dfb6d8647230a77cb4f7733202e7eae316212026e106a266d4ff27c6f6bf199fce7eac59a11957bdec5d5c4e37a8d26fb9650c948298b517be53f3ba66c6c33ecfce4f42bed60c6c805f0dc702dbff8c349c6e23e15936a6e90f4b1d2bfb496ef253d92089cde606eb292199f5ccf2687476815cdc114c96e73f153c81febbb7de24d8e1ea907406321bcedb189e4def1dd4c678a3d258700c05bff3a285ec08efea55a92851bcbfecab499b3164eba3101e3dcaf0e084c6374ba6d619572e53b2101c63fbc0732c810f688fca484bf0f8264b4e8eac0d0e2f3b955df054429a073e6cda421a1ba3e9efad7677cddae881f90cd232c5c8c687861a4807f3f5b4e0fed32ee862aaaee14d2c73a889ad920b973b0cc121bc86752304ca6d3b88606fd5343cda52bd845af6cfbc0eec87234c6f5c4afc7f05fd0bc0931a5c18cb46d9a358b381f534b11d707be2473f9a2e2e8190d3b3080692ad81ee3743b4b582707eb7560c2d3a30f8cbe6d3e54435578dc051315a015b493f3189dd3bc205e8b7565be2cb45441eaf185cfa05c7855a76fd717cf22aa176417e955c2d2e845800f9655d50fcdec6961f457a4f518d5b360cace6916cf6972dc724620466c33d6b35ed2c5d6d20299bb389a6cc88fbe079dcdec555d0bb4266f21cfb3b2054a8671cd99db343b47edf527ddf26047f85f123dc73587d3630d251331a14e8b7f882ab9ee09fe012805a6ab562aa6187cb72bbd79d302fed439c9b654f499f86974db4fedb848ce6f4e98c35070ae834f5bd5ab0b45ab9f42763e60b6ebe64f68f99909fbff4615f79690f323719b5d9141805ef5b8d37f4be6afd96daa131db2c48649431709eef0ce43fc8365534b8332e202e9cf5e9a839e4f47a75f600caeea76329132fdebb8ce15aaec874d795fbad31f4e375ba03953631d791a6056e3c58940b7e284676089879f064f5c3a1507c3f85171acf092ff6b3549d4b0ac30ea15a14d8d379201bda9580529f2f9621dd3136a3aaf50c0b982a06b29a4f00e21dbabbfaa7b8ec7a8d8bef370eb141fecd5b066a75cbc9330fe8c2929b9f382518759cbb0d9eb24a797de30c7367dab95946e6396c603d26525d18ae2c5df2e234864065939dcc685a51b8fca20005dd34ca80c110c7ae5c02745847c7579c3109c89e5ea835b563f886d13f49e11a2e3d79227e258945bb92f11c167f45852af0496baa901f8e6f3ba4d32798d038c4b90715f733af9bcb95d297ad1a4658fe56c81a86ff9a7e63728e0caff5254a34ff34f97e0283eeba586445ca45333bc145c9c669ad420973c643c77a935188eb3ed72384aac0bcd5143cf88cc33b4e7c71c879aa16d5f8fdb4fab2316b148df585c52bf2d0f4414b8435f943a1c844873bcf869f3be3ba8ccb5cfe642197333bc4afcb97dca00427586bfbed3fa66986f44d95c968c4919563f434c938609c7fcb438cbc30dca50e24d62243666bde03149bf891fa6a7d0f1e9f047e5839d433eec05fe712371175cb2e1ab053d5a1505e54288cbe2e79938ea640a87a29d1077b2358c429bd00878341dbac97673c0a3943a48a9f2e64b0b412ca1681d908fbd02fb07916cc1df0a09eddd485e3face9ad52bac8730342a0004c4a0619dfeccae6b33c49bbcdf1cd5c6692ce8ea8c0c6e8c8f982e4ee90309766419b322dab5d6c38be666aa66bad1b4b62794c9edc546bcb1dfea7cdda574c9996c3bd80c8bea0ea807462fb214df294c163da78b8eddbd26711f5d72bcfdd995eeb0cfe96e84ed0d06b5474ad7fdea8964cf33134e21e2e09715077c5e4aca160bac658ff0e62c14299fa9c408d1d0e7b03736d5f63939e3f557fb26b95dd8b5ba277fbff9c41e49fa7ed3f11059b83e33099d17250ebb9e8000537cd485603f0182d320b74840030d1310b240717f1ac1236bb30e59601f77f8dbda20a43539797e6c2cdb4911d0fc5435e11d8d0cbf2b844e2041dd49cfb9e21aaf1e9b969fc73979fc6abe9c19d2780d68dea9916f16537b88e6646aee4f84ce55fc0f7626c68a9ff022dfdd2183e3f09f74771116397cd59d0c547a7454866ecc2ef69953558ac78f06890ebe88f762f5a5186a705d42258efb03e960e2a4d81d92c6c269f0eb12fa8628f4351a5a26cee7c274b98586051fb9caea0911dffe46d332a8129ef0bdb5546288775f3401403551618ef8754a2a1663ce5f64efb0a69d1b0af45b83fa07100490b733272e4e138bdb908b1d491633f1a12e2ca94f3dc96b170d715a77cb884f02478d4176e910fb28a3a5245e33debd196be54aab864b52449463ecdc22e3685d9bf59c1ca2c90b5508eacfd0ce86c55a0832269499729ca7c8cfac787aa47a68aa0ab9a601cac41c341a270acbb93f405bb04c300584d0226bf74032140079919b3b40ff8d17b012fd2a6b20b4d44c80f86eca023aa75f6d7656c04475c5135eb0daf6c83855e0c6daf8ab12b9530cdbfbbed0895592fdde98eb5e7ae9163279b16e4259b9aff9bcea1db1efa6a4187f9b2aa3b8a0dc4ab150fbd11d6644ab793794f722dcb5c39eb85f37ea5cbbf4b6fe893586c4cdb9730d0b8f49b96bd37c3842bbe12b2c3e8199f647525786167176440e20217f66d4458f780386de8aa71ed0a9d1ea4cf33922e9636a5d49ea77ab6d15879fae51b89b32a92849232682cf9e24135d0ea9feea0d875650d72af87728620b98551026a80f82e9ecd6cab029915d97b69275c43a99476a89afd25cea88ebea7a8a595a9a6725372916313414a00a9091fec5c1e38cef20157ddc11faa5313a4c0ac90ed59dd80c6c07de11fba9ad32542bed068ef29ed140a4beef9ae1d71d2fff3e9ee444662c6003e610f0119f3f7865b846e00befe74477b00e574ace02e7517ee007ad14f185849c70a9a91ac728f075a31e4051e600c405eae6829334999b9045126b049445b491421c1663e677f0f1e2f97b1e47cdb531372563638b7b8ccf0262d3bc24f279b128026f307cce9b78d9e5bb3aecfc0140a1356ef4b30dbdee846f9042470feb67b1125f54f4c4e87c39b8a11919825af6a00b9cc11f1aa37f4cd92e1ef329beda1d35c47ef984eedd5167ac36872bf11de96adc4c0d9aadfbe766b38052498c1bfacb0548d04e438cd51a1ba37116b7111c6629270ba28c8c4a3347348c27b0db82e9174feb2ee0de29a98e5eb04778bf200193aff320794242db1c5228f543b8083353c672474ab6b4a15635cef75b5e2d4288f0e9322114a63e4c0059debef8b320a1d55305e4f86acb71b43caadb77219f4b596bf555fa99d438b1d1f3b9df7afafaaddea9ba343f84094e8e08df344bbd78cfe90cc77638a2163a0aecd17cab41ed81ff2ca581c30edc0a16de818d6342208e16921c846668ecc7ad12931b37a5eb63a88c5bb39237e95f7f931bb09f96e09349d19e467775d8efccba063010cbfdf8446edc197faf058e2c15d8f92c64164b90bd539163e3489b89a873c923202425999934d4d355bc97c4b648799bbadf3a832ea1944e26b5742ea87b11fe7b0c11bc3ef5690cc17c7f78a9312dc682dafa90d6bd36a78e8d6815b1f6b2336ded75c2ba55c864cdebed012315e74fc9fa8988fc96f6c6a3eada355063d8532ecb5a53e24e65e19c2e5ef42845db2251edd58d6132a51c99e145532579226e8bdae95802dc98e3ddf82d5d8881891be76454741e72c39781a0872f5e88d3414857cb5a0c2cd0eda2a3dc4b3bf5cfc4ade8a9dc1a211abced22464b04cb1befd4d02e03ddb4147f1ee579d7282d70d56a087e00bdb8415c4508e132a463787c3a0654f0bb8736cd226be69b9f2e3dd17e4a7290c4b14398a72fbfe70db822bc30a0356c2d3625fc4a4433d534449bf95c99115cc260a00ae537469fcc1bb4fe9965e5bc61569827d24a95750e0eb656b304f0a559b0d0119eef85780457beb177aaaab48591d514ed6703564cacb05aeba1c1a83f19ad93ac845e75be2826419f7343312fe41f87c798cd5544401a1082d192c8ff4415304b479fba56f8104b4ee1c9ac077b8fb56bd7add85c972c443fe6cef923d22be1b54f974fa40415d71c443fd56fef84786928058d820ed1671dabf98bec2d2af3e29778854eb38cdc4118dbf3c1e02bb9760bc437121ddac6dd90cfa666e2e74d3bccc3814745ffabe1b1fc8dbf87264ec22f597075fa9f993829525402dc2e6f3246d42cc415720e1612b607c2169f3e05602398c24482909c028ccb41855d2dd24a5895bd887002d33cf270d21e27d54ece6ca5acab3f5e080b914ff489fd867519f3e0382c6f82d3376c200fbcc79155808ec2cec8a77b5a1a8647b55622319fa4f0ceafa8290117eaacb37f899ed4c8da7aad33757d1059c59823ab0e264a77bea65977ead0efba096c3bcd749cf5dd349c0d6b90de91b21244830ff8c0db0de2593750452eda9da73e74570b7ff9a4fc0bba357b42799dbe3843079b479a9e98a4822e4f4e0b87b74f0daf796fc78416b147f5bbdc0919cc8753a7d90d2524442b84e17878e52f0ada8c7a1e1e40871265ac416066288d7a2f8b187b3d0857fb305b0143cab9285bd0d76dc484dfd9ce7b34eb6c00d97fe0e72740706e04a1ff6e47e208f4b43c4406400b8b1b94758d7b9df26833ca02ffbac37e35e398ebdf0df8933749c7432836acc79ad57fcc42e206c34dee0aa43e99721d23f48d548c8e4a37e09b72b2409dd5682fab01a917e66367cba267563f8d7a131e733ff584188601693797579fde64914e5fb86503851c1c6a37cdd5a1e44a005f7c14dbcb459e3e82b8ef43ae1e0c7ad0952c99deac8f837b6c0b2ff1d86e7656ed7d2c8a53e80fb5f8111cd594daf62f070ee06f77bf692f49ad982f28a9c4e2f9348e692da0a49f9fb21ee07e273031ea38e1fc39b67ae9047c18989ee09270b66e94dab965bd994fbea6cf47288af3860214c7bfb56d04156bf4b4f8223f5717c7b0568bea6b1a05bdb052470cbe11f199f1814edf4b2f37e948cc3ced989da2d15aa7e42922ad405d4dec24eb54c1a682085264f5d5aeaa652e246cf097116c2c886b05586b0077e277d79958a565deecf3bd975a85ba915ef582177f638eb4ef8d28b70bb548747f5f39b8731e23ff370bed381478b30c4c5030e1fd06786a6bcd1eea0a0740b831063f1a2d1846f42b4be4e9746019a42410033501109c8a21cc27cc9088a448955639d8b42e0296cba419df2203503b4c9d12abb0c9990c51638333cfb5e0a7ebd36e166277c2937fc11b670263fdf401efcb9c05b2bbaf2f2eb28f34c8452846c9e7a531c4ee9eafad4a131e0859b75911bc60787549a1365d634795c454cbd6bcc0828fec50a6614be569131d74efced8bbc24919694201e7291df3d5bcdca9458dbf545ae8187e3011fc20106196b062d6ef68d41430938d6fe465bbbbd0d2a0e9a4ca2d5546c190ddd5fed009791a89957807192246aef5184909d68e2b0d47f05a695cb3de5bff1609cca1d3889d7e2c36590be388d6bb5907a107300ae78d38ba6900b3a11ab9f910ba6274b8a89e3fccc2a175480a0601b6d3d70cc977695afc8d615508c68d4335f4025185f5582b7ad0e0d66b21d87dbdee6162b38eb0e21bfa270c68e723021da6ebfda5b078b84233d05ec2b3f84c2a805a65510bdb70a85b495a45ae2cebb499323ee82729c0e39023ca8e9ea2e2b45d536b755a9d4a24a622bee5732215b02d4148c0dad6590db673eda4b7b32f9c73832add8deff0cf4d08455be9ba03d748ec9134d46b4d49798852e5ee14b684c4a186e438bda373f4b6754bc2a18417bd79a9f1c36f9cbf2dee95849def11dc9b4cda3286874ae512fcf9918a171fff37c29f74854c215884b9cd2f85263fcd4c1969011e6f807a912182b7cfdea5873c9830cf3cd6111c84a032075ca2cd0ebfb296e122ac1802f7138c21dd2a7f1d10e35e5b8542ff355fd74c050a5c19a3bcb85b166d64ce5f9ef0e4289b6c97642c1762371c859060e08325842c605175179dc0c1b54ed031a390cc8329058ac55df4f18757afa9608e8c8bdbe3450740cac7755d3b6b965e8ae127ee01c8191c68391df55d0f88ac6715fd95ed86cb48a6e37353d3e1f73a6fe647ce853cb88cf7159b5ac9456d500e8ef9fa8c22a818293ca305b1972eb7ba81ff606d32c77cdf75b9e38edd21ff388713e53a2f2d0d9bfc77160eca5f038546a900d26bc30caf8eaee859a07f6bc47fb9572d7b31f72f1bd8cc7a24d88fc98f7fa885fa237ab35855182bd80628b1c685c6c136d41c3862431df5e9c4d9e7e7d6e7f73b3baaa25c2f6346ca4af5aa8bee9e8d8253418766466171802a7ba265c9bb45fbf39a034527fba5538a501ed44c2e5414b105c041edc3e902419c3923ef636f8160728ea6a05ee5fceaa8813587ac395b0e68d7a260e63fde51e68f4661a1d1563e2aea04807e299f6cdfa8abec1dfdef92cf8cc7d8670294f36b3cdc8948e5aa13994d778cdcd383b481c959986cb020eb34e869318f71c2200e741bbe314ad2277cf7f20b41c9503a42a1a9ca9f2b76880a605db6165e8cb273fa01e4ad8eab7f020c6f9ce21b4ddb90f86afb409b332d36c4bdbb7b39b93f2085ab5e6420c7ecc6380db2f12491f1f3e387bb62915d56457a851dbc1581ff0f645f24045ec65abd30b76765cbc7fa1ece8fe61c2adf4e4ddc7b4da4a5082b6ceffa1a9712ee544654a1cbb386eae47af9184c1f4cb8b3bb721bc4016f110fc70bce9dc396c69b7a655031bcda0b30f0605752110b6e3d0d5fb15cbff2c4f2cd75617cc4bbd377120637bf5f5cba86d9f104c196cd5b5fa667cd82508b9cb4022a0409c837309ba08e828990eb02889c7284ee3c97ce74d35a94c3e7de60957521b1fabe68d4f6327cd9c48c85cd0e87701c4ee5bb550ae7d0919d3a6ad637912f4788787439382a1a72e251c75ad6fa0b1871ac808fd42c9bc43fac16a250952de763e0852034dca8f3355f85b45f7c698ce4872c42d2fb7e036bb1d7c3b2203fc399f0f3d5bb0ac2b3a7944d9396dcce5455772875553522d54f5649796fd1f99338358f776f2be7c31b2db3d6215267ced610f70ab42867e982191334280dd8b4f0519c0c1b616857098dd45523f80a85aa1535c83ac1f5aebb634dacf7b3a7c830fae777a656bd3deb200a1eea86ba9955fe1d9a86b1ed1ccf93ff580a98a2829b8e55efd2a221a6022b590f7a7a43f4225d514722681e4861c08f83bf36c67b1ecd2e4612769ff8db99ed0ea0205310ebc981a7979fd6cfbb231969f79ae2dab20c2bb96e18f96736b889bc719a3b690c2ea7a81c171a6e1d5fa8aa8dd208507d9c9555f53d1c93a549ef8a69155cb5f3bd4401b394eff73d97fcfb906d50f03948ba52c72d5595444ac359c8b9cdcada368f3ac988afd31986f36abe5a3eb69556dba54d44c8e5950a343f3a7c5c006f787f2225e59fc6970a8ecd821822ed3cd8b759d567c9b472699ba5c12810526ebd0f79773ad1a8c1c696c030862bff16eecae7f816f9cc8306a09d05e029b0ed3cf62996940a7bac072a4a34ef53453ebf22ef194520f18133c1eff4ac39b68fc9a7b56d7c75fd14fa72b9eaa713e859c527f5ba111162fbdabc8ee328248bcd628f44609361993a1d1dc238a5df6689e200ab5a8280d70869390de2edd78929363998c0a5bd751f32e2edfd1fa0c9d11cb8c4c0e55d00c02fbba0f5dc98aa502881d006157f82e29958ed0e41ebff21150ba8a2a10f084772486cbbdea2baa355249f67aa2e66fe08c24ee562db1a96958b0f9845ee4cfe4e36f8dc794b9b3af871de54d101405e81bfc8525808fef5f0cf7132edb122f7ec2da570443e0521e90ed82aa0e73eb19a9d2410e6716643b4589b2d642fae9c84c056735e56c4e40e10fd6117984337f5382bd2db84ed653abccc06797470818d85fb36c78a610463e0680583885b4290746af731f44ba51681211af687ad909f1a2666bd26ccf433f987da0219ce91d394fd2eeade0a6877c4aa6157cc9308d4078795c02cd84aa6d73cbe22516d1a5f814c1fa6b4c04533c396b5a32d5c2e5a60c80a12f3c6b4f6d3d93cf0f23bb3cf10a869c52538b834eb2bb9fc36cd195cd816f995d63a635aa05b87657f008f35fc4a844eec2e6bc15fd33b8577bb60d16c5c6ecd327626c9ec1b5057742830e6b389a0915d2eccaccdf967f18a52a3f38700eea5a7badb1b94264fbb9876fe4cfae852d646db01a47931be4fa0ac51a3cbf9cc962c6c8cbe8890db8780a4974f16d1b27154991b77523cf856f97ad255254708a2097b01662849aef2a7e0bd74d9e6fd955be8da2753768e29bea2d4ba5ddd748dd970ac2b4ec53429a1b223e39dd5c51a57a20d60722e819b660f7b141bbb075184ad1edbac5fc88968fae01a66c9caf51c9b78430f92b15c44f1d61f212a7f9333b6c70f4b0ac3ed71f04d4989174b078492018e76f02eaa403f6f9c113e0172e24c39806266537a9f76fca0ff79bd575be46de693a2600c7a265f02b9234b462af3592b61c98cbc92d74a29e748d00f3a28c0c10586d7eb37176f9ca93499e53bce72afc3a60deaa126381ece2646b8efcdf42f8605dfda1175e0deffb443ca65a0e78217ca088f11ee0486c4a8799ecefb867d5f8f7df335095c564a642393706ac93313c60f3bbec78823fe0dc2397f638c00a310b350797a7de941fbb42566fe595ddb7ccf551cfff5d8c451162cb922c29eccb9305d25f69bd86b5e948471d105f4fecbf2b1d882ce2346c3cbf4c3ba1d97b86a1ff588125b41d0bbdbeed4b2b95e5dc88a4f839ba6cf80f15254476be93efd30a75bb67afc11490b51616d99b7609e377d354a77aba6771304b4eed741eb0b04aca5aad116e8941934d207e1b5b52af5bfad4308d2b49ebbf7f2358187e440711e7935bef350fccfb656a8580e2752d050fdcde537a907637df6033c6ad180b7d8ddd5ac1e0514a60b5a944c64fa6cea62bc18828cf0b5a53ed307ed91b4aa9c3e78a6e2c12f5f8b59a3cd1d125d17d4ca0ef6c5caa7689f23ea48f5861e31e5b1422606d9c92d33f9f6948f9defd99f8877a0fadf297a7c199864fc7c39256b92caf6ee8205c717b3b0dfacdd05c169ebb24894acda7ec92ca456b067c60257d06216f8f31def324be4913f77152284ed7eb88cd5a1efdee29ddda2ebb94a454555812b1e2fd9e0586aa77ae628a3d3e28828c014783de1deeca8c3ca65fc19287062a2d96ab28d1d1b4a595b3d350d9a0f3aab231ac6c124fec81801fd4ad9f8daed0280b62abf44f9ed37937ba1fb248784770469efa26ec2fe31c27d3a63cc3cd8897ad322bf737e648fad5cdf2446b6b43b361b456169371c0d8a16be71cf5a61295ecd4f076e341fd8befa8dd33b2060dc4268355f326335d6fd4157e28cfe80fe46c8aefd5afb76845f34df625038f334b369fef7cfdea06a7109a3e0a25be3798f5215f6910fe5e7a34d739cafbf0c2571e7d6c3f186ac5342f8e9390e4bfe175da62796ae7a7e9d77446ce945a507d21df6c84b1138f34ecb3bac9b2a4365b93c990f5159e4a299aba93da057c8f396560a07959ea86dedc9726db25a6c25bb17d5db443071ea4919020dd0f57dc57e1e331b1ae7f5c467228fc4f293c71792993b1fc864a8e9a52760666dea9a3b25380c553ba76d60776a2cac8ddac4d6c6874bbc576eb60e7072fecad0a536468ad7321f174c39b7a59fa9ab0698203481955e3db2f27cb130cd2c6097d7c049db9ea2be984864a48dc894001ab23c59dad6d3b08fc85f86076b9e68321f7518fe6b13ef540e01043f40c001354574eaa06dddc1e98b1c94563ea9dce5477a816fb2bb75693210c10fb1d2d80406641269f27e84b001d8369cf037f9f08bf127a0d1debcddc216539e455aeca61d753820dc6440569ff45f7ba28e0cc9e44fbfaeb13b1a847024986f143f56df488628f5db6e8689835f944351115c4980531d3c064d57e66fd1ff517785aea796b56665462884f4293cd68de8ec6a9ab7bf50b9fac354a7b205704aafe217047d3024ae355f0511af839f90b66c0ead52fee0b9c4f5df420e6b823e9851ee09ad6ad24aa0d45d7cc34c85212a8042661052f9a356294762866d7bb4f7f517693ae8bf7c89163608fd9a2fd55479df76c6b1a3972c7835760b116b30abbbdf86434caf8267df9b311dc68f5f78d8a5ef60cc3b46a89c214c40bafdc3ebea99215125ea78acd12279b1853f61fc89d21a51b070f8d88792069e2fe43100df04584b311a00307458184b3d5bf6fec8f3cc1c22adca29d2b512b30f1fa809f3f2303aad64901d59091e9e9f8b7939c8872d97788d7cf34f067e6d69ddb3e49d74333687c60ccb9855d7327360a540b400bca7fadd2549fe2eb48643a6c83f84b5c99a31686f6a0c23c2b8589345486979d0759c8d9f86dde2ebdfd6c16fbe3c74e2f89ba9d32ca5cd920cd26f6ea765b10e687f0a9a4b7c449902e8e70c59acadea61b8ecd11d02b5fb862f821fe5353c27e9cfea43178d7453e17286d7e16ea8474f9b339f5f21e38b6252e2273574f0d10f0703d8fde242e2a77550a875f090b7547bf918f765702344566fa4a5224f2c9ff80e16f827e64a0622d7dd779a6c5a0bd6f80938176f29aafbafd9de368da2de0ea92766367e2f4b18f3d0a4b8173510402fdcb1e166a8ab9ec5599b6ec4edd33a4fa72e57c83ad2c9285834276ea9f85d7ddf29413a19b8eabba6fd49125761e3db4cb2c714dea46e6f1f3ac5f31fb779a62da4e84e16584abbe1135e4cc0d513eeb95a292e971fc2262ce2c766d28abf2ad858f8803d0949b089a87d34db874a4e1eea9280196df3a809d904beb54231be170780f4f1f1cfd9b880140988564745f2c8bb2a8b90786f019c5563b4550a1214bec89a6667d34c7b750401bb1773707bc8d7e19e9413e20c84c6e07aacc0522805e0c8d7784c17ce3806d8a3cbdb9e778f79bc67f0a213f9fa8dd183814317cde4e207b21f1cc5d5c2fe52190cb8021e8591b5bf3924d576a6e7a4d88b09a9dce2b2f06af8f41780f155b330c7d390e4d87fc4b2780ca78514eadfb56e13c0ad21ec0a20ba74bdc9fb7960b8f917bdc8188832c923ede46ffcf8caa1d5b9aa6e59b0f926fb889f2fbde6a13b651d2ad2e8ade622a69f853f6f8a1e993b5ba28b57f84b2ce92979192f3d846892e7ef3667152efb708bc9fd68b076e5ed0172504b6960e2374c77314e285b414bbf45517093ac1ee4f61a9611ab8ef2957cdaaa7c1b0dd52990594d2b85afbe4ddb89d5500a951661a9658e8a4644581216f53447d271bc063110e4c886f411b6176593611544e4df9f865ffc7e752e7bafc0aa7b716e922d956f80ad5c220f9d5f2fab24083191e4a1c00b24d4ef6a5ba5852efbad54349a2bc710aab3fb3baad916ab16bef5288bbf60ef6034ca58a7066deecbb7c7c4025ff916e554f2d77d95172fd7a456baf0011240017105089bf2dd4a56efe3d6d60def5eafbee24a7b6b97481f8520da485f2837f83010bf0d3e7f22294b5b864135b534c3f6103e8dd5044ebe82362fc714720a30dcf53c871d1ca672393d8b77cf02e635be833ddf1941ba0cea4b03f7acf2dca1029c1a3547f8ad517285591c1e13159a9840d7dcbcb7a7de465fb5c4a1e023711684d5c78121a326612e907ae33820f193c11eaba11f29b4e03f0dc4efc517cb4d1ee2f9b47066c6096fad9590f9b77eddb2ccbe40bef77b1c120e7563cbe3f042f2e113b2c6480fcbd9a43a63cd9e199b8c57094d7992c87475cb3cabc216c2176f3e7b45710c1d69ca7a9c1096407314e5ba357e69aa69e0891b8d35efc1888f70f5dd00851432431331d34e38a4ab92693aebeb243221db6d61407d68cd234823d9318e51f0426009941bc98d81ec083d720a1b6c15ad76ef90c96711e2decbf4b5c7e90bef10b8bcb294241dc7b8a7066adb11994b1a0a056c9a7300e5fc02f49bebd00a94f28a5884d695c9302ae027ab69ef5d3d157952dcaf54b666e9e3039683e3e35d0672999eb5a19fc45b6055c777906984251b6278aaf9f8094ed9879def02d82e94656192f6428eb200baff2b5c98feb50a35d0ccd7b1814a388a1c17f7f9058e87ec2ec63a1a5fb20aadfe8ea72058aba0bdd5f2a261b87f7f9b734acf18d817e8e27050b57994b93b6eea97b97465dc04d38a9243c89e68bb4bbff2cac51c58b324021355dc6bf0009dfcfeeab1dcf81863f23dea6948d306125e823b7127db85c1af1b482868133a7b489fb037f001369d30995091456806f89c30143c4112a2d05bceafbda7ce959203a0202c3e63c871508b44da6875f1ed7f636cccf492eb9f4f65627136f469b5b4ad3f6e77b1810931e9a77fd85194c66fb4a8f493ead4649228b2c460ae0db0ea96c92d71b89fd198fa4f4b2c3c286fd737be98b200ed7a37e6441759b5e1cf147b5d300ca253c682dbaf30e3f17f42d22c0bac370e9233fd9d86698e2d545f1815276ac51d192f94e59e8cbb3d661dd509e040f0846e20b6805921caa521fe70d84603b46fdd00db146421a92f8fa054cc425de3e1be3153dfd25dd3fe515d8e8c21be4ad51b79de1a2f70cc60c71f12075d871237a65e10deaf960871ed3aa01e94c9250809a4a8598613bde4c4d6b3c3adc37f3d04f4499ec83d2ef20f3912b4984535a7a59e6fdebb43c1760c79610eb4135f5b52237026f61b015bbc3061ff1e99cf119708a1b66ccb3e40c97af3026c9d7784887ee1f2895e1b25cc7c7665507f29e1683ff05ba8d154a86cd53eef370938b4a931829d2979d8111e2eceff7db33287d303dabe2704313f9984bdb8ec6791adf5204a0cadd93de165e96de06710ad8cbecf9e3f660253a88b0b37a8e6a9f6841acc265249f9d61d5378e9f568064dfb14b29eb62fa3ac804f706229036b9017e122435ab437b015f47233bc11556e51318ea36b22d9bbaadcb855e8fe05a71b3780446ea41d9bcae41334577fec6445bbbf3bf2f57d085a400550060945eff5b42d0d11b84d83435c0c241ca3308ba7806ed1a5f3496512ace8a90d90966e9a973c63f455b9ca68619e0c196064f79582933616706778676e8b2cadfd9c5e61c75a1e0511fda8b913c09aa54a9a9f96b475165ac9f80bca2c2df18e6fcc74e63c216a19e4693baff2f7190f433375a5b7cfdf9705468548637803f0559d1948b8216f884f258663c5f7b66c9b472d9b0006c9815d4d00e18a46cebb63e157356d813ce787707ebde74b53e744f5e68a290532b21e036886d8215404b52101fa60a4db5e6dca5fe2728f598acd530a25d6ee01171ef6fa79d3091a8ffc5cb1c838ab8367a71f1a6bc44120f209ea924e9eb77f6f0cb39c3217a343f13fa19c4b32ae3f9a073cedcd9ab9ad2d9a9db6f025f5b8def2ac8e394cf785a5f92818b924b1c65a23a81de5d04fd27f2b85b859277aae4643dd033d377044e45e30663f176073b127ab7cca96d2514045e74b9f34cf9be063b0e316f783ba4fd11edfa280e644ad976a9c6fce450fa3cc977a7a7e04927fb00ae967cf2fd07645b2c6bf621a076517032c39551b66e481c78f5e776d8e4809e4d49731e5998ed8d8c067e0ff3c5ed6c7f04b06a84571c4770df0d1b07a2519b2754923a61c01b163e197382a9c924959adcd1cd8bfdc7170708ce3523a4b86d144879b821cc814340cd109e900f4d99a88bc270bff45d5f7e9a0ebc22d0a4a468cd19c5a8273b0d6737e5e01e122ed3149fbaedcb702e29ab345d69c59721b4f5013ee15287699d64459ad59633319777044c9fa99e62a3806e46300120e1bfdd048ae5b70e94e8e590e51796ed162bdf4786867eba18d85e519672996de5b924c95228100fc975aa56950bc35aba693f6b74d0c0b486723f7004af42184be40137e74fd08757ca15393d24477f73a85705ac6419e51e18f3b214b35744112500928a3f278eeb02c262f3ab67c4c8f3d14ccc7b5fdf58d08a094dec8902ba9b6cba9f1399f9a97cff0fd9e9ad647ca3d9314f688a609432583e072f02ddf6bd967d98c6ad5ff78a3e2047bb8bd848306a6cd994a2696a2ea71ae494af565bda5d290d73ae89d300f47735557a2772a45a172a8da08a0e61b65046f1df6bb242448375c4dbd7622471fb2d68744e8f99c34b4f3698249253afde050276c4cd0cf3649e5169adac153332a4287fb6a441ac2dd7b7ec0aa6eb0007c1a07207841265ec94753950eb67bb3f01405cd32be32f1f4750c83c8b6a7d9226845e45e24bf46d77ceeb659378d3a2ef49bbb03b45995bca0922e57d4ba78b7bd1a287f866703bab6524c8f16cf88f2ecef705a8e0f986bd0a31d42172256136dfe77964f509a3e160f8a84cfbd86fca34fcb7f8be1d5e8aa1972005904fdf6a9e12249dc30b1eeb69848a8563ef403c182307d894e644ad258128cafe329e5e957969ed9848b79b3a066c440431fd75effe121307294a85c2d814cc8a5bc58b1bb7d5a73e6b7c8634dee87cc28909491a8b93e09bd693ca9bc4c9a839ef1d7b6503ce73e2809d850d0bbda8542a749f2a32a571be0563ab14522d9a125168f02c199659269ed7d95c2454687e70640499e66ae14d3cc0226b2577f7641c8de0edd4af5623fde48cf203bc0d253ec7375bdc9118d5c5980997c80bb98fb48d37c4f0ba2cbc28abeeab4501a2b786117a81648156e83b2412e750de185f464bfd4097e9b6c6d425f263ad7c7a45e569f5bea8bfd52cfd1324c64ea4660340640652e39af2067f2ed062918caf9b7bd9bd5d5f1b4d22071dd8cf61e0c727a50e4149068a87213cfaee5bf6296f170bd5320250b4d41502f982cf325ee00021bdb249019ac852b0b7bb02ec7ac87837a1d4fe268b60bea849a92e5e4398539b408cb852571f17053dae6c7fb7eaa6f984efe9460a382a1348b2d9b33ca30a9a02f84a639a6ad7ea9acbc73121a63053ed265a59147338c327d17d4960ea6377b53104fd71ab205c410249096d86464d2be27bf4a334f46c553af945dcc6d364cac0f27b83d558d02433bdae95414be60b4e161aa6a67a57b6015705dbe3576ff81098ca2491c41e41b17c622d4bf00dafe5e12a87959437c8303db6e3ced271c14f1b17452e27ceef71bbd35525dde5741544b0b4d246266141848667ba8ea85e9d4dcd026c1e9b2eb9f4ec2fc4679a25845131ee82404fa706f9f418ebd001c1aa49aa4787e42e5b294a9baaaca58dd8f774845c2050386192777e623f2006286eb563aaa58dadf9b124a9f10b6ab5a17819173796f67e60d561a66fe581f8d6832003b881e1cddde94358da62f7ad181e58074c7db129421c45181f871621a0a95de3d04bbe68ba27b9fcaa28f3581d956b6dcc4a50f9b38f8772bb97c335cbb8bc491271c7946c53d97e93785a2c87c3a728044961fcc9959a1ffcb0203513921c9044d2f911569511dd133c286c775de573eb580495d18e26aaaf763b3bed2571cab0e2a5c5fd0f1e750a834dc29d804f8758ef4ff3bb99b96a44b2083760c7016a5fb2d0c7447535c990f062cfa83949f3893d8f4dca6a5af8a6106cdd1783b409877dd00232097bb5477004b207c85ed491c04087cec16dc16d240639feb119d35918a426b48884ab031b8b0754d1c998cdb6ce88027bd5223a4847b83944293a95156bd75be83ed9df0d04be9e4653d0623edb1acd0d233a8b720f3dca0becc0243ebd2bf12f840ebf8dd3bf1cee4b04affebb719c7633c67df6013adabd15bab6f1818f4533d7d5dba141a9fb878eeb4b7ea91ed322fe34c6b4df153149089039084f025700573e437683c8ba9fce515867a74b0d37188022f881990e67be92b5aa40c4088433bc64f80e60253ea0187442dff63a670e1a70cce9a40a7a63e64d1a72f646ce41b5709fad93b0c7cecaee9407fd2ebf4edeba1dc5fba2058b608fd420072a61d37be2c7ab0e61d6be384b05325db12ec6ca46da9a264fe453ecb83ceed2e1007973a43b44c53f35aa00f39df89eccdce326d35f538c2006b3574f3b5730f0a7e36a3662606e4eac3e56de6df2873bd195c36db37f3ef46ca7e0f38d949ed4bc60d7ae3cb7a5f3ed4bc2a58df01a28eb2b885c7d340cff4982979bf2fcf086ae89e3b46b2f5337189b30c23edab774bed036fa1a037c1ec17da1ca90b43e01459dbb3b91a7fae127fa6b289b0fb93603ad6f4d08c67bd710e452881b48ef36f40208fbb1c66d39f9363614ef578b94b67f199bd8997038715887558a1ea158eef4b1b1b5090dce0335a23f40443db338a8a78195a46167af336ebf5d832e806c63433c2be326ddcc2f636453c730a9696dd716187de17212f6b5f5f453ebca6e0151eefc92038faac3976af239045135b13dfc97788f49d5ad4155eb98357ed96b112c7f67b580257869c709602932e30779c6577c8aa76aa820ccae6a45dabb9f9b1251c5f29481424beea45c7b3f6ed688eca73088c1cc6185eb68f789e515f3c2e1a63c9371cd054e4f1648c4b9c2ae0ce800006be10911e5e118145e614ae61f92263a516429f72deac79f3a164ebce6ca34be52dd95a385f3103f665ebedd0aab8583a1f1421821005fda361cd93b9400a23b368a0a4bffc4b20b0d74d32190317175f3e8fa5ca4a09813631cdfce471e7a11dafb4f495bf85b97630169b956c9f7d0d26dde3380769cb5bf5161ad2bbe9091c7df021a29c802a40a4ac6660adc3930009d5fac831c33acd80a2962509c46c8d779d2016961ac8f6298a613966d9d940030af05ad58546887cdd1b064b927cae0e31b6610cea723d77ea6d19282a44c3237eaca25d6e8d7133e1a0c3e064f81492fdc16384a6725ec5c4e20a0920eddf362ed9470d843d3657fc72449d0693bfdb4219974f16ddd64fd16f7117cbe9c458ede261aa787ac2399d189f49aa103bf587f2efcf9744931117c74a88fd0f4c1dde21c51538aeb065e4d6292b8b535b3e1129e03fcb4946a410fbb06217c297e325f5c5ec4a089b364bed7f9bbb6893b3af74b20dd1260536fbc6abff723a93e3cb22a72b508ee772c50795b57fb40daf2a1724eb3476690ea5f6848d10bfb61141712c5593ef4e5f3421d0242555162f9cb96f24ddd7c3d3bf1fe5f0e3140835fc3068cead2e81c947958471fbb9a0e0d6946400d3826d6865be121684196a33dad01724e7e5af8435b1a10e0650c345b3b4aaa900e7242c29a2d966d0c5820b86486572efd6706d912848919e4044911225394d89d5c2c50cbd53dac142c6dd4830d5aa27d4b9bd22505d80ee4d6a110830781b42819eb8852cb8e203f6ba7475e9a530e1d735f49cfdbf1a3ec5b52ccf5dfd725da8c06373e8224351a254023ecd3d85e14025790757ca524fc319afa603bbe405651cd43edb62d7309a82ee7a38dc291725b0a15c092d6a9468e4fdb44d022641d2b329fc4d8bef10865b40111e6da95f93d3e0bfb6d4b31d52bdc48f177b9dca54f54dee8adaff10e36783a61bc09fc62e3456cd2ac4853db67efbaf58337974f5528e75d1a73b447f01322bf5d1efa1f65ec934d773059305421641d6b04c2b28d6665c7b206244cbbe14218394f8f6093876b1de79942a63937f6f1c5ca58d98209343876de1f92622daf30e266ab8457515122b2bf74f461c55b7bd2313729d14043153ada1a4f8cfe152d59eb09325179bcdf1ca3f2b4470dd140f0fa8e3bb29f33f2417ca6c7b4bbcaa4a4592370583ffc902da8975089798e3201b3b5e6653e3769d6f1baef35179edceeb7ef89cb4dcab520e68c2565a8e407a0dfe12dae9c82a51e52c0b851345324cd6e17aa7f7a18b927f0c287c12c195cbb7a2a857c562875f54d4daf40c98dfd96879a383f3f2fe3269b40db364c4a459178f06a5607adebbcc0f3d53cadc59fe4c545bd1cb32dd985742f37f358edb2b57a5d2a06f0fcaeb90f7fa164726d3cc2a8a198f4ff4a0ed05a84588ce861b980e6caf74cc3145a9c45eb97c5d5f5fa9632258dcdf8ac865b11ec6eb4d23caf7e43892a2e04b46b54fdde1d5c7d5c8b9655500df689fa580df20da76b916c1b3f237ac8cdfb44ade2eeee1cc0b92276522026a94323d65bc74f77cea145ee0d66f455c9e68f93905c3f84a637d967e93d17e56674b43d78e77ba4f69f51e73184d9592d317ff39a706fe641d3295a400faea2233cfa9dbadd7394b1e05388e29fb731e897c247b72a303330523e84f8466f5a91241cab4096bf41a7572fe605b73861ca20873fe4eff7d6bd8994ca242427a19642e5f86049068cae05a543488f5fb86288f0c2ac5bf9dd3a58a1479cae79308e21fa9eba7b532c7f3ed6575d4e0a08d73aac5cf647b3d6001656d697c297e8f3d0256b6b1f1c1f7974f81d3ee19a8a23af56cdd10c10b73328344130aec8741d5c81669222773c8d595daa1df3b214e0fbac5201a402e0f6646ab9707de09a38f348bb32a047e9722b6e68bface6906d9a447a4210d4fa86060c56fe28857b1809e4e1601f235c4c719bf29b046de57ead2c40435c5f52ed55e2d4712d559e8ecaf8120189d8507962e5e2cbb5d2aba59432428230b6ff8814651cd31699a8ad8244491ba4c0754534cda96b7df3a24de1bd771185ae1905f3de3aaa61b639e7432378bcf2e7bcb2d58c58c20787a8a4d30d31d90b03b8ef9b2efb67ded56963104456c713552122b50836e481e8919e75c46186f5e0a53143e0e11be5d1d0c90b34abf9bec45df15f4beb9b30d602512e96cb24ca26a949f6b90b2aba8a8f886a80513780743785f13242944afe01ed219bc58181d007905c5a8450df9fb33a29e98e8fa2ca743a19e1c1443b672ec821a57ee6dba3bba43da2a75002a4c24c3eae8ecabb97bd16366203b58ff8ccb862a16b07397338ff7d059ec8f7b449ed48be220e1c28871c76be4509874d8ab06a1f32632b759783682d2dd446a0bc0ac479e55181d259e9e0e28e099e1aa0e9f4e68efea363c4ca27c261c975e21f847797575776d2a40edab5ff6f7b50953ab280400578df78d66fda77edcc63bc4f46dab25720518ac8915452b356ad42ec20cb0740db0e263721f6eea010a15cbbd04e2ba3842cde9fbbc2db010406b9428d6b573276dc7332d38c27faa279c3943c25752f029f8ec282397e15a6dbc85824e8f6edb0238700186db23c231e0262229f9e5b9aba9218bd6267fe76ce6ce60545058b77033182cf98c45ec5d3e721d85100157550cd83d78db1927dff804fa9fe0d039001f6d076420c2b33d1fa5f6ac658064fe307707ad103fe6098ee4dfa111f0641cec7c452a69621dd730d7bae57b3960b574b26c63f7801774a6c951bab385a8a3c83f196fdad28da268f82a0fb5fff233a9f37c9e8a851fa081c94d2783435c180f9535a697e57f131c613834389bcb77d62fc122a4be3d4bba55d5a25cefebbd942fb0f170c3d5f80787d9ec7b3e73936c50927997de949b11e5a845d77e479581d12ae7830df516db69cb2aa91959634976a506e50869546b0decfb2ac82ff2bd9d4db5beffa65be6874ce827cd74459de4dbcc8db09aab951f9bc1696d2fbfb173d65ef2e4f2de7e730e051699ce085dee3570f57d821d0d390e1ca03a9803752b98a66ead16ca537778be86430591170d2e6f24dc9c6d2fbeb01ff89f193453031636457873dfa6621264e21b012688eb1dbf303f32c2cfbb36aeb15336efd1ce2e5dd1bdc2c5bbeb8ef76117024d662374acd6d05ec56641fe0718f934808aa2ea45ee99db1fce17a86f86d24e3a0766ac5425ffde37c3f680d758aff75970b39997ec648a9dc443ed6a949975f2c74826eaf9195732703c29120b5c8d8566dc011969564d8ae1d77e3c977186ddac7206fcbcd365aab925075031f6b7ee4feebf3b5d91320d107cd3fa957c2b24b798130c10de759ad1dd0130d200dacdd46d0597a3ac0fd5bc3a6cab4b9a40cc2ddefd4f4225c83d0a4c313598af363408a68eaf112aeac05cb6804c32b7cf9bb1ce11fd077c0039c6f8798bb826f4b58f27dbc91ed3372bdfb08e4f046039aa2070b1a547dca9e4675cf657b493b8c0439c24039467e667061a9b1262b9945efc9a9726ea8cb86328e6c57ff082aad74306663f9740b58f76ca6986e4a4a3ffdd3bdad5c75c6105ff1bf7588701ade647665ee5a0f3471b1407ff5b67a06657cd44b506ae7308dba610b74e1e0a0269b48ab477db635fffef90c0366c9d872cbb47ec85d128bf1bba1450ec0c64cc090f220da54b56495e762c74deac125bb64099dbd6a54ff11aa3a3c83541bffee1da58157e03327c70d7047c570ef1da15406f4bf1e3a5aff7f0d0b71cae056e5bb1685df962fab4e8b685ff5556200e138f853278bc4aa70f3e9e6fa4c900889963315d40b7cd697b7fc521ccbca11cdc267135da33437331913405707fe5ead8cc43e6f351bb47eaa3de9a945c20d90e21346f3066549db25e460da7b0bb441696a58e478731c620574cb9d78a0d1722061b56091d6eb8294ab92ba2a4c2043563427dd328719cea47b8b0e5b4138c5de4ad6700d415cb102afd208eae48eaf549038203707fb06b493643cec873ab3d5f1c4bfba76edfafb84ba3c487b47ffbeb0b9d563ec620fd4968a3b2546a8448b859e013ea1b541c0b8e9bcd9f4bb1bd44069e1136cdda41d68fae28c7eefbd60cdc52fb19d3a7a7646e06e2f7e6d7cbe0dede3f890745060dfcc92ab135600f598e51c29d0cceff737d644f7ccde48ad21d89057f9305cd6a6c86fa83d728f41d8e96a5eb313bebea3e7ca00276f24dd4c7dd64cea725ab95140a6c189951e8fab0cab37004039fd947199f564c31752d3796159b2d401231686b32ac47f72fb1f3a0656679412b3dc7bb72760dbe496ec08a9ee7a32168d4e40c645ccf03595bb6268e30465bb91cccee35b8392f28fc4535efc8b7bec59b9e56555e8666ccd38121576276b2fce6c14be3a6f69cbe4b688383b870e584107842f9a5e5e43229b48d1cfaf07b9472171244a94839db599c1e23c769a0fd4718a1f5eaa51d86e666ed15d70ca606d39e8cb54ca4b97db5a74cd14011c05eed3ea25dbe7ee708583ea48131f3c7c9a76c2ae1a32a4e0007aeb0fc526f30999d2f72e7e6a471cde8eff5dcc283bc05f46a513b3b9b589095fc90b0caa6d92b838a03fb129d5581b64ec1fcc0c4ae3a0b0f6b4136dc45a801e726c9e469ea52cda63f5c13fbe895de81b33015be084fd1f8036c50186e3e7abd78cba2ca26f53f052bc4f4920c8cd4c678e8c9338ecdc45aa176f6135a04afb101e32a35fd04ff00ca945d11d4c0de543ced28e8cb4bcbe332cb9c50ba61baa5fd32ba1010ec0565f4e5973812a3beea8f16449a365c7f0b007dda72519a38e7f0120fc6ee613ba6e571a5530c10943cd8543eaa736a3690d0fe9baec646368c6689df2cdc5fa5385b6d3a5411b71daa8774b079efca2cea760e1ba27437aedfcc957d2eb6ba08b86f628e602dc426f6e11e04f9ea7d473bd0c352bf418eda8415d103b9f263fbcce3123e50eda6ef1b6ee24109b23a7fe5ad08ded3682acba3948f5b1217fab49929e794a4c0ff263b960cf64cdb29b079c6594511f9c085bad65d493f55231d88f02ebee986f29eb01fe887952da6fb8aa8e7830485bcd72f928990c6c63f4b7bccc189bb7e67e1e2d81e75c0948c6417367ca66c85e89965a84019e89b6c6be6477fc38c6140c4fd8b5412c6c3ef15dc0f727042845f219a3579c92483cc8198e5f13bc8f63995065017f46307cce0bf8a9cb20e3173ab115b3ab1273bccdb0c0a996a5199fb60135c3e0268047522bcf81ee67195a0b64839538d06f49615da52fd9ec3fb249fa6ed3027a2d42e70a6734f4c7d63338f8551e799885f70dbb80c92aa1d8a045da81011db1931a6f03b9379154e0084c11cffa9586e2e24842754081711f7475424a070a303eff5bb6e3a5fdb60a82455b5722c730432d03d87b1996d85d2d2fc0a69a0420c53e2eb42917352d658e8f47abda0e26f139af3314113affa597d7056e92645e582245c9098dea4234785abca401fa1d191da470463dbea8b2484bda1eb9a32403e7111ec51e1891d86b5561b76f492ea6582f819b8c091dd3132fad63d628fe4d995c4adadc71a15f8b84751be097e04af04f1be162627db8adb3abc8e5122d75ba8987d1b3d1cd44c32289b96a55fb0f109231d9ec520e705f144a7e65e2041359cf3f1a9f9648e17e8cf68ae63e55efdaa089eee2bc02e4769369160de4a0766628358f711653038103e0e89e3d9fb747c8792c606a1c3d5e06a26a1c5ea78d6979b69e6a5e090874d45e1926eba6e93fe9ff55617e696e24a7315c498fd3c73dca8722b84d9789a055645b06e23873cbc0bc27c4d25d20fa8b0b714a3b745e69c71fd21b0394bd1eb6a9492340d914bb32907a8f0fb1965da66c29bbc451f68b727f84ae37bc6a0c10ac6c307dd42450327adf63cadd5c5a6df3ea1a17a179b8bfb8079a0ace131a58715cc0dcf6be2cba7618a62de33dd94e7cc171f997da58320bc1713436bee49c2f4ef000de58ba06e832e49b4690c61545c46ba09f2245e4500875982338e7ddf072c406f27f9db959762af55d18c0907fea52c78a5a2816946bb6956c90c3194e6313766f2663d56149c8ccf253c3e59faafb5666fcf6c9d49b653ece6dc85fb5e169fb2efdbe83f7b1b9a729098ef80caa8583a52d334816cb9c75111dbc1b0e631f290d0fe2f1da05c80ec61993121b0c4bb9d6ec0aeaa9abe75abd904216552d2e5a83c5f9f0651f71fbdda6bca97fe9af74b3c64d9794a54bd32592657ee073d3f2cb1ff2e94e01ac4d360c1c59dcf69f307ac3682294fd8e01f077cdf00a3029d605305f147ffc6be46c50e368c9df294c2990c970775174c0ad0169c63fff40c41ec8b2b1ee558fc2366bc3f3bcd4cde5115cdccf0ae2c8b97fee4fe01fce3c8ce5c7d3f0ad94fe0b344b3d73e7a3c66700a7375933fc07f3295ca87fd2d9ce7e28d243a8a2f362689b60c25db2a6366f15408593eace2973eb022f62b181463d164c8243c19806e3619888c7f295c2f794ed4031c97702ddc57800620d3a3a0500dad69b4b7476e390f7c1632fc628ad67e2d28b3cb3fd72e99094c1178edfe663aa6ae2c43e84f50427ae5bbbbb13b17a719998c2a64eac7fe0d38860110e0d1dc1adb6f5338bc9ba85c910a8277e3774a3ba08b7e93679d4cde98de1fc01c6e0d5a2451d240c69ed504643d22f607b50de827116af76255ac9a82fa7d31f30730b5b0bf8ce8621de6214680797c3cfd2450dbdf521da7ab681e328e222d7b2b5164212af7a073886ca56a443aeb60de05391a5602be2706a5cc2918b85c87ebfabfb2d2c7861becfdd995549ba80f8efd1c5eebfc9b6c8f293979b4284e14ee544004ab2d27209b318412e64cd3ca4a46726e2edcc6f5c034c0d8462ab8e060c776e6637355bfd1bd41cbffbc79122a8327e077b635a3f7474b3e4134982e2289cbac19a4f20b3175fc61e532ef20bf70826275fb140176b5a1f8be8612dd4af41ff501a02ff7b3c3b7267af74a8a0257779939bcfec9539795303136fa1cebdf6143c521d1bec92bb37943e5599aa82c5b850343c5ff4fe8c85f758f52f8b78b83fc9e30640d44c4855b86f0b97a2d880c073188e4d60a56dba1c0db8c8a9264c9f21dfcc20d2b2abda676a14ff6db392edfc9054e88f2c41ee76f3938c20dda45053a1c2f50f08e222c704c690f3df62b07fda8ce87211a504e0fcb6d187ae8b8ddef6f0a9ccecbe2fb8677b80b4c3c38690b9fe48243ee847e5b64695cd5e419df44d94976b7cf7d6c7c5aab1b60b68a5b86e51501de30679c28c37fafa4ebcc323dc78f99b78a3263d88e34877ee0f9c4038a9369d0a718d1b97f9e0cb47638d2f3c0c5d64e6f88fb7176b4f8b9d3c25aea481235737f2cb0c029947e52f0f70ab707736eb0747c19061090fd3cb603f1389ecefc076fe6e454d9fe580ab63923d2b6336440a3999e0cc4dd5fde8ae798224393dd7d0b96531f1dda7cc699292ae1ca4dba3d244ba298b33c087d792e352f12735e57f74daeb18fe87c43b4742613993aa22cd2c439d7b4e34f031fbc546711ffa8ef8deef75a415a17cfe340dcf42ef7a06b768b6491059d7655d30d3ed8e7fafeb31eefee64d59a0025966a0059eb53bb81119d5a2a82da2c2a2b476570d0781ab288eaf9e69953a2b25e68d9654c3dd1e83eae7757de5f9b63890469aa5ed8e4cbfeee372ed155ad5da906facd5cf4ece0d526cc7618836e67c01d00932edb6a5afc62285ba81c3e229c1a8b00c443139f54793c379604953927c24a5a4524db49fe809466060ae251ef37cc49e7db463148933c188974eddf3b1e50ce978070ab0c2a3f3adfa05db18bfc9350d77c2a3b7b91ebfd73d94b74b3c3719f4115daafa596dc1f59251e7c2b557b83affd322e9a1e5018091585ee06af1ada139deb48bd73c27aad78ea3c2c7b3268527e73ad320088212a284a72da55a477ae1da11ebe588e185c967445c4a842137d3ad295e4957b3638d2f08f42a7f74a7505e33bbbfc81fbc958cc6ba088e577da2edc980a5beb188e841eaf11faa4a41b026c2e93051452994bac17bde62fccd066bfbcd0db228a789e07dd3a478f853d78d5cd0f49e3a84316263a0a9dba533c56853e380d44610b5c7d4d988f573f9cbd99fc2eef739ffaac4f998f86c44f9f7114ba4c356899fc87c88b0df7c5e323d0d6da61fca5176143eae126e3c3ef8f212a193d79a3cbba9b0fc9d086d5f8f7901159d8525bdebd0c42c94af8454c5e724689f8d40163de5946a92a9b2b9a1dbd69a7ccc5baf227b9515e75b4d4cb98c97f6a0e40f7469afaecfcde0fcfd1325feb1b3eb8c4f41d0137284e081640fdde4ef84a103f2cc9fb6c83e278c262d145d32202f3546fc221f8457653b73d6600f5573635c6b8bfe3ae7d1c370beb7668aa340e3619a6fb5e3e9eb05c72242f995bd691f43bea624081fb73e9f52cccffd39646779d07c7fbd292578cf2f4cd1e94331727972573f28214c0371d9a7e318dc2d914f6992b47bac5e69815ca46afa24fe54e0c3a50242eb8586386a796406c7b7e842c888f8abc7739d7e8cc82b62da5cc853ae93d501e497ee7e0727c80617e8d6d5a9fca99de8e244d01ec84c28943b42ccebe242aafa79ba8ec5fe35a810c001597c6d77547d4cbceb20ffd3629eb41cada68b840c41d62a39dda887a654e2c31598e9c76af02632d997d536bdc27c51fbcb3cbd2831466d9a4833f5d087b560253e3ee038e5fd45ac9b22e5de2729cd86c015c146d692f99ef19596a905606f50fb77c9fc53e2824e22f50a0cced155aeebabfbf6614b2b1b396b16665579695b27fa9fdf376d6e7171a21ba4b53eeb1ffde1b3b87e575527d669ebcd82654dc86ca7f69b654eb6de017887ab701785352680cdcf208dfb2872aebe420682041bb89e3ec4a72dcaa7e8153ae0009138b185aabe59286cd37a73d07717182f7cadd6d32797659fe062cd29a5a903f4ddeeb9c8f7608cf26da8b67ae9f06f9e6267d1c29fc9d054f392a3cc15b71168c447f94cfea65fea263ed9149ec6dc44531f4a5ed6877d535fce784071982ad85c51054e0bfd3485ee0c2964adda9ca5f9c8579bcecc0a8b5adf0183e45a389ed46a3fb768538fde45a596c7ee79f89a613496a0c56e3e20173a52032392e9504ccd19f203cd954931d457cdeff32c4eca713c16f1be1e253eb4e7ed5a26e7076c46af115c046912a2895d503e9edc806ebf16dd63be8fafd8ca390c943629d48eacd4b02e708099f0b25c087a4fe86fe60f6843dd0a0b004cc221fd4b286f85d3f8d7e88fb929d1c22bac0a7fa755efdcab1f0bd1ddfa82afe730439216e5ec9100293c71c64ce08a24ce95381ef41e6128e48b565906dcda</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Enter the password to read.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Learning Notes</tag>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Firebase 存储教程</title>
    <url>/contents/Firebase%E5%AD%98%E5%82%A8%E6%95%99%E7%A8%8B.html</url>
    <content><![CDATA[<p>Firebase 云端存储 (Cloud Storage) 是 Google 官方提供的一项功能强大、操作简单且经济实惠的对象存储服务，可轻松支持类似 Google 这种规模级别的应用。无论网络质量如何，适用于 Cloud Storage 的 Firebase SDK 都能为 Firebase 应用提供 Google 安全品质的文件上传和下载服务。可以使用 SDK 来存储图片、音频、视频或其他由用户生成的内容。在服务器上，可以使用 Google Cloud Storage 来访问相同的文件。<br>
<span id="more"></span></p>
<h1 id="准备工作">准备工作</h1>
<ol type="1">
<li>注册成为 Firebase 开发者<br>
在 <a href="https://console.firebase.google.com">Firebase Console</a> 注册账号并登陆。</li>
<li>添加项目<br>
点击 “添加项目”，填写项目名称和国家 / 地区。添加完成后进入项目。</li>
<li>添加应用<br>
在此只演示安卓系统，点击 “Overview 概览” 页面的 “将 Firebase 添加到您的 Android 应用” 按钮。填写 Android 应用包名（不可更改），别名（选填），调试签名证书 SHA1（可选）。</li>
<li>下载配置文件<br>
点击 “注册应用”，下载配置文件 “google-services.json”。（此配置文件也可以在 Overview 的右边设置中的 “项目设置” 中查看、下载。）<br>
在 Android Studio 中切换到项目视图，查看项目根目录（即 app 目录），并将配置文件放入到此根目录下。</li>
</ol>
<h1 id="服务器端">服务器端</h1>
<p>本文使用 Python 作为服务器脚本语言。<br>
Google Cloud Storage 源码：<a href="https://github.com/googleapis/google-cloud-python">Google Cloud Storage</a>，<a href="https://googleapis.dev/python/storage/latest/index.html">API Document</a></p>
<h2 id="环境配置">环境配置</h2>
<p>pip 方式：<code>pip install firebase_admin</code></p>
<h2 id="服务端主函数">服务端主函数</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> firebase_admin</span><br><span class="line"><span class="keyword">from</span> firebase_admin <span class="keyword">import</span> credentials</span><br><span class="line"><span class="keyword">from</span> firebase_admin <span class="keyword">import</span> storage</span><br><span class="line"></span><br><span class="line">cred = credentials.Certificate(<span class="string">'path/to/serviceAccountKey.json'</span>)</span><br><span class="line">firebase_admin.initialize_app(cred, {</span><br><span class="line">    <span class="string">'storageBucket'</span>: <span class="string">'&lt;BUCKET_NAME&gt;.appspot.com'</span></span><br><span class="line">})</span><br><span class="line">bucket = storage.bucket()</span><br><span class="line"></span><br><span class="line">blob = bucket.blob(<span class="string">'path/to/file'</span>)</span><br><span class="line">file_string = blob.download_as_string() <span class="comment">#以字符串的形式打印存储的文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'path/to/file'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    blob.download_to_file(file) <span class="comment">#以byte的形式下载文件到本地</span></span><br><span class="line">    </span><br><span class="line">blobs_list = <span class="built_in">list</span>(bucket.list_blobs(prefix=<span class="string">'xxx'</span>)) <span class="comment">#以blob形式返回以’xxx‘为前缀的文件列表</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="android上的cloud-storage">Android 上的 Cloud Storage</h2>
<p>前提条件：</p>
<ol type="1">
<li>安装 Firebase SDK。</li>
<li>在 Firebase 控制台中将应用添加到 Firebase 项目。</li>
</ol>
<h2 id="设置公共访问权限">设置公共访问权限</h2>
<p>Cloud Storage for Firebase 提供了一种声明式规则语言，可用于定义数据的组织结构方式、将数据编入索引的方式，以及何时可以读取和写入数据。默认情况下，对 Storage 的读写权限是有限制的，只有通过身份验证的用户才能读写数据。要在不设置身份验证的情况下开始使用 Storage，可以将规则配置为允许公共访问。</p>
<ol type="1">
<li>进入 firebase 控制台</li>
<li>进入 firebase 项目</li>
<li>左侧栏中点击 “Develop-Storage”</li>
<li> 选项卡中选择 “规则”</li>
<li> 右侧改写规则为公开规则：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">service firebase.storage {</span><br><span class="line">  match /b/{bucket}/o {</span><br><span class="line">    match /{allPaths=**} {</span><br><span class="line">      allow read, write;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<p>这会使得 Storage 向所有人开放，包括不使用应用的用户，因此在设置身份验证时，请务必重新限制对 Storage 的访问权限。</p>
<h1 id="android客户端">Android 客户端</h1>
<p>官方集成文档：<a href="https://firebase.google.com/docs/storage/android/start">Android 上的 Cloud Storage 使用入门</a></p>
<h2 id="添加所需的依赖">添加所需的依赖</h2>
<ol type="1">
<li>向根项目级 build.gradle 文件添加规则，以纳入 Google 服务插件：<br>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">buildscript {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    dependencies {</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        classpath 'com.google.gms:google-services:<span class="number">4.3</span><span class="number">.3</span>' #修改为最新版本</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li>在模块 Gradle 文件（通常是 app/build.gradle）中，在文件的底部添加 apply plugin 代码行，以启用 Gradle 插件：<br>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">apply plugin: 'com.android.application'</span><br><span class="line">apply plugin: 'com.google.gms.google-services'</span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line">dependencies {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  implementation 'com.google.firebase:firebase-storage:<span class="number">19.1</span><span class="number">.1</span>' #修改为最新版本</span><br><span class="line">  implementation <span class="string">"com.google.firebase:firebase-storage-ktx:19.1.1"</span> #如果是kotlin语言则加上-ktx，修改为最新版本</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h2 id="设置-cloud-storage">设置 Cloud Storage</h2>
<p>访问存储分区的第一步是在 onCreate 函数中创建一个 FirebaseStorage 实例：<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">FirebaseStorage storage = FirebaseStorage.getInstance();</span><br></pre></td></tr></tbody></table></figure><p></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> storage = Firebase.storage</span><br></pre></td></tr></tbody></table></figure>
<h2 id="创建引用">创建引用</h2>
<p>要上传、下载或删除文件，或要获取或更新文件的元数据，请创建引用。引用可以看作是指向云端文件的指针。由于引用属于轻型项目，因此可以根据需要创建多个引用。 这些引用可以重复用于多个操作。</p>
<p>引用是使用 FirebaseStorage 单例实例并调用其 getReference () 方法创建的。<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">StorageReference storageRef = storage.getReference();</span><br></pre></td></tr></tbody></table></figure><p></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> storageRef = storage.reference</span><br></pre></td></tr></tbody></table></figure>
<p>可以在现有引用上使用 getChild () 方法，创建一个对树中较低位置的引用。比如文件存储在‘aaa’文件夹下‘bbb’文件中，则：<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">StorageReference fileRef = storageRef.child(<span class="string">"aaa/bbb"</span>);</span><br></pre></td></tr></tbody></table></figure><p></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> riversRef = storageRef.child(<span class="string">"aaa/bbb"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="上传">上传</h2>
<p>要将文件上传到 Cloud Storage，首先要创建对文件的完整路径（包括文件名）的引用。<br>
创建适当的引用后，可以调用 putBytes ()、putFile () 或 putStream () 方法将文件上传到 Cloud Storage。</p>
<h3 id="通过内存中的数据上传">通过内存中的数据上传</h3>
<p>putBytes () 方法是将文件上传到 Cloud Storage 的最简单方法。putBytes () 需要一个 byte [] 并返回 UploadTask，可以用它来管理和监控上传状态。<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] data;</span><br><span class="line"></span><br><span class="line">UploadTask uploadTask = mountainsRef.putBytes(data);</span><br><span class="line">uploadTask.addOnFailureListener(<span class="keyword">new</span> OnFailureListener() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="meta">@NonNull</span> Exception exception)</span> </span>{</span><br><span class="line">        <span class="comment">// Handle unsuccessful uploads</span></span><br><span class="line">    }</span><br><span class="line">}).addOnSuccessListener(<span class="keyword">new</span> OnSuccessListener&lt;UploadTask.TaskSnapshot&gt;() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(UploadTask.TaskSnapshot taskSnapshot)</span> </span>{</span><br><span class="line">        <span class="comment">// taskSnapshot.getMetadata() contains file metadata such as size, content-type, etc.</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><br>
<figure class="highlight kotlin"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Get the data from an ImageView as bytes</span></span><br><span class="line">imageView.isDrawingCacheEnabled = <span class="literal">true</span></span><br><span class="line">imageView.buildDrawingCache()</span><br><span class="line"><span class="keyword">val</span> bitmap = (imageView.drawable <span class="keyword">as</span> BitmapDrawable).bitmap</span><br><span class="line"><span class="keyword">val</span> baos = ByteArrayOutputStream()</span><br><span class="line">bitmap.compress(Bitmap.CompressFormat.JPEG, <span class="number">100</span>, baos)</span><br><span class="line"><span class="keyword">val</span> <span class="keyword">data</span> = baos.toByteArray()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> uploadTask = mountainsRef.putBytes(<span class="keyword">data</span>)</span><br><span class="line">uploadTask.addOnFailureListener {</span><br><span class="line">    <span class="comment">// Handle unsuccessful uploads</span></span><br><span class="line">}.addOnSuccessListener {</span><br><span class="line">    <span class="comment">// taskSnapshot.metadata contains file metadata such as size, content-type, etc.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>由于 putBytes () 接受了 byte []，因此它需要应用立即将文件的全部内容保存在内存中。请考虑使用 putStream () 或 putFile () 以使用较少的内存。</p>
<h3 id="通过数据流上传">通过数据流上传</h3>
<p>putStream () 方法是将文件上传到 Cloud Storage 最通用的方法。putStream () 接受了 InputStream 并返回 UploadTask，可以使用它来管理和监控上传状态。<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">InputStream stream = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">"path/to/file"</span>));</span><br><span class="line"></span><br><span class="line">uploadTask = mountainsRef.putStream(stream);</span><br><span class="line">uploadTask.addOnFailureListener(<span class="keyword">new</span> OnFailureListener() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="meta">@NonNull</span> Exception exception)</span> </span>{</span><br><span class="line">        <span class="comment">// Handle unsuccessful uploads</span></span><br><span class="line">    }</span><br><span class="line">}).addOnSuccessListener(<span class="keyword">new</span> OnSuccessListener&lt;UploadTask.TaskSnapshot&gt;() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(UploadTask.TaskSnapshot taskSnapshot)</span> </span>{</span><br><span class="line">        <span class="comment">// taskSnapshot.getMetadata() contains file metadata such as size, content-type, etc.</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><br>
<figure class="highlight kotlin"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> stream = FileInputStream(File(<span class="string">"path/to/file"</span>))</span><br><span class="line"></span><br><span class="line">uploadTask = mountainsRef.putStream(stream)</span><br><span class="line">uploadTask.addOnFailureListener {</span><br><span class="line">    <span class="comment">// Handle unsuccessful uploads</span></span><br><span class="line">}.addOnSuccessListener {</span><br><span class="line">    <span class="comment">// taskSnapshot.metadata contains file metadata such as size, content-type, etc.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="从本地文件上传">从本地文件上传</h3>
<p>可以使用 putFile () 方法上传设备上的本地文件，例如相机中的照片和视频。putFile () 需要一个 File 并返回 UploadTask，可以使用它来管理和监控上传状态。<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Uri file = Uri.fromFile(<span class="keyword">new</span> File(<span class="string">"path/to/file"</span>));</span><br><span class="line">StorageReference fileRef = storageRef.child(<span class="string">"folder/"</span>+file.getLastPathSegment());</span><br><span class="line">uploadTask = fileRef.putFile(file);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Register observers to listen for when the download is done or if it fails</span></span><br><span class="line">uploadTask.addOnFailureListener(<span class="keyword">new</span> OnFailureListener() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="meta">@NonNull</span> Exception exception)</span> </span>{</span><br><span class="line">        <span class="comment">// Handle unsuccessful uploads</span></span><br><span class="line">    }</span><br><span class="line">}).addOnSuccessListener(<span class="keyword">new</span> OnSuccessListener&lt;UploadTask.TaskSnapshot&gt;() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(UploadTask.TaskSnapshot taskSnapshot)</span> </span>{</span><br><span class="line">        <span class="comment">// taskSnapshot.getMetadata() contains file metadata such as size, content-type, etc.</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> file = Uri.fromFile(File(<span class="string">"path/to/file"</span>))</span><br><span class="line"><span class="keyword">val</span> riversRef = storageRef.child(<span class="string">"folder/<span class="subst">${file.lastPathSegment}</span>"</span>)</span><br><span class="line">uploadTask = riversRef.putFile(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Register observers to listen for when the download is done or if it fails</span></span><br><span class="line">uploadTask.addOnFailureListener {</span><br><span class="line">    <span class="comment">// Handle unsuccessful uploads</span></span><br><span class="line">}.addOnSuccessListener {</span><br><span class="line">    <span class="comment">// taskSnapshot.metadata contains file metadata such as size, content-type, etc.</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>Firebase 推送教程</title>
    <url>/contents/Firebase%E6%8E%A8%E9%80%81%E6%95%99%E7%A8%8B.html</url>
    <content><![CDATA[<p>Firebase 云信息传递 (FCM) 是 Google 官方提供的一种跨平台消息传递解决方案，可供免费、可靠地传递消息。<br>
<span id="more"></span></p>
<h1 id="准备工作">准备工作</h1>
<ol type="1">
<li>注册成为 Firebase 开发者<br>
在 <a href="https://console.firebase.google.com">Firebase Console</a> 注册账号并登陆。</li>
<li>添加项目<br>
点击 “添加项目”，填写项目名称和国家 / 地区。添加完成后进入项目。</li>
<li>添加应用<br>
在此只演示安卓系统，点击 “Overview 概览” 页面的 “将 Firebase 添加到您的 Android 应用” 按钮。填写 Android 应用包名（不可更改），别名（选填），调试签名证书 SHA1（可选）。</li>
<li>下载配置文件<br>
点击 “注册应用”，下载配置文件 “google-services.json”。（此配置文件也可以在 Overview 的右边设置中的 “项目设置” 中查看、下载。）<br>
在 Android Studio 中切换到项目视图，查看项目根目录（即 app 目录），并将配置文件放入到此根目录下。<br>
修改 Gradle：项目级 build.gradle（<code>&lt;project&gt;/build.gradle</code>）：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">buildscript {</span><br><span class="line">  dependencies {</span><br><span class="line">    // Add this line</span><br><span class="line">    classpath 'com.google.gms:google-services:3.1.0'</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>
应用级 build.gradle（<code>&lt;project&gt;/&lt;app-module&gt;/build.gradle</code>）：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">...</span><br><span class="line">// Add to the bottom of the file （一定要放最后）</span><br><span class="line">apply plugin: 'com.google.gms.google-services'</span><br></pre></td></tr></tbody></table></figure><br>
按 IDE 中显示的栏中的 “立即同步”（Sync now）。</li>
</ol>
<h1 id="服务器端">服务器端</h1>
<p>本文使用 Python 作为服务器脚本语言。<br>
PyFCM 源码：<a href="https://github.com/olucurious/pyfcm">PyFCM</a></p>
<h2 id="环境配置">环境配置</h2>
<p>pip 方式：<code>pip install pyfcm</code></p>
<h2 id="服务端主函数">服务端主函数</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pyfcm <span class="keyword">import</span> FCMNotification</span><br><span class="line"></span><br><span class="line">push_service = FCMNotification(api_key=<span class="string">"&lt;api-key&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者设置一个代理</span></span><br><span class="line"><span class="comment"># proxy_dict = {</span></span><br><span class="line">          <span class="string">"http"</span>  : <span class="string">"http://127.0.0.1"</span>,</span><br><span class="line">          <span class="string">"https"</span> : <span class="string">"http://127.0.0.1"</span>,</span><br><span class="line">        }</span><br><span class="line"><span class="comment"># push_service = FCMNotification(api_key="&lt;api-key&gt;", proxy_dict=proxy_dict)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># api-key可以从https://console.firebase.google.com/project/&lt;project-name&gt;/settings/cloudmessaging获得，即firebase console→对应项目→设置→云消息传递→服务器密钥。</span></span><br><span class="line"></span><br><span class="line">message_title = <span class="string">"xxxxx"</span> <span class="comment">#通知的标题</span></span><br><span class="line">message_body = <span class="string">"xxxxx"</span> <span class="comment">#通知的内容</span></span><br><span class="line">data_message = {</span><br><span class="line">    <span class="string">"a"</span> : <span class="string">"b"</span>,</span><br><span class="line">    <span class="string">"c"</span> : <span class="string">"d"</span>,</span><br><span class="line">    <span class="string">"e"</span> : <span class="string">"f"</span></span><br><span class="line">} <span class="comment"># 数据消息，为键值对</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是发送给单台设备。</span></span><br><span class="line">registration_id = <span class="string">"&lt;device registration_id&gt;"</span> <span class="comment">#Android应用的token</span></span><br><span class="line"><span class="comment"># 发送通知</span></span><br><span class="line">result = push_service.notify_single_device(registration_id=registration_id, message_title=message_title, message_body=message_body)</span><br><span class="line"><span class="comment"># 发送数据</span></span><br><span class="line">result = push_service.single_device_data_message(registration_id=registration_id, data_message=data_message)</span><br><span class="line"><span class="comment"># 发送带有数据的通知</span></span><br><span class="line">result = push_service.notify_single_device(registration_id=registration_id, message_body=message_body, data_message=data_message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是发送给多台设备消息通知。</span></span><br><span class="line">registration_ids = [<span class="string">"&lt;device registration_id 1&gt;"</span>, <span class="string">"&lt;device registration_id 2&gt;"</span>, ...]</span><br><span class="line"><span class="comment"># 发送通知</span></span><br><span class="line">result = push_service.notify_multiple_devices(registration_ids=registration_ids, message_title=message_title, message_body=message_body)</span><br><span class="line"><span class="comment"># 发送数据</span></span><br><span class="line">result = push_service.multiple_devices_data_message(registration_ids=registration_ids, data_message=data_message)</span><br><span class="line"><span class="comment"># 发送带有数据的通知</span></span><br><span class="line">result = push_service.notify_multiple_devices(registration_ids=registration_ids, message_body=message_body, data_message=data_message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他配置</span></span><br><span class="line"><span class="comment"># 发送一个高优先级的数据</span></span><br><span class="line">extra_kwargs = {</span><br><span class="line">    <span class="string">'priority'</span>: <span class="string">'high'</span></span><br><span class="line">}</span><br><span class="line">result = push_service.notify_single_device(registration_id=registration_id, data_message=data_message, extra_kwargs=extra_kwargs)</span><br><span class="line"><span class="comment"># 发送一个低优先级的数据</span></span><br><span class="line"><span class="comment"># low_priority默认为False</span></span><br><span class="line">result = push_service.notify_multiple_devices(registration_ids=registration_ids, message_body=message, low_priority=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得有效的registration_ids（可以用于清洗数据库中有效的registration_ids）</span></span><br><span class="line">registration_ids = [<span class="string">'reg id 1'</span>, <span class="string">'reg id 2'</span>, <span class="string">'reg id 3'</span>, <span class="string">'reg id 4'</span>, ...]</span><br><span class="line">valid_registration_ids = push_service.clean_registration_ids(registration_ids)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送消息至主题</span></span><br><span class="line">result = push_service.notify_topic_subscribers(topic_name=<span class="string">"xxx"</span>, message_body=message)</span><br><span class="line"><span class="comment"># 有条件的发送消息至主题，如果用户订阅了TopicA和TopicB或者TopicA和TopicC则能收到消息。</span></span><br><span class="line">topic_condition = <span class="string">"'TopicA' in topics &amp;&amp; ('TopicB' in topics || 'TopicC' in topics)"</span></span><br><span class="line">result = push_service.notify_topic_subscribers(message_body=message, condition=topic_condition)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他可选配置</span></span><br><span class="line">collapse_key (<span class="built_in">str</span>): 设置折叠消息</span><br><span class="line">delay_while_idle (<span class="built_in">bool</span>): 如果设置为真则表示消息将不会送达直到设备被激活。</span><br><span class="line">time_to_live (<span class="built_in">int</span>): 消息将会被保留多少秒，最多保留<span class="number">4</span>周，默认值也是<span class="number">4</span>周。</span><br><span class="line">restricted_package_name (<span class="built_in">str</span>): 应用包名必须匹配才收的到消息。</span><br><span class="line">dry_run (<span class="built_in">bool</span>): 如果设置为真则表示没有消息将会被送达，但是请求还是会被测试。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回数据</span></span><br><span class="line">response_dict = {</span><br><span class="line">    <span class="string">'multicast_ids'</span>: <span class="built_in">list</span>(), <span class="comment">#多播消息的唯一ID</span></span><br><span class="line">    <span class="string">'success'</span>: <span class="number">0</span>, <span class="comment">#没有报错的消息数目</span></span><br><span class="line">    <span class="string">'failure'</span>: <span class="number">0</span>, <span class="comment">#没有处理的消息数目</span></span><br><span class="line">    <span class="string">'canonical_ids'</span>: <span class="number">0</span>, <span class="comment">#包括标准registration token的结果数目</span></span><br><span class="line">    <span class="string">'results'</span>: <span class="built_in">list</span>(), <span class="comment">#表示消息状态的字典</span></span><br><span class="line">    <span class="string">'topic_message_id'</span>: <span class="literal">None</span> <span class="keyword">or</span> <span class="built_in">str</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="android上的主题消息传递">Android 上的主题消息传递</h2>
<p>在发布 / 订阅模式下，利用 FCM 主题消息传递功能，可以将消息发送至已经选择加入特定主题的多台设备。根据需要撰写主题消息，FCM 将处理消息路由并将消息可靠地传送至正确的设备。<br>
关于主题，请注意以下事项：</p>
<ol type="1">
<li>主题消息传递不限制每个应用拥有的主题和订阅数。</li>
<li>目前，主题消息的有效负载不得超过 2KB。</li>
<li>主题消息传递最适合传递新闻、天气或其他可通过公开途径获得的信息等内容。</li>
<li>主题消息针对吞吐量（而非延迟）进行了优化。要将消息快速安全地传送到单台设备或小规模设备组，应将消息定位至注册令牌，而非主题。</li>
<li>如果需要向一位用户的多台设备发送消息，可考虑针对这些使用情形进行设备组消息传递。</li>
</ol>
<h2 id="设置消息的优先级">设置消息的优先级</h2>
<ul>
<li>普通优先级：这是数据消息的默认优先级。普通优先级消息不会让休眠设备打开网络连接，为了省电，它们可能会被延迟传递。如果是对时间不太敏感的消息，例如新电子邮件通知或其他要同步的数据，建议选择普通传递优先级。</li>
<li>高优先级：这是通知消息的默认优先级。FCM 会立即尝试传递高优先级消息，允许 FCM 服务在可能的情况下唤醒休眠设备并打开与应用服务器的网络连接。例如，带有即时通讯、聊天或语音通话提醒功能的应用通常需要打开网络连接并确保 FCM 及时将消息传递给设备。如果消息属于时间关键型且需要用户立刻交互，请设置高优先级，但需要注意的是，将消息设置为高优先级会比普通优先级耗费更多电池电量。<br>
有效值为 normal 和 high。</li>
</ul>
<h2 id="不可折叠消息和可折叠消息">不可折叠消息和可折叠消息</h2>
<p>不可折叠消息表示每一条消息都将被传递至设备。不可折叠消息可传递一些有用内容至手机应用，从而联系服务器以获取数据，这与 “ping” 相反。默认情况下，消息不可折叠，但通知消息（始终是可折叠消息）除外。<br>
聊天消息或关键消息都是典型的不可折叠消息。例如，在 IM 应用中，可能想要传递每一条消息，因为它们的内容各不相同。<br>
在不折叠的情况下，最多可存储 100 条消息。达到此限值后，所有存储的消息都将被舍弃。设备在重新联网后将收到一条特殊消息，提示已达到此上限。之后，应用可以正常处理该状况，一般情况下会请求与应用服务器完全同步。<br>
可折叠消息在还未被传递至设备的情况下可能会被新消息替代。<br>
两种常见的可折叠消息是 “发送以同步” 消息和通知消息。“发送以同步” 消息是一个 “ping”，它会告诉移动应用从服务器同步数据。为用户更新最新比分的体育应用就属于这种消息。只有最新的消息是相关的。<br>
要将消息标记为可折叠，请在消息有效负载中添加 collapse_key 参数。FCM 允许应用服务器在任意指定时间内为每台设备使用最多 4 个不同的折叠键。也就是说，FCM 连接服务器可以为每台设备同时存储 4 条不同的可折叠 “发送以同步” 消息，每一条都含有不同的折叠键。如果超出此限值，FCM 将仅保留 4 个折叠键，具体保留哪几个不一定。</p>
<h1 id="android客户端">Android 客户端</h1>
<p>官方集成文档：<a href="https://firebase.google.com/docs/cloud-messaging/android/client">在 Android 上设置 Firebase 云消息传递客户端应用</a></p>
<h2 id="将firebase添加到android项目">将 Firebase 添加到 Android 项目</h2>
<p>前提条件：</p>
<ol type="1">
<li>运行 Android 4.0 (Ice Cream Sandwich) 或更高版本以及 Google Play 服务 11.0.4 或更高版本的设备。</li>
<li>Google 代码库中的 Google Play Services SDK，可通过 Android SDK Manager 获得。</li>
<li>最新版本的 Android Studio，1.5 版或更高版本。</li>
</ol>
<p>如果使用最新版本的 Android Studio（2.2 版或更高版本），建议使用 Firebase 智能助理来将的应用关联至 Firebase。Firebase 智能助理可以关联现有的项目，或者为创建一个新项目，并自动安装任何必要的 Gradle 依赖项。</p>
<ol type="1">
<li>依次点击 Tools&gt;Firebase 以打开 Assistant 窗口。</li>
<li>点击以展开所列功能之一（例如 Cloud Messaging），然后点击所提供的教程链接。</li>
<li>点击 Connect to Firebase 按钮以关联至 Firebase，并向应用添加必要的代码。</li>
</ol>
<h2 id="添加所需的依赖">添加所需的依赖</h2>
<ol type="1">
<li>向根项目级 build.gradle 文件添加规则，以纳入 Google 服务插件：<br>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">buildscript {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    dependencies {</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        classpath 'com.google.gms:google-services:<span class="number">3.1</span><span class="number">.0</span>'</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li>在模块 Gradle 文件（通常是 app/build.gradle）中，在文件的底部添加 apply plugin 代码行，以启用 Gradle 插件：<br>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">apply plugin: 'com.android.application'</span><br><span class="line">android {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line">dependencies {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  compile 'com.google.firebase:firebase-messaging:<span class="number">11.4</span><span class="number">.2</span>' #修改为最新版本</span><br><span class="line">  compile 'com.google.android.gms:play-services-base:<span class="number">11.4</span><span class="number">.2</span>' #修改为最新版本</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 一定要放在最底部</span></span><br><span class="line">apply plugin: 'com.google.gms.google-services'</span><br></pre></td></tr></tbody></table></figure></li>
<li>如果 FCM 对于 Android 应用的功能至关重要，请务必在应用的 build.gradle 中设置 minSdkVersion 8 或更高版本。这可确保 Android 应用无法安装在不能让其正常运行的环境中。</li>
</ol>
<h2 id="修改应用清单androidmanifest.xml">修改应用清单 AndroidManifest.xml</h2>
<ol type="1">
<li>一项继承 FirebaseMessagingService 的服务。如果希望在后台进行除接收应用通知之外的消息处理，则必须添加此服务。要接收前台应用中的通知、接收数据有效负载以及发送上行消息等，必须继承此服务。<br>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">".MyFirebaseMessagingService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.google.firebase.MESSAGING_EVENT"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>一项继承 FirebaseInstanceIdService 的服务，用于处理注册令牌的创建、轮替和更新。如果要发送至特定设备或者创建设备组，则必须添加此服务。<br>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">".MyFirebaseInstanceIDService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.google.firebase.INSTANCE_ID_EVENT"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>（可选）在应用组件中，用于设置通知的默认图标、颜色和通知渠道（Android O 的新功能）的元数据元素。如果传入的消息未明确设置图标、颜色或通知渠道，则 Android 会使用这些值。<br>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"com.google.firebase.messaging.default_notification_icon"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:resource</span>=<span class="string">"@drawable/ic_stat_ic_notification"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"com.google.firebase.messaging.default_notification_color"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:resource</span>=<span class="string">"@color/colorAccent"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h2 id="获取设备注册令牌">获取设备注册令牌</h2>
<p>初次启动应用时，FCM SDK 会为客户端应用实例生成一个注册令牌。如果希望定位至单台设备或创建设备组，则需要通过继承 FirebaseInstanceIdService 来访问此令牌。<br>
令牌会在初始启动后生成，建议检索最新更新的注册令牌。<br>
注册令牌可能会在发生下列情况时更改：<br>
- 应用删除实例 ID<br>
- 应用在新设备上恢复<br>
- 用户卸载 / 重新安装应用<br>
- 用户清除应用数据</p>
<ol type="1">
<li>检索当前注册令牌<br>
如果需要检索当前令牌，调用 FirebaseInstanceId.getInstance ().getToken ()。如果令牌尚未生成，此方法将返回 null。</li>
<li>监控令牌的生成<br>
每次生成新的令牌时，都会触发 onTokenRefresh 回调，因此，在上下文中调用 getToken 可以确保访问的是当前可用的注册令牌。确保已将服务添加到清单文件中，然后在 onTokenRefresh 的上下文中调用 getToken，并记录相应值，如下所示：<br>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTokenRefresh</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// 获得注册令牌</span></span><br><span class="line">    String refreshedToken = FirebaseInstanceId.getInstance().getToken();</span><br><span class="line">    Log.d(TAG, <span class="string">"Refreshed token: "</span> + refreshedToken);</span><br><span class="line">    <span class="comment">// 后续操作，如发送令牌到服务器</span></span><br><span class="line">    sendRegistrationToServer(refreshedToken);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>
获取该令牌后，可以将其发送到应用服务器并进行存储。</li>
</ol>
<h2 id="检查-google-play-服务">检查 Google Play 服务</h2>
<p>依靠 Play 服务 SDK 运行的应用在访问 Google Play 服务功能之前，应始终检查设备是否拥有兼容的 Google Play 服务 APK。建议在以下两个位置进行检查：主 Activity 的 onCreate () 方法中，及其 onResume () 方法中。在 onCreate () 中检查可确保该应用在检查成功之前无法使用。在 onResume () 中检查可确保当用户通过一些其他方式返回正在运行的应用（比如通过返回按钮）时，检查仍将继续进行。<br>
如果设备没有兼容的 Google Play 服务版本，应用可以调用 <code>GoogleApiAvailability.makeGooglePlayServicesAvailable(this)</code>，以便让用户从 Play 商店下载 Google Play 服务，需要 <code>import com.google.android.gms.common.GoogleApiAvailability;</code></p>
<h2 id="为客户端应用订阅主题">为客户端应用订阅主题</h2>
<p>客户端应用可以订阅任何现有主题，也可创建新主题。当客户端应用订阅新的主题名称（Firebase 项目中尚不存在的名称）时，系统会在 FCM 中创建使用这个名称的新主题，随后任何客户端都可订阅该主题。<br>
若要订阅某个主题，客户端应用需使用 FCM 主题名称调用 Firebase 云消息传递 subscribeToTopic ()：<code>FirebaseMessaging.getInstance().subscribeToTopic("news");</code><br>
若要退订，客户端应用需使用主题名称调用 Firebase 云消息传递 unsubscribeFromTopic ()。</p>
<h2 id="处理消息">处理消息</h2>
<p>要接收消息，使用继承 FirebaseMessagingService 的服务。重写 onMessageReceived 和 onDeletedMessages 回调。<br>
在收到消息后的 10 秒内处理该消息。超过 10 秒后，Android 无法保证能够执行，并可能随时终止进程。如果应用需要更多时间来处理消息，使用 Firebase Job Dispatcher。<br>
onMessageReceived 是为大多数消息类型提供的，但有以下例外情况：当应用在后台时送达的通知消息。在这种情况下，通知将传送至设备的系统任务栏。默认情况下，用户点按通知即可打开应用启动器。同时具备通知和数据有效负载的消息，无论应用在前台还是后台。在这种情况下，通知将传送至设备的系统任务栏，数据有效负载则传送至启动器 Activity 的 intent 的 extras 参数中。</p>
<table>
<thead>
<tr class="header">
<th>应用状态</th>
<th>通知</th>
<th>数据</th>
<th>两者</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>前台</td>
<td> onMessageReceived</td>
<td>onMessageReceived</td>
<td>onMessageReceived</td>
</tr>
<tr class="even">
<td> 后台</td>
<td>系统任务栏</td>
<td> onMessageReceived</td>
<td> 通知：系统任务栏<br>数据：intent 的 extras 参数。</td>
</tr>
</tbody>
</table>
<p>注意：当需要发送通知（和数据）但是又希望不需要用户打开通知消息的情况下进行其他操作，则可以只发送数据，但是在 onMessageReceived 函数中手动生成 notification。</p>
<h3 id="重写onmessagereceived">重写 onMessageReceived</h3>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessageReceived</span><span class="params">(RemoteMessage remoteMessage)</span> </span>{</span><br><span class="line">    Log.d(TAG, <span class="string">"From: "</span> + remoteMessage.getFrom());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否收到数据</span></span><br><span class="line">    <span class="keyword">if</span> (remoteMessage.getData().size() &gt; <span class="number">0</span>) {</span><br><span class="line">        Log.d(TAG, <span class="string">"Message data payload: "</span> + remoteMessage.getData());</span><br><span class="line">        <span class="keyword">if</span> (<span class="comment">/*如果数据处理超过10秒*/</span> <span class="keyword">true</span>) {</span><br><span class="line">            scheduleJob();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// 如果数据处理在10秒以内</span></span><br><span class="line">            handleNow();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查数据是否携带通知</span></span><br><span class="line">    <span class="keyword">if</span> (remoteMessage.getNotification() != <span class="keyword">null</span>) {</span><br><span class="line">        Log.d(TAG, <span class="string">"Message Notification Body: "</span> + remoteMessage.getNotification().getBody());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>如果服务器只发送数据，但是需要应用主动生成通知则：<br>
</p><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFirebaseMessagingService</span> <span class="keyword">extends</span> <span class="title">FirebaseMessagingService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyFirebaseMsgService"</span>;</span><br><span class="line">    Map&lt;String, String&gt; messageBody;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessageReceived</span><span class="params">(RemoteMessage remoteMessage)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (remoteMessage.getData().size() &gt; <span class="number">0</span>) {</span><br><span class="line">            Log.d(TAG, <span class="string">"Message data payload: "</span> + remoteMessage.getData());</span><br><span class="line">            messageBody = remoteMessage.getData();</span><br><span class="line">            sendNotification(messageBody.get(<span class="string">"xxx"</span>)); # 这里messageBody类似json格式，messageBody.get(<span class="string">"xxx"</span>)获得key为xxx的值。</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendNotification</span><span class="params">(String messageBody)</span> </span>{</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, &lt;Activity&gt;.class); # 这里指定用户点击通知后所需打开的activity</span><br><span class="line">        intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</span><br><span class="line">        PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, intent, PendingIntent.FLAG_ONE_SHOT);</span><br><span class="line">        Uri defaultSoundUri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);</span><br><span class="line">        NotificationCompat.Builder notificationBuilder =</span><br><span class="line">                <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>, <span class="string">"default"</span>)</span><br><span class="line">                        .setSmallIcon(R.drawable.ic_stat_ic_notification)</span><br><span class="line">                        .setContentTitle(<span class="string">"Typing-Proof"</span>)</span><br><span class="line">                        .setContentText(messageBody)</span><br><span class="line">                        .setAutoCancel(<span class="keyword">true</span>)</span><br><span class="line">                        .setSound(defaultSoundUri)</span><br><span class="line">                        .setContentIntent(pendingIntent);</span><br><span class="line">        NotificationManager notificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">        <span class="keyword">if</span> (notificationManager != <span class="keyword">null</span>) {</span><br><span class="line">            notificationManager.notify(<span class="number">0</span>, notificationBuilder.build());</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="重写ondeletedmessages">重写 onDeletedMessages</h3>
<p>如果应用在连接了 FCM 的特定设备上的待处理消息过多（超过 100 条），或者设备已有一个月以上的时间没有连接 FCM，FCM 可能不会传送消息。<br>
在这些情况下，可能会收到对 FirebaseMessagingService.onDeletedMessages () 的回调。<br>
当应用实例收到此回调时，应该执行与应用服务器的完全同步。<br>
如果在过去 4 周内未向该设备上的应用发送消息，FCM 将不会调用 onDeletedMessages ()。</p>
<h3 id="处理后台应用中的通知消息">处理后台应用中的通知消息</h3>
<p>当应用位于后台时，Android 会将通知消息转发至系统任务栏。默认情况下，用户点按通知时将打开应用启动器。<br>
这包括同时含有通知和数据有效负载的消息（以及从通知控制台发送的所有消息）。<br>
在这些情况下，通知将传送至设备的系统任务栏，数据有效负载则传送至启动器 Activity 的 intent 的 extras 参数中。</p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>Git Tutorials</title>
    <url>/contents/Git-Tutorials.html</url>
    <content><![CDATA[<p>Git 指南，参考 <a href="http://rogerdudler.github.io/git-guide/index.zh.html">git - 简明指南</a><br>
<span id="more"></span></p>
<h1 id="安装">安装</h1>
<p><a href="https://book.git-scm.com/download/mac">MAC 版</a><br>
<a href="https://book.git-scm.com/download/win">Windows 版</a><br>
<a href="https://book.git-scm.com/download/linux">Linux 版</a></p>
<h1 id="指令">指令</h1>
<ul>
<li><strong>创建新仓库</strong>：本地创建新文件夹，打开，然后执行 <code>git init</code> 以创建新的 git 仓库。</li>
<li><strong>克隆仓库</strong>：执行 <code>git clone /path/to/repository</code> 以创建一个本地仓库的克隆版本；如果是远端服务器上的仓库，执行 <code>git clone username@host:/path/to/repository</code>。</li>
<li><strong>工作流</strong>：你的本地仓库由 git 维护的三棵 “树” 组成。第一个是你的<font color="red"><strong>工作目录</strong></font>，它持有实际文件；第二个是<font color="red"><strong>暂存区（Index）</strong></font>，它像个缓存区域，临时保存你的改动；最后是<font color="red"><strong> HEAD</strong></font>，它指向你最后一次提交的结果。</li>
<li><strong>查看不同</strong>：你可以修改你的文档或者代码，并且可以通过 <code>git diff</code> 查看具体修改内容和 <code>git diff --stat</code> 查看修改的总体信息。</li>
<li><strong>添加和提交</strong>：你可以提出更改（把它们添加到暂存区），执行 <code>git add &lt;filename&gt;</code> 或 <code>git add *</code>，这是 git 本工作流程的第一步；执行 <code>git commit -m "代码提交信息"</code> 以实际提交改动，现在你的改动已经提交到了 HEAD，但是还没到你的远端仓库。</li>
<li><strong>推送改动</strong>：改动被提交到本地仓库的 HEAD 后，执行 <code>git push origin master</code> 以将这些改动提交到远端仓库（可以把 master 换成你想要推送的任何分支）。如果你还没有克隆现有仓库，并欲将你的仓库连接到某个远程服务器，执行 <code>git remote add origin &lt;server&gt;</code> 以添加服务器。执行 <code>git remote -v</code> 查看远程服务器。</li>
<li><strong>分支</strong>：分支是用来将特性开发绝缘开来的。在你创建仓库的时候，master 是 “默认的” 分支。在其他分支上进行开发，完成后再将它们合并到主分支上。执行 <code>git checkout -b feature_x</code> 以创建一个叫做 “feature_x” 的分支，并切换过去；执行 <code>git checkout master</code> 以切换回主分支；执行 <code>git checkout master</code> 以删除新建的分支；除非你将分支推送到远端仓库 <code>git push origin &lt;branch&gt;</code>，不然该分支就是不为他人所见的；执行 <code>git branch</code> 查看本地分支。</li>
<li><strong>更新与合并</strong>：执行 <code>git pull</code> 以更新你的本地仓库至最新改动（在你的工作目录中获取并合并远端的改动）。执行 <code>git merge &lt;branch&gt;</code> 以合并其他分支到你的当前分支（例如 master）。git 会尝试去自动合并改动。遗憾的是，这可能并非每次都成功，并可能出现冲突。 这时候就需要你手动修改这些文件来合并这些冲突。改完之后，你需要执行 <code>git add &lt;filename&gt;</code> 以将它们标记为合并成功。在合并改动之前，可以执行 <code>git diff &lt;source_branch&gt; &lt;target_branch&gt;</code> 以预览差异。</li>
<li><strong>标签</strong>：推荐为软件发布创建标签，你可以执行 <code>git tag 1.0.0 1b2e1d63ff</code> 以创建一个叫做 1.0.0 的标签，其中 1b2e1d63ff 是你想要标记的提交 ID 的前 10 位字符。可以执行 <code>git log</code> 以获取提交 ID，你也可以使用少一点的提交 ID 前几位，只要它的指向具有唯一性。</li>
<li><strong>历史记录</strong>：执行 <code>git log</code> 以了解本地仓库的历史记录。</li>
<li><strong>替换本地改动</strong>：假如你操作失误，执行 <code>git checkout -- &lt;filename&gt;</code> 替换掉本地改动，此命令会使用 HEAD 中的最新内容替换掉你的工作目录中的文件。已添加到暂存区的改动以及新文件都不会受到影响。假如你想丢弃你在本地的所有改动与提交，可以到服务器上获取最新的版本历史，并将你本地主分支指向它：执行 <code>git fetch origin</code> 和 <code>git reset --hard origin/master</code>。</li>
</ul>
]]></content>
      <categories>
        <category>Tutorial</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux 实用工具</title>
    <url>/contents/Linux-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7.html</url>
    <content><![CDATA[<p>Linux 的终端上有很多实用小工具，能提高工作效率，比如 tmux。</p>
<p>在此介绍他们的用法、配置和快捷键。</p>
<span id="more"></span>
<h1 id="tmux">TMUX</h1>
<p>参考资料：<a href="https://zhuanlan.zhihu.com/p/102546608">一文助你打通 tmux</a>，<a href="http://www.ruanyifeng.com/blog/2019/10/tmux.html">Tmux 使用教程</a></p>
<p>命令行的典型使用方式是，打开一个终端窗口（terminal window，以下简称 "窗口"），窗口可以被不断切割，切割成一个个小块，这一个个小块我们叫做窗格（pane）。在里面输入命令。用户与计算机的这种临时的交互，称为一次 "会话"（session） 。</p>
<p>会话的一个重要特点是，窗口与其中启动的进程是连在一起的。打开窗口，会话开始；关闭窗口，会话结束，会话内部的进程也会随之终止，不管有没有运行完。</p>
<p>Tmux 就是会话与窗口的 "解绑" 工具，将它们彻底分离：窗口关闭时，会话并不终止，而是继续运行，等到以后需要的时候，再让会话 "绑定" 其他窗口。</p>
<ol type="1">
<li><p>它允许在单个窗口中，同时访问多个会话。这对于同时运行多个命令行程序很有用。</p></li>
<li><p>它可以让新窗口 "接入" 已经存在的会话。</p></li>
<li><p>它允许每个会话有多个连接窗口，因此可以多人实时共享会话。</p></li>
<li><p>它还支持窗口任意的垂直和水平拆分。</p></li>
</ol>
<h2 id="tmux-的安装">tmux 的安装</h2>
<p>Linux 系统中通常使用 yum 来安装 tmux : <code>yum install tmux</code></p>
<p>Mac OS 系统中通常使用 brew 来安装 tmux :<code>brew install tmux</code></p>
<h2 id="tmux-的前缀键">tmux 的前缀键</h2>
<p>tmux 中的很多操作都是通过快捷键来实现的，通过快捷键我们可以更加高效的完成任务。如果想使用 tmux 中的快捷键，我们必须使用 tmux 的前缀按键 ctrl + b , 在 tmux 中所有的快捷键都需要通过前缀按键去唤起的。</p>
<h2 id="tmux-的会话常用操作">tmux 的会话常用操作</h2>
<table>
<colgroup>
<col style="width: 13%">
<col style="width: 69%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>操作</th>
<th>命令</th>
<th>快捷键</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>新建会话</td>
<td><code>tmux</code> / <code>tmux new -s &lt;session-name&gt;</code></td>
<td>无</td>
</tr>
<tr class="even">
<td>离开会话</td>
<td><code>tmux detach</code></td>
<td><code>(ctrl + b) d</code></td>
</tr>
<tr class="odd">
<td>查看会话列表</td>
<td><code>tmux ls</code></td>
<td><code>(ctrl + b) s</code></td>
</tr>
<tr class="even">
<td>进入会话</td>
<td><code>ta</code>/<code>tmux attach -t &lt;session-name&gt;</code></td>
<td>无</td>
</tr>
<tr class="odd">
<td>关闭会话</td>
<td><code>tmux kill-session -t &lt;session-name&gt;</code></td>
<td><code>ctrl + d</code></td>
</tr>
<tr class="even">
<td>切换会话</td>
<td><code>tmux switch -t &lt;session-name&gt;</code></td>
<td>无</td>
</tr>
<tr class="odd">
<td>重命名会话</td>
<td><code>tmux rename-session -t &lt;old-session-name&gt; &lt;new-session-name&gt;</code></td>
<td><code>(ctrl +b) $</code></td>
</tr>
</tbody>
</table>
<h2 id="tmux-的窗格常用操作">tmux 的窗格常用操作</h2>
<table>
<thead>
<tr class="header">
<th>操作</th>
<th>命令</th>
<th>快捷键</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>水平分割窗格</td>
<td><code>tmux split-window -h</code>（左右）</td>
<td><code>(ctrl + b) %</code>（左右）</td>
</tr>
<tr class="even">
<td>垂直分割窗格</td>
<td><code>tmux split-window</code> （上下）</td>
<td><code>(ctrl + b) “</code>（上下）</td>
</tr>
<tr class="odd">
<td>光标移动到上方窗格</td>
<td><code>tmux select-pane -U</code></td>
<td><code>(ctrl +b) ↑</code></td>
</tr>
<tr class="even">
<td>光标移动到下方窗格</td>
<td><code>tmux select-pane -D</code></td>
<td><code>(ctrl +b) ↓</code></td>
</tr>
<tr class="odd">
<td>光标移动到左边窗格</td>
<td><code>tmux select-pane -L</code></td>
<td><code>(ctrl +b) ←</code></td>
</tr>
<tr class="even">
<td>光标移动到右边窗格</td>
<td><code>tmux select-pane -R</code></td>
<td><code>(ctrl +b) →</code></td>
</tr>
<tr class="odd">
<td>光标切换到上一个窗格</td>
<td>无</td>
<td><code>(ctrl +b) ;</code></td>
</tr>
<tr class="even">
<td>光标切换到下一个窗格</td>
<td>无</td>
<td><code>(ctrl +b) o</code></td>
</tr>
<tr class="odd">
<td>当前窗格向上移动</td>
<td><code>tmux swap-pane -U</code></td>
<td>无</td>
</tr>
<tr class="even">
<td>当前窗格向下移动</td>
<td><code>tmux swap-pane -D</code></td>
<td>无</td>
</tr>
<tr class="odd">
<td>关闭当前的窗格</td>
<td>无</td>
<td><code>(ctrl +b) x</code></td>
</tr>
<tr class="even">
<td>最大化窗格</td>
<td>无</td>
<td><code>(ctrl +b) z</code> 触发两次还原当前的窗格大小</td>
</tr>
<tr class="odd">
<td>显示时间</td>
<td>无</td>
<td><code>(ctrl +b) t</code> 点击 Enter 将会复原</td>
</tr>
</tbody>
</table>
<h2 id="tmux-的窗口常用操作">tmux 的窗口常用操作</h2>
<table>
<colgroup>
<col style="width: 9%">
<col style="width: 35%">
<col style="width: 55%">
</colgroup>
<thead>
<tr class="header">
<th>操作</th>
<th>命令</th>
<th>快捷键</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>创建窗口</td>
<td><code>tmux new-window -n &lt;window-name&gt;</code></td>
<td><code>(ctrl + b) c</code></td>
</tr>
<tr class="even">
<td>切换窗口</td>
<td><code>tmux select-window -t &lt;window-name&gt;</code></td>
<td><code>(ctrl +b) w</code> 显示窗口列表可以通过 j,k 上下进行选择窗口，然后回车进入指定的窗口。<br><code>(ctrl +b) n</code> 快速切换到下一个窗口。<br><code>(ctrl +b) p</code> 快速切换到上一个窗口。</td>
</tr>
<tr class="odd">
<td>重命名窗口</td>
<td><code>tmux rename-window &lt;new-window-name&gt;</code></td>
<td><code>(ctrl +b) ,</code></td>
</tr>
<tr class="even">
<td>关闭窗口</td>
<td><code>tmux kill-window -t &lt;window-name&gt;</code></td>
<td><code>(ctrl +b) &amp;</code></td>
</tr>
</tbody>
</table>
<h2 id="tmux-的配置">tmux 的配置</h2>
<p>.tmux.conf 默认放在 ～（home 目录） 目录下面，以下是本人配置：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">set -g mode-keys vi</span><br><span class="line">set -g default-shell /bin/zsh</span><br><span class="line"></span><br><span class="line">set -g @plugin 'tmux-plugins/tpm'</span><br><span class="line">set -g @plugin 'tmux-plugins/tmux-sensible'</span><br><span class="line">set -g @plugin 'tmux-plugins/tmux-yank'</span><br><span class="line">set -g @plugin 'fcsonline/tmux-thumbs'</span><br><span class="line">set -g @plugin 'schasse/tmux-jump'</span><br><span class="line">set -g @plugin 'dracula/tmux'</span><br><span class="line"></span><br><span class="line">if '[ -f ~/dotfiles/tmux/bindings.tmux ]' 'source ~/dotfiles/tmux/bindings.tmux'</span><br><span class="line"></span><br><span class="line"># 主题配置</span><br><span class="line">set -g @dracula-show-battery false</span><br><span class="line">set -g @dracula-show-network false</span><br><span class="line">set -g @dracula-show-weather false</span><br><span class="line">set -g @dracula-show-timezone false</span><br><span class="line">set -g @dracula-military-time true</span><br><span class="line">set -g @dracula-border-contrast true</span><br><span class="line">set -g @dracula-cpu-usage true</span><br><span class="line">set -g @dracula-ram-usage tr</span><br><span class="line"></span><br><span class="line">run '~/.tmux/plugins/tpm/tpm'</span><br></pre></td></tr></tbody></table></figure>
<ol type="1">
<li>tmux-plugins/tpm 是 <a href="https://github.com/tmux-plugins/tpm">Tmux Plugin Manager</a>，即 Tmux 的插件管理工具。</li>
<li>tmux-plugins/<a href="https://github.com/tmux-plugins/tmux-sensible">tmux-sensible</a>，一组人人都能接受的选项。</li>
<li>tmux-plugins/<a href="https://github.com/tmux-plugins/tmux-yank">tmux-yank</a>，允许拷贝至系统剪切板。</li>
<li>schasse/<a href="https://github.com/schasse/tmux-jump">tmux-jump</a>，按 <code>tmux-prefix</code>+<code>j</code> 键进入 jump 模式，输入需要跳转到的位置的字符，屏幕会高亮显示符合条件的位置并分配一个 key，输入 key 后光标就会跳转至选中位置。</li>
<li><a href="https://draculatheme.com/tmux">dracula 主题</a>。</li>
</ol>
<p>在 Tmux 中，安装插件的一些快捷命令如下:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">prefix shift-i      # install</span><br><span class="line">prefix shift-u      # update</span><br><span class="line">prefix alt-u        # uninstall plugins not on the plugin list</span><br></pre></td></tr></tbody></table></figure>
<p>bindings.tmux 文件：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"># -- general -------------------------------------------------------------------</span><br><span class="line">set -g default-terminal "screen-256color" # colors!</span><br><span class="line">setw -g xterm-keys on</span><br><span class="line">set -s escape-time 10                     # faster command sequences</span><br><span class="line">set -sg repeat-time 300                   # increase repeat timeout</span><br><span class="line">set -s focus-events on</span><br><span class="line">set -g prefix2 C-a                        # GNU-Screen compatible prefix</span><br><span class="line">bind C-a send-prefix -2</span><br><span class="line">set -q -g status-utf8 on                  # expect UTF-8 (tmux &lt; 2.2)</span><br><span class="line">setw -q -g utf8 on</span><br><span class="line">set -g history-limit 5000                 # boost history</span><br><span class="line"></span><br><span class="line"># edit configuration</span><br><span class="line"># bind e new-window -n "~/.tmux.conf.local" "sh -c '\${EDITOR:-vim} ~/.tmux.conf.local &amp;&amp; tmux source ~/.tmux.conf &amp;&amp; tmux display \"~/.tmux.conf sourced\"'"</span><br><span class="line">bind E command-prompt -p "Command:" \</span><br><span class="line">       "run \"tmux list-panes -a -F '##{session_name}:##{window_index}.##{pane_index}' \</span><br><span class="line">              | xargs -I PANE tmux send-keys -t PANE '%1' Enter\""</span><br><span class="line"></span><br><span class="line"># reload configuration</span><br><span class="line">bind r source-file ~/.tmux.conf \; display '~/.tmux.conf sourced'</span><br><span class="line"></span><br><span class="line"># send the prefix to client inside window</span><br><span class="line">bind-key -n C-q send-prefix</span><br><span class="line"></span><br><span class="line"># -- display -------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">set -g base-index 1           # start windows numbering at 1</span><br><span class="line">setw -g pane-base-index 1     # make pane numbering consistent with windows</span><br><span class="line"></span><br><span class="line">setw -g automatic-rename on   # rename window to reflect current program</span><br><span class="line">set -g renumber-windows on    # renumber windows when a window is closed</span><br><span class="line"></span><br><span class="line">set -g set-titles on          # set terminal title</span><br><span class="line"></span><br><span class="line"># fix the window name</span><br><span class="line">set-option -g allow-rename off</span><br><span class="line"></span><br><span class="line">set -g display-panes-time 800 # slightly longer pane indicators display time</span><br><span class="line">set -g display-time 1000      # slightly longer status messages display time</span><br><span class="line">set -g status-interval 10     # redraw status line every 10 seconds</span><br><span class="line"></span><br><span class="line"># clear both screen and history</span><br><span class="line">bind -n C-l send-keys C-l \; run 'sleep 0.1' \; clear-history</span><br><span class="line"></span><br><span class="line"># activity</span><br><span class="line">set -g monitor-activity on</span><br><span class="line">set -g visual-activity off</span><br><span class="line"></span><br><span class="line"># -- navigation ----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># create session</span><br><span class="line">bind C-c new-session</span><br><span class="line"></span><br><span class="line"># find session</span><br><span class="line">bind C-f command-prompt -p find-session 'switch-client -t %%'</span><br><span class="line"></span><br><span class="line"># split current window horizontally</span><br><span class="line">bind - split-window -v -c "#{pane_current_path}"</span><br><span class="line"># split current window vertically</span><br><span class="line">bind _ split-window -h -c "#{pane_current_path}"</span><br><span class="line">bind | split-window -h -c "#{pane_current_path}"</span><br><span class="line"></span><br><span class="line">bind c new-window -c "#{pane_current_path}"</span><br><span class="line"></span><br><span class="line"># pane navigation</span><br><span class="line">bind -r h select-pane -L  # move left</span><br><span class="line">bind -r j select-pane -D  # move down</span><br><span class="line">bind -r k select-pane -U  # move up</span><br><span class="line">bind -r l select-pane -R  # move right</span><br><span class="line">bind -r &gt; swap-pane -D       # swap current pane with the next one</span><br><span class="line">bind -r &lt; swap-pane -U       # swap current pane with the previous one</span><br><span class="line"></span><br><span class="line"># pane resizing</span><br><span class="line">bind -r H resize-pane -L 2</span><br><span class="line">bind -r J resize-pane -D 2</span><br><span class="line">bind -r K resize-pane -U 2</span><br><span class="line">bind -r L resize-pane -R 2</span><br><span class="line"></span><br><span class="line"># window navigation</span><br><span class="line">unbind n</span><br><span class="line">unbind p</span><br><span class="line">bind -r C-h previous-window # select previous window</span><br><span class="line">bind -r C-l next-window     # select next window</span><br><span class="line">bind Tab last-window        # move to last active window</span><br><span class="line"></span><br><span class="line"># kill pane</span><br><span class="line">bind -r W kill-pane</span><br><span class="line">bind C-w kill-pane</span><br><span class="line"></span><br><span class="line"># -- copy mode -----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">bind Enter copy-mode # enter copy mode</span><br><span class="line"></span><br><span class="line">run -b 'tmux bind -t vi-copy v begin-selection 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -T copy-mode-vi v send -X begin-selection 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -t vi-copy C-v rectangle-toggle 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -T copy-mode-vi C-v send -X rectangle-toggle 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -t vi-copy y copy-selection 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -T copy-mode-vi y send -X copy-selection-and-cancel 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -t vi-copy Escape cancel 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -T copy-mode-vi Escape send -X cancel 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -t vi-copy H start-of-line 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -T copy-mode-vi H send -X start-of-line 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -t vi-copy L end-of-line 2&gt; /dev/null || true'</span><br><span class="line">run -b 'tmux bind -T copy-mode-vi L send -X end-of-line 2&gt; /dev/null || true'</span><br><span class="line"></span><br><span class="line"># copy to macOS clipboard</span><br><span class="line">if -b 'command -v pbcopy &gt; /dev/null 2&gt;&amp;1' 'bind y run -b "tmux save-buffer - | pbcopy"'</span><br><span class="line">if -b 'command -v reattach-to-user-namespace &gt; /dev/null 2&gt;&amp;1' 'bind y run -b "tmux save-buffer - | reattach-to-user-namespace pbcopy"'</span><br><span class="line"># copy to X11 clipboard</span><br><span class="line">if -b 'command -v xsel &gt; /dev/null 2&gt;&amp;1' 'bind y run -b "tmux save-buffer - | xsel -i -b"'</span><br><span class="line">if -b '! command -v xsel &gt; /dev/null 2&gt;&amp;1 &amp;&amp; command -v xclip &gt; /dev/null 2&gt;&amp;1' 'bind y run -b "tmux save-buffer - | xclip -i -selection clipboard &gt;/dev/null 2&gt;&amp;1"'</span><br><span class="line"># copy to Windows clipboard</span><br><span class="line">if -b 'command -v clip.exe &gt; /dev/null 2&gt;&amp;1' 'bind y run -b "tmux save-buffer - | clip.exe"'</span><br><span class="line">if -b '[ -c /dev/clipboard ]' 'bind y run -b "tmux save-buffer - &gt; /dev/clipboard"'</span><br><span class="line"></span><br><span class="line"># -- buffers -------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">bind b list-buffers  # list paste buffers</span><br><span class="line">bind p paste-buffer  # paste from the top paste buffer</span><br><span class="line">bind P choose-buffer # choose which buffer to paste from</span><br><span class="line"></span><br><span class="line"># -- mouse mode ----------------------------------------------------------------</span><br><span class="line">set -g mouse on</span><br><span class="line"></span><br><span class="line"># Toggle mouse on</span><br><span class="line">bind-key M \</span><br><span class="line">  set-option -g mouse on \;\</span><br><span class="line">  display-message 'Mouse: ON'</span><br><span class="line"></span><br><span class="line"># Toggle mouse off</span><br><span class="line">bind-key m \</span><br><span class="line">  set-option -g mouse off \;\</span><br><span class="line">  display-message 'Mouse: OFF'</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>Tutorial</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning：1. Regression</title>
    <url>/contents/ML-1-Regression.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="3e5c4a0e9281c28a161bfe9e1b2e5f40cea04ffba99f511d956e370409925855">0995c6aa457762375935b1a6315531ef338c34f46eb6de53b0f748d9bb9ef8dd0a232936228668da1f7497eacb12b5b5093e71a439cedc7209702c12bf711b7e4ff8d33db961e725ecd7f968280234f55a027e67053dad3696426289ef240422c2dcc158755e84039ab36c784e2f836a4d847f02a3f1418adedd0b4b69d8c953051bd844a4a5a30c80412b74a3731a10f4780af9bcd11e01c9bdc0e8cdcab4ad21c014c60ac18aa48307df5b0678c890ef0f6c95a2298c96af782b16d7be71370fd613204d2a130f502042b0058b90c616d19e335dba5f3d212f2358dee72de82907041d8d8d9f9bd88a2d915096a360c025bef01b895a807ecd074fd80192da0af118fbf48592e67b212c91aba6641292048174045b82e2ebeca86c2c3829cfef2988d2a9d49b7fe1adeed076dca4fdf07537edaf4bf10a522f025af61e80697aa170f8317fdfd6b0afc643bf2689d15aefe82a7ffceeee8d6488f3eb73d38a98a404d73bfe1419ab8d97b3e1092d5216967cce56d4415eb8b4c758a5b22c21d3598b60774f9d7524d36885d0387625bec74a4cadde9bb47397f09340b4c06370860a761c4a0600184910807eb63ff7ee1cd5e37e5c3248f09eddcc3d93effbba55402ad305a6f7051afb26a5a44382f44a5b479b6bdfca753a06266cd136cae0ce1b9854170b8a13824941d2fc3c435af36fa2c23084b29b87dc2aa6bce44ae8bf186934275738acb0fd401eea9ce2f0d2c7052b4ab55f202a8d4512846998a2d5e08d81e0b549f2aed8aa88451ffabfa8f7bc7e9cbc0eeedeadfa40a78ca2e53bbbac8702f5a62a3cdff50c5265ec64f623d30b2c0555369f657d9703b8c305f024d2c35e574ee8eaee0bc42d1583e1741ec10511ac2e044bba3ab87591b4fd0e144550de5f72ca4688a7109490e6a6e8e15b76ac4d5b725400b35e457cfd39064c26b5c1ed0f1a7086058cca4c29a4c9af4ab90941913d20e97bcf3cd4e3b424dfd26810d04267a2a35f1fd168dbb6ffd4c21494436570727fec24e15bda</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Enter the password to read.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Learning Notes</tag>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>PySpark 的 DataFrame 与 Pandas 的 DataFrame 的比较</title>
    <url>/contents/PySpark%E7%9A%84DataFrame%E4%B8%8EPandas%E7%9A%84DataFrame%E7%9A%84%E6%AF%94%E8%BE%83.html</url>
    <content><![CDATA[<p>PySpark 和 Pandas 中都有 DataFrame 这个数据结构，但是他们的使用方法大有不同。<br>
Reference：<a href="https://zhuanlan.zhihu.com/p/34901585">pyspark 系列 --pandas 与 pyspark 对比</a> ;<a href="http://moverzp.com/2018/03/17/Pandas%E5%92%8CPySpark%E4%B8%AD%E7%9A%84DataFrame%E6%AF%94%E8%BE%83/">Pandas 和 PySpark 中的 DataFrame 比较</a> ;<a href="https://spark.apache.org/docs/latest/api/python/pyspark.sql.html">PySpark API</a>;<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">Pandas API</a><br>
<span id="more"></span></p>
<h1 id="工作方式">工作方式</h1>
<ul>
<li><p>PySpark<br>
分布式并行计算框架，内建并行机制 parallelism，所有的数据和操作自动并行分布在各个集群结点上。以处理 in-memory 数据的方式处理 distributed 数据。支持 Hadoop，能处理大量数据<br>
<code>import pyspark.sql.functions as F</code> 导入内置函数库</p></li>
<li><p> Pandas<br>
单机 single machine tool，没有并行机制 parallelism，不支持 Hadoop，处理大量数据有瓶颈</p></li>
</ul>
<h1 id="延迟机制">延迟机制</h1>
<ul>
<li><p>PySpark<br>
lazy-evaluated</p></li>
<li><p>Pandas<br>
not lazy-evaluated</p></li>
</ul>
<p>注：在程式语言理论中，<strong>惰性求值</strong>（英语：Lazy Evaluation），又译为<strong>惰性计算</strong>、<strong>懒惰求值</strong>，也称为<strong>传需求调用</strong>（call-by-need），是一个计算机编程中的一个概念，目的是要最小化计算机要做的工作。它有两个相关而又有区别的含意，可以表示为 “延迟求值” 和 “最小化求值”。在使用延迟求值的时候，表达式不在它被绑定到变量之后就立即求值，而是在该值被取用的时候求值</p>
<h1 id="内存缓存">内存缓存</h1>
<ul>
<li><p>PySpark<br>
persist () 或 cache () 将转换的 RDDs 保存在内存</p></li>
<li><p> Pandas<br>
单机缓存</p></li>
</ul>
<h1 id="dataframe可变性">DataFrame 可变性</h1>
<ul>
<li><p>PySpark<br>
Spark 中 RDDs 是不可变的，因此 DataFrame 也是不可变的</p></li>
<li><p> Pandas<br>
Pandas 中 DataFrame 是可变的</p></li>
</ul>
<h1 id="创建">创建</h1>
<ul>
<li>PySpark<br>
直接创建： <code>spark_df = sc.parallelize([(1, 2), (3, 4)]).toDF(['xx',  'yy']</code><br>
从 pandas_df 转换：<code>spark_df = SQLContext.createDataFrame(pandas_df)</code><br>
另外，createDataFrame 支持从 list 转换 spark_df，其中 list 元素可以为 tuple，dict，rdd<br>
读取 CSV 文件：<code>spark_df = spark.read.csv(csv_path, header=True)</code> 如果 CSV 文件有 header，则将其读取为列名<br>
读取 parquet 文件：<code>spark_df = spark.read.parquet(parquet_path)</code><br>
读取 json 文件：<code>spark_df = spark.read.json(json_path)</code><br>
读取 txt 文件：<code>spark_df = sc.textFile(txt_path).toDF()</code><br>
注：这些 path 均为 HDFS 路径</li>
<li> Pandas<br>
直接创建： <code>pandas_df = pd.DataFrame({'xx': {0: 1, 1: 3}, 'yy':  {0: 2, 1: 4}})</code><br>
从 spark_df 转换：<code>pandas_df = spark_df.toPandas()</code>，或读取其他数据<br>
读取 CSV 文件：<code>pd.read_csv(csv_path)</code><br>
读取 parquet 文件：<code>pd.read_parquet(parquet_path)</code>，其中如果 parquet_path 如果是 HDFS 路径则需要加前缀 'hdfs://'，比如：<code>'hdfs:///projects/path/to/parquet/'</code></li>
</ul>
<h1 id="写入">写入</h1>
<ul>
<li><p>PySpark<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.repartition(partition_num).write.mode(<span class="string">'overwrite'</span>/<span class="string">'append'</span>).partitionBy(col_name).parquet(parquet_path)</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Pandas<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.to_csv(csv_path, index=<span class="literal">True</span>/<span class="literal">False</span>) <span class="comment"># 是否保留index</span></span><br><span class="line">df.to_pickle(csv_pickle)</span><br><span class="line">df.to_parquet(parquet_path)</span><br><span class="line">df.to_csv(csv_path, index=<span class="literal">True</span>/<span class="literal">False</span>)</span><br></pre></td></tr></tbody></table></figure><p></p></li>
</ul>
<h1 id="index索引">index 索引</h1>
<ul>
<li><p>PySpark<br>
没有 index 索引，若需要则要额外创建该列<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.withColumn(<span class="string">'index'</span>, F.row_number().over(Window.orderBy(F.monotonically_increasing_id())))</span><br><span class="line">df.rdd.zipWithIndex().toDF().select(F.col(<span class="string">'_1'</span>).getItem(<span class="string">'col_name_1'</span>).alias(<span class="string">'col_name_1'</span>), F.col(<span class="string">'_2'</span>).getItem(<span class="string">'col_name_2'</span>).alias(<span class="string">'col_name_2'</span>), ..., F.col(<span class="string">'_n'</span>).getItem(<span class="string">'col_name_n'</span>).alias(<span class="string">'col_name_n'</span>), F.col(<span class="string">'_(n+1)'</span>).alias(<span class="string">'row_index'</span>)) <span class="comment"># 此方法更快</span></span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Pandas<br>
自动创建<br>
注：当将 pandas_df 转换为 spark_df 时如需保留索引，则可用<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">spark_df = SQLContext.createDataFrame(pandas_df.reset_index())</span><br></pre></td></tr></tbody></table></figure><p></p></li>
</ul>
<h1 id="行结构">行结构</h1>
<ul>
<li><p>PySpark<br>
Row 结构，属于 Spark DataFrame 结构</p></li>
<li><p> Pandas<br>
Series 结构，属于 Pandas DataFrame 结构</p></li>
</ul>
<h1 id="列结构">列结构</h1>
<ul>
<li><p>PySpark<br>
Column 结构，属于 Spark DataFrame 结构，如：<code>DataFrame[name: string]</code></p></li>
<li><p>Pandas<br>
Series 结构，属于 Pandas DataFrame 结构</p></li>
</ul>
<h1 id="列名称">列名称</h1>
<ul>
<li>PySpark<br>
允许重名，修改列名采用 alias 方法<br>
修改列名：<code>df.withColumnRenamed('old_name', 'new_name')</code><br>
<code>df.select(F.col('old_name').alias('new_name'), ...)</code><br>
<code>df.selectExpr('old_name as new_name', ...)</code></li>
<li>Pandas<br>
不允许重名<br>
修改列名：<code>df.rename(columns={'old_name': 'new_name'})</code></li>
</ul>
<h1 id="列修改">列修改</h1>
<ul>
<li>PySpark<br>
原来有 <code>df['xx']</code> 列，<code>df.withColumn('xx', 1)</code><br>
如需判断逻辑：<code>df.withColumn('xx', F.when(condition expression, true expression).otherwise(false expression))</code><br>
如需链接：<code>df.withColumn('xx', F.concat(F.col('yy'), F.lit('-'), F.col('zz')))</code> 其中 yy 和 zz 列须为 string 类型，如不是则需要提前类型转换。<br>
从文件路径取值：<code>df.withColumn('xx', F.input_file_name().substr(start_index, stop_index))</code></li>
<li>Pandas<br>
原来有 <code>df['xx']</code> 列，<code>df['xx'] = 1</code><br>
如需判断逻辑：<code>df.loc[condition expression, 'xx'] = true expression</code><br>
<code>df.loc[~condition expression, 'xx'] = false expression</code><br>
<code>df['xx'] = np.where(condition expression, true expression, false expression)</code><br>
<code>df['xx'] = df.apply(lambda x: true expression if condition expression else false expression, axis=1)</code><br>
如需链接：<code>df['xx'] = df.yy + '-' + df.zz</code> 其中 yy 和 zz 列须为 string 类型，如不是则需要提前类型转换。</li>
</ul>
<h1 id="显示">显示</h1>
<ul>
<li>PySpark<br>
df 不输出具体内容，输出具体内容用 show 方法。<code>df.show(5, truncate=100)</code> 默认显示 20 行，每行显示长度通过 truncate 参数设置<br>
以树的形式打印概要：<code>df.printSchema()</code><br>
<code>df.columns</code> 输出列的名字</li>
<li> Pandas<br>
df 输出具体内容<br>
<code>df.columns</code> 输出列的名字<br>
<code>pd.set_option('display.max_columns', None) # 显示所有列</code><br>
<code>pd.set_option('max_colwidth', 100) # 每行显示长度设置</code><br>
<code>pd.set_option('display.max_rows', None) # 显示所有行</code></li>
</ul>
<h1 id="排序">排序</h1>
<ul>
<li><p>PySpark<br>
<code>df.sort(df.xx.asc(),df.yy.desc())</code><br>
<code>df.sort(F.asc('xx'),F.desc('yy'))</code><br>
<code>df.sort(F.col("xx").asc(), F.col("yy").desc())</code><br>
<code>df.orderBy(F.col("xx").asc(), F.col("yy").desc())</code><br>
在列中按值依次进行排序，指定先升序后降序</p></li>
<li><p> Pandas<br>
<code>df.sort_index()</code> 按轴进行升序排序<br>
<code>df.sort_values(['xx', 'yy'], ascending=[True, False])</code> 在列中按值依次进行排序，指定先升序后降序<br>
<code>df.sort_values(['xx', 'yy'], axis=0)</code>，<code>df.sort_values([1, 2], axis=1)</code> 在列、行中按值进行升序排序</p></li>
</ul>
<h1 id="选择或切片">选择或切片</h1>
<ul>
<li><p>PySpark<br>
<code>df.select('xx', 'yy')</code> 选择一列或多列<br>
<code>df.first()</code> 以行的形式返回第一行。（注：行的形式为 <code>[Row(col_name1=value1, col_name2=value2, ...)]</code>）<br>
<code>df.head(n)</code>，<code>df.take(n)</code> 以行的形式返回前 n 行；<code>df.tail(n)</code> 以行的形式返回最后 n 行<br>
用 <code>df.collect()</code> 以行的形式返回所有行</p></li>
<li><p> Pandas<br>
<code>df.xx</code>，<code>df['xx']</code> 选择列名为 xx 的列，df [k] 选择行名为 k 的行<br>
<code>df.iat[:, k]</code>，<code>df.iloc[:, k]</code> 选择第 k 列，<code>df.iat[k]</code>，<code>df.iloc[k]</code> 选择第 k 行</p></li>
</ul>
<h1 id="过滤">过滤</h1>
<ul>
<li><p>PySpark<br>
<code>df.filter(df['xx'] &gt; k)</code> 或者 <code>df.where(df['xx'] &gt; k)</code></p>
<p>取值存在于：<code>df.filter(F.col('xx').isin(filter_list))</code></p>
<p>空值处理：</p>
<ul>
<li>值为 null：<code>df.filter(F.col('xx').isNull())</code> 和 <code>df.filter(F.col('xx').isNotNull())</code></li>
<li>值为空字符串：<code>df.filter(F.col('xx') == '')</code></li>
<li>值为 np.nan：<code>df.filter(F.col('xx') == np.nan)</code></li>
</ul></li>
<li><p>Pandas<br>
<code>df[df['xx']&gt;k]</code> 或者 <code>s[s&gt;k]</code></p>
<p>取值存在于：<code>df[df.xx.isin(filter_list)]</code></p>
<p>空值处理：包括 null，np.NaN，pd.NaT，None，不包括空字符串 <code>df[df.xx.isnull()]</code> 或 <code>df[df.xx.isna()]</code> 和 <code>df.filter(F.col('xx').notnull())</code> 或 <code>df[df.xx.notnull()]</code> 或 <code>df[df.xx.notna()]</code></p></li>
<li><p>Examples:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">&gt;&gt; pdf = pd.DataFrame(<span class="built_in">dict</span>(numpy=[np.NaN], pandas=[pd.NaT], empty=[<span class="string">''</span>], none=[<span class="literal">None</span>]))</span><br><span class="line">&gt;&gt; pdf</span><br><span class="line">   numpy pandas empty  none</span><br><span class="line"><span class="number">0</span>    NaN    NaT        <span class="literal">None</span></span><br><span class="line">&gt;&gt; pdf.isnull()</span><br><span class="line">   numpy  pandas  empty  none</span><br><span class="line"><span class="number">0</span>   <span class="literal">True</span>    <span class="literal">True</span>  <span class="literal">False</span>  <span class="literal">True</span></span><br><span class="line">&gt;&gt; <span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> *</span><br><span class="line">&gt;&gt; sdf = spark.createDataFrame(pdf, StructType([StructField(<span class="string">'numpy'</span>, DoubleType(), <span class="literal">True</span>),StructField(<span class="string">'pandas'</span>, StringType(), <span class="literal">True</span>),StructField(<span class="string">'empty'</span>, StringType(), <span class="literal">True</span>),StructField(<span class="string">'pandas'</span>, StringType(), <span class="literal">True</span>)])) <span class="comment"># 必须指定schema，否则报错”ValueError: Some of types cannot be determined after inferring“</span></span><br><span class="line">&gt;&gt; sdf.show()</span><br><span class="line">+-----+------+-----+------+</span><br><span class="line">|numpy|pandas|empty|pandas|</span><br><span class="line">+-----+------+-----+------+</span><br><span class="line">|  NaN|  null|     |  null|</span><br><span class="line">+-----+------+-----+------+</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h1 id="分组聚合">分组聚合</h1>
<ul>
<li><p>PySpark<br>
<code>df.groupBy(cols_to_group)</code> 或者 <code>df.groupBy(cols_to_group).avg('xx').show()</code> 应用单个函数<br>
<code>df.groupBy(cols_to_group).agg(F.avg('xx'), F.min('xx'), F.max('xx')).show()</code> 应用多个函数</p></li>
<li><p> Pandas<br>
<code>df.groupby(cols_to_group)</code><br>
<code>df.groupby(cols_to_group).avg('xx')</code></p>
<p>group filter by function: <code>df.groupby(cols_to_group).filter(function)</code></p></li>
</ul>
<h1 id="统计">统计</h1>
<ul>
<li><p>PySpark<br>
<code>df.count()</code> 输出总行数<br>
<code>df.describe()</code> 描述某些列的 count, mean, stddev, min, max</p></li>
<li><p>Pandas<br>
<code>df.count()</code> 输出每一列的非空行数<br>
<code>df.shape</code> 输出行数 x 列数<br>
<code>df.describe()</code> 描述某些列的 count, mean, std, min, 25%, 50%, 75%, max</p></li>
</ul>
<h1 id="合并">合并</h1>
<ul>
<li><p>PySpark<br>
扩充列<br>
<code>df.join()</code> 同名列不自动添加后缀，只有键值完全匹配才保留一份副本<br>
'inner', 'outer', 'full', 'fullouter', 'full_outer', 'leftouter', 'left', 'left_outer', 'rightouter', 'right', 'right_outer', 'leftsemi', 'left_semi', 'leftanti', 'left_anti', 'cross'.<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">&gt;&gt; df_left = spark.createDataFrame(pd.DataFrame({<span class="string">'Keys'</span>: [<span class="string">'key1'</span>, <span class="string">'key2'</span>, <span class="string">'key3'</span>, <span class="string">'key4'</span>, <span class="string">'key5'</span>], <span class="string">'Values_Left'</span>: [<span class="string">'value1'</span>, <span class="string">'value2'</span>, <span class="string">'value3'</span>, <span class="string">'value4'</span>, <span class="string">'value5'</span>]}, index=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]))</span><br><span class="line">&gt;&gt; df_left.show()</span><br><span class="line">+----+-----------+</span><br><span class="line">|Keys|Values_Left|</span><br><span class="line">+----+-----------+</span><br><span class="line">|key1|     value1|</span><br><span class="line">|key2|     value2|</span><br><span class="line">|key3|     value3|</span><br><span class="line">|key4|     value4|</span><br><span class="line">|key5|     value5|</span><br><span class="line">+----+-----------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_right = spark.createDataFrame(pd.DataFrame({<span class="string">'Keys'</span>: [<span class="string">'key1'</span>, <span class="string">'key2'</span>, <span class="string">'key2'</span>, <span class="string">'key3'</span>, <span class="string">'key6'</span>], <span class="string">'Values_Right'</span>: [<span class="string">'value6'</span>, <span class="string">'value7'</span>, <span class="string">'value8'</span>, <span class="string">'value9'</span>, <span class="string">'value10'</span>]}, index=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]))</span><br><span class="line">&gt;&gt; df_right.show()</span><br><span class="line">+----+------------+</span><br><span class="line">|Keys|Values_Right|</span><br><span class="line">+----+------------+</span><br><span class="line">|key1|      value6|</span><br><span class="line">|key2|      value7|</span><br><span class="line">|key2|      value8|</span><br><span class="line">|key3|      value9|</span><br><span class="line">|key6|     value10|</span><br><span class="line">+----+------------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_left.join(df_right, [<span class="string">'Keys'</span>], <span class="string">'left'</span>).sort(<span class="string">'Keys'</span>).show() <span class="comment"># left=leftouter=left_outer</span></span><br><span class="line">+----+-----------+------------+</span><br><span class="line">|Keys|Values_Left|Values_Right|</span><br><span class="line">+----+-----------+------------+</span><br><span class="line">|key1|     value1|      value6|</span><br><span class="line">|key2|     value2|      value7|</span><br><span class="line">|key2|     value2|      value8|</span><br><span class="line">|key3|     value3|      value9|</span><br><span class="line">|key4|     value4|        null|</span><br><span class="line">|key5|     value5|        null|</span><br><span class="line">+----+-----------+------------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_right.join(df_left, [<span class="string">'Keys'</span>], <span class="string">'right'</span>).sort(<span class="string">'Keys'</span>).show() <span class="comment"># right=rightouter=right_outer</span></span><br><span class="line">+----+------------+-----------+</span><br><span class="line">|Keys|Values_Right|Values_Left|</span><br><span class="line">+----+------------+-----------+</span><br><span class="line">|key1|      value6|     value1|</span><br><span class="line">|key2|      value7|     value2|</span><br><span class="line">|key2|      value8|     value2|</span><br><span class="line">|key3|      value9|     value3|</span><br><span class="line">|key4|        null|     value4|</span><br><span class="line">|key5|        null|     value5|</span><br><span class="line">+----+------------+-----------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_left.join(df_right, [<span class="string">'Keys'</span>], <span class="string">'left_semi'</span>).sort(<span class="string">'Keys'</span>).show() <span class="comment"># left_semi=leftsemi</span></span><br><span class="line">+----+-----------+</span><br><span class="line">|Keys|Values_Left|</span><br><span class="line">+----+-----------+</span><br><span class="line">|key1|     value1|</span><br><span class="line">|key2|     value2|</span><br><span class="line">|key3|     value3|</span><br><span class="line">+----+-----------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_left.join(df_right, [<span class="string">'Keys'</span>], <span class="string">'left_anti'</span>).sort(<span class="string">'Keys'</span>).show() <span class="comment"># leftanti=left_anti</span></span><br><span class="line">+----+-----------+</span><br><span class="line">|Keys|Values_Left|</span><br><span class="line">+----+-----------+</span><br><span class="line">|key4|     value4|</span><br><span class="line">|key5|     value5|</span><br><span class="line">+----+-----------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_left.join(df_right, [<span class="string">'Keys'</span>], <span class="string">'inner'</span>).sort(<span class="string">'Keys'</span>).show()</span><br><span class="line">+----+-----------+------------+</span><br><span class="line">|Keys|Values_Left|Values_Right|</span><br><span class="line">+----+-----------+------------+</span><br><span class="line">|key1|     value1|      value6|</span><br><span class="line">|key2|     value2|      value8|</span><br><span class="line">|key2|     value2|      value7|</span><br><span class="line">|key3|     value3|      value9|</span><br><span class="line">+----+-----------+------------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_left.join(df_right, [<span class="string">'Keys'</span>], <span class="string">'outer'</span>).sort(<span class="string">'Keys'</span>).show() <span class="comment"># outer=full=fullouter=full_outer</span></span><br><span class="line">+----+-----------+------------+</span><br><span class="line">|Keys|Values_Left|Values_Right|</span><br><span class="line">+----+-----------+------------+</span><br><span class="line">|key1|     value1|      value6|</span><br><span class="line">|key2|     value2|      value8|</span><br><span class="line">|key2|     value2|      value7|</span><br><span class="line">|key3|     value3|      value9|</span><br><span class="line">|key4|     value4|        null|</span><br><span class="line">|key5|     value5|        null|</span><br><span class="line">|key6|       null|     value10|</span><br><span class="line">+----+-----------+------------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_left = df_left.withColumnRenamed(<span class="string">'Keys'</span>, <span class="string">'Keys_Left'</span>)</span><br><span class="line">&gt;&gt; df_right = df_right.withColumnRenamed(<span class="string">'Keys'</span>, <span class="string">'Keys_Right'</span>)</span><br><span class="line">&gt;&gt; df_left.join(df_right, df_left.Keys_Left==df_right.Keys_Right, <span class="string">'cross'</span>).show()</span><br><span class="line">+---------+-----------+----------+------------+</span><br><span class="line">|Keys_Left|Values_Left|Keys_Right|Values_Right|</span><br><span class="line">+---------+-----------+----------+------------+</span><br><span class="line">|     key1|     value1|      key1|      value6|</span><br><span class="line">|     key2|     value2|      key2|      value8|</span><br><span class="line">|     key2|     value2|      key2|      value7|</span><br><span class="line">|     key3|     value3|      key3|      value9|</span><br><span class="line">+---------+-----------+----------+------------+</span><br><span class="line"></span><br><span class="line">&gt;&gt; df_left.crossJoin(df_right).show(<span class="number">25</span>)</span><br><span class="line">+---------+-----------+----------+------------+</span><br><span class="line">|Keys_Left|Values_Left|Keys_Right|Values_Right|</span><br><span class="line">+---------+-----------+----------+------------+</span><br><span class="line">|     key1|     value1|      key1|      value6|</span><br><span class="line">|     key1|     value1|      key2|      value7|</span><br><span class="line">|     key1|     value1|      key2|      value8|</span><br><span class="line">|     key1|     value1|      key3|      value9|</span><br><span class="line">|     key1|     value1|      key6|     value10|</span><br><span class="line">|     key2|     value2|      key1|      value6|</span><br><span class="line">|     key2|     value2|      key2|      value7|</span><br><span class="line">|     key2|     value2|      key2|      value8|</span><br><span class="line">|     key2|     value2|      key3|      value9|</span><br><span class="line">|     key2|     value2|      key6|     value10|</span><br><span class="line">|     key3|     value3|      key1|      value6|</span><br><span class="line">|     key3|     value3|      key2|      value7|</span><br><span class="line">|     key3|     value3|      key2|      value8|</span><br><span class="line">|     key3|     value3|      key3|      value9|</span><br><span class="line">|     key3|     value3|      key6|     value10|</span><br><span class="line">|     key4|     value4|      key1|      value6|</span><br><span class="line">|     key4|     value4|      key2|      value7|</span><br><span class="line">|     key4|     value4|      key2|      value8|</span><br><span class="line">|     key4|     value4|      key3|      value9|</span><br><span class="line">|     key4|     value4|      key6|     value10|</span><br><span class="line">|     key5|     value5|      key1|      value6|</span><br><span class="line">|     key5|     value5|      key2|      value7|</span><br><span class="line">|     key5|     value5|      key2|      value8|</span><br><span class="line">|     key5|     value5|      key3|      value9|</span><br><span class="line">|     key5|     value5|      key6|     value10|</span><br><span class="line">+---------+-----------+----------+------------+</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>扩充行<br>
<code>df.union()</code>：两个 df 合并，按位置进行合并，列名以前表为准（a.union (b) 列名顺序以 a 为准）<br>
<code>df.unoinAll()</code>：同 union 方法<br>
<code>df.unionByName()</code>：两个 df 合并，按列名进行合并<br>
<code>df1.unionByName(df2).unionByName(df3)</code></p></li>
<li><p>Pandas<br>
Pandas 下有 <code>concat</code> 方法，支持轴向合并<br>
<code>pd.concat([df1, df2, df3], ignore_index=True, sort=False)</code><br>
<code>df1.append([df2, df3], ignore_index=True, sort=False)</code><br>
<code>df1.join([df2, df3])</code><br>
Pandas 下有 <code>merge</code> 方法，支持多列合并<br>
同名列自动添加后缀，对应键仅保留一份副本<br>
<code>df.join()</code> 支持多列合并<br>
<code>df.append()</code> 支持多行合并</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">&gt;&gt; df_left = pd.DataFrame({<span class="string">'Keys'</span>: [<span class="string">'key1'</span>, <span class="string">'key2'</span>, <span class="string">'key3'</span>, <span class="string">'key4'</span>, <span class="string">'key5'</span>], <span class="string">'Values_Left'</span>: [<span class="string">'value1'</span>, <span class="string">'value2'</span>, <span class="string">'value3'</span>, <span class="string">'value4'</span>, <span class="string">'value5'</span>]}, index=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">&gt;&gt; df_right = pd.DataFrame({<span class="string">'Keys'</span>: [<span class="string">'key1'</span>, <span class="string">'key2'</span>, <span class="string">'key2'</span>, <span class="string">'key3'</span>, <span class="string">'key6'</span>], <span class="string">'Values_Right'</span>: [<span class="string">'value6'</span>, <span class="string">'value7'</span>, <span class="string">'value8'</span>, <span class="string">'value9'</span>, <span class="string">'value10'</span>]}, index=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">&gt;&gt; df_left, df_right</span><br><span class="line">    Keys    Values_Left</span><br><span class="line"> <span class="number">0</span>  key1      value1</span><br><span class="line"> <span class="number">1</span>  key2      value2</span><br><span class="line"> <span class="number">2</span>  key3      value3</span><br><span class="line"> <span class="number">3</span>  key4      value4</span><br><span class="line"> <span class="number">4</span>  key5      value5,</span><br><span class="line">    Keys    Values_Right</span><br><span class="line"> <span class="number">0</span>  key1       value6</span><br><span class="line"> <span class="number">1</span>  key2       value7</span><br><span class="line"> <span class="number">2</span>  key2       value8</span><br><span class="line"> <span class="number">4</span>  key3       value9</span><br><span class="line"> <span class="number">5</span>  key6       value10</span><br><span class="line">&gt;&gt; df_left.append(df_right) &lt;=&gt; pd.concat([df_left, df_right])</span><br><span class="line">Keys	Values_Left	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	value1	    NaN</span><br><span class="line"><span class="number">1</span>	key2	value2	    NaN</span><br><span class="line"><span class="number">2</span>	key3	value3	    NaN</span><br><span class="line"><span class="number">3</span>	key4	value4	    NaN</span><br><span class="line"><span class="number">4</span>	key5	value5	    NaN</span><br><span class="line"><span class="number">0</span>	key1	 NaN	  value6</span><br><span class="line"><span class="number">1</span>	key2	 NaN	  value7</span><br><span class="line"><span class="number">2</span>	key2	 NaN	  value8</span><br><span class="line"><span class="number">4</span>	key3	 NaN	  value9</span><br><span class="line"><span class="number">5</span>	key6	 NaN	  value10</span><br><span class="line">&gt;&gt; pd.concat([df_left, df_right], axis=<span class="number">1</span>) <span class="comment"># 类似join outer，key为index</span></span><br><span class="line">    Keys	Values_Left	  Keys  	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	  key1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	  key2	       value7</span><br><span class="line"><span class="number">2</span>	key3	   value3	  key2	       value8</span><br><span class="line"><span class="number">3</span>	key4	   value4	  NaN	        NaN</span><br><span class="line"><span class="number">4</span>	key5	   value5	  key3	       value9</span><br><span class="line"><span class="number">5</span>	NaN	        NaN	      key6	       value10</span><br><span class="line">&gt;&gt; pd.concat([df_left, df_right], axis=<span class="number">1</span>, join=<span class="string">'inner'</span>)</span><br><span class="line">	Keys	Values_Left	  Keys  	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	  key1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	  key2	       value7</span><br><span class="line"><span class="number">2</span>	key3	   value3	  key2	       value8</span><br><span class="line"><span class="number">4</span>	key5	   value5	  key3	       value9</span><br><span class="line">&gt;&gt; pd.merge(df_left, df_right, on=<span class="string">'Keys'</span>)</span><br><span class="line">    Keys	Values_Left  	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7</span><br><span class="line"><span class="number">2</span>	key2	   value2	       value8</span><br><span class="line"><span class="number">3</span>	key3	   value3	       value9</span><br><span class="line">&gt;&gt; pd.merge(df_left, df_right, how=<span class="string">'left'</span>, on=<span class="string">'Keys'</span>)</span><br><span class="line">	Keys	Values_Left 	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7</span><br><span class="line"><span class="number">2</span>	key2	   value2	       value8</span><br><span class="line"><span class="number">3</span>	key3	   value3	       value9</span><br><span class="line"><span class="number">4</span>	key4	   value4	        NaN</span><br><span class="line"><span class="number">5</span>	key5	   value5	        NaN</span><br><span class="line">&gt;&gt; pd.merge(df_left, df_right, how=<span class="string">'right'</span>, on=<span class="string">'Keys'</span>)</span><br><span class="line">    Keys	Values_Left 	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7</span><br><span class="line"><span class="number">2</span>	key2	   value2	       value8</span><br><span class="line"><span class="number">3</span>	key3	   value3	       value9</span><br><span class="line"><span class="number">4</span>	key6	    NaN	           value10</span><br><span class="line">&gt;&gt; pd.merge(df_left, df_right, how=<span class="string">'outer'</span>, on=<span class="string">'Keys'</span>, validate=<span class="string">'one_to_many'</span>, indicator=<span class="string">'indicator_column'</span>)</span><br><span class="line">	Keys	Values_Left 	Values_Right	indicator_column</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6	          both</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7	          both</span><br><span class="line"><span class="number">2</span>	key2	   value2	       value8	          both</span><br><span class="line"><span class="number">3</span>	key3   	   value3	       value9	          both</span><br><span class="line"><span class="number">4</span>	key4	   value4	        NaN	           left_only</span><br><span class="line"><span class="number">5</span>	key5	   value5	        NaN	           left_only</span><br><span class="line"><span class="number">6</span>	key6	    NaN 	       value10	       right_only</span><br><span class="line">&gt;&gt; pd.merge(df_left, df_right, how=<span class="string">'inner'</span>, on=<span class="string">'Keys'</span>)</span><br><span class="line">    Keys	Values_Left 	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7</span><br><span class="line"><span class="number">2</span>	key2	   value2	       value8</span><br><span class="line"><span class="number">3</span>	key3	   value3	       value9</span><br><span class="line">&gt;&gt; df_left.join(df_right, how=<span class="string">'left'</span>, lsuffix=<span class="string">'_Left'</span>, rsuffix=<span class="string">'_Right'</span>)</span><br><span class="line">    Keys_Left	Values_Left 	Keys_Right  	Values_Right</span><br><span class="line"><span class="number">0</span>	  key1	       value1	       key1	           value6</span><br><span class="line"><span class="number">1</span>	  key2	       value2	       key2	           value7</span><br><span class="line"><span class="number">2</span>	  key3	       value3	       key2	           value8</span><br><span class="line"><span class="number">3</span>	  key4	       value4	       NaN	            NaN</span><br><span class="line"><span class="number">4</span>	  key5	       value5	       key3	           value9</span><br><span class="line">&gt;&gt; df_left.join(df_right, how=<span class="string">'right'</span>, lsuffix=<span class="string">'_Left'</span>, rsuffix=<span class="string">'_Right'</span>)</span><br><span class="line">	Keys_Left	Values_Left 	Keys_Right  	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	      value1	       key1	           value6</span><br><span class="line"><span class="number">1</span>	key2	      value2	       key2	           value7</span><br><span class="line"><span class="number">2</span>	key3	      value3	       key2	           value8</span><br><span class="line"><span class="number">4</span>	key5	      value5	       key3	           value9</span><br><span class="line"><span class="number">5</span>	NaN	           NaN	           key6	           value10</span><br><span class="line">&gt;&gt; df_left.join(df_right, how=<span class="string">'outer'</span>, lsuffix=<span class="string">'_Left'</span>, rsuffix=<span class="string">'_Right'</span>)</span><br><span class="line">    Keys_Left	Values_Left 	Keys_Right   	Values_Right</span><br><span class="line"><span class="number">0</span>	   key1	       value1	        key1	       value6</span><br><span class="line"><span class="number">1</span>	   key2	       value2	        key2	       value7</span><br><span class="line"><span class="number">2</span>	   key3	       value3	        key2	       value8</span><br><span class="line"><span class="number">3</span>	   key4	       value4	        NaN	            NaN</span><br><span class="line"><span class="number">4</span>	   key5	       value5	        key3	       value9</span><br><span class="line"><span class="number">5</span>	   NaN	        NaN	            key6	       value10</span><br><span class="line">&gt;&gt; df_left.join(df_right, how=<span class="string">'inner'</span>, lsuffix=<span class="string">'_Left'</span>, rsuffix=<span class="string">'_Right'</span>)</span><br><span class="line">	Keys_Left	Values_Left 	Keys_Right  	Values_Right</span><br><span class="line"><span class="number">0</span>	   key1	       value1	        key1	       value6</span><br><span class="line"><span class="number">1</span>	   key2	       value2	        key2	       value7</span><br><span class="line"><span class="number">2</span>	   key3	       value3	        key2	       value8</span><br><span class="line"><span class="number">4</span>	   key5	       value5	        key3	       value9</span><br><span class="line">&gt;&gt; df_left.join(df_right.reindex([<span class="string">'key1'</span>, <span class="string">'key2'</span>, <span class="string">'key2'</span>, <span class="string">'key3'</span>, <span class="string">'key6'</span>]), on=<span class="string">'Keys'</span>, lsuffix=<span class="string">'_Left'</span>, rsuffix=<span class="string">'_Right'</span>) &lt;=&gt; pd.merge(df_left, df_right.reindex([<span class="string">'key1'</span>, <span class="string">'key2'</span>, <span class="string">'key2'</span>, <span class="string">'key3'</span>, <span class="string">'key6'</span>]), left_on=<span class="string">"Keys"</span>, right_index=<span class="literal">True</span>, how=<span class="string">"left"</span>, sort=<span class="literal">False</span>, suffixes=(<span class="string">'_Left'</span>, <span class="string">'_Right'</span>))</span><br><span class="line">	Keys	Keys_Left	Values_Left 	Keys_Right  	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   key1	       value1	        NaN	            NaN</span><br><span class="line"><span class="number">1</span>	key2	   key2	       value2	        NaN	            NaN</span><br><span class="line"><span class="number">1</span>	key2	   key2	       value2	        NaN	            NaN</span><br><span class="line"><span class="number">2</span>	key3	   key3	       value3	        NaN	            NaN</span><br><span class="line"><span class="number">3</span>	key4	   key4	       value4	        NaN	            NaN</span><br><span class="line"><span class="number">4</span>	key5	   key5	       value5	        NaN	            NaN</span><br><span class="line">&gt;&gt; df_left.combine_first(df_right) <span class="comment"># 相同Keys只保留左边的</span></span><br><span class="line">	Keys	Values_Left 	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7</span><br><span class="line"><span class="number">2</span>	key3	   value3	       value8</span><br><span class="line"><span class="number">3</span>	key4	   value4	        NaN</span><br><span class="line"><span class="number">4</span>	key5	   value5	       value9</span><br><span class="line"><span class="number">5</span>	key6	    NaN	           value10</span><br><span class="line">&gt;&gt; df_left.update(df_right)</span><br><span class="line">&gt;&gt; df_left</span><br><span class="line">	Keys	Values_Left</span><br><span class="line"><span class="number">0</span>	key1	   value1</span><br><span class="line"><span class="number">1</span>	key2	   value2</span><br><span class="line"><span class="number">2</span>	key2	   value3</span><br><span class="line"><span class="number">3</span>	key4	   value4</span><br><span class="line"><span class="number">4</span>	key3	   value5</span><br><span class="line">&gt;&gt; pd.merge_ordered(df_left, df_right, on=<span class="string">"Keys"</span>)</span><br><span class="line">	Keys	Values_Left 	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7</span><br><span class="line"><span class="number">2</span>	key2	   value2	       value8</span><br><span class="line"><span class="number">3</span>	key2	   value3	       value7</span><br><span class="line"><span class="number">4</span>	key2	   value3	       value8</span><br><span class="line"><span class="number">5</span>	key3	   value5	       value9</span><br><span class="line"><span class="number">6</span>	key4	   value4       	NaN</span><br><span class="line"><span class="number">7</span>	key6	    NaN	           value10</span><br><span class="line">&gt;&gt; pd.merge_ordered(df_left, df_right, left_by=<span class="string">"Keys"</span>)</span><br><span class="line">    Keys	Values_Left 	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7</span><br><span class="line"><span class="number">2</span>	key2	   value2	       value8</span><br><span class="line"><span class="number">3</span>	key2	   value3	       value7</span><br><span class="line"><span class="number">4</span>	key2	   value3	       value8</span><br><span class="line"><span class="number">5</span>	key4	   value4	        NaN</span><br><span class="line"><span class="number">6</span>	key3	   value5	       value9</span><br><span class="line">&gt;&gt; pd.merge_ordered(df_left, df_right, right_by=<span class="string">"Keys"</span>)</span><br><span class="line">	Keys	Values_Left 	Values_Right</span><br><span class="line"><span class="number">0</span>	key1	   value1	       value6</span><br><span class="line"><span class="number">1</span>	key2	   value2	       value7</span><br><span class="line"><span class="number">2</span>	key2	   value2	       value8</span><br><span class="line"><span class="number">3</span>	key2	   value3	       value7</span><br><span class="line"><span class="number">4</span>	key2	   value3	       value8</span><br><span class="line"><span class="number">5</span>	key3	   value5	       value9</span><br><span class="line"><span class="number">6</span>	key6	    NaN	           value10</span><br><span class="line">&gt;&gt; df_left = df_left.rename(columns={<span class="string">'Values_Left'</span>: <span class="string">'Values'</span>})</span><br><span class="line">&gt;&gt; df_right = df_right.rename(columns={<span class="string">'Values_Right'</span>: <span class="string">'Values'</span>}).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line">&gt;&gt; df_left.compare(df_right, align_axis=<span class="number">0</span>)</span><br><span class="line">		    Keys	Values</span><br><span class="line"><span class="number">0</span>	self	NaN 	value1</span><br><span class="line">   other	NaN 	value6</span><br><span class="line"><span class="number">1</span>	self	NaN 	value2</span><br><span class="line">   other	NaN 	value7</span><br><span class="line"><span class="number">2</span>	self	NaN 	value3</span><br><span class="line">   other	NaN 	value8</span><br><span class="line"><span class="number">3</span>	self	key4	value4</span><br><span class="line">   other	key3	value9</span><br><span class="line"><span class="number">4</span>	self	key3	value5</span><br><span class="line">   other	key6	value10</span><br><span class="line">&gt;&gt; df_left.compare(df_right, keep_shape=<span class="literal">True</span>)</span><br><span class="line">        Keys	        Values</span><br><span class="line">    self	other	 self	other</span><br><span class="line"><span class="number">0</span>	NaN  	 NaN	value1	value6</span><br><span class="line"><span class="number">1</span>	NaN	     NaN	value2	value7</span><br><span class="line"><span class="number">2</span>	NaN   	 NaN	value3	value8</span><br><span class="line"><span class="number">3</span>	key4	 key3	value4	value9</span><br><span class="line"><span class="number">4</span>	key3	 key6	value5	value10</span><br><span class="line">&gt;&gt; df_left.compare(df_right, keep_shape=<span class="literal">True</span>, keep_equal=<span class="literal">True</span>)</span><br><span class="line">        Keys	       Values</span><br><span class="line">    self	other	 self	other</span><br><span class="line"><span class="number">0</span>	key1	key1	value1	value6</span><br><span class="line"><span class="number">1</span>	key2	key2	value2	value7</span><br><span class="line"><span class="number">2</span>	key2	key2	value3	value8</span><br><span class="line"><span class="number">3</span>	key4	key3	value4	value9</span><br><span class="line"><span class="number">4</span>	key3	key6	value5	value10</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h1 id="删除">删除</h1>
<ul>
<li><p>PySpark<br>
删除一列：<code>df.drop('xx')</code> 或者 <code>df.drop(F.col('xx'))</code><br>
删除多列：<code>df.drop(*['xx', 'yy', ...])</code><br>
删除某（些）行：使用 filter 方法<br>
去重：<code>df.dropDuplicates()</code> 或 <code>df.drop_duplicates()</code> 其中参数必须为数组，<code>df.distinct()</code> 其中不能传入参数。<br>
在 cols_to_group 相同的情况下保留 xx 列的值最小 / 最大的行：</p>
<p></p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.groupBy(cols_to_group).agg(F.<span class="built_in">min</span>/<span class="built_in">max</span>(<span class="string">'xx'</span>).alias(<span class="string">'xx'</span>))</span><br><span class="line">df.withColumn(<span class="string">'min/max'</span>, F.<span class="built_in">min</span>/<span class="built_in">max</span>(<span class="string">'xx'</span>).over(Window.partitionBy(cols_to_group))).where(F.col(<span class="string">'xx'</span>) == F.col(<span class="string">'min/max'</span>))</span><br><span class="line"><span class="comment"># example</span></span><br><span class="line">&gt;&gt; pdf = pd.DataFrame(<span class="built_in">dict</span>(os=[<span class="string">'ANDROID'</span>, <span class="string">'ANDROID'</span>, <span class="string">'IOS'</span>, <span class="string">'IOS'</span>, <span class="string">'IOS'</span>, <span class="string">'IOS'</span>], region=[<span class="string">'SG'</span>, <span class="string">'SG'</span>, <span class="string">'SG'</span>, <span class="string">'SG'</span>, <span class="string">'CN'</span>, <span class="string">'CN'</span>], value=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]))</span><br><span class="line">&gt;&gt; sdf = spark.createDataFrame(pdf)</span><br><span class="line">&gt;&gt; sdf.show()</span><br><span class="line">+-------+------+-----+</span><br><span class="line">|     os|region|value|</span><br><span class="line">+-------+------+-----+</span><br><span class="line">|ANDROID|    SG|    <span class="number">1</span>|</span><br><span class="line">|ANDROID|    SG|    <span class="number">2</span>|</span><br><span class="line">|    IOS|    SG|    <span class="number">3</span>|</span><br><span class="line">|    IOS|    SG|    <span class="number">4</span>|</span><br><span class="line">|    IOS|    CN|    <span class="number">5</span>|</span><br><span class="line">|    IOS|    CN|    <span class="number">6</span>|</span><br><span class="line">+-------+------+-----+</span><br><span class="line">&gt;&gt; sdf.groupBy([<span class="string">'os'</span>, <span class="string">'region'</span>]).agg(F.<span class="built_in">min</span>(<span class="string">'value'</span>)).show()</span><br><span class="line">+-------+------+----------+</span><br><span class="line">|     os|region|<span class="built_in">min</span>(value)|</span><br><span class="line">+-------+------+----------+</span><br><span class="line">|    IOS|    CN|         <span class="number">5</span>|</span><br><span class="line">|    IOS|    SG|         <span class="number">3</span>|</span><br><span class="line">|ANDROID|    SG|         <span class="number">1</span>|</span><br><span class="line">+-------+------+----------+</span><br><span class="line">&gt;&gt; <span class="keyword">from</span> pyspark.sql.window <span class="keyword">import</span> Window</span><br><span class="line">&gt;&gt; sdf.withColumn(<span class="string">'min'</span>, F.<span class="built_in">min</span>(<span class="string">'value'</span>).over(Window.partitionBy([<span class="string">'os'</span>, <span class="string">'region'</span>]))).where(F.col(<span class="string">'value'</span>) == F.col(<span class="string">'min'</span>)).show()</span><br><span class="line">+-------+------+-----+---+</span><br><span class="line">|     os|region|value|<span class="built_in">min</span>|</span><br><span class="line">+-------+------+-----+---+</span><br><span class="line">|    IOS|    CN|    <span class="number">5</span>|  <span class="number">5</span>|</span><br><span class="line">|    IOS|    SG|    <span class="number">3</span>|  <span class="number">3</span>|</span><br><span class="line">|ANDROID|    SG|    <span class="number">1</span>|  <span class="number">1</span>|</span><br><span class="line">+-------+------+-----+---+</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Pandas<br>
删除某（些）列：<code>df.drop(['xx', 'xx'], axis=1)</code> 或者 <code>df.drop(columns=['xx', 'yy'])</code><br>
删除某（些）行：<code>df.drop([0, 1])</code> 其中 0，1 为 index 名字<br>
去重：<code>drop_duplicates(subset=None, keep='first', inplace=False, ignore_index=False)</code> 其中 keep 取值 {‘first’, ‘last’, False}；keep 第一次或者最后一次出现。如果需要根据某列最大最小值保留的话，则需提前排序</p></li>
</ul>
<h1 id="更改数据类型">更改数据类型</h1>
<ul>
<li><p>PySpark<br>
更改指定列的数据类型：<code>df = df.withColumn('xx', F.col('xx').cast(Type()))</code></p></li>
<li><p>Pandas<br>
更改所有列的数据类型：<code>df.astype('type')</code><br>
更改指定列的数据类型：<code>df.astype({'xx': 'int32'})</code></p></li>
</ul>
<h1 id="失数据处理">失数据处理</h1>
<ul>
<li><p>PySpark<br>
不自动添加 NaNs，且不抛出错误<br>
fillna 函数：<code>df.na.fill()</code><br>
dropna 函数：<code>df.na.drop()</code></p></li>
<li><p>Pandas<br>
对缺失数据自动添加 NaNs<br>
fillna 函数：<code>df.fillna()</code><br>
dropna 函数：<code>df.dropna()</code></p></li>
</ul>
<h1 id="sql语句">SQL 语句</h1>
<ul>
<li><p>PySpark<br>
表格注册：把 DataFrame 结构注册成 SQL 语句使用类型<br>
<code>df.registerTempTable('tt')</code> 或者 <code>sqlContext.registerDataFrameAsTable(df, 'tt')</code><br>
<code>spark.sql('SELECT xx, yy FROM tt WHERE xx &gt;= m AND yy &lt;= n')</code><br>
功能注册：把函数注册成 SQL 语句使用类型<br>
<code>spark.registerFunction('stringLengthString', lambda x: len(x))</code><br>
<code>spark.sql("SELECT stringLengthString('test')")</code></p></li>
<li><p>Pandas<br>
<code>import sqlite3</code><br>
<code>pd.read_sql('SELECT xx, yy FROM tt WHERE xx &gt;= m AND yy &lt;= n')</code></p></li>
</ul>
<h1 id="两者互相转换">两者互相转换</h1>
<ul>
<li><p>PySpark<br>
<code>pandas_df = spark_df.toPandas()</code><br>
<code>ArrayType()</code>, <code>StructType()</code>, <code>MapType()</code> 类型需要提前转换成 string，pandas 不支持</p></li>
<li><p> Pandas<br>
<code>spark_df = spark.createDataFrame(pandas_df)</code><br>
转换过程中可能会遇到报错： TypeError: field xx: Can not merge type A and B<br>
原因是该列存在空值。解决方法是转换成 String<br>
<code>pandas_df.xx = pandas_df.xx.astype(str)</code></p></li>
</ul>
<h1 id="函数应用">函数应用</h1>
<ul>
<li><p>PySpark<br>
<code>df.foreach(f)</code> 或者 <code>df.rdd.foreach(f)</code> 将 df 的每一列应用函数 f<br>
<code>df.foreachPartition(f)</code> 或者 <code>df.rdd.foreachPartition(f)</code> 将 df 的每一块应用函数 f<br>
UDF (User-defined Function):</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># one-line way:</span></span><br><span class="line">udf_name = F.udf(<span class="keyword">lambda</span> x, y: expression, ReturnType())</span><br><span class="line"></span><br><span class="line"><span class="comment"># def way:</span></span><br><span class="line"><span class="meta">@F.udf(<span class="params">returnType=ReturnType(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">udf_name</span>(<span class="params">x</span>):</span></span><br><span class="line">   expression</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">df.withColumn(<span class="string">'xx'</span>, udf_name(F.col(<span class="string">'xx'</span>), F.col(<span class="string">'yy'</span>)))</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>Pandas<br>
<code>df.apply(f)</code> 将 df 的每一列应用函数 f</p></li>
<li><p>Pandas udf in PySpark<br>
Driver 可能缺少必要的 package:pyarrow 导致报错 ModuleNotFoundError: No module named 'pyarrow'。有多种方案解决：</p>
<ol type="1">
<li><p>参考 <a href="https://spark.apache.org/docs/latest/api/python/user_guide/python_packaging.html">Python Package Management</a><br>
PySpark 允许通过以下方式将 Python 文件 (<code>.py</code>)、压缩的 Python 包 (<code>.zip</code>) 和 Egg 文件 (<code>.egg</code>) 上传到执行程序：<br>
设置配置 <code>spark.submit.pyFiles</code> 或者 <code>--py-files</code>Spark 脚本中的设置选项或者直接调用 <a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.SparkContext.addPyFile.html#pyspark.SparkContext.addPyFile"><code>pyspark.SparkContext.addPyFile()</code></a>应用程序。<br>
这是将额外的自定义 Python 代码发送到集群的直接方法。只添加单个文件或压缩整个包并上传它们。如果使用 <a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.SparkContext.addPyFile.html#pyspark.SparkContext.addPyFile"><code>pyspark.SparkContext.addPyFile()</code></a>，即使 job 开始运行后也允许使用上传的代码。<br>
但是不允许添加构建为 <a href="https://www.python.org/dev/peps/pep-0427/">Wheels</a> 包，因此不允许包含与本机代码的依赖关系。</p></li>
<li><p>使用 Conda 打包<br>
<a href="https://docs.conda.io/en/latest/">Conda</a> 是使用最广泛的 Python 包管理系统之一。PySpark 可以直接使用 Conda 环境通过利用 <a href="https://conda.github.io/conda-pack/spark.html">conda-pack</a> 来传送第三方 Python 包，它是一个命令行工具，可创建可重定位的 Conda 环境。<br>
下面的示例创建了一个 Conda 环境以在驱动程序和执行程序上使用，并将其打包到一个存档文件中。此存档文件捕获 Python 的 Conda 环境并存储 Python 解释器及其所有相关依赖项。<br>
</p><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">conda create -y -n pyspark_conda_env -c conda-forge pyarrow pandas conda-pack</span><br><span class="line">conda activate pyspark_conda_env</span><br><span class="line">conda pack -f -o pyspark_conda_env.tar.gz</span><br></pre></td></tr></tbody></table></figure><br>
之后可以使用 <code>--archives</code> 选项或 <code>spark.archives</code> 配置（<code>spark.yarn.dist.archives</code> 在 YARN 中）将其与脚本或代码一起发送。它会自动解压缩执行程序上的存档。<br>
在 <code>spark-submit</code> 脚本的情况下，您可以按如下方式使用它：<p></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">export PYSPARK_DRIVER_PYTHON=python # Do not set in cluster modes.</span><br><span class="line">export PYSPARK_PYTHON=./environment/bin/python</span><br><span class="line">spark-submit --archives pyspark_conda_env.tar.gz#environment app.py</span><br></pre></td></tr></tbody></table></figure>
<p>注意 <code>PYSPARK_DRIVER_PYTHON</code> 不应为 YARN 集群模式设置上述内容。<br>
如果您使用的是常规 Python shell 或 Notebook，您可以尝试如下所示：</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> main</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">'PYSPARK_PYTHON'</span>] = <span class="string">'./environment/bin/python'</span></span><br><span class="line">os.environ[<span class="string">'PYSPARK_DRIVER_PYTHON'</span>] = <span class="string">'./environment/bin/python'</span></span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.config(</span><br><span class="line">    <span class="string">"spark.archives"</span>,  <span class="comment"># 'spark.yarn.dist.archives' in YARN.</span></span><br><span class="line">    <span class="string">"pyspark_conda_env.tar.gz#environment"</span>).getOrCreate()</span><br><span class="line">main(spark)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">SPARK_CONF = SparkConf() \</span><br><span class="line">    .<span class="built_in">set</span>(<span class="string">'spark.yarn.dist.archives'</span>, <span class="string">'pyspark_conda_env.tar.gz#environment'</span>) \</span><br><span class="line">    .<span class="built_in">set</span>(<span class="string">'spark.yarn.appMasterEnv.ARROW_PRE_0_15_IPC_FORMAT'</span>, <span class="string">'1'</span>) \</span><br><span class="line">    .<span class="built_in">set</span>(<span class="string">'spark.executorEnv.ARROW_PRE_0_15_IPC_FORMAT'</span>, <span class="string">'1'</span>)</span><br><span class="line">sc = SparkContext(appName=appName, conf=SPARK_CONF)</span><br><span class="line">sc.setLogLevel(<span class="string">'ERROR'</span>)</span><br><span class="line">spark = SparkSession.builder.enableHiveSupport().getOrCreate()</span><br></pre></td></tr></tbody></table></figure>
<p>对于 pyspark Shell：<br>
</p><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">export PYSPARK_DRIVER_PYTHON=python</span><br><span class="line">export PYSPARK_PYTHON=./environment/bin/python</span><br><span class="line">pyspark --archives pyspark_conda_env.tar.gz#environment</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>使用本机，不用集群<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">SPARK_CONF = SparkConf() \</span><br><span class="line">   .setMaster(<span class="string">'local'</span>) \</span><br><span class="line">   .<span class="built_in">set</span>(<span class="string">'spark.submit.deployMode'</span>, <span class="string">'client'</span>)</span><br><span class="line"> sc = SparkContext(appName=appName, conf=SPARK_CONF)</span><br><span class="line"> sc.setLogLevel(<span class="string">'ERROR'</span>)</span><br><span class="line"> spark = SparkSession.builder.enableHiveSupport().getOrCreate()</span><br></pre></td></tr></tbody></table></figure><p></p></li>
</ol></li>
</ul>
<h1 id="map-reduce操作">Map-Reduce 操作</h1>
<ul>
<li><p>PySpark<br>
<code>df.map(func)</code>，<code>df.reduce(func)</code> 返回类型 seqRDDs</p></li>
<li><p>Pandas<br>
<code>map-reduce操作map(func, list)</code>，<code>reduce(func, list)</code> 返回类型 seq</p></li>
</ul>
<h1 id="diff操作">Diff 操作</h1>
<ul>
<li><p>PySpark<br>
没有 diff 操作（Spark 的上下行是相互独立，分布式存储的）</p></li>
<li><p>Pandas<br>
有 diff 操作，处理时间序列数据（Pandas 会对比当前行与上一行）</p></li>
</ul>
<h1 id="most-common计数">Most Common 计数</h1>
<ul>
<li><p>PySpark<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.cube(column_name/column_list).count().sort(<span class="string">'count'</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">df.groupBy(column_name/column_list).agg({<span class="string">'*'</span>: <span class="string">'count'</span>}).withColumnRenamed(<span class="string">'count(1)'</span>, <span class="string">'new_count'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Pandas<br>
<code>df.value_counts(ascending=False)</code></p></li>
</ul>
<h1 id="json-格式化选择解析">Json 格式化、选择、解析</h1>
<ul>
<li><p>PySpark<br>
格式化：<code>df.withColum('json_string', F.to_json(F.struct('key1', 'key2')))</code><br>
选择：<code>df.select('json_string.key')</code><br>
解析：<code>json_schema = spark.read.json(df.rdd.map(lambda row: row.json_string)).schema</code><br>
<code>F.get_json_object('json_string', '$.key')</code><br>
<code>F.from_json(F.get_json_object('json_string', '$.key'), schema)</code></p></li>
<li><p>Pandas<br>
格式化：<code>df['json_string'] = df[['key1', 'key2']].to_dict(orient='records')</code><br>
选择：<code>df.json_string.apply(pd.Series).key</code><br>
解析：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.join(pd.concat(<span class="built_in">list</span>(df[<span class="string">'json_string'</span>].apply(<span class="keyword">lambda</span> x: pd.json_normalize(json.loads(x)))), ignore_index=<span class="literal">True</span>))</span><br></pre></td></tr></tbody></table></figure><p></p></li>
</ul>
<h1 id="explode操作pivot操作melt操作">Explode 操作、Pivot 操作、Melt 操作</h1>
<ul>
<li><p>PySpark<br>
Explode &lt;=&gt; Groupby：<br>
将 xx 列中的每行的列表 / 数组值分拆形成单独的行<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.withColumn(<span class="string">'xx'</span>, explode(F.col(<span class="string">'yy'</span>))) <span class="comment"># 忽略空值或者空列表/数组</span></span><br><span class="line">df.withColumn(<span class="string">'xx'</span>, explode_outer(F.col(<span class="string">'yy'</span>))) <span class="comment"># 不忽略空值或者空列表/数组</span></span><br><span class="line">df.groupBy(cols_to_group).agg(F.collect_list(<span class="string">'xx'</span>).alias(<span class="string">'yy'</span>)) <span class="comment"># 返回list形式，不去重</span></span><br><span class="line">df.groupBy(cols_to_group).agg(F.collect_set(<span class="string">'xx'</span>).alias(<span class="string">'yy'</span>)) <span class="comment"># 返回set形式，去重</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Pivot &lt;=&gt; Melt</p>
<table>
<thead>
<tr class="header">
<th>Label</th>
<th>Keys</th>
<th style="text-align: left;">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>'key1'</td>
<td style="text-align: left;">'value1'</td>
</tr>
<tr class="even">
<td>0</td>
<td>'key2'</td>
<td style="text-align: left;">'value2'</td>
</tr>
<tr class="odd">
<td>1</td>
<td>'key1'</td>
<td style="text-align: left;">'value3'</td>
</tr>
<tr class="even">
<td>1</td>
<td>'key2'</td>
<td style="text-align: left;">'value4'</td>
</tr>
</tbody>
</table>
<p>&lt;=&gt;</p>
<table>
<thead>
<tr class="header">
<th>Label</th>
<th>key1</th>
<th>key2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>'value1'</td>
<td>'value2'</td>
</tr>
<tr class="even">
<td>1</td>
<td>'value3'</td>
<td>'value4'</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">melt</span>(<span class="params">df, id_vars, value_vars, var_name, value_name</span>):</span></span><br><span class="line">    _vars_and_vals = F.create_map(<span class="built_in">list</span>(chain.from_iterable([[F.lit(c), F.col(c)] <span class="keyword">for</span> c <span class="keyword">in</span> value_vars])))</span><br><span class="line">    _tmp = df.select(*id_vars, explode(_vars_and_vals)).withColumnRenamed(<span class="string">'key'</span>, var_name).withColumnRenamed(<span class="string">'value'</span>, value_name)</span><br><span class="line">    <span class="keyword">return</span> _tmp.select(*cols)</span><br><span class="line"></span><br><span class="line">df_melt = df.selectExpr(<span class="string">'Label'</span>, <span class="string">'stack({}, {}) as (Keys, Values)'</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(cols), <span class="string">', '</span>.join((<span class="string">"'{}', {}"</span>.<span class="built_in">format</span>(i, i) <span class="keyword">for</span> i <span class="keyword">in</span> df.columns[<span class="number">1</span>:])))).where(F.col(<span class="string">'Values'</span>).isNotNull())</span><br><span class="line">df_melt = melt(df, id_vars=<span class="string">'Label'</span>, value_vars=df.columns[<span class="number">1</span>:], var_name=<span class="string">'Keys'</span>, value_name=<span class="string">'Values'</span>)</span><br><span class="line">df_pivot = df_melt.groupBy(<span class="string">'Label'</span>).pivot(<span class="string">'Keys'</span>).agg(F.first(<span class="string">'Values'</span>))</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>Pandas<br>
Explode：</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">&gt;&gt; df = pd.DataFrame( {<span class="string">'a'</span>:[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>], <span class="string">'b'</span>:[[<span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>]]})</span><br><span class="line">&gt;&gt; df.explode(<span class="string">'b'</span>) <span class="comment"># explode的列名还是b</span></span><br><span class="line">   a  b</span><br><span class="line"><span class="number">0</span>  A  <span class="number">1</span></span><br><span class="line"><span class="number">1</span>  B  <span class="number">2</span></span><br><span class="line"><span class="number">1</span>  B  <span class="number">3</span></span><br><span class="line"><span class="number">2</span>  C  <span class="number">4</span></span><br><span class="line"><span class="number">2</span>  C  <span class="number">5</span></span><br><span class="line"><span class="number">2</span>  C  <span class="number">4</span></span><br><span class="line">&gt;&gt; df = pd.DataFrame( {<span class="string">'a'</span>:[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'C'</span>, <span class="string">'C'</span>], <span class="string">'b'</span>:[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>]})</span><br><span class="line">&gt;&gt; df</span><br><span class="line">   a  b</span><br><span class="line"><span class="number">0</span>  A  <span class="number">1</span></span><br><span class="line"><span class="number">1</span>  B  <span class="number">2</span></span><br><span class="line"><span class="number">2</span>  B  <span class="number">3</span></span><br><span class="line"><span class="number">3</span>  C  <span class="number">4</span></span><br><span class="line"><span class="number">4</span>  C  <span class="number">5</span></span><br><span class="line"><span class="number">5</span>  C  <span class="number">4</span></span><br><span class="line">&gt;&gt; df.groupby(<span class="string">'a'</span>)[<span class="string">'b'</span>].apply(<span class="built_in">list</span>).reset_index()</span><br><span class="line">   a          b</span><br><span class="line"><span class="number">0</span>  A        [<span class="number">1</span>]</span><br><span class="line"><span class="number">1</span>  B     [<span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="number">2</span>  C  [<span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>]</span><br><span class="line">&gt;&gt; df.groupby(<span class="string">'a'</span>)[<span class="string">'b'</span>].apply(<span class="built_in">set</span>).apply(<span class="built_in">list</span>).reset_index()</span><br><span class="line">   a       b</span><br><span class="line"><span class="number">0</span>  A     [<span class="number">1</span>]</span><br><span class="line"><span class="number">1</span>  B  [<span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="number">2</span>  C  [<span class="number">4</span>, <span class="number">5</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>Pivot &lt;=&gt; Melt：</p>
<table>
<thead>
<tr class="header">
<th>Label</th>
<th>Keys</th>
<th style="text-align: left;">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>'key1'</td>
<td style="text-align: left;">'value1'</td>
</tr>
<tr class="even">
<td>0</td>
<td>'key2'</td>
<td style="text-align: left;">'value2'</td>
</tr>
<tr class="odd">
<td>1</td>
<td>'key1'</td>
<td style="text-align: left;">'value3'</td>
</tr>
<tr class="even">
<td>1</td>
<td>'key2'</td>
<td style="text-align: left;">'value4'</td>
</tr>
</tbody>
</table>
<p>&lt;=&gt;</p>
<table>
<thead>
<tr>
<th>
</th>
<th colspan="2" align="Center">
<p>Values</p>
</th>
</tr>
<tr>
<th>
<p>Keys</p>
</th>
<th>
<p>key1</p>
</th>
<th>
<p>key2</p>
</th>
</tr>
<tr>
<th>
<p>Label</p>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
<p>0</p>
</th>
<td>
<p>value1</p>
</td>
<td>
<p>value2</p>
</td>
</tr>
<tr>
<th>
<p>1</p>
</th>
<td>
<p>value3</p>
</td>
<td>
<p>value4</p>
</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">&gt;&gt; <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">&gt;&gt; <span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="function"><span class="keyword">def</span> <span class="title">melt</span>(<span class="params">frame</span>):</span></span><br><span class="line">&gt;&gt;     <span class="comment"># identifier is index</span></span><br><span class="line">&gt;&gt;     N, K = frame.shape</span><br><span class="line">&gt;&gt;     data = {</span><br><span class="line">&gt;&gt;         <span class="string">"Values"</span>: frame.to_numpy().ravel(),</span><br><span class="line">&gt;&gt;         <span class="string">"Keys"</span>: np.tile(np.asarray(frame.columns), K),</span><br><span class="line">&gt;&gt;         <span class="string">"Label"</span>: np.asarray(frame.index).repeat(N),</span><br><span class="line">&gt;&gt;     }</span><br><span class="line">&gt;&gt;     <span class="keyword">return</span> pd.DataFrame(data, columns=[<span class="string">"Label"</span>, <span class="string">"Keys"</span>, <span class="string">"Values"</span>])</span><br><span class="line"></span><br><span class="line">&gt;&gt; df = pd.DataFrame({<span class="string">'key1'</span>: [<span class="string">'value1'</span>, <span class="string">'value3'</span>], <span class="string">'key2'</span>: [<span class="string">'value2'</span>, <span class="string">'value4'</span>]}, index=[<span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">     key1    key2</span><br><span class="line"><span class="number">0</span>  value1  value2</span><br><span class="line"><span class="number">1</span>  value3  value4</span><br><span class="line">&gt;&gt; df_melt = melt(df)</span><br><span class="line">   Label  Keys  Values</span><br><span class="line"><span class="number">0</span>      <span class="number">0</span>  key1  value1</span><br><span class="line"><span class="number">1</span>      <span class="number">0</span>  key2  value2</span><br><span class="line"><span class="number">2</span>      <span class="number">1</span>  key1  value3</span><br><span class="line"><span class="number">3</span>      <span class="number">1</span>  key2  value4</span><br><span class="line">&gt;&gt; df = df.reset_index().rename(columns={<span class="string">'index'</span>: <span class="string">'Label'</span>})</span><br><span class="line">   Label    key1    key2</span><br><span class="line"><span class="number">0</span>      <span class="number">0</span>  value1  value2</span><br><span class="line"><span class="number">1</span>      <span class="number">1</span>  value3  value4</span><br><span class="line">&gt;&gt; df_melt = df.melt(id_vars=[<span class="string">'Label'</span>], var_name=<span class="string">'Keys'</span>, value_name=<span class="string">'Values'</span>).sort_values(<span class="string">'Label'</span>).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line">   Label  Keys  Values</span><br><span class="line"><span class="number">0</span>      <span class="number">0</span>  key1  value1</span><br><span class="line"><span class="number">1</span>      <span class="number">0</span>  key2  value2</span><br><span class="line"><span class="number">2</span>      <span class="number">1</span>  key1  value3</span><br><span class="line"><span class="number">3</span>      <span class="number">1</span>  key2  value4</span><br><span class="line">&gt;&gt; df_pivot = df_melt.pivot(index=<span class="string">"Label"</span>, columns=<span class="string">"Keys"</span>, values=<span class="string">"Values"</span>)</span><br><span class="line">Keys     key1    key2</span><br><span class="line">Label                </span><br><span class="line"><span class="number">0</span>      value1  value2</span><br><span class="line"><span class="number">1</span>      value3  value4</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Python</tag>
        <tag>Data Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Matplotlib 库基础</title>
    <url>/contents/Python-Matplotlib%E5%BA%93%E5%9F%BA%E7%A1%80.html</url>
    <content><![CDATA[<p>Matplotlib 是 Python 语言的一个图像绘制库。支持各种可视化类。<br>
Reference：<a href="http://blog.csdn.net/linzch3/article/details/71036772">【MOOC】Python 数据分析与展示 - 北京理工大学 -【第二周】数据分析之展示</a> ; <a href="http://www.icourse163.org/course/BIT-1001870002">公开课</a> ;<a href="https://matplotlib.org/index.html">Document</a>;<a href="https://github.com/matplotlib/matplotlib">GitHub</a><br>
<span id="more"></span></p>
<h1 id="matplotlib库的pyplot子库">Matplotlib 库的 pyplot 子库</h1>
<p>一般通过 <code>import matplotlib.pyplot as plt</code> 来引用 Matplotlib 库的 pyplot 子库。<br>
plt 通常为该模块的别名。</p>
<h1 id="线形图">线形图</h1>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html">matplotlib.pyplot.plot</a><br>
<code>plt.plot()</code> 为常用的画直线、折线或者曲线图像的函数。<br>
最简单的使用 <code>plt.plot(list_x or numpy.array_x)</code>：当 plt.plot 函数只有一个输入列表或者数组时，参数的元素的索引为 X 轴值，参数的元素的值为 Y 轴值。<br>
当有两个输入列表或者数组时 <code>plt.plot(list_x or numpy.array_x, list_y or numpy.array_y)</code>，第一个参数的元素的值为 X 轴值，第二个参数的元素的值为 Y 值。<br>
当绘制多条曲线时，各条图像的 X 轴不能省略。<br>
当有 2n 个输入列表或者数组时（n 为大于 1 的整数），将会绘制 n 条图像，第 i 个参数的元素的值为 X 轴值，第 i+1 个参数的元素的值为 Y 值（i 为 1 到 n 之间的整数）。<br>
一般化的函数格式：<br>
<code>plt.plot(x, y, format_string, **kwargs</code>：x 是 X 轴数据，列表或者数组，可选；y 是 Y 轴数据，列表或者数组；format_string 是控制曲线的格式，可选，**kwargs 是第二组或者更多 (x, y, format_string)。<br>
format_string 是控制曲线的格式，由颜色字符、风格字符、标记字符组成。<br>
- 颜色字符：</p>
<table>
<tbody><tr>
<td style="text-align:center">
蓝色
</td>
<td style="text-align:center">
绿色
</td>
<td style="text-align:center">
红色
</td>
<td style="text-align:center">
青绿色
</td>
<td style="text-align:center">
洋红色
</td>
<td style="text-align:center">
黄色
</td>
<td style="text-align:center">
黑色
</td>
<td style="text-align:center">
白色
</td>
<td style="text-align:center">
RGB 某颜色
</td>
<td style="text-align:center">
灰度值
</td>
</tr>
<tr>
<td style="text-align:center">
'b'
</td>
<td style="text-align:center">
'g'
</td>
<td style="text-align:center">
'r'
</td>
<td style="text-align:center">
'c'
</td>
<td style="text-align:center">
'm'
</td>
<td style="text-align:center">
'y'
</td>
<td style="text-align:center">
'k'
</td>
<td style="text-align:center">
'w'
</td>
<td style="text-align:center">
'#666666'
</td>
<td style="text-align:center">
'0.5'
</td>
</tr>
</tbody></table>
<ul>
<li>风格字符：</li>
</ul>
<table>
<tbody><tr>
<td style="text-align:center">
实线
</td>
<td style="text-align:center">
破折线
</td>
<td style="text-align:center">
点划线
</td>
<td style="text-align:center">
虚线
</td>
<td style="text-align:center">
无线条
</td>
</tr>
<tr>
<td style="text-align:center">
'-'
</td>
<td style="text-align:center">
'--'
</td>
<td style="text-align:center">
'-.'
</td>
<td style="text-align:center">
':'
</td>
<td style="text-align:center">
'' 或者 ' '
</td>
</tr>
</tbody></table>
<ul>
<li>标记字符：</li>
</ul>
<table>
<tbody><tr>
<td style="text-align:center">
点标记
</td>
<td style="text-align:center">
像素标记（极小的点）
</td>
<td style="text-align:center">
实心圆标记
</td>
<td style="text-align:center">
上三角标记
</td>
<td style="text-align:center">
下三角标记
</td>
<td style="text-align:center">
右三角标记
</td>
<td style="text-align:center">
左三角标记
</td>
</tr>
<tr>
<td style="text-align:center">
'.'
</td>
<td style="text-align:center">
','
</td>
<td style="text-align:center">
'o'
</td>
<td style="text-align:center">
'v'
</td>
<td style="text-align:center">
'^'
</td>
<td style="text-align:center">
'&gt;'
</td>
<td style="text-align:center">
'&lt;'
</td>
</tr>
<tr>
<td style="text-align:center">
下花三角标记
</td>
<td style="text-align:center">
上花三角标记
</td>
<td style="text-align:center">
左花三角标记
</td>
<td style="text-align:center">
右花三角标记
</td>
<td style="text-align:center">
实心方形标记
</td>
<td style="text-align:center">
实心五角标记
</td>
<td style="text-align:center">
星形标记
</td>
</tr>
<tr>
<td style="text-align:center">
'1'
</td>
<td style="text-align:center">
'2'
</td>
<td style="text-align:center">
'3'
</td>
<td style="text-align:center">
'4'
</td>
<td style="text-align:center">
's'
</td>
<td style="text-align:center">
'p'
</td>
<td style="text-align:center">
'*'
</td>
</tr>
<tr>
<td style="text-align:center">
竖六边形标记
</td>
<td style="text-align:center">
横六边形标记
</td>
<td style="text-align:center">
十字标记
</td>
<td style="text-align:center">
叉标记
</td>
<td style="text-align:center">
菱形标记
</td>
<td style="text-align:center">
瘦菱形标记
</td>
<td style="text-align:center">
垂直线标记
</td>
</tr>
<tr>
<td style="text-align:center">
'h'
</td>
<td style="text-align:center">
'H'
</td>
<td style="text-align:center">
'+'
</td>
<td style="text-align:center">
'x'
</td>
<td style="text-align:center">
'D'
</td>
<td style="text-align:center">
'd'
</td>
<td style="text-align:center">
|
</td>
</tr>
</tbody></table>
<p>举例：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a = np.arange(<span class="number">5</span>)</span><br><span class="line">plt.plot(a, a, <span class="string">'go-'</span>, a, a*<span class="number">1.5</span>, <span class="string">'r1'</span>, a, a*<span class="number">2</span>, <span class="string">'h'</span>, a, a*<span class="number">2.5</span>, <span class="string">'b:d'</span>)</span><br><span class="line">plt.savefig(<span class="string">'example'</span>, dpi=<span class="number">500</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/basic_plot.png" class="" width="600" height="450"><br>
因为三种格式所用字符均不相同，所以三者可以任意顺序排列，并且可选。<br>
此外也可以通过属性赋值来设定格式：<p></p>
<table>
<thead>
<tr class="header">
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> color</td>
<td> 线条颜色</td>
</tr>
<tr class="even">
<td> linestyle</td>
<td> 线条风格</td>
</tr>
<tr class="odd">
<td> marker</td>
<td> 标记风格</td>
</tr>
<tr class="even">
<td> markerfacecolor</td>
<td> 标记颜色</td>
</tr>
<tr class="odd">
<td> markersize</td>
<td> 标记尺寸</td>
</tr>
<tr class="even">
<td> markevery</td>
<td> 标记间隔</td>
</tr>
</tbody>
</table>
<p>markevery 默认为 None, 此时所有点将会被标记。<br>
<code>markevery=N</code>, N 为整数，此时每隔 N-1 个点将会被标记。<br>
<code>markevery=(start, N)</code>，start 和 N 均为整数，此时从第 start 个点开始，每隔 N-1 个点将会被标记。<br>
<code>markevery=slice(start, end, N)</code>，start、end 和 N 均为整数，此时从第 start 个点开始直到第 end-1 个点，每隔 N-1 个点将会被标记。<br>
<code>markevery=[x1, x2, ..., xi]</code>，只有第 x1, x2, ..., xi 个点被标记。这里列表为任意长度（最大长度为数据的总个数）。<br>
<code>markevery=n</code>，n 为浮点数，此时标记的 x 轴坐标将会均匀间隔分布，标记个数为 1/n 取整。<br>
<code>markevery=(start, N)</code>，start 和 N 均为浮点数，此时标记的 x 轴坐标将会均匀间隔分布，标记个数为 (1-start)/n 取整，而且从第 l*start 个点开始，其中 l 为数据总个数。<br>
<code>plt.show()</code> 显示所绘图像；<code>plt.savefig(filename, dpi)</code> 保存所绘图像为文件，默认 PNG 格式，dpi 表示输出质量。<br>
<code>plt.figure(num=None, figsize=None, dpi=None, facecolor=None, clear=False)</code> 定义图像参数，其中 num 表示图像个数；figsize 表示图像尺寸，为一个二维元组；dpi 表示输出质量；facecolor 表示背景颜色；<code>clear=True</code> 表示清空之前的绘制。</p>
<h1 id="pyplot的子绘图区域">pyplot 的子绘图区域</h1>
<h2 id="plt.subplot">plt.subplot</h2>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplot.html">matplotlib.pyplot.subplot</a><br>
<code>plt.subplot(nrows, ncols, plot_number)</code> 在全局绘图区域中创建一个分区体系，并定位到一个子绘图区域。<br>
举例：<br>
<img src="/images/Matplotlib/subplot.png" class="" width="600" height="450"><br>
注：参数之间的逗号可以省略。<br>
调用 plt.subplot 函数后使用 plt.plot 函数绘图至对应区域。</p>
<h2 id="plt.subplot2grid">plt.subplot2grid</h2>
<p><code>plt.subplot2grid(GridSpec, CurSpec, colspan=1, rowspan=1)</code> 设定网络，选中网络起始索引，从编号 0 开始，确定选中的行列区域跨越的数量。<br>
举例：<br>
<img src="/images/Matplotlib/subplot2grid.png" class="" width="600" height="450"><br>
注：为了使上面的 subplot2grid 函数的调用显示更加简洁，可以引入 GridSpec 类来实现该功能<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.gridspec <span class="keyword">as</span> gridspec</span><br><span class="line">gs = gridspec.GridSpec(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">ax1 = plt.subplot(gs[<span class="number">0</span>,:])</span><br><span class="line">ax2 = plt.subplot(gs[<span class="number">1</span>,:-<span class="number">1</span>])</span><br><span class="line">ax3 = plt.subplot(gs[<span class="number">0</span>,-<span class="number">1</span>])</span><br><span class="line">ax4 = plt.subplot(gs[<span class="number">2</span>,<span class="number">0</span>])</span><br><span class="line">ax5 = plt.subplot(gs[<span class="number">2</span>,<span class="number">1</span>])</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="pyplot的文字显示">pyplot 的文字显示</h1>
<h2 id="字体属性">字体属性</h2>
中文字体分类：<br>

<table>
<tbody><tr>
<td style="text-align:center">
黑体
</td>
<td style="text-align:center">
楷体
</td>
<td style="text-align:center">
隶书
</td>
<td style="text-align:center">
仿宋
</td>
<td style="text-align:center">
幼圆
</td>
<td style="text-align:center">
宋体
</td>
</tr>
<tr>
<td style="text-align:center">
'SimHei'
</td>
<td style="text-align:center">
'Kaiti'
</td>
<td style="text-align:center">
'LiSu'
</td>
<td style="text-align:center">
'FangSong'
</td>
<td style="text-align:center">
'YouYuan'
</td>
<td style="text-align:center">
'STSong'
</td>
</tr>
</tbody></table>
字体风格：<br>

<table>
<tbody><tr>
<td style="text-align:center">
正常
</td>
<td style="text-align:center">
斜体
</td>
</tr>
<tr>
<td style="text-align:center">
'normal' 或者 'roman'
</td>
<td style="text-align:center">
'italic' 或者 'oblique'
</td>
</tr>
</tbody></table>
字体大小：<br>

<table>
<tbody><tr>
<td style="text-align:center">
字号
</td>
<td style="text-align:center">
极小
</td>
<td style="text-align:center">
很小
</td>
<td style="text-align:center">
小
</td>
<td style="text-align:center">
比父元素更小
</td>
<td style="text-align:center">
中
</td>
<td style="text-align:center">
大
</td>
<td style="text-align:center">
很大
</td>
<td style="text-align:center">
极大
</td>
<td style="text-align:center">
比父元素更大
</td>
</tr>
<tr>
<td style="text-align:center">
整数
</td>
<td style="text-align:center">
xx-small
</td>
<td style="text-align:center">
x-small
</td>
<td style="text-align:center">
small
</td>
<td style="text-align:center">
smaller
</td>
<td style="text-align:center">
medium
</td>
<td style="text-align:center">
large
</td>
<td style="text-align:center">
x-large
</td>
<td style="text-align:center">
xx-large
</td>
<td style="text-align:center">
larger
</td>
</tr>
</tbody></table>
<ol type="1">
<li>修改全局的字体属性：<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib</span><br><span class="line">matplotlib.rcParams[<span class="string">'font.family'</span>]=<span class="string">''</span> <span class="comment">#字体</span></span><br><span class="line">matplotlib.rcParams[<span class="string">'font.style'</span>]=<span class="string">''</span> <span class="comment">#风格</span></span><br><span class="line">matplotlib.rcParams[<span class="string">'font.size'</span>]=<span class="string">''</span> <span class="comment">#字号</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>修改局部的字体属性：<br>
在有文字显示的函数中增加属性 fontname 改变字体，fontstyle 改变风格，fontsize 改变字号</li>
</ol>
<h2 id="文本显示">文本显示</h2>
<table>
<colgroup>
<col style="width: 73%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>plt.xlabel(string)</code></td>
<td>对 X 轴增加文本标签</td>
</tr>
<tr class="even">
<td><code>plt.ylabel(string)</code></td>
<td>对 Y 轴增加文本标签</td>
</tr>
<tr class="odd">
<td><code>plt.title(string)</code></td>
<td>对图形整体增加文本标签</td>
</tr>
<tr class="even">
<td><code>plt.text(x, y, string)</code></td>
<td>在任意位置增加文本标签</td>
</tr>
<tr class="odd">
<td><code>plt.annotate(s, xy=arrow_crd, xytext=text_crd, arrowprops=dict)</code></td>
<td>在图形中增加带箭头的注解</td>
</tr>
</tbody>
</table>
<p>注：文本字符串中可以用一对 $ 符号来引入 LaTeX 公式。<br>
annotate 函数的参数：<code>plt.annotate(s, xy=arrow_crd, xytext=text_crd, arrowprops=dict)</code><br>
s 为文本字符串；xy 为箭头指向的位置，即要注释的位置；xytext 为箭尾的位置，即文本位置；两个位置属性的值均为二维元组；arrowprops 为箭头的属性，如：facecolor 箭头颜色，shrink 箭头缩放成程度，width 箭头线段宽度，headwidth 箭头宽度，frac 箭头头部所占据的比例等；这些属性以字典形式传入。</p>
<h2 id="坐标轴显示">坐标轴显示</h2>
<table>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>plt.xticks(x, list)</code></td>
<td>对 X 轴增加坐标标记</td>
</tr>
<tr class="even">
<td><code>plt.yticks(y, list)</code></td>
<td>对 Y 轴增加坐标标记</td>
</tr>
<tr class="odd">
<td><code>plt.xlim(min, max)</code></td>
<td>显示 X 轴坐标范围</td>
</tr>
<tr class="even">
<td><code>plt.ylim(min, max)</code></td>
<td>显示 Y 轴坐标范围</td>
</tr>
</tbody>
</table>
<p>其中 ticks 可以设置字体大小（fontsize）、旋转角度（rotation）等属性。</p>
<h2 id="网格显示">网格显示</h2>
<p><code>plt.grid(Ture)</code></p>
<h1 id="matplotlib库的基础绘图函数">matplotlib 库的基础绘图函数</h1>
<h2 id="基础绘图函数">基础绘图函数</h2>
<table>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>plt.plot(x,y,fmt)</code></td>
<td>绘制一个坐标图</td>
</tr>
<tr class="even">
<td><code>plt.vlines(x, ymin, ymax)</code></td>
<td>绘制一个垂直线</td>
</tr>
<tr class="odd">
<td><code>plt.hlines(y, xmin, xmax)</code></td>
<td>绘制一个水平线</td>
</tr>
<tr class="even">
<td><code>plt.axvline(x=0, ymin=0, ymax=1)</code></td>
<td>绘制一个垂直线</td>
</tr>
<tr class="odd">
<td><code>plt.axhline(y=0, xmin=0, xmax=1)</code></td>
<td>绘制一个水平线</td>
</tr>
<tr class="even">
<td><code>plt.axvspan(xmin, xmax, ymin=0, ymax=1)</code></td>
<td>绘制一个垂直矩形</td>
</tr>
<tr class="odd">
<td><code>plt.axhspan(ymin, ymax, xmin=0, xmax=1)</code></td>
<td>绘制一个水平矩形</td>
</tr>
<tr class="even">
<td><code>plt.boxplot(data,notch,position)</code></td>
<td>绘制一个箱形图</td>
</tr>
<tr class="odd">
<td><code>plt.bar(left,height,width,bottom)</code></td>
<td>绘制一个条形图</td>
</tr>
<tr class="even">
<td><code>plt.barh(width,bottom,left,height)</code></td>
<td>绘制一个横向条形图</td>
</tr>
<tr class="odd">
<td><code>plt.hist(x,bins,normed)</code></td>
<td>绘制一个直方图</td>
</tr>
<tr class="even">
<td><code>plt.pie(data, explode)</code></td>
<td>绘制一个饼状图</td>
</tr>
<tr class="odd">
<td><code>plt.scatter(x,y)</code></td>
<td>绘制一个散点图</td>
</tr>
<tr class="even">
<td><code>plt.stem(x,y,linefmt,markerfmt)</code></td>
<td>绘制一个柴火图</td>
</tr>
<tr class="odd">
<td><code>plt.step(x,y,where)</code></td>
<td>绘制一个步阶图</td>
</tr>
<tr class="even">
<td><code>pyplot.psd()</code></td>
<td>绘制一个能量谱密度图</td>
</tr>
<tr class="odd">
<td><code>pyplot.magnitude_spectrum()</code></td>
<td>绘制一个幅度频谱图</td>
</tr>
<tr class="even">
<td><code>pyplot.phase_spectrum()</code></td>
<td>绘制一个相角频谱图</td>
</tr>
<tr class="odd">
<td><code>pyplot.angle_spectrum()</code></td>
<td>绘制一个相位频谱图</td>
</tr>
</tbody>
</table>
<h2 id="绘制垂直水平线矩形">绘制垂直、水平线、矩形</h2>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.axhline.html">matplotlib.pyplot.axhline</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.axvline.html">matplotlib.pyplot.axvline</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.hlines.html">matplotlib.pyplot.hlines</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.vlines.html">matplotlib.pyplot.vlines</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.axhspan.html">matplotlib.pyplot.axhspan</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.axvspan.html">matplotlib.pyplot.axvspan</a><br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw a default hline at y=1 that spans the xrange</span></span><br><span class="line">plt.axhline(y=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># draw a default vline at x=1 that spans the yrange</span></span><br><span class="line">plt.axvline(x=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw a thick red hline at y=0 that spans the xrange</span></span><br><span class="line">plt.axhline(linewidth=<span class="number">8</span>, color=<span class="string">'#d62728'</span>)</span><br><span class="line"><span class="comment"># draw a thick blue vline at x=0 that spans the yrange from 0.8 to 1.4</span></span><br><span class="line">plt.axvline(x=<span class="number">0.25</span>, ymin=<span class="number">0.6</span>, ymax=<span class="number">0.8</span>, linewidth=<span class="number">8</span>, color=<span class="string">'#1f77b4'</span>)</span><br><span class="line">plt.axvline(x=<span class="number">0.5</span>, ymin=<span class="number">0.8</span>, ymax=<span class="number">0.6</span>, linewidth=<span class="number">8</span>, color=<span class="string">'#1f77b4'</span>)</span><br><span class="line">plt.vlines(x=<span class="number">0.75</span>, ymin=<span class="number">0.8</span>, ymax=<span class="number">1.4</span>, linewidth=<span class="number">8</span>, color=<span class="string">'#1f77b4'</span>)</span><br><span class="line">plt.vlines(x=<span class="number">1</span>, ymin=<span class="number">1.4</span>, ymax=<span class="number">0.8</span>, linewidth=<span class="number">8</span>, color=<span class="string">'#1f77b4'</span>)</span><br><span class="line"><span class="comment"># draw a default hline at y=.5 that spans the middle half of the axes</span></span><br><span class="line">plt.axhline(y=<span class="number">0.5</span>, xmin=<span class="number">0.25</span>, xmax=<span class="number">0.75</span>)</span><br><span class="line"></span><br><span class="line">plt.axhspan(<span class="number">0.25</span>, <span class="number">0.75</span>, xmin=<span class="number">0.2</span>, xmax=<span class="number">0.7</span>, facecolor=<span class="string">'0.5'</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line">plt.axvspan(<span class="number">1.25</span>, <span class="number">1.55</span>, ymin=<span class="number">0.2</span>, ymax=<span class="number">0.7</span>, facecolor=<span class="string">'#2ca02c'</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">plt.axis([-<span class="number">1</span>, <span class="number">2</span>, -<span class="number">1</span>, <span class="number">2</span>])</span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/line_span.png" class="" width="600" height="450"><br>
<code>plt.axvline(x=0, ymin=0, ymax=1)</code>、<code>plt.axhline(y=0, xmin=0, xmax=1)</code> 与 <code>plt.vlines(x, ymin, ymax)</code>、<code>plt.hlines(y, xmin, xmax)</code> 类似，但是前者可以不填任何参数，而后者必须指定三个参数。其中第一个参数为线段的x轴或者y轴位置，第二、第三个参数为线段的起点和终点位置。其中对于前者，起点和终点位置是由距离坐标系两端的距离的比例来决定，对于后者，起点和终点位置是由绝对坐标来决定。<br>
例如 <code>plt.axvline(x=0.25, ymin=0.6, ymax=0.8, linewidth=8, color='#1f77b4')</code> 表示线段从(0.25,0.6*(2-(-1))+(-1))到(0.25,0.8*(2-(-1))+(-1))。其中ymin和ymax的值交换位置不影响结果。而 <code>plt.vlines(x=0.75, ymin=0.8, ymax=1.4, linewidth=8, color='#1f77b4')</code> 表示线段从(0.75,0.8)到(0.75,1.4)。同样的，ymin和ymax的值交换位置不影响结果。从图中还可以观察到，axvline形成的线段上下端也有宽度，而vline形成的线段没有，所以前者形成的线段比后者稍长。<br>
除x,y,xmin,xmax,ymin,ymax之外的参数为通用参数，其中facecolor或者fc表示面积颜色，alpha表示透明度（取值为0到1之间的浮点数）。<p></p>
<h2 id="绘制箱形图条形图直方图">绘制箱形图、条形图、直方图</h2>
<h3 id="箱形图">箱形图</h3>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.boxplot.html">matplotlib.pyplot.boxplot</a><br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">data = np.random.lognormal(size=(<span class="number">25</span>, <span class="number">4</span>), mean=<span class="number">1.5</span>, sigma=<span class="number">1.75</span>)</span><br><span class="line">labels = <span class="built_in">list</span>(<span class="string">'ABCD'</span>)</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(nrows=<span class="number">2</span>, ncols=<span class="number">6</span>, figsize=(<span class="number">12</span>, <span class="number">6</span>), sharey=<span class="literal">True</span>)</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">0</span>].boxplot(data, labels=labels)</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">1</span>].boxplot(data, labels=labels, showmeans=<span class="literal">True</span>)</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">2</span>].boxplot(data, labels=labels, showmeans=<span class="literal">True</span>, meanline=<span class="literal">True</span>)</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">3</span>].boxplot(data, labels=labels, showbox=<span class="literal">False</span>, showcaps=<span class="literal">False</span>)</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">4</span>].boxplot(data, labels=labels, notch=<span class="literal">True</span>, bootstrap=<span class="number">10000</span>)</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">5</span>].boxplot(data, labels=labels, showfliers=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">boxprops = <span class="built_in">dict</span>(linestyle=<span class="string">'--'</span>, linewidth=<span class="number">3</span>, color=<span class="string">'darkgoldenrod'</span>)</span><br><span class="line">flierprops = <span class="built_in">dict</span>(marker=<span class="string">'o'</span>, markerfacecolor=<span class="string">'green'</span>, markersize=<span class="number">12</span>, linestyle=<span class="string">'none'</span>)</span><br><span class="line">medianprops = <span class="built_in">dict</span>(linestyle=<span class="string">'-.'</span>, linewidth=<span class="number">2.5</span>, color=<span class="string">'firebrick'</span>)</span><br><span class="line">meanpointprops = <span class="built_in">dict</span>(marker=<span class="string">'D'</span>, markeredgecolor=<span class="string">'black'</span>, markerfacecolor=<span class="string">'firebrick'</span>)</span><br><span class="line">meanlineprops = <span class="built_in">dict</span>(linestyle=<span class="string">'--'</span>, linewidth=<span class="number">2.5</span>, color=<span class="string">'purple'</span>)</span><br><span class="line"></span><br><span class="line">axes[<span class="number">1</span>, <span class="number">0</span>].boxplot(data, boxprops=boxprops)</span><br><span class="line">axes[<span class="number">1</span>, <span class="number">1</span>].boxplot(data, flierprops=flierprops, medianprops=medianprops)</span><br><span class="line">axes[<span class="number">1</span>, <span class="number">2</span>].boxplot(data, whis=<span class="string">'range'</span>)</span><br><span class="line">axes[<span class="number">1</span>, <span class="number">3</span>].boxplot(data, meanprops=meanpointprops, meanline=<span class="literal">False</span>, showmeans=<span class="literal">True</span>)</span><br><span class="line">axes[<span class="number">1</span>, <span class="number">4</span>].boxplot(data, meanprops=meanlineprops, meanline=<span class="literal">True</span>, showmeans=<span class="literal">True</span>)</span><br><span class="line">axes[<span class="number">1</span>, <span class="number">5</span>].boxplot(data, whis=[<span class="number">15</span>, <span class="number">85</span>])</span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/box.png" class="" width="1200" height="450"><br>
<img src="/images/Matplotlib/box_illustration.png" class="" width="500" height="450"><br>
data为随机生成的4×25数组，图片划分为2栏6列，<code>sharey=Ture</code> 表示共享Y轴坐标。<br>
axes为坐标系对象是一个2×6的数组，每一个元素对应一个坐标系。<br>
<code>plt.boxplot()</code> 第一个参数为所展示的数据，数组形式；label为X轴坐标的标签。<br>
<code>vert=False</code> 表示箱形图案为横向放置，<code>patch_artist=True</code> 表示箱形图框内有填充。<br>
<code>showmeans=Ture</code> 表示显示平均值，<code>meanline=Ture</code> 表示使平均值以虚线形式显示。<br>
<code>showbox=False</code> 表示不显示箱形边框，<code>showcaps=False</code> 表示不显示上下两端的error_bar。<br>
<code>notch=True</code> 表示显示槽口，<code>bootstrap=10000</code> 表示显示中值周围的置信区间。<br>
<code>showfliers=False</code> 表示不显示上下error_bar之外的值。<br>
<code>boxprops</code> 表示箱形图案的属性；<code>flierprops</code> 表示error_bar之外的点的属性；<code>medianprops</code> 表示中值点的属性；<code>meanprops</code> 表示平均值点的属性。<br>
<code>whis</code> 表示数据范围的属性：它的值可以是浮点数、字符串、数组范围。<br>
- 如果 <code>whis='range'</code> 表示error_bar的范围为所有数值的最小值到所有数值的最大值，即没有上下极端值。<br>
- 如果 <code>whis=[a,b]</code>，其中a,b是两个数字（整型或者浮点型均可），则error_bar的范围为所有数值由小到大排列后第a%位的值到所有数值由小到大排列后第b%位的值。<br>
- 如果 <code>whis=c</code>，其中c是一个浮点数，则表示error_bar的范围为(Q1-c*(Q3-Q1))到(Q3+c*(Q3-Q1))，其中Q1所有数值由小到大排列后第25%的值，Q3所有数值由小到大排列后第75%的值。<br>
- 如果不设置whis，则默认值为 <code>whis=1.5</code>。<p></p>
<h3 id="条形图">条形图</h3>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.bar.html">matplotlib.pyplot.bar</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.barh.html">matplotlib.pyplot.barh</a><br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">N = <span class="number">5</span></span><br><span class="line">menMeans = (<span class="number">20</span>, <span class="number">35</span>, <span class="number">30</span>, <span class="number">35</span>, <span class="number">27</span>)</span><br><span class="line">womenMeans = (<span class="number">25</span>, <span class="number">32</span>, <span class="number">34</span>, <span class="number">20</span>, <span class="number">25</span>)</span><br><span class="line">menStd = (<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">womenStd = (<span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">ind = np.arange(N)    <span class="comment"># the x locations for the groups</span></span><br><span class="line">width = <span class="number">0.5</span>       <span class="comment"># the width of the bars: can also be len(x) sequence</span></span><br><span class="line"></span><br><span class="line">p1 = plt.bar(ind, menMeans, width, color=<span class="string">'r'</span>, hatch=<span class="string">'o'</span>)</span><br><span class="line">plt.errorbar(ind+<span class="number">0.25</span>, menMeans, yerr=menStd, capsize=<span class="number">5</span>, elinewidth=<span class="number">5</span>, capthick=<span class="number">5</span>, ecolor=<span class="string">'g'</span>, linewidth=<span class="number">0</span>)</span><br><span class="line">p2 = plt.bar(ind, womenMeans, width, bottom=menMeans, yerr=womenStd)</span><br><span class="line">plt.errorbar(ind+<span class="number">0.25</span>, np.array(womenMeans)+np.array(menMeans) , yerr=womenStd, capsize=<span class="number">5</span>, elinewidth=<span class="number">5</span>, capthick=<span class="number">5</span>, ecolor=<span class="string">'y'</span>, linewidth=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">plt.ylabel(<span class="string">'Scores'</span>)</span><br><span class="line">plt.title(<span class="string">'Scores by group and gender'</span>)</span><br><span class="line">plt.xticks(ind+<span class="number">0.25</span>, (<span class="string">'G1'</span>, <span class="string">'G2'</span>, <span class="string">'G3'</span>, <span class="string">'G4'</span>, <span class="string">'G5'</span>))</span><br><span class="line">plt.yticks(np.arange(<span class="number">0</span>, <span class="number">81</span>, <span class="number">10</span>))</span><br><span class="line">plt.legend((p1[<span class="number">0</span>], p2[<span class="number">0</span>]), (<span class="string">'Men'</span>, <span class="string">'Women'</span>))</span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/bar.png" class="" width="600" height="450"><br>
<code>plt.bar(x, height, width, bottom, align='center')</code> 表示画一个柱状图案（矩形），其上下左右边界分别为bottom+height、bottom、x-width/2、x+width/2<br>
align表示x表示矩形的中间（align='center'）还是矩形的左边边界（align='edge'）。如果需要让x表示矩形的右边边界，则设置align='edge'且width为一个负数。align的默认值为'center'。<br>
其他常用的属性有：<br>
color : 柱状图案的填充颜色<br>
edgecolor : 柱状图案的边框颜色<br>
linewidth : 柱状图案的边框粗细<br>
xerr : x轴的error bar<br>
yerr : y轴的error bar<br>
elinewidth: error bar的宽度<br>
capsize： error bar的帽子大小<br>
capthick： error bar的帽子宽度<br>
ecolor : error bar的颜色<br>
log : 如果为true，则坐标为对数显示<br>
hatch：图案填充， ['/' | '' | '|' | '-' | '+' | 'x' | 'o' | 'O' | '.' | '*']<br>
如果绘制横向条形图，则使用 <code>plt.barh(y, height, width, left, align='center')</code>，使用方法同上。<p></p>
<h3 id="直方图">直方图</h3>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.hist.html">matplotlib.pyplot.hist</a><br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.mlab <span class="keyword">as</span> mlab</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># example data</span></span><br><span class="line">mu = <span class="number">100</span>  <span class="comment"># mean of distribution</span></span><br><span class="line">sigma = <span class="number">25</span>  <span class="comment"># standard deviation of distribution</span></span><br><span class="line">x = mu + sigma * np.random.randn(<span class="number">500</span>)</span><br><span class="line">num_bins = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line"></span><br><span class="line"><span class="comment"># the histogram of the data</span></span><br><span class="line">n, bins, patches = ax.hist(x, num_bins, normed=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> patches[::<span class="number">2</span>]:</span><br><span class="line">    i.set_color(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add a 'best fit' line</span></span><br><span class="line">y = mlab.normpdf(bins, mu, sigma)</span><br><span class="line">ax.plot(bins, y, <span class="string">'--'</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">'Smarts'</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">'Probability density'</span>)</span><br><span class="line">ax.set_title(<span class="string">r'Histogram of IQ: $\mu=100$, $\sigma=25$'</span>)</span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/hist.png" class="" width="600" height="450"><br>
data为随机生成的以mu为均值，以sigma为标准差的正态分布数组，数组长度为500。<br>
所绘制的直方图有50个分组。<br>
<code>plt.bar(x, num_bins, normed=True)</code> 中x为data，num_bins为分组个数，normed为是否归一化。<br>
并且返回n, bins, patches三个数组，n和patches的数组维度均为分组个数，而bins的数组维度为分组个数+1；<br>
其中n为数据落在每个分组中的个数或者概率密度，bins为每个分组的两端的x坐标值，patches表示每个分组，可以通过patches对分组属性进行设置。<br>
当normed=False时，n为数据落在每个分组中的个数；当normed=True，n为数据落在每个分组中的概率密度（注意，不是概率分布，sum(n)*(max(num_bins)-min(num_bins))=num_bins）。<br>
<code>i.set_color('y')</code> 设置了每隔一个分组颜色为黄色。<br>
<code>y = mlab.normpdf(bins, mu, sigma)</code> 返回一个数组，数组为以mu为均值，以sigma为标准差的正态分布曲线上bins所对应的y轴值。<br>
<code>ax.plot(bins, y, '--')</code> 则绘制匹配直方图的正态分布图曲线。<p></p>
<h2 id="绘制饼状图">绘制饼状图</h2>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.pie.html">matplotlib.pyplot.pie</a><br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pie chart, where the slices will be ordered and plotted counter-clockwise:</span></span><br><span class="line">labels = <span class="string">'Frogs'</span>, <span class="string">'Hogs'</span>, <span class="string">'Dogs'</span>, <span class="string">'Logs'</span></span><br><span class="line">sizes = [<span class="number">15</span>, <span class="number">30</span>, <span class="number">45</span>, <span class="number">10</span>]</span><br><span class="line">explode = (<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>)  <span class="comment"># only "explode" the 2nd slice (i.e. 'Hogs')</span></span><br><span class="line"></span><br><span class="line">fig1, ax1 = plt.subplots()</span><br><span class="line">ax1.pie(sizes, explode=explode, labels=labels, autopct=<span class="string">'%1.1f%%'</span>, pctdistance=<span class="number">0.5</span>, labeldistance=<span class="number">1.2</span>, radius=<span class="number">2</span>, shadow=<span class="literal">True</span>, startangle=<span class="number">90</span>)</span><br><span class="line">ax1.axis(<span class="string">'equal'</span>)  <span class="comment"># Equal aspect ratio ensures that pie is drawn as a circle.</span></span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/pie.png" class="" width="600" height="450"><br>
explode表示每部分饼状图案偏离圆心的距离，为<strong>绝对</strong>距离。<br>
autopct表示显示数字的格式。pctdistance表示显示数字距离圆心的<strong>相对</strong>距离，默认值为0.6，表示数字离圆心0.6个半径距离。<br>
shadow表示是否有阴影，startangle表示绘制饼状图的起始角度。<br>
labels表示标签，labeldistance表示标签离圆心的<strong>相对</strong>距离，默认为1.1，表示数字离圆心1.1个半径距离。<br>
radius表示饼状图的半径，为<strong>绝对</strong>距离。<br>
plt.axis('equal')表示饼状图为正圆形，否则为椭圆形。<p></p>
<h2 id="绘制散点图">绘制散点图</h2>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.scatter.html">matplotlib.pyplot.scatter</a><br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">N = <span class="number">50</span></span><br><span class="line">x = np.random.rand(N)</span><br><span class="line">y = np.random.rand(N)</span><br><span class="line">colors = np.random.rand(N)</span><br><span class="line">area = np.pi * (<span class="number">15</span> * np.random.rand(N))**<span class="number">2</span>  <span class="comment"># 0 to 15 point radii</span></span><br><span class="line"></span><br><span class="line">plt.scatter(x, y, s=area, c=colors, alpha=<span class="number">0.5</span>)</span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/scatter.png" class="" width="600" height="450"><br>
data为50个任意点，颜色也为任意的0-1之间的数，半径为0-15π之间任意的数。<br>
x,y是维度一样的列表，其中每个元素表示每个点的横纵坐标。<br>
s表示大小。alpha表示透明度。<p></p>
<h2 id="绘制柴火图步阶图">绘制柴火图、步阶图</h2>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.stem.html">matplotlib.pyplot.stem</a>；<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.step.html">matplotlib.pyplot.step</a><br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> ma</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">16</span>,<span class="number">4</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">x = np.linspace(<span class="number">0.1</span>, <span class="number">2</span>*np.pi, <span class="number">10</span>)</span><br><span class="line">plt.stem(x, np.cos(x), <span class="string">'-.'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">x = np.arange(<span class="number">1</span>, <span class="number">7</span>, <span class="number">0.4</span>)</span><br><span class="line">y0 = np.sin(x)</span><br><span class="line">y = y0.copy() + <span class="number">2.5</span></span><br><span class="line">plt.step(x, y, label=<span class="string">'pre (default)'</span>)</span><br><span class="line">y -= <span class="number">0.5</span></span><br><span class="line">plt.step(x, y, where=<span class="string">'mid'</span>, label=<span class="string">'mid'</span>)</span><br><span class="line">y -= <span class="number">0.5</span></span><br><span class="line">plt.step(x, y, where=<span class="string">'post'</span>, label=<span class="string">'post'</span>)</span><br><span class="line">y = ma.masked_where((y0 &gt; -<span class="number">0.15</span>) &amp; (y0 &lt; <span class="number">0.15</span>), y - <span class="number">0.5</span>)</span><br><span class="line">plt.step(x, y, label=<span class="string">'masked (pre)'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">7</span>)</span><br><span class="line">plt.ylim(-<span class="number">0.5</span>, <span class="number">4</span>)</span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/stem_step.png" class="" width="1200" height="450"><br>
x, y表示数据的横纵坐标。<br>
在step函数中有一个where属性，where属性有三个取值'pre'或'post'或'mid'。<br>
<code>where='pre'</code> 是默认值，表示每个步阶的坐标是从(x[i],y[i+1])到(x[i+1],y[i+1])。<br>
<code>where='mid'</code> 表示每个步阶的坐标是从(x[i],y[i])到(x[i+1],y[i])。<br>
<code>where='post'</code> 表示每个步阶的跳跃是从步阶的一半开始。<p></p>
<h2 id="绘制频谱图">绘制频谱图</h2>
<p><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.psd.html">matplotlib.pyplot.psd</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.magnitude_spectrum.html">matplotlib.pyplot.magnitude_spectrum</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.angle_spectrum.html">matplotlib.pyplot.angle_spectrum</a>;<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.phase_spectrum.html">matplotlib.pyplot.phase_spectrum</a><br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">dt = <span class="number">0.01</span></span><br><span class="line">Fs = <span class="number">1</span>/dt</span><br><span class="line">t = np.arange(<span class="number">0</span>, <span class="number">10</span>, dt)</span><br><span class="line">nse = np.random.randn(<span class="built_in">len</span>(t))</span><br><span class="line">r = np.exp(-t/<span class="number">0.05</span>)</span><br><span class="line">cnse = np.convolve(nse, r)*dt</span><br><span class="line">cnse = cnse[:<span class="built_in">len</span>(t)]</span><br><span class="line">s = <span class="number">0.1</span>*np.sin(<span class="number">2</span>*np.pi*t) + cnse</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">plt.plot(t, s)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">plt.psd(s, Fs=Fs)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">plt.magnitude_spectrum(s, Fs=Fs)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line">plt.magnitude_spectrum(s, Fs=Fs, scale=<span class="string">'dB'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">plt.angle_spectrum(s, Fs=Fs)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line">plt.phase_spectrum(s, Fs=Fs)</span><br></pre></td></tr></tbody></table></figure><br>
<img src="/images/Matplotlib/spectrum.png" class="" width="1200" height="450"><br>
<code>pyplot.psd()</code> 绘制能量谱密度图；<code>pyplot.magnitude_spectrum()</code> 绘制幅度频谱图；<code>pyplot.phase_spectrum()</code> 绘制相角频谱图；<code>pyplot.angle_spectrum()</code> 绘制相位频谱图。<br>
Fs表示采样频率。<p></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Python</tag>
        <tag>Data Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title>Python NumPy 库基础</title>
    <url>/contents/Python-NumPy%E5%BA%93%E5%9F%BA%E7%A1%80.html</url>
    <content><![CDATA[<p>NumPy 是 Python 语言的一个扩充程序库。支持高级大量的维度数组与矩阵运算，此外也针对数组运算提供大量的数学函数函数库。<br>
Reference：<a href="http://blog.csdn.net/linzch3/article/details/70992906">【MOOC】Python 数据分析与展示 - 北京理工大学 -【第一周】数据分析之表示</a> ; <a href="http://www.icourse163.org/course/BIT-1001870002">公开课</a> ;<a href="http://www.numpy.org">Document</a>;<a href="https://github.com/numpy/numpy">GitHub</a><br>
<span id="more"></span></p>
<h1 id="数据的维度">数据的维度</h1>
<ol type="1">
<li><p>一维数据<br>
一维数据由对等关系的有序或无序数据构成，采用线性方式组织，对应列表、数组和集合等概念。<br>
列表和数组的区别是：</p>
<ul>
<li>列表中元素的数据类型可以不同。</li>
<li>数组中元素的数据类型相同。<br>
一维数据的 Python 表示：列表（有序）或者集合（无序）。</li>
</ul></li>
<li><p>二维数据<br>
二维数据由多个一维数据构成，是一维数据的组合形式，表格是典型的二维数据，其中，表头是二维数据的一部分。<br>
二维数据的 Python 表示：列表。</p></li>
<li><p>多维数据<br>
多维数据由一维或二维数据在新维度上扩展形成。<br>
多维数据的 Python 表示：列表。</p></li>
<li><p>高维数据<br>
高维数据仅利用最基本的二元关系展示数据间的复杂结构。<br>
高维数据的 Python 表示：字典类型或者 JSON、XML、YAML 格式。</p></li>
</ol>
<h1 id="numpy的数组对象ndarray">NumPy 的数组对象：ndarray</h1>
<p>NumPy 是一个开源的 Python 科学计算基础库，包含：<br>
- 一个强大的 N 维数组对象 ndarray<br>
- 广播功能函数<br>
- 整合 C/C++/Fortran 代码的工具<br>
- 线性代数、傅里叶变换、随机数生成等功能<br>
NumPy 是 SciPy、 Pandas 等数据处理或科学计算库的基础。<br>
一般使用 <code>import numpy as np</code> 来引用 numpy 库。<br>
ndarray 意为：N 维数组对象。</p>
<h2 id="ndarray的好处">ndarray 的好处</h2>
<ul>
<li>数组对象可以去掉元素间运算所需的循环，使一维向量更像单个数据。</li>
<li>设置专门的数组对象，经过优化，可以提升这类应用的运算速度。<br>
注：科学计算中，一个维度所有数据的类型往往相同。</li>
<li>数组对象采用相同的数据类型，有助于节省运算和存储空间。</li>
</ul>
<h2 id="ndarray由两部分构成">ndarray 由两部分构成</h2>
<ul>
<li>实际的数据</li>
<li>描述这些数据的元数据（数据维度、数据类型等）</li>
</ul>
<p>ndarray 数组一般要求所有元素类型相同（同质），数组下标从 0 开始。<br>
ndarray 在程序中的别名是 array，所以用 np.array () 生成一个 ndarray 数组。<br>
<code>np.array()</code> 输出成 [] 格式，元素由空格分割。<br>
轴（axis）保存数据的维度；秩（rank）轴的数量。</p>
<h2 id="ndarray对象的属性">ndarray 对象的属性</h2>
<table>
<colgroup>
<col style="width: 8%">
<col style="width: 91%">
</colgroup>
<thead>
<tr class="header">
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.ndim</td>
<td> 秩，即轴的数量或维度的数量</td>
</tr>
<tr class="even">
<td>.shape</td>
<td>ndarray 对象的尺度，对于矩阵：n 行 m 列</td>
</tr>
<tr class="odd">
<td>.size</td>
<td>ndarray 对象元素的个数，即 n*m 的值</td>
</tr>
<tr class="even">
<td>.dtype</td>
<td>ndarray 对象的元素类型</td>
</tr>
<tr class="odd">
<td>.itemsize</td>
<td>ndarray 对象中每个元素的大小，以字节为单位<br>如果元素均为整数，则缺省为 int32，如果元素中有浮点数，则缺省为 float64。</td>
</tr>
</tbody>
</table>
<h2 id="ndarray数组的元素类型">ndarray 数组的元素类型</h2>
<table>
<thead>
<tr class="header">
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> bool</td>
<td> 布尔类型，True 或者 False。</td>
</tr>
<tr class="even">
<td>intc</td>
<td> 与 C 语言的 int 类型一致，一般是 int32 或者 int64</td>
</tr>
<tr class="odd">
<td>intp</td>
<td> 用于索引的整数，与 C 预言中的 ssize_t 一致，int32 或者 int64</td>
</tr>
<tr class="even">
<td>int8</td>
<td> 字节长度的整数，取值：[-128, 127]</td>
</tr>
<tr class="odd">
<td>int16</td>
<td>16 位长度的整数，取值：[-32768, 32767]</td>
</tr>
<tr class="even">
<td>int32</td>
<td>32 位长度的整数，取值：[-2<sup>31</sup>, 2<sup>31</sup>-1]</td>
</tr>
<tr class="odd">
<td>int64</td>
<td>64 位长度的整数，取值：[-2<sup>63</sup>, 2<sup>63</sup>-1]</td>
</tr>
<tr class="even">
<td>uint8</td>
<td>8 位无符号整数，取值：[0, 255]</td>
</tr>
<tr class="odd">
<td>uint16</td>
<td>16 位无符号整数，取值：[0, 65535]</td>
</tr>
<tr class="even">
<td>uint32</td>
<td>32 位无符号整数，取值：[0, 2<sup>32</sup>-1]</td>
</tr>
<tr class="odd">
<td>uint64</td>
<td>64 位无符号整数，取值：[0, 2<sup>64</sup>-1]</td>
</tr>
<tr class="even">
<td>float16</td>
<td>16 位半精度浮点数：1 位符号位，5 位指数，10 位尾数</td>
</tr>
<tr class="odd">
<td> float32</td>
<td>32 位半精度浮点数：1 位符号位，8 位指数，23 位尾数</td>
</tr>
<tr class="even">
<td> float64</td>
<td>64 位半精度浮点数：1 位符号位，11 位指数，52 位尾数</td>
</tr>
<tr class="odd">
<td> complex64</td>
<td> 复数类型，实部和虚部都是 32 位浮点数</td>
</tr>
<tr class="even">
<td> complex128</td>
<td> 复数类型，实部和虚部都是 64 位浮点数</td>
</tr>
</tbody>
</table>
<p>浮点数：（符号）尾数 * 10<sup> 指数</sup><br>
复数：实部 (.real)+ 虚部 i（.imag）</p>
<h2 id="与python对比">与 Python 对比</h2>
<ul>
<li>Python 语法仅支持整数、浮点数和复数 3 种类型。</li>
<li>科学计算涉及数据较多，对存储和性能都有较高要求。</li>
<li>对元素类型精细定义，有助于 NumPy 合理使用存储空间并优化性能。</li>
<li>对元素类型精细定义，有助于程序员对程序规模有合理评估。</li>
</ul>
<h2 id="非同质的ndarray对象">非同质的 ndarray 对象</h2>
<p>ndarray 数组可以由非同质的对象构成。<br>
非同质的 ndarray 元素类型为 object 类型。</p>
<h2 id="ndarray数组的创建">ndarray 数组的创建</h2>
<p>ndarray 数组的创建方法</p>
<ol type="1">
<li>从 Python 中的列表、元组、列表元祖混合等类型创建 ndarray 数组：<br>
<code>np.array(list,tuple)</code></li>
<li>从字节流（raw bytes）中创建 ndarray 数组。</li>
<li>从文件中读取特定格式中创建 ndarray 数组。</li>
<li>使用 NumPy 中函数创建 ndarray 数组：</li>
</ol>
<table>
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>np.arange(n,m,k)</code></td>
<td>类似 <code>range()</code> 函数，返回 ndarray 类型，元素从 n 到 m-k，间隔 k</td>
</tr>
<tr class="even">
<td><code>np.ones(shape)</code></td>
<td>根据 shape 生成一个全 1 数组，shape 是元组类型</td>
</tr>
<tr class="odd">
<td><code>np.zeros(shape)</code></td>
<td>根据 shape 生成一个全 0 数组，shape 是元组类型</td>
</tr>
<tr class="even">
<td><code>np.full(shape,val)</code></td>
<td>根据 shape 生成一个数组，shape 是元组类型，每个元素的值都是 val</td>
</tr>
<tr class="odd">
<td><code>np.eye(n)</code></td>
<td>创建一个正方的 n*n 单位矩阵，对角线为 1，其余为 0</td>
</tr>
<tr class="even">
<td><code>np.ones_like(a)</code></td>
<td>根据数组 a 的形状生成一个全 1 数组</td>
</tr>
<tr class="odd">
<td><code>np.zero_like(a)</code></td>
<td>根据数组 a 的形状生成一个全 0 数组</td>
</tr>
<tr class="even">
<td><code>np.full_like(a,val)</code></td>
<td>根据数组 a 的形状生成一个全 1 数组</td>
</tr>
<tr class="odd">
<td><code>np.linspace(n,m,k)</code></td>
<td>根据起止数据等间距地填充数据，形成数据，元素从 n 到 m，间隔 (m-n)/(k-1)，元素个数为 k</td>
</tr>
<tr class="even">
<td><code>np.linspace(n,m,k,endpoint=False)</code></td>
<td>根据起止数据等间距地填充数据，形成数据，元素从 n 到 m-(m-n)/k，间隔 (m-n)/k，元素个数为 k</td>
</tr>
<tr class="odd">
<td><code>np.linspace(a,b,c,...)</code></td>
<td>将两个或者多个数组合并成一个新的数组，原数组不变</td>
</tr>
</tbody>
</table>
<p>当 <code>np.array()</code> 不指定 dtype 时，NumPy 将根据数据情况关联一个 dtype 类型。</p>
<h2 id="ndarray数组的变换">ndarray 数组的变换</h2>
<p>对于创建后的 ndarray 数组，可以对其进行维度变换和元素类型变换。<br>
维度变换：</p>
<table>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>.reshape(shape)</code></td>
<td>不改变数组元素，返回一个 shape 形状的新数组，原数组不变</td>
</tr>
<tr class="even">
<td><code>.resize(shape)</code></td>
<td>与<code>.reshape(shape)</code> 功能一致，但修改原数组</td>
</tr>
<tr class="odd">
<td><code>.swapaxes(ax1,ax2)</code></td>
<td>将数组的其中两个维度进行顺序调换</td>
</tr>
<tr class="even">
<td><code>.flatten()</code></td>
<td>对数组进行降维，返回折叠后的新的一维数组，原数组不变</td>
</tr>
<tr class="odd">
<td><code>.astype(new_type)</code></td>
<td>对数组中的元素进行类型变化，返回一个新数组，原数组不变</td>
</tr>
<tr class="even">
<td><code>.tolist()</code></td>
<td>ndarray 数组向列表转换</td>
</tr>
</tbody>
</table>
<h2 id="ndarray数组的操作">ndarray 数组的操作</h2>
<p>数组的索引和切片：<br>
- 索引：获取数组中特定位置元素的过程。<br>
- 切片：获取数组元素子集的过程。</p>
<ol type="1">
<li>一维数组的索引和切片：与 Python 的列表类似
<ul>
<li><code>a[n]</code>：返回第 n+1 个元素。如果 n 为负数，则返回倒着数第 n 个元素。</li>
<li><code>a[n:m:k]</code>：起始编号 n，终止编号 m，步长 k，用冒号分割。如果 n 为空，即 <code>n = 0</code>；如果 m 为空，即 <code>m = len(a)</code>。</li>
</ul></li>
<li>多维数组的索引和切片：
<ul>
<li><code>a[n,m,k,...]</code>：每个维度一个索引值，最外 list 中第 n 个元素，倒数第二外 list 中第 m 个元素，以此类推。如果 n 为负数，则返回倒着数第 n 个元素。</li>
<li><code>a[n1:m1:k1,n2:m2:k2,n3:m3:k3,...]</code>：每个维度的切片方法与一维数组相同。顺序为从外到内。</li>
</ul></li>
</ol>
<h2 id="ndarray数组的运算">ndarray 数组的运算</h2>
<p>数组与标量之间的运算作用于数组的每一个元素。</p>
<h3 id="numpy一元函数">NumPy 一元函数</h3>
<p>对 ndarray 中的数据执行元素级运算的函数：</p>
<table>
<colgroup>
<col style="width: 62%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>np.abs(x)</code> or <code>np.fabs(x)</code></td>
<td>计算数组各元素的绝对值</td>
</tr>
<tr class="even">
<td><code>np.sqrt(x)</code></td>
<td>计算数组各元素的平方根</td>
</tr>
<tr class="odd">
<td><code>np.sqare(x)</code></td>
<td>计算数组各元素的平方</td>
</tr>
<tr class="even">
<td><code>np.log(x)</code> or <code>np.log10(x)</code>or<code>np.log2(x)</code></td>
<td>计算数组各元素的自然对数、10 为底的对数、2 为底的对数</td>
</tr>
<tr class="odd">
<td><code>np.ceil(x)</code> or <code>np.floor(x)</code></td>
<td>计算数组各元素的向上取整、向下取整</td>
</tr>
<tr class="even">
<td><code>np.rint(x)</code></td>
<td>计算数组各元素的四舍五入</td>
</tr>
<tr class="odd">
<td><code>np.modf(x)</code></td>
<td>将数组各元素的小数部分和整数部分以两个独立数组形式返回</td>
</tr>
<tr class="even">
<td><code>np.cos(x)</code> or <code>np.cosh(x)</code><br><code>np.cos(x)</code> or <code>np.cosh(x)</code><br><code>np.cos(x)</code> or <code>np.cosh(x)</code></td>
<td>计算数组各元素的普通型和双曲型三角函数</td>
</tr>
<tr class="odd">
<td><code>np.exp(x)</code></td>
<td>计算数组各元素的指数值</td>
</tr>
<tr class="even">
<td><code>np.sign(x)</code></td>
<td>计算数组各元素的符号值：1 (+),0,-1 (-)</td>
</tr>
</tbody>
</table>
<h3 id="numpy二元函数">NumPy 二元函数</h3>
<table>
<colgroup>
<col style="width: 61%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> + - * / **</td>
<td> 两个数组各元素进行对应运算</td>
</tr>
<tr class="even">
<td><code>np.maximum(x,y)</code> or <code>np.fmax(x,y)</code>or<code>np.minimum(x,y)</code> or <code>np.fmin(x,y)</code></td>
<td>两个数组元素级的最大值、最小值计算</td>
</tr>
<tr class="odd">
<td><code>np.mod(x,y)</code></td>
<td>两个数组元素级的模运算</td>
</tr>
<tr class="even">
<td><code>np.copysign(x,y)</code></td>
<td>将数组 y 中的各元素值的符号赋值给数组 x 的对应元素</td>
</tr>
<tr class="odd">
<td> &gt; &lt; &gt;= &lt;= == !=</td>
<td> 算术比较两个数组各元素，产生布尔型数组</td>
</tr>
</tbody>
</table>
<h2 id="numpy数据的存取">Numpy 数据的存取</h2>
<h3 id="一维二维数据的csv存取">一维、二维数据的 CSV 存取</h3>
<p>CSV (Comma‐Separated Value，逗号分隔值)，CSV 是一种常见的文件格式，用来存储批量数据。<br>
<strong>写入 CSV 文件：</strong><code>np.savetxt(fname, array, fmt, delimiter)</code>，其中 fname 指的是文件、字符串或者产生器，可以是.gz 或.bz2 压缩文件（NumPy 支持直接存入压缩文件以节省空间）；array 指的是需要存入的数组；fmt 指的是写入文件的格式，例如：% d (十进制整数) %.2f (保留 2 位小数的浮点数) %.18e (保留 18 位小数点的科学计数法)；delimiter 指的是分割字符串，默认是空格。<br>
<strong>读取 CSV 文件：</strong><code>np.loadtxt(fname, dtype, fmt, delimiter)</code>，其中 fname 指的是文件、字符串或者产生器，可以是.gz 或.bz2 压缩文件（NumPy 支持直接读取压缩文件）；dtype 指的是读取数据的类型，默认为浮点类型；delimiter 指的是分割字符串，默认是空格；uppack 指的是如果 True，读入属性将写入不同变量。<br>
CSV 文件的局限性：<br>
- CSV 只能有效存储一维和二维数组。<br>
- <code>np.savetxt()</code>；<code>np.loadtxt()</code> 只能有效存取一维和二维数组。</p>
<h3 id="多维数据的dat存取">多维数据的 dat 存取</h3>
<p>使用 tofile 函数保存多维数据：<br>
<strong>写入 dat 文件：</strong><code>a.tofile(fname, sep, format)</code>，其中 a 指的是需要存入的数组；fname 指的是文件、字符串；sep 指的是数据分割字符串，如果是空格，写入文件为二进制。<br>
<strong>读取 dat 文件：</strong><code>np.fromfile(fname, dtype, count, sep)</code>，其中 fname 指的是文件、字符串；dtype 指的是读取数据的类型；count 指的是读取数据的个数，如果 count=-1 则表示读入整个文件；sep 指的是数据分割字符串，如果是空格，以二进制读取文件。<br>
注意：该方法需要读取时知道存入文件时数组的维度和元素类型，a.tofile () 和 np.fromfile () 需要配合使用，可以通过元数据文件来存储额外信息。</p>
<h3 id="numpy便捷文件的存取">NumPy 便捷文件的存取</h3>
<p><strong>写入文件：</strong><code>np.save(fname, array)</code>，其中 fname 指的是文件名，以.npy 或者.npz 为扩展名，后者为压缩文件；array 指的是需要存入的数组。<br>
<strong>读取文件：</strong><code>np.load(fname)</code>，其中 fname 指的是文件名，以.npy 或者.npz 为扩展名，后者为压缩文件。</p>
<h2 id="numpy的随机数函数">NumPy 的随机数函数</h2>
<p>NumPy 的随机函数子库：<code>np.random.*</code> 包含有关随机数的函数。</p>
<h3 id="随机数组生成">随机数组生成</h3>
<table>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>rand(d0, d1, ..., dn)</code></td>
<td>根据 d0-dn 创建随机数数组，浮点数，[0, 1)，均匀分布</td>
</tr>
<tr class="even">
<td><code>randn(d0, d1, ..., dn)</code></td>
<td>根据 d0-dn 创建随机数数组，标准正太分布</td>
</tr>
<tr class="odd">
<td><code>randint(low[,high,shape])</code></td>
<td>根据 shape 创建随机整数数组 范围是 [1ow, high)，均匀分布</td>
</tr>
<tr class="even">
<td><code>seed(s)</code></td>
<td>随机数种子 s 是给定的种子值，相同的种子值产生相同的随机数组</td>
</tr>
<tr class="odd">
<td><code>uniform(low,high,size)</code></td>
<td>产生具有均匀分布的数组，low 为起始值，high 为结束值，size 为形状</td>
</tr>
<tr class="even">
<td><code>normal(loc,scale,size)</code></td>
<td>产生具有正太分布的数组，loc 为均值，scale 为标准差，size 为形状</td>
</tr>
<tr class="odd">
<td><code>poisson(lam,size)</code></td>
<td>产生具有泊松分布的数组，lam 为随机事件发生率，size 为形状</td>
</tr>
</tbody>
</table>
<h3 id="数组的随机变换">数组的随机变换</h3>
<table>
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>shuffle(a)</code></td>
<td>根据数组 a 的第 1 轴进行随机排列，改变数组 x</td>
</tr>
<tr class="even">
<td><code>permutation(a)</code></td>
<td>根据数组 a 的第 1 轴产生一个新的乱序数组，不改变数组 x</td>
</tr>
<tr class="odd">
<td><code>choice(a[, size, replace, p])</code></td>
<td>从一维数组 a 中以概率 p 抽取元素，形成 size 形状新数组<br>replace 表示是否可以重用元素，默认为 True</td>
</tr>
</tbody>
</table>
<h2 id="numpy的统计函数">NumPy 的统计函数</h2>
<table>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sum(a, axis = None)</code></td>
<td>根据给定轴 axis 计算数组 a 相关元素之和</td>
</tr>
<tr class="even">
<td><code>mean(a, axis = None)</code></td>
<td>根据给定轴 axis 计算数组 a 相关元素的期望</td>
</tr>
<tr class="odd">
<td><code>average(a, axis = None, weights = None)</code></td>
<td>根据给定轴 axis 计算数组 a 相关元素的加权平均值</td>
</tr>
<tr class="even">
<td><code>std(a, axis = None)</code></td>
<td>根据给定轴 axis 计算数组 a 相关元素的标准差</td>
</tr>
<tr class="odd">
<td><code>var(a, axis = None)</code></td>
<td>根据给定轴 axis 计算数组 a 相关元素的方差</td>
</tr>
<tr class="even">
<td><code>min(a) max(a)</code></td>
<td>计算数组 a 中元素的最小值、最大值</td>
</tr>
<tr class="odd">
<td><code>argmin(a) argmax(a)</code></td>
<td>计算数组 a 中元素最小值、最大值的降一维后下标</td>
</tr>
<tr class="even">
<td><code>unravel_index(index, shape)</code></td>
<td>根据 shape 将一维下标 index 转换成多维下标</td>
</tr>
<tr class="odd">
<td><code>ptp(a)</code></td>
<td>计算数组 a 中元素最大值与最小值的差</td>
</tr>
<tr class="even">
<td><code>median(a)</code></td>
<td>计算数组 a 中元素的中位数（中值），结果为浮点数</td>
</tr>
</tbody>
</table>
<p>・axis = None 是统计函数的标配参数，axis 为整数或元组。</p>
<h2 id="numpy的梯度函数">NumPy 的梯度函数</h2>
<p><code>np.gradient(f)</code>：计算数组 f 中元素的梯度，当 f 为多维时，返回每个维度的梯度。<br>
梯度：连续值之间的变化率，即斜率。例如：XY 坐标轴连续三个 X 坐标对应的 Y 轴值：a, b, c，其中，b 的梯度是 (c-a)/2。</p>
<h1 id="图像的数据表示">图像的数据表示</h1>
<p>图像一般使用 RGB 色彩模式，即每个像素点的颜色由红 (R)、绿 (G)、蓝 (B) 组成。<br>
RGB 三个颜色通道的变化和叠加得到各种颜色，其中<br>
・R 红色，取值范围：0‐255<br>
・G 绿色，取值范围：0‐255<br>
・B 蓝色，取值范围：0‐255<br>
RGB 形成的颜色包括了人类视力所能感知的所有颜色。</p>
<h2 id="pil库">PIL 库</h2>
<p>Python Image Library：<br>
安装：<code>pip install pillow</code><br>
调用：<code>from PIL import Image</code><br>
Image 是 PIL 库中代表一个图像的类（对象）。<br>
图像是一个三维数组，维度分别是高度、宽度和像素 RGB 值。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Python</tag>
        <tag>Data Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Pandas 库基础</title>
    <url>/contents/Python-Pandas%E5%BA%93%E5%9F%BA%E7%A1%80.html</url>
    <content><![CDATA[<p>Pandas 是 Python 第三方库，提供高性能易用数据类型和分析工具，Pandas 基于 NumPy 实现，常与 NumPy 和 Matplotlib 一同使用。<br>
Reference：<a href="http://blog.csdn.net/linzch3/article/details/71046340">【MOOC】Python 数据分析与展示 - 北京理工大学 -【第三周】数据分析之概要</a> ; <a href="http://www.icourse163.org/course/BIT-1001870002">公开课</a> ;<a href="http://pandas.pydata.org/#">Document</a>;<a href="https://github.com/pandas-dev/pandas">GitHub</a><br>
<span id="more"></span></p>
<h1 id="pandas库">Pandas 库</h1>
<p>一般通过 <code>import pandas as pd</code> 来引用 Pandas 库。<br>
pd 通常为该模块的别名。<br>
与 numpy 的区别：</p>
<table>
<thead>
<tr class="header">
<th>NumPy</th>
<th>Pandas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> 基础数据类型</td>
<td>扩展数据类型</td>
</tr>
<tr class="even">
<td>关注数据的结构表达</td>
<td>关注数据的应用表达</td>
</tr>
<tr class="odd">
<td>维度：数据间关系</td>
<td>数据与索引的关系</td>
</tr>
</tbody>
</table>
<p>该库基于 numpy 提供了两个新的数据类型：Series, DataFrame。<br>
基于上述数据类型有各类操作：基本操作、运算操作、特征类操作、关联类操作。</p>
<h1 id="series类型一维">Series 类型（一维）</h1>
<p>Series 类型由一组数据及与之相关的数据索引组成：<br>
index_0 ------&gt; data_a<br>
index_1 ------&gt; data_b<br>
index_2 ------&gt; data_c<br>
index_3 ------&gt; data_d<br>
index_4 ------&gt; data_e<br>
　索引　　　 数据</p>
<p>Series 是一维带 “标签” 数组 (Series 类型包括 index 和 values 两部分，index 和 values 一一对应)</p>
<h2 id="series类型的创建">Series 类型的创建</h2>
<p>Series 类型可以由如下类型创建：<br>
- Python 列表，index 与列表元素个数一致<br>
- 标量值，index 表达 Series 类型的尺寸<br>
- Python 字典，键值对中的 “键” 是索引，index 从字典中进行选择操作<br>
- ndarray，索引和数据都可以通过 ndarray 类型创建<br>
- 其他函数，range () 函数等</p>
<h3 id="列表">列表</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">&gt;&gt;&gt;<span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span>    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"><span class="comment"># 第一列为自动索引，dtype后为数据类型。</span></span><br></pre></td></tr></tbody></table></figure>
<p>Pandas 也可以自定义索引。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"><span class="comment"># 第一列为给定索引，dtype后为数据类型。</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="标量">标量</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series(<span class="number">5</span>, index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"><span class="comment"># 第一列为给定索引，dtype后为数据类型。</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意：此时不能省略 index。</p>
<h3 id="字典">字典</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series({<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>, <span class="string">'d'</span>:<span class="number">4</span>, <span class="string">'e'</span>:<span class="number">5</span>}, index=[<span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>])</span><br><span class="line">&gt;&gt;&gt;e    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"><span class="comment"># 第一列为给定索引，dtype后为数据类型。</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意，index 里面的值的个数可以少于给定字典的键的个数，但是 index 里面每个值必须都是给定字典的键。输出顺序为 index 的顺序。</p>
<h3 id="ndarray">ndarray</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">s = pd.Series(np.arange(<span class="number">5</span>), index=np.arange(<span class="number">9</span>,<span class="number">4</span>,-<span class="number">1</span>))</span><br><span class="line">&gt;&gt;&gt;<span class="number">9</span>    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">8</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">7</span>    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">6</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">5</span>    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"><span class="comment"># 第一列为给定索引，dtype后为数据类型。</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意：这里数据类型为 int64。</p>
<h3 id="range">range()</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series(<span class="built_in">range</span>(<span class="number">5</span>), index=<span class="built_in">range</span>(<span class="number">9</span>,<span class="number">4</span>,-<span class="number">1</span>))</span><br><span class="line">&gt;&gt;&gt;<span class="number">9</span>    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">8</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">7</span>    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">6</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">5</span>    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"><span class="comment"># 第一列为给定索引，dtype后为数据类型。</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意：这里数据类型为 int64。</p>
<h2 id="series类型的基本操作">Series 类型的基本操作</h2>
<h3 id="获取所有索引所有数据">获取所有索引、所有数据</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">s.index</span><br><span class="line">&gt;&gt;&gt;Index([<span class="string">u'a'</span>, <span class="string">u'b'</span>, <span class="string">u'c'</span>, <span class="string">u'd'</span>, <span class="string">u'e'</span>], dtype=<span class="string">'object'</span>)</span><br><span class="line"></span><br><span class="line">s.values</span><br><span class="line">&gt;&gt;&gt;[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span>(s.values)</span><br><span class="line">&gt;&gt;&gt;&lt;<span class="built_in">type</span> <span class="string">'numpy.ndarray'</span>&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>注意 a.values 返回的是 ndarray 类型。</p>
<h3 id="索引">索引</h3>
<p>自动索引和自定义索引并存（但不能混合使用）<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">s[<span class="number">0</span>]</span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">s[<span class="string">'a'</span>]</span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">s.at[<span class="string">'a'</span>]</span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">s.iat[<span class="number">0</span>]</span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">s[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]</span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"></span><br><span class="line">s[[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>]]</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"></span><br><span class="line">s[[<span class="string">'a'</span>,<span class="number">1</span>]] <span class="comment"># 自动索引和自定义索引不能混用。</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1.0</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>    NaN</span><br><span class="line">&gt;&gt;&gt;dtype: float64</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="切片">切片</h3>
<p>NumPy 中运算和操作可用于 Series 类型（运算和操作结果仍然是 Series 类型）<br>
可以通过自定义索引的列表进行切片（切片后的结果仍然是 Series 类型）<br>
可以通过自动索引进行切片，如果存在自定义索引，则一同被切片（切片后的结果仍然是 Series 类型）<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">s[<span class="number">3</span>]</span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span></span><br><span class="line"></span><br><span class="line">s.loc[<span class="string">'b'</span>: <span class="string">'d'</span>]</span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"></span><br><span class="line">s.iloc[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"></span><br><span class="line">s[:<span class="number">3</span>]</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"></span><br><span class="line">s[s &gt; s.median()]</span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br><span class="line"></span><br><span class="line">np.exp(s)</span><br><span class="line">&gt;&gt;&gt;a      <span class="number">2.718282</span></span><br><span class="line">&gt;&gt;&gt;b      <span class="number">7.389056</span></span><br><span class="line">&gt;&gt;&gt;c     <span class="number">20.085537</span></span><br><span class="line">&gt;&gt;&gt;d     <span class="number">54.598150</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">148.413159</span></span><br><span class="line">&gt;&gt;&gt;dtype: float64</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="字典-1">字典</h3>
<p>Python 字典中运算和操作可用于 Series 类型（运算和操作结果仍然是 Series 类型）<br>
通过自定义索引访问<br>
保留字 in 操作（只会判断自定义索引，不会判断自动索引）<br>
使用.get () 方法<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line"><span class="string">'c'</span> <span class="keyword">in</span> s</span><br><span class="line">&gt;&gt;&gt;<span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="keyword">in</span> s</span><br><span class="line">&gt;&gt;&gt;<span class="literal">False</span></span><br><span class="line"></span><br><span class="line">s.get(<span class="string">'c'</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span></span><br><span class="line"></span><br><span class="line">s.get(<span class="string">'f'</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">s.get(<span class="string">'f'</span>, <span class="number">100</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">100</span></span><br></pre></td></tr></tbody></table></figure><br>
注意s.get(key)：<br>
- 如果key存在于索引中，则返回该索引对应的值。<br>
- 如果key不存在于索引中，则返回None。<br>
- 如果get函数中有第二个参数且key不存在于索引中，则返回第二个参数的值，但不会改变s的值。<p></p>
<h3 id="对齐">对齐</h3>
<p>Series 类型在运算中会自动对齐不同索引的数据。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s1 = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">s2 = pd.Series([<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">s1 + s2</span><br><span class="line">&gt;&gt;&gt;a    NaN</span><br><span class="line">&gt;&gt;&gt;b    NaN</span><br><span class="line">&gt;&gt;&gt;c    <span class="number">6.0</span></span><br><span class="line">&gt;&gt;&gt;d    NaN</span><br><span class="line">&gt;&gt;&gt;e    NaN</span><br><span class="line">&gt;&gt;&gt;dtype: float64</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="名字">名字</h3>
<p>Series 对象和索引都可以有一个名字，存储在属性.name 中。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">s.name = <span class="string">'values'</span></span><br><span class="line">s.index.name = <span class="string">'indexes'</span></span><br><span class="line">&gt;&gt;&gt;indexes</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;Name: values, dtype: int64</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="修改">修改</h3>
<p>Series 对象可以随时修改并即刻生效。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line">s[<span class="string">'c'</span>] = <span class="number">30</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c   <span class="number">30</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;dtype: int64</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="dataframe类型二维">DataFrame 类型（二维）</h1>
<p>DataFrame 类型由共用相同索引的一组列组成：<br>
　　　　　　column　　　　　　　axis=1<br>
　　　　　　index_0 ------&gt; data_a data_f ... data_v<br>
　　　　　　index_1 ------&gt; data_b data_g ... data_w<br>
rows　　　　index_2 ------&gt; data_c data_h ... data_x<br>
axis=0　　　index_3 ------&gt; data_d data_i ... data_y<br>
　　　　　　index_4 ------&gt; data_e data_j ... data_z<br>
　　　　　　　索引　　　　　　　　数据<br>
DataFrame 是一个表格型的数据类型，每列值类型可以不同 (类似于 Excel)。<br>
DataFrame 既有行索引、也有列索引。<br>
DataFrame 常用于表达二维数据，但可以表达多维数据。</p>
<h2 id="dataframe类型的创建">DataFrame 类型的创建</h2>
<p>DataFrame 类型可以由如下类型创建：<br>
- 二维 ndarray 对象<br>
- 由一维 ndarray、列表、字典、元组或 Series 构成的字典<br>
- Series 类型<br>
- 其他 DataFrame 类型</p>
<h3 id="二维ndarray">二维 ndarray</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="字典-2">字典</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df_dict = {<span class="string">'one'</span>: np.arange(<span class="number">0</span>,<span class="number">10</span>,<span class="number">2</span>), <span class="string">'two'</span>: np.arange(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>)}</span><br><span class="line">df = pd.DataFrame(df_dict, index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line"></span><br><span class="line">df_dict = {<span class="string">'one'</span>: [<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>], <span class="string">'two'</span>: [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>]}</span><br><span class="line">df = pd.DataFrame(df_dict, index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line"></span><br><span class="line">df_dict = {<span class="string">'one'</span>: {<span class="string">'a'</span>:<span class="number">0</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">4</span>, <span class="string">'d'</span>:<span class="number">6</span>, <span class="string">'e'</span>:<span class="number">8</span>}, <span class="string">'two'</span>: {<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">3</span>, <span class="string">'c'</span>:<span class="number">5</span>, <span class="string">'d'</span>:<span class="number">7</span>, <span class="string">'e'</span>:<span class="number">9</span>}}</span><br><span class="line">df = pd.DataFrame(df_dict)</span><br><span class="line"></span><br><span class="line">df_dict = {<span class="string">'one'</span>: (<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>), <span class="string">'two'</span>: (<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>)}</span><br><span class="line">df = pd.DataFrame(df_dict, index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</span><br><span class="line"></span><br><span class="line">df_dict = {<span class="string">'one'</span>: pd.Series(<span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]), <span class="string">'two'</span>: pd.Series(<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])}</span><br><span class="line">df = pd.DataFrame(df_dict)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上述所有的创建方式的结果都一样</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure>
<p>字典内的值可以是 ndarray、列表、字典、元组或 Series 类型。</p>
<h3 id="series类型">Series 类型</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s1 = pd.Series([<span class="number">0</span>,<span class="number">1</span>], index=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">s2 = pd.Series([<span class="number">2</span>,<span class="number">3</span>], index=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">s3 = pd.Series([<span class="number">4</span>,<span class="number">5</span>], index=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">s4 = pd.Series([<span class="number">6</span>,<span class="number">7</span>], index=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">s5 = pd.Series([<span class="number">8</span>,<span class="number">9</span>], index=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">df = pd.DataFrame([s1,s2,s3,s4,s5], index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意：这里每一个 Series 对象的 index 必须一样，否则报错。</p>
<h3 id="其他dataframe类型">其他 DataFrame 类型</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(a, index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>], columns=[<span class="string">'one'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span></span><br></pre></td></tr></tbody></table></figure>
<p>类似对 DataFrame 进行切片。</p>
<h3 id="读取csv文件">读取 CSV 文件</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'aaa.csv'</span>) <span class="comment"># 读取aaa.csv文件</span></span><br><span class="line">df = pd.read_csv(<span class="string">'aaa.csv'</span>, index_col=<span class="string">'bbb'</span>) <span class="comment"># 指定行标签 label</span></span><br><span class="line">df = pd.read_csv(StringIO(<span class="string">'one,two\n0,1\n2,3\n4,5\n6,7\n8,9'</span>)) <span class="comment"># 读取csv格式的字符串</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;<span class="number">0</span>    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span>    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span>    <span class="number">8</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="dataframe类型的基本操作">DataFrame 类型的基本操作</h2>
<h3 id="获取所有索引所有数据-1">获取所有索引、所有数据</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">df.index</span><br><span class="line">&gt;&gt;&gt;Index([<span class="string">u'a'</span>, <span class="string">u'b'</span>, <span class="string">u'c'</span>, <span class="string">u'd'</span>, <span class="string">u'e'</span>], dtype=<span class="string">'object'</span>)</span><br><span class="line"></span><br><span class="line">df.columns</span><br><span class="line">&gt;&gt;&gt;Index([<span class="string">u'one'</span>, <span class="string">u'two'</span>], dtype=<span class="string">'object'</span>)</span><br><span class="line"></span><br><span class="line">df.values</span><br><span class="line">&gt;&gt;&gt;[[<span class="number">0</span> <span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">2</span> <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">4</span> <span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">6</span> <span class="number">7</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">8</span> <span class="number">9</span>]]</span><br></pre></td></tr></tbody></table></figure>
<h3 id="索引-1">索引</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">df[[<span class="string">'one'</span>]] <span class="comment"># 返回一个DataFrame类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">'one'</span>] <span class="comment"># 返回一个Series类型，注意这里不能用自动索引</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span></span><br><span class="line">&gt;&gt;&gt;Name: one, dtype: int32</span><br><span class="line"></span><br><span class="line">df.loc[<span class="string">'c'</span>] <span class="comment"># 返回一个Series类型，注意这里不能用自动索引</span></span><br><span class="line">&gt;&gt;&gt;one    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;two    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;Name: c, dtype: int32</span><br><span class="line">        </span><br><span class="line">df.iloc[<span class="number">1</span>] <span class="comment"># 返回第二行，Series类型，不可直接用a[1]</span></span><br><span class="line">&gt;&gt;&gt;one    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;two    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;Name: b, dtype: int32</span><br><span class="line"></span><br><span class="line">df[<span class="string">'one'</span>][<span class="string">'c'</span>] <span class="comment"># 返回一个numpy.int32类型，注意这里顺序为先列后行</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span></span><br><span class="line"></span><br><span class="line">df.loc[<span class="string">'c'</span>, <span class="string">'one'</span>] <span class="comment"># 返回一个numpy.int32类型，注意这里顺序为先行后列</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span></span><br><span class="line"></span><br><span class="line">df.at[<span class="string">'c'</span>, <span class="string">'one'</span>] <span class="comment"># 返回一个numpy.int32类型，注意这里顺序为先行后列</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span></span><br><span class="line"></span><br><span class="line">df.iloc[<span class="number">1</span>, <span class="number">0</span>] <span class="comment"># 返回一个numpy.int32类型，注意这里顺序为先行后列</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span></span><br><span class="line"></span><br><span class="line">df.iat[<span class="number">2</span>, <span class="number">0</span>] <span class="comment"># 返回一个numpy.int32类型，注意这里顺序为先行后列</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="切片-1">切片</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">df[<span class="number">0</span>:<span class="number">3</span>] <span class="comment"># 返回前三行</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line"></span><br><span class="line">df.head(<span class="number">3</span>) <span class="comment"># 返回前三行</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line"></span><br><span class="line">df.head(-<span class="number">3</span>) <span class="comment"># 返回前两行</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line"></span><br><span class="line">df.take([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]) <span class="comment"># 返回第一、二、三行</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line"></span><br><span class="line">df.take([<span class="number">0</span>], axis=<span class="number">1</span>) <span class="comment"># 返回第一列</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span></span><br><span class="line"></span><br><span class="line">df.take([-<span class="number">1</span>, -<span class="number">2</span>]) <span class="comment"># 返回倒数第一、二行</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line"></span><br><span class="line">df.tail(<span class="number">2</span>) <span class="comment"># 返回倒数两行，注意和上方顺序不一样</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.tail(-<span class="number">2</span>) <span class="comment"># 返回倒数三行</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.loc[<span class="string">'b'</span>:<span class="string">'d'</span>] <span class="comment"># 与切片不同，这种情况下包含开头也包含结束</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line"></span><br><span class="line">df.loc[<span class="string">'c'</span>:, [<span class="string">'one'</span>]] <span class="comment"># 行标签从c到最后行，且只选取one这一列</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one</span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span></span><br><span class="line"></span><br><span class="line">df[df &gt; df.median()]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a  NaN  NaN</span><br><span class="line">&gt;&gt;&gt;b  NaN  NaN</span><br><span class="line">&gt;&gt;&gt;c  NaN  NaN</span><br><span class="line">&gt;&gt;&gt;d  <span class="number">6.0</span>  <span class="number">7.0</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="number">8.0</span>  <span class="number">9.0</span></span><br><span class="line"></span><br><span class="line">np.exp(df)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>          one          two</span><br><span class="line">&gt;&gt;&gt;a     <span class="number">1.000000</span>     <span class="number">2.718282</span></span><br><span class="line">&gt;&gt;&gt;b     <span class="number">7.389056</span>    <span class="number">20.085537</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">54.598150</span>   <span class="number">148.413159</span></span><br><span class="line">&gt;&gt;&gt;d   <span class="number">403.428793</span>  <span class="number">1096.633158</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="number">2980.957987</span>  <span class="number">8103.083928</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="条件筛选">条件筛选</h3>
<ol type="1">
<li><p>简单逻辑判断（&lt;,&gt;, ==, &amp;, |, ~ 等）</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">df.loc[df[<span class="string">'one'</span>] &gt; <span class="number">5</span>] <span class="comment"># one属性大于5的记录</span></span><br><span class="line">df[df[<span class="string">'one'</span>] &gt; <span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">'two'</span>][df[<span class="string">'one'</span>] &gt; <span class="number">5</span>] <span class="comment"># 返回Series类型</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;Name: two, dtype: int32</span><br><span class="line"></span><br><span class="line">df.loc[[<span class="string">'two'</span>]][df[<span class="string">'one'</span>] &gt; <span class="number">5</span>] <span class="comment"># 返回DataFrame类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  two</span><br><span class="line">&gt;&gt;&gt;d    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.loc[:, [<span class="string">'two'</span>,<span class="string">'one'</span>]][df[<span class="string">'one'</span>] &gt; <span class="number">5</span>] <span class="comment"># 调换index顺序</span></span><br><span class="line">df[[<span class="string">'two'</span>,<span class="string">'one'</span>]][df[<span class="string">'one'</span>] &gt; <span class="number">5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  two  one</span><br><span class="line">&gt;&gt;&gt;d    <span class="number">7</span>    <span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">9</span>    <span class="number">8</span></span><br><span class="line"></span><br><span class="line">df.loc[(df[<span class="string">'one'</span>] &gt; <span class="number">5</span>) | (df[<span class="string">'two'</span>] &lt;<span class="number">5</span>)] <span class="comment"># one属性大于5或者two属性小于5的记录，注意每个判断表达式都要用括号括起来</span></span><br><span class="line">df[(df[<span class="string">'one'</span>] &gt; <span class="number">5</span>) | (df[<span class="string">'two'</span>] &lt;<span class="number">5</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.loc[df[<span class="string">'two'</span>] != <span class="number">5</span>] <span class="comment"># 删除某符合条件的行</span></span><br><span class="line">df[df[<span class="string">'two'</span>] != <span class="number">5</span>]</span><br><span class="line">df.drop(df.loc[df.two == <span class="number">5</span>].index, axis=<span class="number">0</span>)</span><br><span class="line">df.drop(df[df.two == <span class="number">5</span>].index, axis=<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><p>自定义函数筛选</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">df.loc[<span class="keyword">lambda</span> x: x[<span class="string">'one'</span>] * x[<span class="string">'two'</span>] &gt; <span class="number">5</span>] <span class="comment"># 函数入参x是整个DataFrame</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df[df.apply(<span class="keyword">lambda</span> x: x[<span class="string">'one'</span>] * x[<span class="string">'two'</span>] &gt; <span class="number">5</span>, axis=<span class="number">1</span>)] <span class="comment"># 函数入参x是一行数据Series</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">filter</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> x &gt; <span class="number">5</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">df[df.apply(<span class="built_in">filter</span>, axis=<span class="number">1</span>)] <span class="comment"># 函数作为apply的参数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a  NaN  NaN</span><br><span class="line">&gt;&gt;&gt;b  NaN  NaN</span><br><span class="line">&gt;&gt;&gt;c  NaN  NaN</span><br><span class="line">&gt;&gt;&gt;d  <span class="number">6.0</span>  <span class="number">7.0</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="number">8.0</span>  <span class="number">9.0</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h3 id="字典-3">字典</h3>
<p>in 关键字只能检查 columns 的值是否存在。<br>
get 关键字也只能提取列<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="string">'c'</span> <span class="keyword">in</span> df</span><br><span class="line">&gt;&gt;&gt;<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">'one'</span> <span class="keyword">in</span> df</span><br><span class="line">&gt;&gt;&gt;<span class="literal">True</span></span><br><span class="line"></span><br><span class="line">df.get(<span class="string">'c'</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">df.get(<span class="string">'one'</span>)</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span></span><br><span class="line">&gt;&gt;&gt;Name: one, dtype: int32</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="对齐-1">对齐</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">6</span>).reshape(<span class="number">3</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">4</span>, <span class="number">10</span>).reshape(<span class="number">3</span>, <span class="number">2</span>), index=[<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df1 + df2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one   two</span><br><span class="line">&gt;&gt;&gt;a  NaN   NaN</span><br><span class="line">&gt;&gt;&gt;b  NaN   NaN</span><br><span class="line">&gt;&gt;&gt;c  <span class="number">8.0</span>  <span class="number">10.0</span></span><br><span class="line">&gt;&gt;&gt;d  NaN   NaN</span><br><span class="line">&gt;&gt;&gt;e  NaN   NaN</span><br></pre></td></tr></tbody></table></figure>
<h3 id="名字-1">名字</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">df.columns.name = <span class="string">'columns'</span></span><br><span class="line">df.index.name = <span class="string">'indexes'</span></span><br><span class="line">&gt;&gt;&gt;columns  one  two</span><br><span class="line">&gt;&gt;&gt;indexes          </span><br><span class="line">&gt;&gt;&gt;a          <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b          <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c          <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d          <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e          <span class="number">8</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="修改-1">修改</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">s = {<span class="number">8</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>}</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">set</span>([<span class="number">0</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">df[<span class="string">'one'</span>] = {<span class="number">8</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>}</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">8</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">2</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">4</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">6</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">'one'</span>] = [<span class="number">8</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">8</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">6</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">2</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">0</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">'one'</span>] = (<span class="number">8</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">8</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">6</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">2</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">0</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure>
<p>字典会自动重排顺序。</p>
<h1 id="pandas的数据类型操作">Pandas 的数据类型操作</h1>
<p>Pandas 提供各种函数对 Series 类型和 DataFrame 类型进行操作，两种类型操作类似，下面例子以 DataFrame 为例。</p>
<h2 id="重新索引">重新索引</h2>
<p>.reindex () 能够改变或重排 Series 和 DataFrame 索引<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.reindex(index=[<span class="string">'e'</span>,<span class="string">'d'</span>,<span class="string">'c'</span>,<span class="string">'b'</span>,<span class="string">'a'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line"></span><br><span class="line">df.reindex(columns=[<span class="string">'two'</span>,<span class="string">'one'</span>,<span class="string">'three'</span>]) <span class="comment"># 注意仅仅是重排索引，如果列名不存在，整列为NaN</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  two  one  three</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span>    <span class="number">0</span>    NaN</span><br><span class="line">&gt;&gt;&gt;b    <span class="number">3</span>    <span class="number">2</span>    NaN</span><br><span class="line">&gt;&gt;&gt;c    <span class="number">5</span>    <span class="number">4</span>    NaN</span><br><span class="line">&gt;&gt;&gt;d    <span class="number">7</span>    <span class="number">6</span>    NaN</span><br><span class="line">&gt;&gt;&gt;e    <span class="number">9</span>    <span class="number">8</span>    NaN</span><br><span class="line"></span><br><span class="line">df.set_index(<span class="string">'one'</span>) <span class="comment"># 将某列变成索引</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    two</span><br><span class="line">&gt;&gt;&gt;one     </span><br><span class="line">&gt;&gt;&gt;<span class="number">0</span>      <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>      <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span>      <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">6</span>      <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">8</span>      <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.reset_index() <span class="comment"># 新生成数字升序索引，原索引变成新的列</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> index  one  two</span><br><span class="line">&gt;&gt;&gt;<span class="number">0</span>     a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>     b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>     c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span>     d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span>     e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.reset_index(drop=<span class="literal">True</span>) <span class="comment"># 新生成数字升序索引，原索引丢弃</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;<span class="number">0</span>    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span>    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span>    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.rename(columns={<span class="string">'one'</span>: <span class="string">'x'</span>, <span class="string">'two'</span>: <span class="string">'y'</span>}) <span class="comment"># 列索引重命名</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  x  y</span><br><span class="line">&gt;&gt;&gt;a  <span class="number">0</span>  <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b  <span class="number">2</span>  <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c  <span class="number">4</span>  <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d  <span class="number">6</span>  <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="number">8</span>  <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.rename({<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'d'</span>: <span class="number">4</span>, <span class="string">'e'</span>: <span class="number">5</span>}) <span class="comment"># 行索引重命名</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span>    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span>    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">5</span>    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.rename(<span class="built_in">str</span>.upper) <span class="comment"># 行索引更改种类；如需要改变列索引种类则增加参数axis='columns'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;A    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;B    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;C    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;D    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;E    <span class="number">8</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="插入">插入</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df2 = df1.columns.insert(<span class="number">1</span>, <span class="string">'three'</span>)</span><br><span class="line">&gt;&gt;&gt;Index([<span class="string">u'one'</span>, <span class="string">u'three'</span>, <span class="string">u'two'</span>], dtype=<span class="string">'object'</span>)</span><br><span class="line"></span><br><span class="line">df3 = df1.reindex(columns=df2, fill_value=<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  three  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>      <span class="number">5</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>      <span class="number">5</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>      <span class="number">5</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>      <span class="number">5</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>      <span class="number">5</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df4 = df1.index.insert(<span class="number">3</span>, <span class="string">'f'</span>)</span><br><span class="line">&gt;&gt;&gt;Index([<span class="string">u'a'</span>, <span class="string">u'b'</span>, <span class="string">u'c'</span>, <span class="string">u'f'</span>, <span class="string">u'd'</span>, <span class="string">u'e'</span>], dtype=<span class="string">'object'</span>)</span><br><span class="line"></span><br><span class="line">df5 = df1.reindex(index=df4, fill_value=<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;f    <span class="number">5</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="合并">合并</h2>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html">合并官方教程</a></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">10</span>, <span class="number">16</span>).reshape(<span class="number">3</span>, <span class="number">2</span>), index=[<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;f   <span class="number">10</span>   <span class="number">11</span></span><br><span class="line">&gt;&gt;&gt;g   <span class="number">12</span>   <span class="number">13</span></span><br><span class="line">&gt;&gt;&gt;h   <span class="number">14</span>   <span class="number">15</span></span><br><span class="line"></span><br><span class="line">df3 = pd.DataFrame(np.arange(<span class="number">16</span>, <span class="number">22</span>).reshape(<span class="number">3</span>, <span class="number">2</span>), index=[<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;i   <span class="number">16</span>   <span class="number">17</span></span><br><span class="line">&gt;&gt;&gt;j   <span class="number">18</span>   <span class="number">19</span></span><br><span class="line">&gt;&gt;&gt;k   <span class="number">20</span>   <span class="number">21</span></span><br><span class="line"></span><br><span class="line">df4 = pd.DataFrame(np.arange(<span class="number">10</span>, <span class="number">25</span>).reshape(<span class="number">5</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  three  four  five</span><br><span class="line">&gt;&gt;&gt;a     <span class="number">10</span>    <span class="number">11</span>    <span class="number">12</span></span><br><span class="line">&gt;&gt;&gt;b     <span class="number">13</span>    <span class="number">14</span>    <span class="number">15</span></span><br><span class="line">&gt;&gt;&gt;c     <span class="number">16</span>    <span class="number">17</span>    <span class="number">18</span></span><br><span class="line">&gt;&gt;&gt;d     <span class="number">19</span>    <span class="number">20</span>    <span class="number">21</span></span><br><span class="line">&gt;&gt;&gt;e     <span class="number">22</span>    <span class="number">23</span>    <span class="number">24</span></span><br><span class="line"></span><br><span class="line">df5 = pd.concat([df1, df2, df3], keys=[<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>]) <span class="comment"># 行合并</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    one  two</span><br><span class="line">&gt;&gt;&gt;x a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;y f   <span class="number">10</span>   <span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> g   <span class="number">12</span>   <span class="number">13</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> h   <span class="number">14</span>   <span class="number">15</span></span><br><span class="line">&gt;&gt;&gt;z i   <span class="number">16</span>   <span class="number">17</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> j   <span class="number">18</span>   <span class="number">19</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span> k   <span class="number">20</span>   <span class="number">21</span></span><br><span class="line"></span><br><span class="line">df5.loc[<span class="string">'y'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;f   <span class="number">10</span>   <span class="number">11</span></span><br><span class="line">&gt;&gt;&gt;g   <span class="number">12</span>   <span class="number">13</span></span><br><span class="line">&gt;&gt;&gt;h   <span class="number">14</span>   <span class="number">15</span></span><br><span class="line"></span><br><span class="line">df5.loc[<span class="string">'y'</span>].loc[<span class="string">'g'</span>]</span><br><span class="line">&gt;&gt;&gt;one    <span class="number">12</span></span><br><span class="line">&gt;&gt;&gt;two    <span class="number">13</span></span><br><span class="line">&gt;&gt;&gt;Name: g, dtype: int32</span><br><span class="line">    </span><br><span class="line">pd.concat([df1, df4], axis=<span class="number">1</span>) <span class="comment"># 列合并</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two  three  four  five</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span>     <span class="number">10</span>    <span class="number">11</span>    <span class="number">12</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span>     <span class="number">13</span>    <span class="number">14</span>    <span class="number">15</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span>     <span class="number">16</span>    <span class="number">17</span>    <span class="number">18</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span>     <span class="number">19</span>    <span class="number">20</span>    <span class="number">21</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span>     <span class="number">22</span>    <span class="number">23</span>    <span class="number">24</span></span><br><span class="line"></span><br><span class="line">df6 = pd.DataFrame(np.arange(<span class="number">10</span>, <span class="number">16</span>).reshape(<span class="number">3</span>, <span class="number">2</span>), index=[<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>], columns=[<span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  two  three</span><br><span class="line">&gt;&gt;&gt;d   <span class="number">10</span>     <span class="number">11</span></span><br><span class="line">&gt;&gt;&gt;e   <span class="number">12</span>     <span class="number">13</span></span><br><span class="line">&gt;&gt;&gt;f   <span class="number">14</span>     <span class="number">15</span></span><br><span class="line"></span><br><span class="line">pd.concat([df1, df6], axis=<span class="number">1</span>) <span class="comment"># 列合并，行并集</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two   two  three</span><br><span class="line">&gt;&gt;&gt;a  <span class="number">0.0</span>  <span class="number">1.0</span>   NaN    NaN</span><br><span class="line">&gt;&gt;&gt;b  <span class="number">2.0</span>  <span class="number">3.0</span>   NaN    NaN</span><br><span class="line">&gt;&gt;&gt;c  <span class="number">4.0</span>  <span class="number">5.0</span>   NaN    NaN</span><br><span class="line">&gt;&gt;&gt;d  <span class="number">6.0</span>  <span class="number">7.0</span>  <span class="number">10.0</span>   <span class="number">11.0</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="number">8.0</span>  <span class="number">9.0</span>  <span class="number">12.0</span>   <span class="number">13.0</span></span><br><span class="line">&gt;&gt;&gt;f  NaN  NaN  <span class="number">14.0</span>   <span class="number">15.0</span></span><br><span class="line"></span><br><span class="line">pd.concat([df1, df6], axis=<span class="number">1</span>, join=<span class="string">'inner'</span>) <span class="comment"># 列合并，行交集</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two  two  three</span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span>   <span class="number">10</span>     <span class="number">11</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span>   <span class="number">12</span>     <span class="number">13</span></span><br><span class="line"></span><br><span class="line">df1.append(df2) <span class="comment"># 行合并</span></span><br><span class="line">   one  two</span><br><span class="line">a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line">f   <span class="number">10</span>   <span class="number">11</span></span><br><span class="line">g   <span class="number">12</span>   <span class="number">13</span></span><br><span class="line">h   <span class="number">14</span>   <span class="number">15</span></span><br><span class="line"></span><br><span class="line">df1.append([df2, df3]) <span class="comment"># 多个DataFrame行合并</span></span><br><span class="line">   one  two</span><br><span class="line">a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line">f   <span class="number">10</span>   <span class="number">11</span></span><br><span class="line">g   <span class="number">12</span>   <span class="number">13</span></span><br><span class="line">h   <span class="number">14</span>   <span class="number">15</span></span><br><span class="line">i   <span class="number">16</span>   <span class="number">17</span></span><br><span class="line">j   <span class="number">18</span>   <span class="number">19</span></span><br><span class="line">k   <span class="number">20</span>   <span class="number">21</span></span><br><span class="line"></span><br><span class="line">df1.append(df6) <span class="comment"># 行合并，列交集</span></span><br><span class="line">   one  two  three</span><br><span class="line">a  <span class="number">0.0</span>    <span class="number">1</span>    NaN</span><br><span class="line">b  <span class="number">2.0</span>    <span class="number">3</span>    NaN</span><br><span class="line">c  <span class="number">4.0</span>    <span class="number">5</span>    NaN</span><br><span class="line">d  <span class="number">6.0</span>    <span class="number">7</span>    NaN</span><br><span class="line">e  <span class="number">8.0</span>    <span class="number">9</span>    NaN</span><br><span class="line">d  NaN   <span class="number">10</span>   <span class="number">11.0</span></span><br><span class="line">e  NaN   <span class="number">12</span>   <span class="number">13.0</span></span><br><span class="line">f  NaN   <span class="number">14</span>   <span class="number">15.0</span></span><br><span class="line"></span><br><span class="line">df1.append(df6, ignore_index=<span class="literal">True</span>) <span class="comment"># 行合并，列交集，重新索引</span></span><br><span class="line">   one  two  three</span><br><span class="line"><span class="number">0</span>  <span class="number">0.0</span>    <span class="number">1</span>    NaN</span><br><span class="line"><span class="number">1</span>  <span class="number">2.0</span>    <span class="number">3</span>    NaN</span><br><span class="line"><span class="number">2</span>  <span class="number">4.0</span>    <span class="number">5</span>    NaN</span><br><span class="line"><span class="number">3</span>  <span class="number">6.0</span>    <span class="number">7</span>    NaN</span><br><span class="line"><span class="number">4</span>  <span class="number">8.0</span>    <span class="number">9</span>    NaN</span><br><span class="line"><span class="number">5</span>  NaN   <span class="number">10</span>   <span class="number">11.0</span></span><br><span class="line"><span class="number">6</span>  NaN   <span class="number">12</span>   <span class="number">13.0</span></span><br><span class="line"><span class="number">7</span>  NaN   <span class="number">14</span>   <span class="number">15.0</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="索引-2">索引</h2>
<p>Series 和 DataFrame 的索引是 Index 类型，Index 对象是不可修改类型<br>
Index 类型的常用方法：</p>
<table>
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>idx.append(idx)</code></td>
<td>连接另一个 Index 对象，产生新的 Index 对象</td>
</tr>
<tr class="even">
<td><code>idx.diff(idx)</code></td>
<td>计算差集，产生新的 Index 对象</td>
</tr>
<tr class="odd">
<td><code>idx.intersection(idx)</code></td>
<td>计算交集，产生新的 Index 对象</td>
</tr>
<tr class="even">
<td><code>idx.union(idx)</code></td>
<td>计算并集，产生新的 Index 对象</td>
</tr>
<tr class="odd">
<td><code>idx.delete(loc)</code></td>
<td>删除 loc 位置处的元素，产生新的 Index 对象</td>
</tr>
<tr class="even">
<td><code>idx.insert(loc, e)</code></td>
<td>在 loc 位置处增加一个元素 e，产生新的 Index 对象</td>
</tr>
<tr class="odd">
<td><code>Series/DataFrame.drop(idx.vaule, axis=0/1)</code></td>
<td>删除 Series 和 DataFrame 指定行或列索引，axis=1 表示列（默认 axis=0）</td>
</tr>
</tbody>
</table>
<h2 id="数据类型运算">数据类型运算</h2>
<h3 id="算术运算法则">算术运算法则</h3>
<p>算术运算根据行列索引，补齐后运算，运算默认产生浮点数。<br>
补齐时缺项填充 NaN (空值)。<br>
二维和一维、一维和零维间为广播运算（低维对象元素会作用到高维对象的每一个元素）。<br>
采用 +、‐、*、/ 符号进行的二元运算产生新的对象。<br>
方法形式的运算可通过指定参数避免上面的 NaN 的产生。</p>
<table>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>.add(d, **argws)</code></td>
<td>类型间的加法运算，可选参数</td>
</tr>
<tr class="even">
<td><code>.sub(d, **argws)</code></td>
<td>类型间的减法运算，可选参数</td>
</tr>
<tr class="odd">
<td><code>.mul(d, **argws)</code></td>
<td>类型间的乘法运算，可选参数</td>
</tr>
<tr class="even">
<td><code>.div(d, **argws)</code></td>
<td>类型间的除法运算，可选参数 </td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">3</span>).reshape(<span class="number">3</span>,<span class="number">1</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>], columns=[<span class="string">'one'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">2</span></span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df1 + df2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a  <span class="number">0.0</span>  NaN</span><br><span class="line">&gt;&gt;&gt;b  <span class="number">3.0</span>  NaN</span><br><span class="line">&gt;&gt;&gt;c  <span class="number">6.0</span>  NaN</span><br><span class="line">&gt;&gt;&gt;d  NaN  NaN</span><br><span class="line">&gt;&gt;&gt;e  NaN  NaN</span><br><span class="line"></span><br><span class="line">df1.add(df2, fill_value=<span class="number">5</span>) <span class="comment"># 先填充后运算</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>   one   two</span><br><span class="line">&gt;&gt;&gt;a   <span class="number">0.0</span>   <span class="number">6.0</span></span><br><span class="line">&gt;&gt;&gt;b   <span class="number">3.0</span>   <span class="number">8.0</span></span><br><span class="line">&gt;&gt;&gt;c   <span class="number">6.0</span>  <span class="number">10.0</span></span><br><span class="line">&gt;&gt;&gt;d  <span class="number">11.0</span>  <span class="number">12.0</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="number">13.0</span>  <span class="number">14.0</span></span><br><span class="line"></span><br><span class="line">df3 = pd.Series([<span class="number">5</span>, <span class="number">10</span>], index=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">&gt;&gt;&gt;one     <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;two    <span class="number">10</span></span><br><span class="line">&gt;&gt;&gt;dtype: int32</span><br><span class="line"></span><br><span class="line">df3 + <span class="number">5</span> <span class="comment"># 广播运算</span></span><br><span class="line">&gt;&gt;&gt;one    <span class="number">10</span></span><br><span class="line">&gt;&gt;&gt;two    <span class="number">15</span></span><br><span class="line">&gt;&gt;&gt;dtype: int32</span><br><span class="line"></span><br><span class="line">df2 + df3 <span class="comment"># 不同维度间的广播运算，一维Series默认在轴1参与运算</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">5</span>   <span class="number">11</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">7</span>   <span class="number">13</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">9</span>   <span class="number">15</span></span><br><span class="line">&gt;&gt;&gt;d   <span class="number">11</span>   <span class="number">17</span></span><br><span class="line">&gt;&gt;&gt;e   <span class="number">13</span>   <span class="number">19</span></span><br><span class="line"></span><br><span class="line">df3 = pd.Series([<span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">&gt;&gt;&gt;a     <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">10</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">15</span></span><br><span class="line">&gt;&gt;&gt;dtype: int32</span><br><span class="line"></span><br><span class="line">df2.add(df3, axis=<span class="number">0</span>) <span class="comment"># 使用运算方法可以令一维Series在轴0参与运算</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>   one   two</span><br><span class="line">&gt;&gt;&gt;a   <span class="number">5.0</span>   <span class="number">6.0</span></span><br><span class="line">&gt;&gt;&gt;b  <span class="number">12.0</span>  <span class="number">13.0</span></span><br><span class="line">&gt;&gt;&gt;c  <span class="number">19.0</span>  <span class="number">20.0</span></span><br><span class="line">&gt;&gt;&gt;d   NaN   NaN</span><br><span class="line">&gt;&gt;&gt;e   NaN   NaN</span><br></pre></td></tr></tbody></table></figure>
<h3 id="比较运算法则">比较运算法则</h3>
<p>比较运算只能比较<strong>相同索引</strong>的元素，<strong>不进行补齐</strong>。<br>
二维和一维、一维和零维间为广播运算。<br>
采用 &gt;、&lt;、&gt;=、&lt;=、==、!= 等符号进行的二元运算产生布尔对象。</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">15</span>,<span class="number">5</span>,-<span class="number">1</span>).reshape(<span class="number">5</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a   <span class="number">15</span>   <span class="number">14</span></span><br><span class="line">&gt;&gt;&gt;b   <span class="number">13</span>   <span class="number">12</span></span><br><span class="line">&gt;&gt;&gt;c   <span class="number">11</span>   <span class="number">10</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">9</span>    <span class="number">8</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">7</span>    <span class="number">6</span></span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df1 &gt; df2 <span class="comment">#df1和df2必须尺寸一样</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    one    two</span><br><span class="line">&gt;&gt;&gt;a   <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;b   <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;c   <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;d   <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="literal">False</span>  <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">df3 = pd.Series([<span class="number">5</span>,<span class="number">10</span>,<span class="number">15</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">&gt;&gt;&gt;one     <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;two    <span class="number">10</span></span><br><span class="line">&gt;&gt;&gt;dtype: int32</span><br><span class="line"></span><br><span class="line">df3 &gt; <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;one    <span class="literal">False</span></span><br><span class="line">&gt;&gt;&gt;two     <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;dtype: <span class="built_in">bool</span></span><br><span class="line"></span><br><span class="line">df3 &gt; df2 <span class="comment"># 不同维度间的广播运算，一维Series默认在轴1参与运算</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    one   two</span><br><span class="line">&gt;&gt;&gt;a   <span class="literal">True</span>  <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;b   <span class="literal">True</span>  <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;c   <span class="literal">True</span>  <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;d  <span class="literal">False</span>  <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="literal">False</span>  <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="单列多列分组聚合运算">单列 / 多列 / 分组 / 聚合运算</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.loc[:, <span class="string">'one'</span>] = df.loc[:, <span class="string">'one'</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x ** <span class="number">2</span>) <span class="comment"># 在Pandas中，DataFrame的一列就是一个Series, 可以通过map来对一列进行操作</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">4</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c   <span class="number">16</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d   <span class="number">36</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e   <span class="number">64</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x ** <span class="number">2</span></span><br><span class="line">df.loc[:, <span class="string">'one'</span>] = df.loc[:, <span class="string">'one'</span>].<span class="built_in">map</span>(square) <span class="comment"># 其中lambda函数中的x代表当前元素。可以使用另外的函数来代替lambda函数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">4</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c   <span class="number">16</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d   <span class="number">36</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e   <span class="number">64</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.loc[:, <span class="string">'one'</span>] = df.loc[:, <span class="string">'one'</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="literal">True</span> <span class="keyword">if</span> x &gt;= <span class="number">5</span> <span class="keyword">else</span> <span class="literal">False</span>) <span class="comment"># lambda中可以传入任何表达式</span></span><br><span class="line">df.loc[:, <span class="string">'two'</span>] = df.loc[:, <span class="string">'two'</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="literal">True</span> <span class="keyword">if</span> x &gt;= <span class="number">5</span> <span class="keyword">else</span> <span class="literal">False</span>)</span><br><span class="line">&gt;&gt;&gt;		  one    two</span><br><span class="line">&gt;&gt;&gt;a  <span class="literal">False</span>  <span class="literal">False</span></span><br><span class="line">&gt;&gt;&gt;b  <span class="literal">False</span>  <span class="literal">False</span></span><br><span class="line">&gt;&gt;&gt;c  <span class="literal">False</span>   <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;d   <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;e   <span class="literal">True</span>   <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">df.loc[:, <span class="string">'three'</span>] = df.apply(<span class="keyword">lambda</span> x: x[<span class="string">'one'</span>] + <span class="number">2</span> * x[<span class="string">'two'</span>], axis=<span class="number">1</span>) <span class="comment"># 要对DataFrame的多个列同时进行运算，可以使用apply</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two  three</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span>      <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span>      <span class="number">8</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">4</span>    <span class="number">5</span>     <span class="number">14</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">6</span>    <span class="number">7</span>     <span class="number">20</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">8</span>    <span class="number">9</span>     <span class="number">26</span></span><br><span class="line"></span><br><span class="line">df.loc[<span class="string">'f'</span>, :] = df.apply(<span class="keyword">lambda</span> x: x[<span class="string">'a'</span>] + <span class="number">2</span> * x[<span class="string">'b'</span>], axis=<span class="number">0</span>) <span class="comment">#对DataFrame的多个行同时进行运算，将axis设为0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a  <span class="number">0.0</span>  <span class="number">1.0</span></span><br><span class="line">&gt;&gt;&gt;b  <span class="number">2.0</span>  <span class="number">3.0</span></span><br><span class="line">&gt;&gt;&gt;c  <span class="number">4.0</span>  <span class="number">5.0</span></span><br><span class="line">&gt;&gt;&gt;d  <span class="number">6.0</span>  <span class="number">7.0</span></span><br><span class="line">&gt;&gt;&gt;e  <span class="number">8.0</span>  <span class="number">9.0</span></span><br><span class="line">&gt;&gt;&gt;f  <span class="number">4.0</span>  <span class="number">7.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 要对DataFrame的每个元素同时进行运算，可以使用applymap</span></span><br><span class="line">df = df.applymap(<span class="keyword">lambda</span> x: x ** <span class="number">2</span> <span class="keyword">if</span> x &lt;= <span class="number">5</span> <span class="keyword">else</span> x * <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">4</span>    <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;c   <span class="number">16</span>   <span class="number">25</span></span><br><span class="line">&gt;&gt;&gt;d   <span class="number">12</span>   <span class="number">14</span></span><br><span class="line">&gt;&gt;&gt;e   <span class="number">16</span>   <span class="number">18</span></span><br></pre></td></tr></tbody></table></figure>
<h1 id="pandas的数据特征分析">Pandas 的数据特征分析</h1>
<h2 id="排序">排序</h2>
<p><code>.sort_index(axis=0, ascending=True)</code> 方法在指定轴上根据索引进行排序，默认升序。<br>
<code>Series.sort_values(axis=0, ascending=True)</code>、<code>DataFrame.sort_values(by, axis=0, ascending=True)</code> 方法在指定轴上根据数值进行排序，默认升序。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>,<span class="number">2</span>), index=[<span class="string">'c'</span>,<span class="string">'b'</span>,<span class="string">'a'</span>,<span class="string">'e'</span>,<span class="string">'d'</span>], columns=[<span class="string">'two'</span>, <span class="string">'one'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  two  one</span><br><span class="line">&gt;&gt;&gt;c    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.sort_index() <span class="comment"># 根据indexes顺排（首字母顺序）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  two  one</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line"></span><br><span class="line">df.sort_index(ascending=<span class="literal">False</span>) <span class="comment"># 根据indexes逆排（首字母顺序）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  two  one</span><br><span class="line">&gt;&gt;&gt;e    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line"></span><br><span class="line">df.sort_index(axis=<span class="number">1</span>) <span class="comment"># 根据columns顺排（首字母顺序）</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;c    <span class="number">1</span>    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">3</span>    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">5</span>    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">7</span>    <span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">9</span>    <span class="number">8</span></span><br><span class="line"></span><br><span class="line">df.sort_values(<span class="string">'two'</span>, ascending=<span class="literal">False</span>) <span class="comment"># 根据'two'这一列的值重排所有的数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  two  one</span><br><span class="line">&gt;&gt;&gt;d    <span class="number">8</span>    <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">6</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">2</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">0</span>    <span class="number">1</span></span><br><span class="line"></span><br><span class="line">df.sort_values(<span class="string">'c'</span>, axis=<span class="number">1</span>, ascending=<span class="literal">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;c    <span class="number">1</span>    <span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">3</span>    <span class="number">2</span></span><br><span class="line">&gt;&gt;&gt;a    <span class="number">5</span>    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">7</span>    <span class="number">6</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">9</span>    <span class="number">8</span></span><br></pre></td></tr></tbody></table></figure><br>
注意：排序时，NaN永远都是在排序结果末尾（不管是升序 还是 降序）<p></p>
<h2 id="统计">统计</h2>
<p>适用于 Series 和 DataFrame 类型数据，基本统计分析</p>
<table>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.sum()</td>
<td> 计算数据的总和，按 0 轴计算，下同</td>
</tr>
<tr class="even">
<td>.count()</td>
<td> 非 NaN 值的数量</td>
</tr>
<tr class="odd">
<td>.mean() .median()</td>
<td> 计算数据的算术平均值、算术中位数</td>
</tr>
<tr class="even">
<td>.var() .std()</td>
<td> 计算数据的方差、标准差</td>
</tr>
<tr class="odd">
<td>.min() .max()</td>
<td> 计算数据的最小值、最大值</td>
</tr>
<tr class="even">
<td>.describe()</td>
<td> 针对 0 轴（各列）的统计汇总</td>
</tr>
</tbody>
</table>
<p>适用于 Series 类型，基本统计分析</p>
<table>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.argmin() .argmax()</td>
<td> 计算数据最大值、最小值所在位置的索引位置（自动索引）</td>
</tr>
<tr class="even">
<td>.idxmin() .idxmax()</td>
<td> 计算数据最大值、最小值所在位置的索引位置（自定义索引）</td>
</tr>
</tbody>
</table>
<p>适用于 Series 和 DataFrame 类型，累计计算</p>
<table>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.cumsum()</td>
<td> 依次给出前 1、2、…、n 个数的和</td>
</tr>
<tr class="even">
<td>.cumprod()</td>
<td> 依次给出前 1、2、…、n 个数的积</td>
</tr>
<tr class="odd">
<td>.cummax()</td>
<td> 依次给出前 1、2、…、n 个数的最大值</td>
</tr>
<tr class="even">
<td>.cummin()</td>
<td> 依次给出前 1、2、…、n 个数的最小值</td>
</tr>
</tbody>
</table>
<p>适用于 Series 和 DataFrame 类型，滚动计算（窗口计算）</p>
<table>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.rolling(w).sum()</td>
<td> 依次计算相邻 w 个元素的和</td>
</tr>
<tr class="even">
<td>.rolling(w).mean()</td>
<td> 依次计算相邻 w 个元素的算术平均值</td>
</tr>
<tr class="odd">
<td>.rolling(w).var()</td>
<td> 依次计算相邻 w 个元素的方差</td>
</tr>
<tr class="even">
<td>.rolling(w).std()</td>
<td> 依次计算相邻 w 个元素的标准差</td>
</tr>
<tr class="odd">
<td>.rolling(w).min() .max()</td>
<td> 依次计算相邻 w 个元素的最小值和最大值</td>
</tr>
</tbody>
</table>
<p>适用于 Series 和 DataFrame 类型，相关性分析</p>
<table>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.cov()</td>
<td> 计算协方差矩阵</td>
</tr>
<tr class="even">
<td>.corr()</td>
<td> 计算相关系数矩阵，Pearson、Spearman、Kendall 等系数 </td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10</span>).reshape(<span class="number">5</span>,<span class="number">2</span>), index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</span><br><span class="line">df[<span class="string">'one'</span>] = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span>    <span class="number">1</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">1</span>    <span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">1</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">2</span>    <span class="number">7</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">2</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.groupby(<span class="string">'one'</span>)[<span class="string">'two'</span>].<span class="built_in">sum</span>() <span class="comment"># 按照列one进行分组对列two进行统计求和，返回Series类型</span></span><br><span class="line">&gt;&gt;&gt;one</span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>     <span class="number">9</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>    <span class="number">16</span></span><br><span class="line">&gt;&gt;&gt;Name: two, dtype: int32</span><br><span class="line">    </span><br><span class="line">df.groupby([<span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>]).<span class="built_in">sum</span>() <span class="comment"># 可以指定分组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two</span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span>    <span class="number">2</span>    <span class="number">4</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">4</span>    <span class="number">5</span>   <span class="number">21</span></span><br><span class="line"></span><br><span class="line">df.groupby(<span class="string">'one'</span>)[<span class="string">'two'</span>].describe() <span class="comment"># 按照列one进行分组对列two进行统计计数，返回DataFrame类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    count  mean       std  <span class="built_in">min</span>  <span class="number">25</span>%  <span class="number">50</span>%  <span class="number">75</span>%  <span class="built_in">max</span></span><br><span class="line">&gt;&gt;&gt;one                                                </span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>      <span class="number">3.0</span>   <span class="number">3.0</span>  <span class="number">2.000000</span>  <span class="number">1.0</span>  <span class="number">2.0</span>  <span class="number">3.0</span>  <span class="number">4.0</span>  <span class="number">5.0</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>      <span class="number">2.0</span>   <span class="number">8.0</span>  <span class="number">1.414214</span>  <span class="number">7.0</span>  <span class="number">7.5</span>  <span class="number">8.0</span>  <span class="number">8.5</span>  <span class="number">9.0</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">'three'</span>] = df.groupby(<span class="string">'one'</span>)[<span class="string">'two'</span>].transform(<span class="keyword">lambda</span> x: (x.<span class="built_in">sum</span>() - x) / x.count()) <span class="comment"># 按照列one进行分组对列two进行函数运算</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  one  two     three</span><br><span class="line">&gt;&gt;&gt;a    <span class="number">1</span>    <span class="number">1</span>  <span class="number">2.666667</span></span><br><span class="line">&gt;&gt;&gt;b    <span class="number">1</span>    <span class="number">3</span>  <span class="number">2.000000</span></span><br><span class="line">&gt;&gt;&gt;c    <span class="number">1</span>    <span class="number">5</span>  <span class="number">1.333333</span></span><br><span class="line">&gt;&gt;&gt;d    <span class="number">2</span>    <span class="number">7</span>  <span class="number">4.500000</span></span><br><span class="line">&gt;&gt;&gt;e    <span class="number">2</span>    <span class="number">9</span>  <span class="number">3.500000</span></span><br><span class="line"></span><br><span class="line">df.groupby(<span class="string">'one'</span>).agg([<span class="string">'sum'</span>, <span class="string">'count'</span>, <span class="string">'mean'</span>, <span class="string">'median'</span>, <span class="string">'var'</span>, <span class="string">'std'</span>, <span class="string">'min'</span>, <span class="string">'max'</span>, <span class="string">'first'</span>, <span class="string">'last'</span>]) <span class="comment"># agg方法将一个函数使用在一个数列上，然后返回一个标量的值。内置函数名需要用引号</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>   two                                                   </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>   <span class="built_in">sum</span> count mean median var       std <span class="built_in">min</span> <span class="built_in">max</span> first last</span><br><span class="line">&gt;&gt;&gt;one                                                       </span><br><span class="line">&gt;&gt;&gt;<span class="number">1</span>     <span class="number">9</span>     <span class="number">3</span>    <span class="number">3</span>      <span class="number">3</span>   <span class="number">4</span>  <span class="number">2.000000</span>   <span class="number">1</span>   <span class="number">5</span>     <span class="number">1</span>    <span class="number">5</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">2</span>    <span class="number">16</span>     <span class="number">2</span>    <span class="number">8</span>      <span class="number">8</span>   <span class="number">2</span>  <span class="number">1.414214</span>   <span class="number">7</span>   <span class="number">9</span>     <span class="number">7</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">df.agg([<span class="string">'sum'</span>, <span class="string">'count'</span>, <span class="string">'mean'</span>, <span class="string">'median'</span>, <span class="string">'var'</span>, <span class="string">'std'</span>, <span class="string">'min'</span>, <span class="string">'max'</span>, <span class="string">'first'</span>, <span class="string">'last'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>            one        two</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">sum</span>     <span class="number">7.000000</span>  <span class="number">25.000000</span></span><br><span class="line">&gt;&gt;&gt;count   <span class="number">5.000000</span>   <span class="number">5.000000</span></span><br><span class="line">&gt;&gt;&gt;mean    <span class="number">1.400000</span>   <span class="number">5.000000</span></span><br><span class="line">&gt;&gt;&gt;median  <span class="number">1.000000</span>   <span class="number">5.000000</span></span><br><span class="line">&gt;&gt;&gt;var     <span class="number">0.300000</span>  <span class="number">10.000000</span></span><br><span class="line">&gt;&gt;&gt;std     <span class="number">0.547723</span>   <span class="number">3.162278</span></span><br><span class="line">&gt;&gt;&gt;<span class="built_in">min</span>     <span class="number">1.000000</span>   <span class="number">1.000000</span></span><br><span class="line">&gt;&gt;&gt;<span class="built_in">max</span>     <span class="number">2.000000</span>   <span class="number">9.000000</span></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Python</tag>
        <tag>Data Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 爬虫</title>
    <url>/contents/Python%E7%88%AC%E8%99%AB.html</url>
    <content><![CDATA[<p>网络爬虫是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本。<br>
本文介绍基本的网络爬虫的方法，并给出一个具体实例。<br>
Reference：<a href="http://www.icourse163.org/course/BIT-1001870001">公开课</a><br>
<span id="more"></span></p>
<h1 id="爬虫许可">爬虫许可</h1>
<p>大部分网站都会在其网站根网址上发布 robots 协议<br>
如豆瓣网：https://www.douban.com/robots.txt<br>
</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">User-agent:</span> <span class="string">*</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/subject_search</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/amazon_search</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/search</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/group/search</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/event/search</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/celebrities/search</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/location/drama/search</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/forum/</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/new_subject</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/service/iframe</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/j/</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/link2/</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/recommend/</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/trailer/</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/doubanapp/card</span></span><br><span class="line"><span class="attr">Sitemap:</span> <span class="string">https://www.douban.com/sitemap_index.xml</span></span><br><span class="line"><span class="attr">Sitemap:</span> <span class="string">https://www.douban.com/sitemap_updated_index.xml</span></span><br><span class="line"><span class="comment"># Crawl-delay: 5</span></span><br><span class="line"></span><br><span class="line"><span class="attr">User-agent:</span> <span class="string">Wandoujia</span> <span class="string">Spider</span></span><br><span class="line"><span class="attr">Disallow:</span> <span class="string">/</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="requests库">Requests 库</h1>
<p>Reference：<a href="http://www.jianshu.com/p/c6376d6c753c">Python 网络爬虫与信息提取 (一)：网络爬虫之规则</a><br>
安装：<code>pip install requests</code>。</p>
<h2 id="requests库的主要方法">Requests 库的主要方法</h2>
<table>
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>requests.request()</code></td>
<td>构造一个请求，支撑以下各方法的基础方法</td>
</tr>
<tr class="even">
<td><code>requests.get()</code></td>
<td>获取 HTML 网页的主要方法，对应于 HTTP 的 GET，请求获取 url 位置的资源</td>
</tr>
<tr class="odd">
<td><code>requests.head()</code></td>
<td>获取 HTML 网页头信息的方法，对应于 HTTP 的 HEAD，请求获取 url 位置资源的响应消息报告，获得该资源的头部信息</td>
</tr>
<tr class="even">
<td><code>requests.post()</code></td>
<td>向 HTML 网页提交 post 请求的方法，对应于 HTTP 的 POST，请求向 url 位置的资源后附加新的数据</td>
</tr>
<tr class="odd">
<td><code>requests.put()</code></td>
<td>向 HTML 网页提交 put 请求的方法，对应于 HTTP 的 PUT，请求向 url 位置存储一个资源，覆盖原 url 位置的资源</td>
</tr>
<tr class="even">
<td><code>requests.patch()</code></td>
<td>向 HTML 网页提交局部修改请求的方法，对应于 HTTP 的 PATCH，请求局部更新 url 位置的资源，即改变该处资源的部分内容</td>
</tr>
<tr class="odd">
<td><code>requests.delete()</code></td>
<td>向 HTML 网页提交删除请求的方法，对应于 HTTP 的 DELETE，请求删除 url 位置存储的资源</td>
</tr>
</tbody>
</table>
<h2 id="get方法">get 方法</h2>
<p>在爬虫中主要使用 get 方法，其他方法参数与 get 方法类似。<br>
<code>r = requests.get(url)</code>: 右边构造一个向服务器请求资源的 Requests 对象，左边返回一个包含服务器资源的 Response 对象给 r。<br>
完整参数:<code>requests.get(url,params=None,**kwargs)</code>, 实则由 request 方法封装。<br>
Resonse 对象的五个属性：</p>
<table>
<thead>
<tr class="header">
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> r.status_code</td>
<td>HTTP 请求的返回状态，200 表示连接成功，404 表示失败</td>
</tr>
<tr class="even">
<td> r.text</td>
<td>HTTP 响应内容的字符串形式，即 url 对应的页面内容</td>
</tr>
<tr class="odd">
<td> r.encoding</td>
<td>HTTP header 中猜测的响应内容编码方式</td>
</tr>
<tr class="even">
<td> r.apparent_encoding</td>
<td> 从内容中分析出的响应内容编码方式（备选编码方式）</td>
</tr>
<tr class="odd">
<td>r.content</td>
<td>HTTP 响应内容的二进制形式</td>
</tr>
</tbody>
</table>
<h2 id="异常处理">异常处理</h2>
<table>
<thead>
<tr class="header">
<th>异常</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> requests.ConnectionError</td>
<td> 网络连接错误异常，如 DNS 查询失败、拒绝连接等</td>
</tr>
<tr class="even">
<td> requests.HTTPError</td>
<td>HTTP 错误异常</td>
</tr>
<tr class="odd">
<td> requests.URLRequired</td>
<td>url 缺失异常</td>
</tr>
<tr class="even">
<td> requests.TooManyRedirects</td>
<td> 超过最大重定向次数，产生重定向异常</td>
</tr>
<tr class="odd">
<td> requests.ConnectTimeout</td>
<td> 连接远程服务器超时异常</td>
</tr>
<tr class="even">
<td> requests.Timeout</td>
<td> 请求 url 超时，产生超时异常</td>
</tr>
</tbody>
</table>
<p>使用 r.raise_for_status () 方法构建通用代码框架：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHTMLText</span>(<span class="params">url</span>)</span></span><br><span class="line"><span class="function">	<span class="title">try</span>:</span></span><br><span class="line">		r = requests.get(url,timeout = <span class="number">30</span>)</span><br><span class="line">		r.raise_for_status()</span><br><span class="line">		r.encoding = r.apparent_encoding</span><br><span class="line">		<span class="keyword">return</span> r.text</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Error"</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="requests库主要方法">Requests 库主要方法</h2>
<p><code>requests.request(method,url,**kwargs)</code><br>
- method (请求方式) 包括：GET/HEAD/POST/PUT/PATCH/DELETE/OPTIONS。<br>
- **kwargs (控制访问参数) 包括:params (添加键值到 url 后)/data (字典 / 字节序列等作为 Request 的内容)/json/headers (HTTP 定制头)/cookies (Request 中的 cookie)/auth (元祖，支持 HTTP 认证)/files (传输文件)/timeout/proxies (设定访问代理服务器)/allow_redirects (重定向开关)/stream (获取内容立即下载开关)/verify (认证 SSL 证书开关)/cert (本地 SSL 证书路径)。</p>
<h1 id="beautiful-soup库">Beautiful Soup 库</h1>
<p>Beautiful Soup 库可对 HTML/XML 格式进行解析并提取相关信息。<br>
Beautiful Soup 库是解析 / 遍历 / 维护 "标签" 的功能库，引用方式：<code>from bs4 import BeautifulSoup</code>。<br>
Reference：<a href="http://www.jianshu.com/p/7b950b8a5966">Python 网络爬虫与信息提取 (二)：网络爬虫之提取</a><br>
安装：<code>pip install beautifulsoup4</code>。</p>
<h2 id="beautiful-soup库的解析器">Beautiful Soup 库的解析器</h2>
<table>
<thead>
<tr class="header">
<th>解析器</th>
<th>使用方法</th>
<th>条件</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> HTML 解析器</td>
<td><code>BeautifulSoup(mk,'html.parser')</code></td>
<td>安装 bs4 库</td>
</tr>
<tr class="even">
<td> lxml 的 HTML 解析器</td>
<td><code>BeautifulSoup(mk,'lxml')</code></td>
<td><code>pip install lxml</code></td>
</tr>
<tr class="odd">
<td>lxml 的 XML 解析器</td>
<td><code>BeautifulSoup(mk,'xml')</code></td>
<td><code>pip install lxml</code></td>
</tr>
<tr class="even">
<td>html5lib 的解析器</td>
<td><code>BeautifulSoup(mk,'html5lib')</code></td>
<td><code>pip install html5lib</code></td>
</tr>
</tbody>
</table>
<h2 id="beautiful-soup类的基本元素">Beautiful Soup 类的基本元素</h2>
<table>
<thead>
<tr class="header">
<th>基本元素</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> Tag</td>
<td> 标签，最基本的信息组织单元，分别用 <code>&lt;&gt;</code> 和 <code>&lt;/&gt;</code> 标明开头和结尾</td>
</tr>
<tr class="even">
<td> Name</td>
<td> 标签的名字，<code>&lt;p&gt;...&lt;/p&gt;</code> 的名字是 'p'，格式：<code>&lt;tag&gt;.name</code></td>
</tr>
<tr class="odd">
<td>Attributes</td>
<td> 标签的属性，字典形式组织，格式：<code>&lt;tag&gt;.attrs</code> 或者 <code>&lt;tag&gt;['attrs']</code></td>
</tr>
<tr class="even">
<td>NavigableString</td>
<td> 标签内非属性字符串，<code>&lt;&gt;...&lt;/&gt;</code> 中的字符串，格式：<code>&lt;tag&gt;.string</code></td>
</tr>
<tr class="odd">
<td>Comment</td>
<td> 标签内字符串的注释部分，一种特殊的 Comment 类型</td>
</tr>
</tbody>
</table>
<ul>
<li>任何存在于 HTML 语法中的标签都可用 <code>soup.&lt;tag&gt;</code> 访问获得，存在多个取第一个。</li>
<li>每个 <code>&lt;tag&gt;</code> 有自己的名字，通过 <code>&lt;tag&gt;.name</code> 获取，字符串类型。</li>
<li>每个 <code>&lt;tag&gt;</code> 有 0 或多个属性，字典类型。</li>
<li>每个 <code>&lt;tag&gt;</code> 内有字符串，可以跨越多个标签层次，如果字符串不是注释，则 NavigableString 类型。</li>
<li>如果 <code>&lt;tag&gt;</code> 内的字符串是注释，则返回 Comment 类型。</li>
</ul>
<h2 id="html内容遍历方法">HTML 内容遍历方法</h2>
<img src="/images/Python%E7%88%AC%E8%99%AB/HTML.png" class="" width="600" height="400">
<table>
<thead>
<tr class="header">
<th>属性</th>
<th>说明</th>
<th>遍历方式</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
.contents |子节点的列表，将 <code>&lt;tag&gt;</code> 所有儿子节点存入列表

下行遍历

.children |子节点的迭代类型，与.contents类似，用于循环遍历儿子节点<br>
.descendants |子孙节点的迭代类型，用于循环遍历子孙节点<br>
.parent |节点的父标签

上行遍历

.parents |节点先辈标签的迭代类型，用于循环遍历先辈节点<br>
.next_sibling |返回按照HTML文本顺序的下一个平行节点标签

平行遍历

<p>.previous_sibling | 返回按照 HTML 文本顺序的上一个平行节点标签<br>
.next_siblings | 迭代类型，返回按照 HTML 文本顺序的后续所有平行节点标签<br>
.previous_siblings | 迭代类型，返回按照 HTML 文本顺序的前续所有平行节点标签</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> child <span class="keyword">in</span> soup.body.children:</span><br><span class="line">	<span class="built_in">print</span>(child) <span class="comment">#遍历儿子节点</span></span><br><span class="line"><span class="keyword">for</span> descendant <span class="keyword">in</span> soup.body.descendants:</span><br><span class="line">	<span class="built_in">print</span>(descendant) <span class="comment">#遍历子孙节点</span></span><br><span class="line"><span class="keyword">for</span> parent <span class="keyword">in</span> soup.body.parents:</span><br><span class="line">	<span class="keyword">if</span> parent <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">		<span class="built_in">print</span>(parent)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(parent.name)</span><br><span class="line"><span class="keyword">for</span> sibling <span class="keyword">in</span> soup.a.next_siblings:</span><br><span class="line">	<span class="built_in">print</span>(sibling)</span><br><span class="line"><span class="keyword">for</span> sibling <span class="keyword">in</span> soup.a.previous_siblings:</span><br><span class="line">	<span class="built_in">print</span>(sibling)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="html格式输出">HTML 格式输出</h2>
<p>使用 <code>prettify()</code> 方法，为 HTML 文本 &lt;&gt; 及其内容增加 '' 并且可用于标签 / 方法。</p>
<h2 id="html内容查找方法">HTML 内容查找方法</h2>
<p><code>&lt;&gt;.find_all(name,attrs,recursive,text='',**kwargs)</code><br>
返回一个列表类型，存储查找的结果<br>
name: 对标签名称的检索字符串<br>
attrs: 对标签属性值的检索字符串，可标注属性检索，如果 attrs 是 class，则替换为 class_。<br>
recursive: 是否对子孙全部搜索，默认 True<br>
text='': 对字符串域进行检索，其中可以用 re.compile () 来进行正则表达式检索<br>
由<code>.find_all()</code> 扩展的七个方法:</p>
<table>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&lt;&gt;.find()</code></td>
<td>搜索且只返回一个结果，同<code>.find_a11()</code> 参数</td>
</tr>
<tr class="even">
<td><code>&lt;&gt;.find_parents()</code></td>
<td>在先辈节点中搜索，返回列表类型，同<code>.find_all()</code> 参数</td>
</tr>
<tr class="odd">
<td><code>&lt;&gt;.find_parent()</code></td>
<td>在先辈节点中返回一个结果，同<code>.find()</code> 参数</td>
</tr>
<tr class="even">
<td><code>&lt;&gt;.find_next_siblings()</code></td>
<td>在后续平行节点中搜索，返回列表类型，同<code>.find_a11()</code> 参数</td>
</tr>
<tr class="odd">
<td><code>&lt;&gt;.find_next_sibling()</code></td>
<td>在后续平行节点中返回一个结果，同<code>.find()</code> 参数</td>
</tr>
<tr class="even">
<td><code>&lt;&gt;.find_previous_siblings()</code></td>
<td>在前续平行节点中搜索，返回列表类型，同<code>.find_a11()</code> 参数</td>
</tr>
<tr class="odd">
<td><code>&lt;&gt;.find_previous_sibling()</code></td>
<td>在前续平行节点中返回一个结果，同<code>.find()</code> 参数</td>
</tr>
</tbody>
</table>
<h1 id="信息组织与提取方法">信息组织与提取方法</h1>
<p>信息标记的三种形式及比较：<br>
XML (Extensible Markup Language) 是最早的通用信息标记语言，可扩展性好，但繁琐；标签由名字和属性构成，形式有：<br>
</p><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>...<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   --&gt;</span></span><br></pre></td></tr></tbody></table></figure><br>
JSON(JavaScript Objection Notation)适合程序处理，较XML简洁;有类型的键值对，形式有：<br>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">"key"</span>:<span class="string">"value"</span></span><br><span class="line"><span class="string">"key"</span>:[<span class="string">"value1"</span>,<span class="string">"value2"</span>]</span><br><span class="line"><span class="string">"key"</span>:{<span class="attr">"subkey"</span>:<span class="string">"subvalue"</span>}</span><br></pre></td></tr></tbody></table></figure><br>
YAML(YAML Ain't Markup Language)文本信息比例最高，可读性好;无类型的键值对，形式有：<br>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">key:value</span></span><br><span class="line"><span class="string">key:#Comment</span></span><br><span class="line"><span class="string">-value1</span></span><br><span class="line"><span class="string">-value2</span></span><br><span class="line"><span class="attr">key:</span></span><br><span class="line">  <span class="string">subkey:subvalue</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="re正则表达式库">Re (正则表达式) 库</h1>
<p>regular expression = regex = RE<br>
是一种通用的字符串表达框架，用来简洁表达一组字符串的表达式，也可用来判断某字符串的特征归属。<br>
Reference：<a href="http://www.jianshu.com/p/98d0139dacac">Python 网络爬虫与信息提取 (三)：网络爬虫之实战</a> ;<a href="http://www.cnblogs.com/huxi/archive/2010/07/04/1771073.html">Python 正则表达式指南</a></p>
<h2 id="正则表达式的语法">正则表达式的语法</h2>
<h3 id="普通字符">普通字符</h3>
<p>普通字符包括没有显式指定为元字符的所有可打印和不可打印字符。这包括所有大写和小写字母、所有数字、所有标点符号和一些其他符号。</p>
<h3 id="非打印字符">非打印字符</h3>
<p>非打印字符也可以是正则表达式的组成部分。下表列出了表示非打印字符的转义序列：</p>
<table>
<colgroup>
<col style="width: 4%">
<col style="width: 95%">
</colgroup>
<thead>
<tr class="header">
<th>字符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\cx</code></td>
<td>匹配由 x 指明的控制字符。例如，<code>\cM</code> 匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 'c' 字符。</td>
</tr>
<tr class="even">
<td><code>\f</code></td>
<td>匹配一个换页符。等价于 <code>\x0c</code> 和 <code>\cL</code>。</td>
</tr>
<tr class="odd">
<td><code>\n</code></td>
<td>匹配一个换行符。等价于 <code>\x0a</code> 和 <code>\cJ</code>。</td>
</tr>
<tr class="even">
<td><code>\r</code></td>
<td>匹配一个回车符。等价于 <code>\x0d</code> 和 <code>\cM</code>。</td>
</tr>
<tr class="odd">
<td><code>\d</code></td>
<td>匹配任何数字。等价于 <code>[0-9]</code>。</td>
</tr>
<tr class="even">
<td><code>\D</code></td>
<td>匹配任何非数字。等价于 <code>[^\d]</code>。</td>
</tr>
<tr class="odd">
<td><code>\w</code></td>
<td>匹配任何单词字符。等价于 <code>[a-zA-Z0-9_]</code>。</td>
</tr>
<tr class="even">
<td><code>\W</code></td>
<td>匹配任何非单词字符。等价于 <code>[^\w]</code>。</td>
</tr>
<tr class="odd">
<td><code>\s</code></td>
<td>匹配任何空白字符，包括空格、制表符、换页符等等。等价于 <code>[\f\n\r\t\v]</code>。</td>
</tr>
<tr class="even">
<td><code>\S</code></td>
<td>匹配任何非空白字符。等价于 <code>[^\f\n\r\t\v]</code>。</td>
</tr>
<tr class="odd">
<td><code>\t</code></td>
<td>匹配一个制表符。等价于 <code>\x09</code> 和 <code>\cI</code>。</td>
</tr>
<tr class="even">
<td><code>\v</code></td>
<td>匹配一个垂直制表符。等价于 <code>\x0b</code> 和 <code>\cK</code>。</td>
</tr>
</tbody>
</table>
<h3 id="特殊字符">特殊字符</h3>
<p>所谓特殊字符，就是一些有特殊含义的字符。<br>
若要匹配这些特殊字符，必须首先使字符 "转义"，即，将反斜杠字符。下表列出了正则表达式中的特殊字符：</p>
<table>
<colgroup>
<col style="width: 19%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th>特别字符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>^</code></td>
<td>匹配输入字符串的开始位置，在多行模式中匹配每一行的结尾。<br>除非在方括号表达式中使用，此时它表示不接受该字符集合。</td>
</tr>
<tr class="even">
<td><code>$</code></td>
<td>匹配输入字符串的结尾位置，在多行模式中匹配每一行的结尾。</td>
</tr>
<tr class="odd">
<td><code>(...)</code></td>
<td>标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。从表达式左边开始每遇到一个分组，则编号 + 1。分组表达式作为一个整体可以后接数量词。表达式中的 <code>|</code> 仅在分组中有效。</td>
</tr>
<tr class="even">
<td><code>(?P&lt;name&gt;...)</code></td>
<td>分组，除了原有编号外再指定额外别名。</td>
</tr>
<tr class="odd">
<td><code>\&lt;number&gt;</code><br><code>(&lt;?P=name)</code></td>
<td>引用编号为 number 或者别名为 name 的分组。</td>
</tr>
<tr class="even">
<td><code>[...]</code></td>
<td>字符集，对应的位置可以是字符集中任意字符。 字符集中的字符可以逐个列出，也可以给出范围，如 <code>[abc]</code> 或 <code>[a-c]</code>。第一个字符如果是 ^ 则表示取反，如 [^abc] 表示不是 a 或 b 或 c 的其他字符。<br>所有的特殊字符在字符集中都失去其原有的特殊含义。在字符集中如果要使用<code>]</code> 或 <code>-</code> 或 <code>^</code>，可以在前面加上反斜杠，或者把<code>]</code> 或 <code>-</code> 放在第一位，把 <code>^</code> 放在非第一位。</td>
</tr>
<tr class="odd">
<td><code>{n}</code></td>
<td>n 是一个非负整数。匹配确定的 n 次。</td>
</tr>
<tr class="even">
<td><code>{n,}</code></td>
<td>n 是一个非负整数。至少匹配 n 次。<code>{1,}</code> 等价于 <code>+</code>。<code>{0,}</code> 则等价于 <code>*</code>。</td>
</tr>
<tr class="odd">
<td><code>{n,m}</code></td>
<td>m 和 n 均为非负整数，其中 n&lt;=m。最少匹配 n 次且最多匹配 m 次。<code>{0,1}</code> 等价于 <code>?</code>。<br>请注意在逗号和两个数之间不能有空格。</td>
</tr>
<tr class="even">
<td><code>*</code></td>
<td>匹配前面的子表达式零次或多次。</td>
</tr>
<tr class="odd">
<td><code>+</code></td>
<td>匹配前面的子表达式一次或多次。</td>
</tr>
<tr class="even">
<td><code>.</code></td>
<td>匹配除换行符 <code>\n</code> 之外的任何单字符。在 DOTALL 模式中也能匹配换行符。</td>
</tr>
<tr class="odd">
<td><code>?</code></td>
<td>匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。</td>
</tr>
<tr class="even">
<td><code>\</code></td>
<td>将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。</td>
</tr>
<tr class="odd">
<td><code>|</code></td>
<td>左右表达式任意一个。</td>
</tr>
</tbody>
</table>
<h3 id="经典实例">经典实例</h3>
<table>
<thead>
<tr class="header">
<th>正则表达式</th>
<th>匹配字符串</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>^[A-Za-z]+$</code></td>
<td>由 26 个字母组成的字符串</td>
</tr>
<tr class="even">
<td><code>^[A-Za-z0-9]+$</code></td>
<td>由 26 个字母和数字组成的字符串</td>
</tr>
<tr class="odd">
<td><code>^-?\d+$</code></td>
<td>整数形式的字符串</td>
</tr>
<tr class="even">
<td><code>^[1-9][0-9]*$</code></td>
<td>正整数形式的字符串</td>
</tr>
<tr class="odd">
<td><code>[\u4e00-\u9fa5]</code></td>
<td>匹配中文字符</td>
</tr>
</tbody>
</table>
<h2 id="正则表达式相关注解">正则表达式相关注解</h2>
<ol type="1">
<li>数量词的贪婪模式与非贪婪模式<br>
正则表达式通常用于在文本中查找匹配的字符串。Python 里数量词默认是贪婪的（在少数语言里也可能是默认非贪婪），总是尝试匹配尽可能多的字符；非贪婪的则相反，总是尝试匹配尽可能少的字符。实际我们一般使用非贪婪模式来提取。</li>
<li>反斜杠问题<br>
与大多数编程语言相同，正则表达式里使用 <code>\</code> 作为转义字符，这就可能造成反斜杠困扰。假如你需要匹配文本中的字符 <code>\</code>，那么使用编程语言表示的正则表达式里将需要 4 个反斜杠 <code>\\\\</code>：前两个和后两个分别用于在编程语言里转义成反斜杠，转换成两个反斜杠后再在正则表达式里转义成一个反斜杠。<br>
Python 里的原生字符串很好地解决了这个问题，这个例子中的正则表达式可以使用 <code>r'\\'</code> 表示。同样，匹配一个数字的 <code>\\d</code> 可以写成 <code>r'\d'</code>。使用原生字符串，就不用担心漏写了反斜杠，写出来的表达式也更直观。</li>
</ol>
<h2 id="re库的基本使用">Re 库的基本使用</h2>
<p>正则表达式的表示类型为 raw string 类型 (原生字符串类型), 表示为 <code>r'text'</code>。</p>
<h3 id="re库主要功能函数">Re 库主要功能函数</h3>
<table>
<thead>
<tr class="header">
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> re.search()</td>
<td> 在一个字符串中搜索匹配正则表达式的第一个位置，返回 match 对象</td>
</tr>
<tr class="even">
<td> re.match()</td>
<td> 从一个字符串的开始位置起匹配正则表达式，返回 match 对象</td>
</tr>
<tr class="odd">
<td> re.findall()</td>
<td> 搜索字符串，以列表类型返回全部能匹配的子串</td>
</tr>
<tr class="even">
<td> re.split()</td>
<td> 将一个字符串按照正则表达式匹配结果进行分割，返回列表类型</td>
</tr>
<tr class="odd">
<td> re.finditer()</td>
<td> 搜索字符串，返回一个匹配结果的迭代类型，每个迭代元素是 match 对象</td>
</tr>
<tr class="even">
<td> re.sub()</td>
<td> 在一个字符串中替换所有匹配正则表达式的子串，返回替换后的字符串</td>
</tr>
</tbody>
</table>
<h3 id="search方法">search 方法</h3>
<p><code>re.search(pattern, string, flags = 0)</code><br>
参数 flag 是匹配模式，取值可以使用按位或运算符’|’表示同时生效。<br>
其他方法的参数与 search 类似。sub 方法多一个参数 repl，<code>re.sub(pattern, repl, string, flags = 0)</code>。</p>
<table>
<thead>
<tr class="header">
<th>flag</th>
<th> 说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> re.I(IGNORECASE)</td>
<td> 忽略大小写</td>
</tr>
<tr class="even">
<td> re.M(MULTILINE)</td>
<td> 多行模式，改变 '^' 和 '$' 的行为</td>
</tr>
<tr class="odd">
<td> re.S(DOTALL)</td>
<td> 点任意匹配模式，改变 '.' 的行为</td>
</tr>
<tr class="even">
<td> re.L(LOCALE)</td>
<td> 使预定字符类</td>
</tr>
<tr class="odd">
<td> re.U(UNICODE)</td>
<td> 使预定字符类</td>
</tr>
<tr class="even">
<td> re.X(VERBOSE)</td>
<td> 详细模式。这个模式下正则表达式可以是多行，忽略空白字符，并可以加入注释。</td>
</tr>
</tbody>
</table>
<h3 id="match对象">Match 对象</h3>
<p>一次匹配的结果，包含了很多关于此次匹配的信息，可以使用 Match 提供的可读属性或方法来获取这些信息。</p>
<h4 id="属性">属性</h4>
<table>
<thead>
<tr class="header">
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> string</td>
<td> 匹配时使用的文本。</td>
</tr>
<tr class="even">
<td>re</td>
<td> 匹配时使用的 Pattern 对象。</td>
</tr>
<tr class="odd">
<td>pos</td>
<td> 文本中正则表达式开始搜索的索引。值与 Pattern.match () 和 Pattern.seach () 方法的同名参数相同。</td>
</tr>
<tr class="even">
<td>endpos</td>
<td> 文本中正则表达式结束搜索的索引。值与 Pattern.match () 和 Pattern.seach () 方法的同名参数相同。</td>
</tr>
<tr class="odd">
<td>lastindex</td>
<td> 最后一个被捕获的分组在文本中的索引。如果没有被捕获的分组，将为 None。</td>
</tr>
<tr class="even">
<td>lastgroup</td>
<td> 最后一个被捕获的分组的别名。如果这个分组没有别名或者没有被捕获的分组，将为 None。</td>
</tr>
</tbody>
</table>
<h4 id="方法">方法</h4>
<table>
<colgroup>
<col style="width: 19%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>group([group1, …])</code></td>
<td>获得一个或多个分组截获的字符串；指定多个参数时将以元组形式返回。可以使用编号也可以使用别名。<br>编号 0 代表整个匹配的子串，不填写参数时，返回 <code>group(0)</code>，没有截获字符串的组返回 None，截获了多次的组返回最后一次截获的子串。</td>
</tr>
<tr class="even">
<td><code>groups([default])</code></td>
<td>以元组形式返回全部分组截获的字符串。相当于调用 <code>group(1,2,…last)</code>。<br>default 表示没有截获字符串的组以这个值替代，默认为 None。</td>
</tr>
<tr class="odd">
<td><code>groupdict([default])</code></td>
<td>返回以有别名的组的别名为键、以该组截获的子串为值的字典，没有别名的组不包含在内。default 含义同上。</td>
</tr>
<tr class="even">
<td><code>start([group])</code></td>
<td>返回指定的组截获的子串在 string 中的起始索引（子串第一个字符的索引）。group 默认值为 0。</td>
</tr>
<tr class="odd">
<td><code>end([group])</code></td>
<td>返回指定的组截获的子串在 string 中的结束索引（子串最后一个字符的索引 + 1）。group 默认值为 0。</td>
</tr>
<tr class="even">
<td><code>span([group])</code></td>
<td>返回 <code>(start(group), end(group))</code>。</td>
</tr>
<tr class="odd">
<td><code>expand(template)</code></td>
<td>将匹配到的分组代入 template 中然后返回。template 中可以使用 <code>\id</code> 或 <code>\g&lt;id&gt;</code> 或 <code>\g&lt;name&gt;</code> 引用分组，但不能使用编号 0。<code>\id</code> 与 <code>\g&lt;id&gt;</code> 是等价的，但 <code>\10</code> 将被认为是第 10 个分组，如果你想表达 <code>\1</code> 之后是字符<code>'0'</code>，只能使用 <code>\g&lt;1&gt;0</code>。</td>
</tr>
</tbody>
</table>
<h3 id="pattern对象">Pattern 对象</h3>
<p>Pattern 对象是一个编译好的正则表达式，通过 Pattern 提供的一系列方法可以对文本进行匹配查找。<br>
Pattern 不能直接实例化，必须使用 re.compile () 进行构造。<br>
Pattern 提供了几个可读属性用于获取表达式的相关信息：</p>
<table>
<thead>
<tr class="header">
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> pattern</td>
<td> 编译时用的表达式字符串。</td>
</tr>
<tr class="even">
<td>flags</td>
<td> 编译时用的匹配模式。数字形式。</td>
</tr>
<tr class="odd">
<td>groups</td>
<td> 表达式中分组的数量。</td>
</tr>
<tr class="even">
<td>groupindex</td>
<td> 以表达式中有别名的组的别名为键、以该组对应的编号为值的字典，没有别名的组不包含在内。</td>
</tr>
</tbody>
</table>
<p>所以 <code>re.xxx(pattern, string, flags = 0)</code> 可以写做 <code>pattern.xxx(string, flag)</code>。</p>
<h1 id="sqlite库">SQLite 库</h1>
<h2 id="sqlite简介">SQLite 简介</h2>
<ul>
<li>轻量级</li>
<li>速度快</li>
<li>无需部署</li>
<li>没有服务器</li>
<li>很少或不需要进行管理</li>
<li>由于 SQLite 数据库的驱动已经在 Python 里面了，可以直接使用 <code>import sqlite3</code></li>
</ul>
<h2 id="创建数据库">创建数据库</h2>
<p><code>conn = sqlite3.connect("数据库名称.db")</code><br>
如果数据库不存在，那么它就会被创建，最后将返回一个数据库对象。</p>
<h2 id="创建游标对象">创建游标对象</h2>
<p><code>cur = conn.cursor()</code></p>
<h2 id="创建数据库表">创建数据库表</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	cursor.execute(<span class="string">'CREATE TABLE 表名称 (键1 键类型 PRIMARY KEY, 键2 键类型, 键3 键类型, ...)'</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"Table created successfully"</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">	<span class="built_in">print</span>(e)</span><br></pre></td></tr></tbody></table></figure>
<p>这里 ' 键 i' 为键的名称，其中键 1 为主键，键类型有 TEXT（文本字符串，使用数据库编码 UTF-8、UTF-16BE 或 UTF-16LE 存储），REAL（浮点值，存储为 8 字节的 IEEE 浮点数字），INT（带符号的整数，根据值的大小存储在 1、2、3、4、6 或 8 字节中），NULL（空值）。</p>
<h2 id="insert操作">INSERT 操作</h2>
<p>单个插入<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	cursor.execute(<span class="string">'INSERT INTO 表名称 (键1, 键2, 键3, ...) VALUES (值1, 值2, 值3, ...)'</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">'data insert successfully'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">	<span class="built_in">print</span>(e)</span><br></pre></td></tr></tbody></table></figure><br>
批量插入<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	data = [(<span class="string">"值11"</span>, <span class="string">"值12"</span>, <span class="string">"值13"</span>, ...), (<span class="string">"值21"</span>, <span class="string">"值22"</span>, <span class="string">"值23"</span>, ...), (<span class="string">"值31"</span>, <span class="string">"值32"</span>, <span class="string">"值33"</span>, ...)]</span><br><span class="line">	cursor.execute(<span class="string">'INSERT INTO 表名称 (?, ?, ?, ...)'</span>, data)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">'data insert successfully'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">	<span class="built_in">print</span>(e)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="update操作">UPDATE 操作</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	cursor.execute(<span class="string">'UPDATE 表名称 SET 键1 = 值1, 键2 = 值2, 键3 = 值3, ... WHERE 键1 = 值1, 键2 = 值2, 键3 = 值3, ...'</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">'data update successfully'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">	<span class="built_in">print</span>(e)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="select操作">SELECT 操作</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	cursor.execute(<span class="string">'SELECT 键1, 键2, 键3, ... FROM 表名称 WHERE 键1 = 值1, 键2 = 值2, 键3 = 值3, ...'</span>)</span><br><span class="line">	<span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">		<span class="built_in">print</span>(row)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">	<span class="built_in">print</span>(e)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="delete操作">DELETE 操作</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	c.execute(<span class="string">"DELETE FROM 表名称 WHERE 键1 = 值1, 键2 = 值2, 键3 = 值3, ..."</span>)</span><br><span class="line">	<span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">		<span class="built_in">print</span>(row)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">	<span class="built_in">print</span>(e)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="关闭数据库">关闭数据库</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cursor.close() <span class="comment"># 关闭Cursor</span></span><br><span class="line">conn.commit() <span class="comment"># 提交事务</span></span><br><span class="line">conn.close() <span class="comment"># 关闭Connection</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="将数据库中的数据导出为csv文件">将数据库中的数据导出为 csv 文件：</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">conn = sqlite3.connect(<span class="string">'文件名.db'</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">cursor.execute(<span class="string">"SELECT name FROM sqlite_master WHERE type = 'table'"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    tablename = i[<span class="number">0</span>]</span><br><span class="line">    cursor.execute(<span class="string">"SELECT * FROM '{}'"</span>.<span class="built_in">format</span>(tablename))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(tablename + <span class="string">'.csv'</span>, <span class="string">'w'</span>, newline=<span class="string">''</span>, encoding=<span class="string">'utf_8_sig'</span>) <span class="keyword">as</span> csv_file: </span><br><span class="line">        csv_writer = csv.writer(csv_file)</span><br><span class="line">        csv_writer.writerow([j[<span class="number">0</span>] <span class="keyword">for</span> j <span class="keyword">in</span> cursor.description])</span><br><span class="line">        csv_writer.writerows(cursor)</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Python</tag>
        <tag>Crawler</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Web 框架 - CherryPy</title>
    <url>/contents/Python-Web%E6%A1%86%E6%9E%B6-CherryPy.html</url>
    <content><![CDATA[<p>CherryPy is a pythonic, object-oriented web framework.<br>
CherryPy allows developers to build web applications in much the same way they would build any other object-oriented Python program. This results in smaller source code developed in less time.<br>
Reference：<a href="http://cherrypy.org">官网</a>；<a href="https://github.com/cherrypy/cherrypy">GitHub</a><br>
<span id="more"></span></p>
<h1 id="安装">安装</h1>
<p>直接执行 <code>$ pip install cherrypy</code>。<br>
也可以从 GitHub 的 CherryPy 获取最新版的源代码并安装：<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">$ git clone https://github.com/cherrypy/cherrypy</span><br><span class="line">$ cd cherrypy</span><br><span class="line">$ python setup.py install</span><br></pre></td></tr></tbody></table></figure><br>
用测试用例检验是否安装成功，直接执行 <code>$ python -m cherrypy.tutorial.tut01_helloworld</code>。<br>
打开页面http://127.0.0.1:8080 或者http://localhost:8080 查看结果。<br>
一旦成功，控制台也会显示log：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ENGINE Listening for SIGHUP.</span><br><span class="line">ENGINE Listening for SIGTERM.</span><br><span class="line">ENGINE Listening for SIGUSR1.</span><br><span class="line">ENGINE Bus STARTING</span><br><span class="line">ENGINE Started monitor thread 'Autoreloader'.</span><br><span class="line">ENGINE Started monitor thread '_TimeoutMonitor'.</span><br><span class="line">ENGINE Serving on http://127.0.0.1:8080</span><br><span class="line">ENGINE Bus STARTED</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="hello-world页面部署">Hello World 页面部署</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello world!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(HelloWorld())</span><br></pre></td></tr></tbody></table></figure>
<p>运行此程序后，控制台则会显示：<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ENGINE Listening for SIGHUP.</span><br><span class="line">ENGINE Listening for SIGTERM.</span><br><span class="line">ENGINE Listening for SIGUSR1.</span><br><span class="line">ENGINE Bus STARTING</span><br><span class="line">CherryPy Checker:</span><br><span class="line">The Application mounted at '' has an empty config.</span><br><span class="line"></span><br><span class="line">ENGINE Started monitor thread 'Autoreloader'.</span><br><span class="line">ENGINE Started monitor thread '_TimeoutMonitor'.</span><br><span class="line">ENGINE Serving on http://127.0.0.1:8080</span><br><span class="line">ENGINE Bus STARTED</span><br></pre></td></tr></tbody></table></figure><br>
前三行表示服务器会处理signal；第四行表示服务器的状态，此刻在启动阶段；第五、六行表示你的应用没有特别的配置；第八、九行表示服务器开始了一些内部的功能，倒数第二行表示已经准备好通信并且监听地址127.0.0.1:8080，最后一行表示现在你的应用已经开始运行，可以使用。<br>
这里return为index页面的源码：<br>
- 可以是一般字符串，比如 <code>"Hello world!"</code>，页面直接显示字符串<br>
- 可以是<a href="http://www.w3school.com.cn/html/">HTML</a>格式的字符串，比如<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">"""</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;script type="text/javascript" src="/xxx/xxx/xxx.js"&gt;&lt;/script&gt;</span><br><span class="line">        &lt;title&gt;Write Your WebPage Title Here&lt;/title&gt;</span><br><span class="line">        &lt;link rel="stylesheet" type="text/css" href="/xxx/xxx/xxx.css" /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div class="xxx"&gt;</span><br><span class="line">            Hello world!</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">"""</span><br></pre></td></tr></tbody></table></figure><br>
这里使用三对双引号，用来输入多行文本，之中的单号和双引号不用转义，其中的不可见字符比如。<br>
- 可以是HTML文件 <code>open('xxx/xxx/xxx.html')</code><br>
注打开文件的时候可以传递参数<br>
<code>open("xxx.html").read().format(a=a, b=b, c=c, ...)</code>，则HTML文件中 <code>{a:}</code>; <code>{b:}</code>; <code>{c:}</code>; ...来表示相应的字符串。<br>
或者 <code>open("xxx.html").read() % (a, b, c, ...)</code>，HTML文件中 <code>%s</code>;<code>%d</code>;<code>%f</code> 等来表示相应位置的字符串。<br>
原理：<code>open("xxx.html").read()</code> 返回一个string对象，传递参数同格式化输出。<p></p>
<p>用 <code>cherrypy.quickstart()</code> 启动单个应用，此函数至少需要一个参数，第一个必选一般为类名；第二个可选参数为应用访问的基础路径；第三个可选参数为应用配置。<br>
如果要启动多个应用，则用 <code>cherrypy.tree.mount()</code>，此函数的参数和 <code>cherrypy.quickstart()</code> 一样，均为一个应用的类名，一个主机路径，一个配置。举例如下<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cherrypy.tree.mount(A(), <span class="string">'/a'</span>, a_conf)</span><br><span class="line">cherrypy.tree.mount(B(), <span class="string">'/b'</span>, b_conf)</span><br><span class="line"></span><br><span class="line">cherrypy.engine.start()</span><br><span class="line">cherrypy.engine.block()</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="不同的urls对应不同的functions">不同的 URLs 对应不同的 functions</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGenerator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello world!"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(StringGenerator())</span><br></pre></td></tr></tbody></table></figure>
<p>运行此程序后，打开 http://localhost:8080 或者 http://localhost:8080/index 则会显示 Helloworld 界面（index 可以省略）。<br>
而打开 http://localhost:8080/generate 则会运行 generate 函数并返回且显示一个 8 位随机字符串。<br>
此外，开发者可以实现一个 default 方法，如果服务器找不到任何对应的方法时，将会调用 default 方法。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGenerator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello world!"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">default</span>(<span class="params">self, url</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(StringGenerator())</span><br></pre></td></tr></tbody></table></figure><br>
运行此程序后，打开http://localhost:8080/xxx 则会运行default函数并返回且显示一个8位随机字符串，这里xxx为任意网址。<br>
注意，default函数必须有两个参数，url会传入用户所访问的网址，即 <code>url=xxx</code><p></p>
<h1 id="通过url传递参数">通过 URL 传递参数</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGenerator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello world!"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">self, length=<span class="number">8</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="built_in">int</span>(length)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(StringGenerator())</span><br></pre></td></tr></tbody></table></figure>
<p>运行此程序后，打开 http://localhost:8080/generate?length=16 ，<br>
则地址栏中的 16 会被从客户端传递到服务器端，作为 generate 的参数 length 的值，其结果是返回且显示一个长度为 16 的随机字符串。<br>
如果直接访问 http://localhost:8080/generate 则参数为缺省值 length=8。<br>
如果并未设置缺省值也没有通过 url 传递参数则会报错。</p>
<h1 id="提交表单">提交表单</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGenerator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"""&lt;html&gt;</span></span><br><span class="line"><span class="string">          &lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">          &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;form method="get" action="generate"&gt;</span></span><br><span class="line"><span class="string">              &lt;input type="text" value="8" name="length" /&gt;</span></span><br><span class="line"><span class="string">              &lt;button type="submit"&gt;Give it now!&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">          &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">self, length=<span class="number">8</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="built_in">int</span>(length)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(StringGenerator())</span><br></pre></td></tr></tbody></table></figure>
<p>运行此程序后，打开 http://localhost:8080/ ，填写表格并提交。<br>
触发 submit 时候，根据 form 中定义的 action 的名字寻找对应的 function，并将表单元素提交的内容作为 name 属性所对应的参数传递。</p>
<h1 id="session">Session</h1>
<p>一个应用经常需要追踪用户的行为，一个常用的做法是使用 session 暂存数据，并且在客户端服务器通信中保持。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGenerator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"""&lt;html&gt;</span></span><br><span class="line"><span class="string">          &lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">          &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;form method="get" action="generate"&gt;</span></span><br><span class="line"><span class="string">              &lt;input type="text" value="8" name="length" /&gt;</span></span><br><span class="line"><span class="string">              &lt;button type="submit"&gt;Give it now!&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">          &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">self, length=<span class="number">8</span></span>):</span></span><br><span class="line">        some_string = <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="built_in">int</span>(length)))</span><br><span class="line">        cherrypy.session[<span class="string">'mystring'</span>] = some_string</span><br><span class="line">        <span class="keyword">return</span> some_string</span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">display</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cherrypy.session[<span class="string">'mystring'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    conf = {</span><br><span class="line">        <span class="string">'/'</span>: {</span><br><span class="line">            <span class="string">'tools.sessions.on'</span>: <span class="literal">True</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cherrypy.quickstart(StringGenerator(), <span class="string">'/'</span>, conf)</span><br></pre></td></tr></tbody></table></figure><br>
运行此程序后，打开http://localhost:8080/generate 生成一个随机字符串并存入session的'mystring'字段之中。<br>
打开http://localhost:8080/display 展示session中存储的字符串。<br>
CherryPy会存储session的信息在进程的内存中。<br>
注意此时要修改.conf文件。<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[/]</span><br><span class="line">tools.sessions.on = True</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="cookies">Cookies</h1>
<p>CherryPy 使用 Python 模块 Cookie，Cookie.SimpleCookie 对象来处理 cookie<br>
要将 cookie 发送至浏览器，使用 <code>cherrypy.response.cookie[key] = value</code><br>
要提取浏览器的 cookie，使用 <code>cherrypy.request.cookie[key]</code><br>
要删除 cookie（在客户端），必须将 cookie 的过期时间设置为 0：<code>cherrypy.response.cookie[key]['expires'] = 0</code></p>
<h1 id="允许文件上传下载">允许文件上传、下载</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"><span class="keyword">from</span> cherrypy.lib <span class="keyword">import</span> static</span><br><span class="line"></span><br><span class="line">localDir = os.path.dirname(__file__)</span><br><span class="line">absDir = os.path.join(os.getcwd(), localDir)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileDemo</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"""</span></span><br><span class="line"><span class="string">        &lt;html&gt;&lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;h2&gt;Upload a file&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;form action="upload" method="post" enctype="multipart/form-data"&gt;</span></span><br><span class="line"><span class="string">            filename: &lt;input type="file" name="myFile" /&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">            &lt;input type="submit" /&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">            &lt;h2&gt;Download a file&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;a href='download'&gt;This one&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;&lt;/html&gt;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload</span>(<span class="params">self, myFile</span>):</span></span><br><span class="line">        out = <span class="string">"""&lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            myFile length: %s&lt;br /&gt;</span></span><br><span class="line"><span class="string">            myFile filename: %s&lt;br /&gt;</span></span><br><span class="line"><span class="string">            myFile mime-type: %s</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;"""</span></span><br><span class="line">        size = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = myFile.file.read(<span class="number">8192</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            size += <span class="built_in">len</span>(data)</span><br><span class="line">        <span class="keyword">return</span> out % (size, myFile.filename, myFile.content_type)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">self</span>):</span></span><br><span class="line">        path = os.path.join(absDir, <span class="string">'pdf_file.pdf'</span>)</span><br><span class="line">        <span class="keyword">return</span> static.serve_file(path, <span class="string">'application/x-download'</span>, <span class="string">'attachment'</span>, os.path.basename(path))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(FileDemo())</span><br></pre></td></tr></tbody></table></figure>
<p><strong>上传</strong>：<br>
当客户端上传一个文件到 CherryPy 应用时，CherryPy 将会将文件作为一个参数传给方法（upload (self, myFile)）。<br>
此参数有一个 file 属性，可以用于操作临时传入的文件，如果想要永久的保留文件，则需要用 read () 函数读取 myFile.file 的数据并且写入到某个文件中。<br>
<strong>下载</strong>：<br>
使用响应类型 “application/x-download”，可以告诉浏览器，应该将资源下载到用户的机器上，而不是显示。<br>
<code>serve_file(path, content_type=None, disposition=None, name=None, debug=False)</code> 函数：第一个参数为文件路径；第二个参数为内容类型；第三个参数为 Content-Disposition 信息（Content-Disposition 就是当用户想把请求所得的内容存为一个文件的时候提供一个默认的文件名），如果不为空，则 Content-Disposition header 会被设置为 <code>"&lt;disposition&gt;; filename=&lt;name&gt;"</code>，如果 name 为空，则 name 被设置为文件的 basename。</p>
<h1 id="以流形式处理请求主体">以流形式处理请求主体</h1>
<p>CherryPy 收到 HTTP 请求后，对于底层信心进行处理后将请求传给页面处理部分，这里就会生成请求主体 (response body).<br>
ChereyPy 支持多种类型的请求主体，如字符串、字符串列表或者文件；同样，也可以通过 yield 内容的方式形成 stream。<br>
默认是关闭流输出的，因为这更加安全也更容易处理；如果要开启这个功能，需要对 session 会话有所了解。<br>
一般请求的处理过程中，HTTP 服务器是一次性将整个请求接受、一次性将整个结果返回。<br>
这对于简单的网页或者静态内容比较合适，因为请求、代码等都可以随时改变。<br>
而流输出中程序不是一次性的返回数据，而是返回生成器，再通过生成器不断的以流的形式获取数据。<br>
使用 <code>response.stream = true</code> 并结合 yield，示例如下：<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">import os.path</span><br><span class="line">import cherrypy</span><br><span class="line"></span><br><span class="line">class HelloWorld(object):</span><br><span class="line">    @cherrypy.expose</span><br><span class="line">    def index(self):</span><br><span class="line">        yield "Hello "</span><br><span class="line">        yield "world!"</span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    conf = {</span><br><span class="line">        '/': {</span><br><span class="line">            'response.stream': True</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cherrypy.quickstart(HelloWorld(), '/', conf)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="调用网站资源">调用网站资源</h1>
<p>网络应用经常会调用一些静态资源，比如 <a href="http://www.w3school.com.cn/js/index.asp">JavaScript</a>，<a href="http://www.w3school.com.cn/css/index.asp">CSS</a> 或 image 等资源。<br>
在网站的根目录下新建文件夹 public，在 public 中可以自己新建文件夹 js，css，image 等子文件夹，并在相应文件夹中存放相应的资源。<br>
在 HTML 调用资源的地方写入：<br>
<code>&lt;script type="text/javascript" src="/static/js/xxx.js"&gt;&lt;/script&gt;</code><br>
<code>&lt;link rel="stylesheet" type="text/css" href="/static/css/xxx.css" /&gt;</code><br>
<code>&lt;img src="/static/image/xxx.jpg" alt="xxx" style="width:123px;height:123px;"&gt;</code><br>
并且修改.conf 文件。<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[/]</span><br><span class="line">tools.staticdir.root = os.path.abspath(os.getcwd())</span><br><span class="line"></span><br><span class="line">[/static]</span><br><span class="line">tools.staticdir.on = True</span><br><span class="line">tools.staticdir.dir = "public"</span><br></pre></td></tr></tbody></table></figure><br>
对于独立文件资源：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[/style.css]</span><br><span class="line">tools.staticfile.on = True</span><br><span class="line">tools.staticfile.filename = filepath</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="rest">REST</h1>
<p>客户端除了浏览器之外，还有其他一些形式比如 python，iOS，Android 等。<br>
RESTful 可以通过一套统一的接口为他们提供服务。<br>
而且对于很多平台来说，不需要有显式的前端，只需要一套提供服务的接口。<br>
REST 用 URL 定位资源，用 HTTP 动词（GET，POST，PUT，DELETE 等）描述操作。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="meta">@cherrypy.expose</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGeneratorWebService</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.tools.accept(<span class="params">media=<span class="string">'text/plain'</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cherrypy.session[<span class="string">'mystring'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">POST</span>(<span class="params">self, length=<span class="number">8</span></span>):</span></span><br><span class="line">        some_string = <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="built_in">int</span>(length)))</span><br><span class="line">        cherrypy.session[<span class="string">'mystring'</span>] = some_string</span><br><span class="line">        <span class="keyword">return</span> some_string</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PUT</span>(<span class="params">self, another_string</span>):</span></span><br><span class="line">        cherrypy.session[<span class="string">'mystring'</span>] = another_string</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DELETE</span>(<span class="params">self</span>):</span></span><br><span class="line">        cherrypy.session.pop(<span class="string">'mystring'</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    conf = {</span><br><span class="line">        <span class="string">'/'</span>: {</span><br><span class="line">            <span class="string">'request.dispatch'</span>: cherrypy.dispatch.MethodDispatcher(),</span><br><span class="line">            <span class="string">'tools.sessions.on'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'tools.response_headers.on'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'tools.response_headers.headers'</span>: [(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>)],</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cherrypy.quickstart(StringGeneratorWebService(), <span class="string">'/'</span>, conf)</span><br></pre></td></tr></tbody></table></figure><br>
运行此程序后，可以使用python的requests库来进行交互。<br>
这里通过@cherrypy.expose装饰器一次性暴露StringGeneratorWebService类的所有方法。<br>
该应用不再是以&lt;URL，函数&gt;匹配的方式进行工作，而是在配置里面创建了cherrypy.dispatch.MethodDispatcher实例，用于自动匹配。<br>
对于get函数强制response的contenttype为text/plain。<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = requests.Session()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = s.get(<span class="string">'http://127.0.0.1:8080/'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</span><br><span class="line"><span class="number">500</span> <span class="comment"># 因为session['mystring']为空，所以产生服务器错误</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = s.post(<span class="string">'http://127.0.0.1:8080/'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code, r.text</span><br><span class="line">(<span class="number">200</span>, <span class="string">u'04A92138'</span>) <span class="comment"># post提交一个长度为8的随机字符串并存入session中</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = s.get(<span class="string">'http://127.0.0.1:8080/'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code, r.text</span><br><span class="line">(<span class="number">200</span>, <span class="string">u'04A92138'</span>) <span class="comment"># get获取session中所存的字符串</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = s.get(<span class="string">'http://127.0.0.1:8080/'</span>, headers={<span class="string">'Accept'</span>: <span class="string">'application/json'</span>})</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</span><br><span class="line"><span class="number">406</span> <span class="comment"># 因为提出请求，将获取所生成的字符串作为一个JSON格式返回，格式不符所以返回406错误</span></span><br><span class="line"><span class="comment"># 406 Not Acceptable 请求的资源的内容特性无法满足请求头中的条件，因而无法生成响应实体，该请求不可接受。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = s.put(<span class="string">'http://127.0.0.1:8080/'</span>, params={<span class="string">'another_string'</span>: <span class="string">'hello'</span>})</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = s.get(<span class="string">'http://127.0.0.1:8080/'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code, r.text</span><br><span class="line">(<span class="number">200</span>, <span class="string">u'hello'</span>) <span class="comment"># put更新session中所存的字符串</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = s.delete(<span class="string">'http://127.0.0.1:8080/'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = s.get(<span class="string">'http://127.0.0.1:8080/'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</span><br><span class="line"><span class="number">500</span> <span class="comment"># delete删除session中的字符串，所以产生服务器错误</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="ajax">AJAX</h1>
<p><a href="http://www.w3school.com.cn/ajax/index.asp">AJAX</a> = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。<br>
AJAX 是在不重新加载整个页面的情况下与服务器交换数据并<strong>更新部分</strong>网页的技术。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os, os.path</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGenerator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'''&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">                    &lt;html&gt;</span></span><br><span class="line"><span class="string">                      &lt;head&gt;</span></span><br><span class="line"><span class="string">                        &lt;style&gt;</span></span><br><span class="line"><span class="string">                          #the-string {</span></span><br><span class="line"><span class="string">                            display: none;</span></span><br><span class="line"><span class="string">                          }</span></span><br><span class="line"><span class="string">                        &lt;/style&gt;</span></span><br><span class="line"><span class="string">                        &lt;script src="http://code.jquery.com/jquery-2.0.3.min.js"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">                        &lt;script type="text/javascript"&gt;</span></span><br><span class="line"><span class="string">                          $(document).ready(function() {</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            $("#generate-string").click(function(e) {</span></span><br><span class="line"><span class="string">                              $.ajax({</span></span><br><span class="line"><span class="string">                                type: "POST",</span></span><br><span class="line"><span class="string">                                url: "/generator",</span></span><br><span class="line"><span class="string">                                data: {"length": $("input[name='length']").val()}</span></span><br><span class="line"><span class="string">                              })</span></span><br><span class="line"><span class="string">                              e.preventDefault();</span></span><br><span class="line"><span class="string">                            });</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            $("#replace-string").click(function(e) {</span></span><br><span class="line"><span class="string">                              $.ajax({</span></span><br><span class="line"><span class="string">                                type: "PUT",</span></span><br><span class="line"><span class="string">                                url: "/generator",</span></span><br><span class="line"><span class="string">                                data: {"another_string": $("#the-string input").val()}</span></span><br><span class="line"><span class="string">                              })</span></span><br><span class="line"><span class="string">                              .done(function() {</span></span><br><span class="line"><span class="string">                                alert("Replaced!");</span></span><br><span class="line"><span class="string">                              });</span></span><br><span class="line"><span class="string">                              e.preventDefault();</span></span><br><span class="line"><span class="string">                            });</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            $("#delete-string").click(function(e) {</span></span><br><span class="line"><span class="string">                              $.ajax({</span></span><br><span class="line"><span class="string">                                type: "DELETE",</span></span><br><span class="line"><span class="string">                                url: "/generator"</span></span><br><span class="line"><span class="string">                              })</span></span><br><span class="line"><span class="string">                              .done(function() {</span></span><br><span class="line"><span class="string">                                $("#the-string").hide();</span></span><br><span class="line"><span class="string">                              });</span></span><br><span class="line"><span class="string">                              e.preventDefault();</span></span><br><span class="line"><span class="string">                            });</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                          });</span></span><br><span class="line"><span class="string">                        &lt;/script&gt;</span></span><br><span class="line"><span class="string">                      &lt;/head&gt;</span></span><br><span class="line"><span class="string">                      &lt;body&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type="text" value="8" name="length"/&gt;</span></span><br><span class="line"><span class="string">                        &lt;button id="generate-string"&gt;Give it now!&lt;/button&gt;</span></span><br><span class="line"><span class="string">                        &lt;div id="the-string"&gt;</span></span><br><span class="line"><span class="string">                          &lt;input type="text" /&gt;</span></span><br><span class="line"><span class="string">                          &lt;button id="replace-string"&gt;Replace&lt;/button&gt;</span></span><br><span class="line"><span class="string">                          &lt;button id="delete-string"&gt;Delete it&lt;/button&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                      &lt;/body&gt;</span></span><br><span class="line"><span class="string">                    &lt;/html&gt;</span></span><br><span class="line"><span class="string">                    '''</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@cherrypy.expose</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGeneratorWebService</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.tools.accept(<span class="params">media=<span class="string">'text/plain'</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cherrypy.session[<span class="string">'mystring'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">POST</span>(<span class="params">self, length=<span class="number">8</span></span>):</span></span><br><span class="line">        some_string = <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="built_in">int</span>(length)))</span><br><span class="line">        cherrypy.session[<span class="string">'mystring'</span>] = some_string</span><br><span class="line">        <span class="keyword">return</span> some_string</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PUT</span>(<span class="params">self, another_string</span>):</span></span><br><span class="line">        cherrypy.session[<span class="string">'mystring'</span>] = another_string</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DELETE</span>(<span class="params">self</span>):</span></span><br><span class="line">        cherrypy.session.pop(<span class="string">'mystring'</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    conf = {</span><br><span class="line">        <span class="string">'/'</span>: {</span><br><span class="line">            <span class="string">'tools.sessions.on'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'tools.staticdir.root'</span>: os.path.abspath(os.getcwd())</span><br><span class="line">        },</span><br><span class="line">        <span class="string">'/generator'</span>: {</span><br><span class="line">            <span class="string">'request.dispatch'</span>: cherrypy.dispatch.MethodDispatcher(),</span><br><span class="line">            <span class="string">'tools.response_headers.on'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'tools.response_headers.headers'</span>: [(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>)],</span><br><span class="line">        },</span><br><span class="line">    }</span><br><span class="line">    webapp = StringGenerator()</span><br><span class="line">    webapp.generator = StringGeneratorWebService()</span><br><span class="line">    cherrypy.quickstart(webapp, <span class="string">'/'</span>, conf)</span><br></pre></td></tr></tbody></table></figure><br>
运行此程序后，可以使用按钮触发ajax结合<a href="http://www.w3school.com.cn/jquery/index.asp">jQuery</a>来进行交互。<br>
其中：<br>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line">$(<span class="string">"#generate-string"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>{</span><br><span class="line">  $.ajax({</span><br><span class="line">    <span class="attr">type</span>: <span class="string">"POST"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"/generator"</span>,</span><br><span class="line">    <span class="attr">data</span>: {<span class="string">"length"</span>: $(<span class="string">"input[name='length']"</span>).val()}</span><br><span class="line">  })</span><br><span class="line">   .done(<span class="function"><span class="keyword">function</span>(<span class="params">string</span>) </span>{</span><br><span class="line">    $(<span class="string">"#the-string"</span>).show();</span><br><span class="line">    $(<span class="string">"#the-string input"</span>).val(string);</span><br><span class="line">  });</span><br><span class="line">  e.preventDefault();</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><br>
表示当id为generate-string的按钮被点击后，执行POST命令，目标url是generator，以<a href="http://www.w3school.com.cn/json/index.asp">JSON</a>方式传参数length，length的值为名字等于length的input组件的值。完成POST后服务器返回string，并且将id为the-string的组件显示出来，将其input组件的值赋值为string。<br>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line">$(<span class="string">"#replace-string"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>{</span><br><span class="line">  $.ajax({</span><br><span class="line">    <span class="attr">type</span>: <span class="string">"PUT"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"/generator"</span>,</span><br><span class="line">    <span class="attr">data</span>: {<span class="string">"another_string"</span>: $(<span class="string">"#the-string input"</span>).val()}</span><br><span class="line">  })</span><br><span class="line">  .done(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    alert(<span class="string">"Replaced!"</span>);</span><br><span class="line">  });</span><br><span class="line">  e.preventDefault();</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><br>
表示当id为replace-string的按钮被点击后，执行PUT命令，目标url是generator，以JSON方式传参数another_string，another_string的值为id为the-string的组件中的input组件的值。完成PUT后弹出警告框"Replaced"。<br>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line">$(<span class="string">"#delete-string"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>{</span><br><span class="line">  $.ajax({</span><br><span class="line">    <span class="attr">type</span>: <span class="string">"DELETE"</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">"/generator"</span></span><br><span class="line">  })</span><br><span class="line">  .done(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    $(<span class="string">"#the-string"</span>).hide();</span><br><span class="line">  });</span><br><span class="line">  e.preventDefault();</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><br>
表示当id为delete-string的按钮被点击后，执行DELETE命令，目标url是generator，完成DELETE后将id为the-string的组件隐藏。<p></p>
<h1 id="数据库存储">数据库存储</h1>
<p>这里以 SQLite 数据库为例，演示如何将网页数据存入<a href="http://www.w3school.com.cn/sql/index.asp">数据库</a>。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os, os.path</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line">DB_STRING = <span class="string">"my.db"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGenerator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'''&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">                    &lt;html&gt;</span></span><br><span class="line"><span class="string">                      &lt;head&gt;</span></span><br><span class="line"><span class="string">                        &lt;style&gt;</span></span><br><span class="line"><span class="string">                          #the-string {</span></span><br><span class="line"><span class="string">                            display: none;</span></span><br><span class="line"><span class="string">                          }</span></span><br><span class="line"><span class="string">                        &lt;/style&gt;</span></span><br><span class="line"><span class="string">                        &lt;script src="http://code.jquery.com/jquery-2.0.3.min.js"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">                        &lt;script type="text/javascript"&gt;</span></span><br><span class="line"><span class="string">                          $(document).ready(function() {</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            $("#generate-string").click(function(e) {</span></span><br><span class="line"><span class="string">                              $.ajax({</span></span><br><span class="line"><span class="string">                                type: "POST",</span></span><br><span class="line"><span class="string">                                url: "/generator",</span></span><br><span class="line"><span class="string">                                data: {"length": $("input[name='length']").val()}</span></span><br><span class="line"><span class="string">                              })</span></span><br><span class="line"><span class="string">                              e.preventDefault();</span></span><br><span class="line"><span class="string">                            });</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            $("#replace-string").click(function(e) {</span></span><br><span class="line"><span class="string">                              $.ajax({</span></span><br><span class="line"><span class="string">                                type: "PUT",</span></span><br><span class="line"><span class="string">                                url: "/generator",</span></span><br><span class="line"><span class="string">                                data: {"another_string": $("#the-string input").val()}</span></span><br><span class="line"><span class="string">                              })</span></span><br><span class="line"><span class="string">                              .done(function() {</span></span><br><span class="line"><span class="string">                                alert("Replaced!");</span></span><br><span class="line"><span class="string">                              });</span></span><br><span class="line"><span class="string">                              e.preventDefault();</span></span><br><span class="line"><span class="string">                            });</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            $("#delete-string").click(function(e) {</span></span><br><span class="line"><span class="string">                              $.ajax({</span></span><br><span class="line"><span class="string">                                type: "DELETE",</span></span><br><span class="line"><span class="string">                                url: "/generator"</span></span><br><span class="line"><span class="string">                              })</span></span><br><span class="line"><span class="string">                              .done(function() {</span></span><br><span class="line"><span class="string">                                $("#the-string").hide();</span></span><br><span class="line"><span class="string">                              });</span></span><br><span class="line"><span class="string">                              e.preventDefault();</span></span><br><span class="line"><span class="string">                            });</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                          });</span></span><br><span class="line"><span class="string">                        &lt;/script&gt;</span></span><br><span class="line"><span class="string">                      &lt;/head&gt;</span></span><br><span class="line"><span class="string">                      &lt;body&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type="text" value="8" name="length"/&gt;</span></span><br><span class="line"><span class="string">                        &lt;button id="generate-string"&gt;Give it now!&lt;/button&gt;</span></span><br><span class="line"><span class="string">                        &lt;div id="the-string"&gt;</span></span><br><span class="line"><span class="string">                          &lt;input type="text" /&gt;</span></span><br><span class="line"><span class="string">                          &lt;button id="replace-string"&gt;Replace&lt;/button&gt;</span></span><br><span class="line"><span class="string">                          &lt;button id="delete-string"&gt;Delete it&lt;/button&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                      &lt;/body&gt;</span></span><br><span class="line"><span class="string">                    &lt;/html&gt;</span></span><br><span class="line"><span class="string">                    '''</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@cherrypy.expose</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGeneratorWebService</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @cherrypy.tools.accept(<span class="params">media=<span class="string">'text/plain'</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">with</span> sqlite3.connect(DB_STRING) <span class="keyword">as</span> c:</span><br><span class="line">            cherrypy.session[<span class="string">'ts'</span>] = time.time()</span><br><span class="line">            r = c.execute(<span class="string">"SELECT value FROM user_string WHERE session_id=?"</span>,</span><br><span class="line">                          [cherrypy.session.<span class="built_in">id</span>])</span><br><span class="line">            <span class="keyword">return</span> r.fetchone()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">POST</span>(<span class="params">self, length=<span class="number">8</span></span>):</span></span><br><span class="line">        some_string = <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="built_in">int</span>(length)))</span><br><span class="line">        <span class="keyword">with</span> sqlite3.connect(DB_STRING) <span class="keyword">as</span> c:</span><br><span class="line">            cherrypy.session[<span class="string">'ts'</span>] = time.time()</span><br><span class="line">            c.execute(<span class="string">"INSERT INTO user_string VALUES (?, ?)"</span>,</span><br><span class="line">                      [cherrypy.session.<span class="built_in">id</span>, some_string])</span><br><span class="line">        <span class="keyword">return</span> some_string</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PUT</span>(<span class="params">self, another_string</span>):</span></span><br><span class="line">        <span class="keyword">with</span> sqlite3.connect(DB_STRING) <span class="keyword">as</span> c:</span><br><span class="line">            cherrypy.session[<span class="string">'ts'</span>] = time.time()</span><br><span class="line">            c.execute(<span class="string">"UPDATE user_string SET value=? WHERE session_id=?"</span>,</span><br><span class="line">                      [another_string, cherrypy.session.<span class="built_in">id</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DELETE</span>(<span class="params">self</span>):</span></span><br><span class="line">        cherrypy.session.pop(<span class="string">'ts'</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">with</span> sqlite3.connect(DB_STRING) <span class="keyword">as</span> c:</span><br><span class="line">            c.execute(<span class="string">"DELETE FROM user_string WHERE session_id=?"</span>,</span><br><span class="line">                      [cherrypy.session.<span class="built_in">id</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup_database</span>():</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Create the `user_string` table in the database</span></span><br><span class="line"><span class="string">    on server startup</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">with</span> sqlite3.connect(DB_STRING) <span class="keyword">as</span> con:</span><br><span class="line">        con.execute(<span class="string">"CREATE TABLE user_string (session_id, value)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cleanup_database</span>():</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Destroy the `user_string` table from the database</span></span><br><span class="line"><span class="string">    on server shutdown.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">with</span> sqlite3.connect(DB_STRING) <span class="keyword">as</span> con:</span><br><span class="line">        con.execute(<span class="string">"DROP TABLE user_string"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    conf = {</span><br><span class="line">        <span class="string">'/'</span>: {</span><br><span class="line">            <span class="string">'tools.sessions.on'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'tools.staticdir.root'</span>: os.path.abspath(os.getcwd())</span><br><span class="line">        },</span><br><span class="line">        <span class="string">'/generator'</span>: {</span><br><span class="line">            <span class="string">'request.dispatch'</span>: cherrypy.dispatch.MethodDispatcher(),</span><br><span class="line">            <span class="string">'tools.response_headers.on'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'tools.response_headers.headers'</span>: [(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>)],</span><br><span class="line">        },</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    cherrypy.engine.subscribe(<span class="string">'start'</span>, setup_database)</span><br><span class="line">    cherrypy.engine.subscribe(<span class="string">'stop'</span>, cleanup_database)</span><br><span class="line"></span><br><span class="line">    webapp = StringGenerator()</span><br><span class="line">    webapp.generator = StringGeneratorWebService()</span><br><span class="line">    cherrypy.quickstart(webapp, <span class="string">'/'</span>, conf)</span><br></pre></td></tr></tbody></table></figure><br>
运行此程序后，可以使用按钮触发ajax来进行交互。<br>
大部分功能与上一个例子相同，这里增加了将session中的数据存入数据库的功能。<br>
其中 <code>cherrypy.engine.subscribe('start', setup_database)</code> 和 <code>cherrypy.engine.subscribe('stop', cleanup_database)</code> 表示setup_database函数和cleanup_database函数被注册到服务器，当服务器启动和停止时调用。<br>
setup_database函数新建一个名为user_string的表格，cleanup_database函数删除user_string表格。<p></p>
<h1 id="日志记录">日志记录</h1>
<p>CherryPy 会记录所有的 requests 和协议错误。<br>
应用也可以自己配置日志记录功能，调用 <code>cherrypy.log()</code>。<br>
如果在配置中配置以下内容，则所有的 log 会被记录到文件：<br>
- <code>log.access_file</code> 记录 requests 情况<br>
- <code>log.error_file</code> 记录其他的情况</p>
<p>修改.conf 文件。<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[/]</span><br><span class="line">log.screen = False, #用于取消console的logging</span><br><span class="line">log.access_file = "access.log",</span><br><span class="line">log.error_file = "error.log",</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="服务器配置">服务器配置</h1>
<h2 id="全局配置global">全局配置 (global)</h2>
<p>HTTP 配置<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[global]</span><br><span class="line">server.socket_host = "127.0.0.1"</span><br><span class="line">server.socket_port = 8080</span><br><span class="line">server.thread_pool = 10</span><br></pre></td></tr></tbody></table></figure><br>
HTTPS配置<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[global]</span><br><span class="line">server.socket_host = "0.0.0.0"</span><br><span class="line">server.socket_port = 443</span><br><span class="line">server.thread_pool = 10</span><br><span class="line">server.ssl_module = 'builtin'</span><br><span class="line">server.ssl_certificate = "cert.pem"</span><br><span class="line">server.ssl_private_key = "privkey.pem"</span><br></pre></td></tr></tbody></table></figure><br>
可以用OpenSSL工具生成自签名的证书，方法如下：<p></p>
<ol type="1">
<li><code>$ openssl genrsa -out privkey.pem 2048 #用于生成私钥</code></li>
<li>修改 OpenSSL.cnf 配置文件（最好不修改此目录下的文件，而是拷贝一份至你的生成证书的目录）</li>
<li>找到 [v3_ca] 在其下方加入并保存：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">subjectAltName = "IP:server的ip"</span><br><span class="line">basicConstraints = CA:FALSE</span><br><span class="line">keyUsage = digitalSignature, keyEncipherment</span><br></pre></td></tr></tbody></table></figure></li>
<li><code>$ openssl req -new -x509 -days 365 -key privkey.pem -out cert.pem -config openssl.cnf #用于生成证书</code><br>
有效期为 365 天，按照提示写入个人信息（国、省、市、机构、组织、server 的 ip、邮箱）。</li>
<li>cert.pem 的后缀改为 cer 就可以作为证书使用了。</li>
</ol>
<h2 id="网站gzip">网站 Gzip</h2>
<p>Gzip 开启以后会将输出到用户浏览器的数据进行压缩的处理，这样就会减小通过网络传输的数据量，提高浏览的速度。<br>
修改.conf 文件开启压缩功能。<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[/]</span><br><span class="line">tools.gzip.on: True</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="其他配置">其他配置</h2>
<p>也可以将某些字符串存入配置文件，供各种函数访问。<br>
修改.conf 文件。<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[abc]</span><br><span class="line">def = "ghi"</span><br></pre></td></tr></tbody></table></figure><br>
在函数中通过 <code>jklmn = cherrypy.request.app.config['abc']['def']</code> 调用，此时jklmn变量被赋值"ghi"，str类型。<p></p>
<h1 id="处理json">处理 JSON</h1>
<p>CherryPy 内置支持了对 JSON 编码的请求或响应的解码支持。</p>
<h2 id="解码-request">解码 request</h2>
<p>自动解码 JSON 请求的内容：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@cherrypy.expose</span></span><br><span class="line"><span class="meta">@cherrypy.tools.json_in()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">    data = cherrypy.request.json</span><br></pre></td></tr></tbody></table></figure><br>
附加在请求的JSON属性包含解码内容。<p></p>
<h2 id="编码response">编码 response</h2>
<p>使用 JSON 自动编码 response 的内容：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@cherrypy.expose</span></span><br><span class="line"><span class="meta">@cherrypy.tools.json_out()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> {<span class="string">'key'</span>: <span class="string">'value'</span>}</span><br></pre></td></tr></tbody></table></figure><br>
CherryPy将使用JSON对你的页面处理程序返回的任何内容进行编码，并非所有类型的对象都可以被编码。<p></p>
<h1 id="认证">认证</h1>
<p>CherryPy 提供了两种非常简单的身份验证机制。他们最常见的触发方式是触发浏览器弹出窗口向用户询问他们的名字和密码。</p>
<h2 id="basic">Basic</h2>
<p>Basic 身份验证是最简单的验证方式，但它不是一个安全的身份验证，因为用户的凭证被嵌入到请求中。不建议使用它，除非你在 SSL 或封闭的网络中运行。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> cherrypy.lib <span class="keyword">import</span> auth_basic</span><br><span class="line"></span><br><span class="line">USERS = {<span class="string">'id'</span>: <span class="string">'password'</span>}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_password</span>(<span class="params">realm, username, password</span>):</span></span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> USERS <span class="keyword">and</span> USERS[username] == password:</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">conf = {</span><br><span class="line">   <span class="string">'/protected/area'</span>: {</span><br><span class="line">       <span class="string">'tools.auth_basic.on'</span>: <span class="literal">True</span>,</span><br><span class="line">       <span class="string">'tools.auth_basic.realm'</span>: <span class="string">'localhost'</span>,</span><br><span class="line">       <span class="string">'tools.auth_basic.checkpassword'</span>: validate_password</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">cherrypy.quickstart(myapp, <span class="string">'/'</span>, conf)</span><br></pre></td></tr></tbody></table></figure><br>
必须提供一个将有CherryPy调用的函数，解码从请求中传递的用户名和密码。<br>
该功能可以从任何来源读取数据：文件，数据库，内存等。<p></p>
<h2 id="digest">Digest</h2>
<p>Digest 认证的不同之处在于，凭证没有携带在请求中，因此比 Basic 更安全。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> cherrypy.lib <span class="keyword">import</span> auth_digest</span><br><span class="line"></span><br><span class="line">USERS = {<span class="string">'id'</span>: <span class="string">'password'</span>}</span><br><span class="line"></span><br><span class="line">conf = {</span><br><span class="line">   <span class="string">'/protected/area'</span>: {</span><br><span class="line">        <span class="string">'tools.auth_digest.on'</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">'tools.auth_digest.realm'</span>: <span class="string">'localhost'</span>,</span><br><span class="line">        <span class="string">'tools.auth_digest.get_ha1'</span>: auth_digest.get_ha1_dict_plain(USERS),</span><br><span class="line">        <span class="string">'tools.auth_digest.key'</span>: <span class="string">'a565c27146791cfb'</span></span><br><span class="line">   }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">cherrypy.quickstart(myapp, <span class="string">'/'</span>, conf)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="网站图标">网站图标</h1>
<p>CherryPy 提供自己的红色 cherrypy 作为默认图标。可以用以下方式提供自己的图标：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">   @cherrypy.expose</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(HelloWorld(), <span class="string">'/'</span>,</span><br><span class="line">        {</span><br><span class="line">            <span class="string">'/favicon.ico'</span>:</span><br><span class="line">            {</span><br><span class="line">                <span class="string">'tools.staticfile.on'</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">'tools.staticfile.filename'</span>: <span class="string">'/path/to/myfavicon.ico'</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    )</span><br></pre></td></tr></tbody></table></figure><br>
也可以使用文件进行配置：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[/favicon.ico]</span><br><span class="line">tools.staticfile.on: True</span><br><span class="line">tools.staticfile.filename: "/path/to/myfavicon.ico"</span><br></pre></td></tr></tbody></table></figure><br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">   @cherrypy.expose</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(HelloWorld(), <span class="string">'/'</span>, app.conf)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="设置页面别名">设置页面别名</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cherrypy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringGenerator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @cherrypy.expose(<span class="params">[<span class="string">'generer'</span>, <span class="string">'generar'</span>]</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">self, length=<span class="number">8</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(random.sample(string.hexdigits, <span class="built_in">int</span>(length)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    cherrypy.quickstart(StringGenerator())</span><br></pre></td></tr></tbody></table></figure>
<p>其中 <code>@cherrypy.expose(['generer', 'generar'])</code> 设置了别名，所以下面三个页面效果是一样：/generate；/generer (French)；/generar (Spanish)</p>
<h1 id="请求超时">请求超时</h1>
<p>CherryPy 包含 3 个时间相关的属性：<br>
- response.time：当请求开始的时候，记录 time.time ()<br>
- response.timeout：请求可以运行的时间，默认 300s<br>
- response.timed_out：是否激活超时机制 (默认 False)</p>
<p>可以通过 response.check_timeout 来检查是否超时，在激活超时机制的情况下，一旦超时则触发 TimeoutError 异常。<br>
默认会通过 cherrypy.engine.timeout_monitor 监控所有请求是否超时，如果要关闭：<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[global]</span><br><span class="line">engine.timeout_monitor.on: False</span><br></pre></td></tr></tbody></table></figure><br>
或者<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cherrypy.engine.timeout_monitor.unsubscribe()</span><br></pre></td></tr></tbody></table></figure><br>
默认超时监控是1分钟1次，改成1小时1次：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[global]</span><br><span class="line">engine.timeout_monitor.frequency: 60 * 60</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="信号处理">信号处理</h1>
<p>对于信号处理，有一个 cherrypy.engine.signal_handler 插件，它是被 cherrypy.quickstart () 自动调用的。<br>
如果要手动进行信号处理，则可以调用 <code>tree.mount()</code> 或 <code>engine.start()</code> 或 <code>engine.block()</code>。<br>
记得启动引擎前调用 <code>engine.signals.subscribe()</code>。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Python</tag>
        <tag>Web Framework</tag>
      </tags>
  </entry>
  <entry>
    <title>主流视频网站弹幕下载</title>
    <url>/contents/%E4%B8%BB%E6%B5%81%E8%A7%86%E9%A2%91%E7%BD%91%E7%AB%99%E5%BC%B9%E5%B9%95%E4%B8%8B%E8%BD%BD.html</url>
    <content><![CDATA[<p>如今主流的视频网站（如 bilibili，腾讯，爱奇艺，优酷，芒果 TV 等）都支持了弹幕，本文介绍了如何下载视频弹幕（.xml）文件并转化为字幕（.ass）文件，支持本地播放。<br>
<span id="more"></span></p>
<h1 id="xml格式弹幕">XML 格式弹幕</h1>
<p>B 站是最早的一批弹幕网站之一，且比较成熟，弹幕可以直接以 XML 格式下载，非常方便，所以本文下载的弹幕均以 B 站的 XML 弹幕格式的简化为标准格式。</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">d</span> <span class="attr">p</span>=<span class="string">"5,1,20,16777215"</span>&gt;</span>这是一条弹幕<span class="tag">&lt;/<span class="name">d</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>每一条弹幕的属性 p 的格式为：</p>
<ol type="1">
<li>弹幕发送时间，相对于视频开始时间，以秒为单位</li>
<li>弹幕类型，1-3 为滚动弹幕、4 为底部、5 为顶端、6 为逆向、7 为精确、8 为高级</li>
<li>字体大小，25 为中，18 为小，Bilibili 只有这 2 个字号，本地 20 字号比较合适（电脑分辨率是 1920*1080）</li>
<li>弹幕颜色，RGB 颜色转为十进制后的值，16777215 为白色</li>
<li>弹幕发送时间，Unix 时间戳格式</li>
<li>弹幕池，0 为普通，1 为字幕，2 为特殊</li>
<li>发送人的 id</li>
<li> 弹幕 id</li>
</ol>
<p>一般只需要使用前 4 项即可。</p>
<p>Python 中利用 request 库来爬取网页结果：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_response</span>(<span class="params">url</span>):</span></span><br><span class="line">    req = urllib.request.Request(url)</span><br><span class="line">    req.add_header(<span class="string">'User-Agent'</span>, <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36'</span>)</span><br><span class="line">    response = urllib.request.urlopen(req).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>生成 XML 弹幕文件时需要检查是否有非法 XML 字符，并可以设置弹幕黑名单：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">filename = <span class="string">'XML/'</span> + title + <span class="string">'.xml'</span></span><br><span class="line">contents = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fout:</span><br><span class="line">    fout.write(<span class="string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n'</span>)</span><br><span class="line">    fout.write(<span class="string">'&lt;i&gt;\n'</span>)</span><br><span class="line">    illegal = <span class="literal">False</span> <span class="comment">#标志是否有非法XML字符</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> [<span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>, <span class="string">'&amp;'</span>, <span class="string">'\u0000'</span>, <span class="string">'\b'</span>]:</span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> j[<span class="string">'content'</span>]:</span><br><span class="line">            illegal = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> illegal:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    black_list = [<span class="string">''</span>] <span class="comment">#列出弹幕黑名单</span></span><br><span class="line">    <span class="keyword">if</span> content <span class="keyword">not</span> <span class="keyword">in</span> contents <span class="keyword">and</span> <span class="built_in">all</span>(word <span class="keyword">not</span> <span class="keyword">in</span> content <span class="keyword">for</span> word <span class="keyword">in</span> black_list):</span><br><span class="line">        contents.append(content)</span><br><span class="line">        fout.write(<span class="string">'&lt;d p="'</span> + <span class="built_in">str</span>(timepoint) + <span class="string">','</span> + <span class="built_in">str</span>(ct) +<span class="string">','</span> + <span class="built_in">str</span>(size) + <span class="string">','</span> + <span class="built_in">str</span>(color) + <span class="string">'"&gt;'</span> + content + <span class="string">'&lt;/d&gt;\n'</span>)</span><br><span class="line">    fout.write(<span class="string">'&lt;/i&gt;'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>网上很多相关工具（如<a href="https://tiansh.github.io/us-danmaku/bilibili/">弹幕 ASS 转换工具</a>等）可以将 XML 弹幕文件转换成 ASS 字幕文件。<br>
基于弹幕 ASS 转换工具个性化设置：<br>
</p><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 设置项，适合视频2倍速播放</span></span><br><span class="line"><span class="keyword">var</span> config = {</span><br><span class="line">  <span class="string">'playResX'</span>: <span class="number">1440</span>,          <span class="comment">// 屏幕分辨率宽（像素）</span></span><br><span class="line">  <span class="string">'playResY'</span>: <span class="number">810</span>,           <span class="comment">// 屏幕分辨率高（像素）</span></span><br><span class="line">  <span class="string">'fontlist'</span>: [              <span class="comment">// 字形（会自动选择最前面一个可用的）</span></span><br><span class="line">    <span class="string">'黑体'</span>,</span><br><span class="line">    <span class="string">'Microsoft YaHei UI'</span>,</span><br><span class="line">    <span class="string">'Microsoft YaHei'</span>,</span><br><span class="line">    <span class="string">'文泉驿正黑'</span>,</span><br><span class="line">    <span class="string">'STHeitiSC'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">'font_size'</span>: <span class="number">1.2</span>,          <span class="comment">// 字号（比例）</span></span><br><span class="line">  <span class="string">'r2ltime'</span>: <span class="number">20</span>,             <span class="comment">// 右到左弹幕持续时间（秒）</span></span><br><span class="line">  <span class="string">'fixtime'</span>: <span class="number">5</span>,              <span class="comment">// 固定弹幕持续时间（秒）</span></span><br><span class="line">  <span class="string">'opacity'</span>: <span class="number">0.8</span>,            <span class="comment">// 不透明度（比例）</span></span><br><span class="line">  <span class="string">'space'</span>: <span class="number">0</span>,                <span class="comment">// 弹幕间隔的最小水平距离（像素）</span></span><br><span class="line">  <span class="string">'max_delay'</span>: <span class="number">6</span>,            <span class="comment">// 最多允许延迟几秒出现弹幕</span></span><br><span class="line">  <span class="string">'bottom'</span>: <span class="number">0</span>,               <span class="comment">// 底端给字幕保留的空间（像素）</span></span><br><span class="line">  <span class="string">'use_canvas'</span>: <span class="literal">true</span>,        <span class="comment">// 是否使用canvas计算文本宽度（布尔值，Linux下的火狐默认否，其他默认是，Firefox bug #561361）</span></span><br><span class="line">  <span class="string">'debug'</span>: <span class="literal">false</span>,            <span class="comment">// 打印调试信息</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="腾讯视频弹幕下载">腾讯视频弹幕下载</h1>
<p>打开一个腾讯视频 PC 网页端，其源码中的 VIDEO_INFO 字段：<br>
</p><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> VIDEO_INFO = {</span><br><span class="line">    <span class="string">"publish_date"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"leading_actor_id"</span>: [<span class="string">""</span>],</span><br><span class="line">    <span class="string">"duration"</span>: ,</span><br><span class="line">    <span class="string">"guests"</span>: ,</span><br><span class="line">    <span class="string">"race_teams_id"</span>: ,</span><br><span class="line">    <span class="string">"type_name"</span>: ,</span><br><span class="line">    <span class="string">"tag"</span>: [</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"singer_id"</span>: ,</span><br><span class="line">    <span class="string">"episode"</span>: ,</span><br><span class="line">    <span class="string">"race_stars_id"</span>: ,</span><br><span class="line">    <span class="string">"srcsite_name"</span>: ,</span><br><span class="line">    <span class="string">"type"</span>: ,</span><br><span class="line">    <span class="string">"title"</span>: ,</span><br><span class="line">    <span class="string">"leading_actor"</span>: [<span class="string">""</span>],</span><br><span class="line">    <span class="string">"show_type"</span>: ,</span><br><span class="line">    <span class="string">"singer_name"</span>: ,</span><br><span class="line">    <span class="string">"danmu_status"</span>: ,</span><br><span class="line">    <span class="string">"second_title"</span>: ,</span><br><span class="line">    <span class="string">"positive_trailer"</span>: ,</span><br><span class="line">    <span class="string">"athlete"</span>: ,</span><br><span class="line">    <span class="string">"mv_stars"</span>: ,</span><br><span class="line">    <span class="string">"trytime_second"</span>: ,</span><br><span class="line">    <span class="string">"c_full"</span>: ,</span><br><span class="line">    <span class="string">"update_flag"</span>: ,</span><br><span class="line">    <span class="string">"first_recommand"</span>: ,</span><br><span class="line">    <span class="string">"desc"</span>: ,</span><br><span class="line">    <span class="string">"pioneer_tag"</span>: ,</span><br><span class="line">    <span class="string">"begin_time"</span>: ,</span><br><span class="line">    <span class="string">"upload_qq"</span>: ,</span><br><span class="line">    <span class="string">"category_map"</span>: [, <span class="string">""</span>],</span><br><span class="line">    <span class="string">"is_trailer"</span>: ,</span><br><span class="line">    <span class="string">"stars_name"</span>: ,</span><br><span class="line">    <span class="string">"pic_640_360"</span>: ,</span><br><span class="line">    <span class="string">"c_title_segment"</span>: ,</span><br><span class="line">    <span class="string">"guests_id"</span>: ,</span><br><span class="line">    <span class="string">"presenter_id"</span>: ,</span><br><span class="line">    <span class="string">"upload_src"</span>: ,</span><br><span class="line">    <span class="string">"athlete_id"</span>: ,</span><br><span class="line">    <span class="string">"sec_recommand"</span>: ,</span><br><span class="line">    <span class="string">"costar_id"</span>: ,</span><br><span class="line">    <span class="string">"relative_stars_id"</span>: ,</span><br><span class="line">    <span class="string">"relative_stars"</span>: ,</span><br><span class="line">    <span class="string">"drm"</span>: ,</span><br><span class="line">    <span class="string">"modify_time"</span>: ,</span><br><span class="line">    <span class="string">"tail_time"</span>: ,</span><br><span class="line">    <span class="string">"valid_tag_id"</span>: ,</span><br><span class="line">    <span class="string">"vid"</span>: ,</span><br><span class="line">    <span class="string">"pic_url"</span>: ,</span><br><span class="line">    <span class="string">"costar"</span>: ,</span><br><span class="line">    <span class="string">"race_teams_name"</span>: ,</span><br><span class="line">    <span class="string">"c_title_output"</span>: ,</span><br><span class="line">    <span class="string">"director_id"</span>: [<span class="string">""</span>],</span><br><span class="line">    <span class="string">"title_en"</span>: ,</span><br><span class="line">    <span class="string">"stars"</span>: ,</span><br><span class="line">    <span class="string">"danmu"</span>: ,</span><br><span class="line">    <span class="string">"mv_stars_id"</span>: ,</span><br><span class="line">    <span class="string">"playright"</span>: [<span class="string">""</span>],</span><br><span class="line">    <span class="string">"presenter"</span>: ,</span><br><span class="line">    <span class="string">"race_stars"</span>: ,</span><br><span class="line">    <span class="string">"view_all_count"</span>: ,</span><br><span class="line">    <span class="string">"c_tags_flag"</span>: ,</span><br><span class="line">    <span class="string">"c_has_adv_danmu"</span>: ,</span><br><span class="line">    <span class="string">"head_time"</span>: ,</span><br><span class="line">    <span class="string">"state"</span>: ,</span><br><span class="line">    <span class="string">"copyright_id"</span>: ,</span><br><span class="line">    <span class="string">"pic160x90"</span>: ,</span><br><span class="line">    <span class="string">"director"</span>: [<span class="string">""</span>],</span><br><span class="line">    <span class="string">"famous_id"</span>: ,</span><br><span class="line">    <span class="string">"pioneer_tag_ids"</span>: ,</span><br><span class="line">    <span class="string">"trytime"</span>: ,</span><br><span class="line">    <span class="string">"famous_actor"</span>: ,</span><br><span class="line">    <span class="string">"video_checkup_time"</span>: ,</span><br><span class="line">    <span class="string">""</span>: ,</span><br><span class="line">    <span class="string">"isFull"</span>: </span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><br>
其中所需的字段是duration、title、vid。<br>
接下来通过vid找到targetid：<code>http://bullet.video.qq.com/fcgi-bin/target/regist?otype=json&amp;vid=(%vid%)</code>，打开此链接得到：<br>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line">QZOutputJson = {</span><br><span class="line">    <span class="string">"danmukey"</span>:<span class="string">"bubble_flag=&amp;targetid=&amp;vid=&amp;type="</span>,</span><br><span class="line">    <span class="string">"display"</span>:,</span><br><span class="line">    <span class="string">"is_has_adv"</span>:,</span><br><span class="line">    <span class="string">"is_has_bubble"</span>:,</span><br><span class="line">    <span class="string">"open"</span>:,</span><br><span class="line">    <span class="string">"returncode"</span>:,</span><br><span class="line">    <span class="string">"returnmsg"</span>:,</span><br><span class="line">    <span class="string">"targetid"</span>:,</span><br><span class="line">    <span class="string">"userstatus"</span>:</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>
然后就可以通过targetid得到弹幕：<code>http://mfm.video.qq.com/danmu?timestamp=(%timestamp%)&amp;target_id=(%targetid%)</code>，其中timestamp从0开始并且以30为增量，打开此链接得到（只截取了第一条弹幕）：<br>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"err_code"</span>:,</span><br><span class="line">    <span class="attr">"err_msg"</span>:,</span><br><span class="line">    <span class="attr">"peroid"</span>:,</span><br><span class="line">    <span class="attr">"target_id"</span>:,</span><br><span class="line">    <span class="attr">"count"</span>:,</span><br><span class="line">    <span class="attr">"tol_up"</span>:,</span><br><span class="line">    <span class="attr">"single_max_count"</span>:,</span><br><span class="line">    <span class="attr">"session_key"</span>:,</span><br><span class="line">    <span class="attr">"comments"</span>:[</span><br><span class="line">        {</span><br><span class="line">            <span class="attr">"commentid"</span>:,</span><br><span class="line">            <span class="attr">"content"</span>:,</span><br><span class="line">            <span class="attr">"upcount"</span>:,</span><br><span class="line">            <span class="attr">"isfriend"</span>:,</span><br><span class="line">            <span class="attr">"isop"</span>:,</span><br><span class="line">            <span class="attr">"isself"</span>:,</span><br><span class="line">            <span class="attr">"timepoint"</span>:,</span><br><span class="line">            <span class="attr">"headurl"</span>:,</span><br><span class="line">            <span class="attr">"opername"</span>:,</span><br><span class="line">            <span class="attr">"bb_bcolor"</span>:,</span><br><span class="line">            <span class="attr">"bb_head"</span>:,</span><br><span class="line">            <span class="attr">"bb_level"</span>:,</span><br><span class="line">            <span class="attr">"bb_id"</span>:,</span><br><span class="line">            <span class="attr">"rich_type"</span>:,</span><br><span class="line">            <span class="attr">"uservip_degree"</span>:,</span><br><span class="line">            <span class="attr">"content_style"</span>: <span class="string">"{\"color\":\"\",\"position\":}"</span></span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>
其中timepoint、content_style中的color、content字段可以组成xml弹幕格式。<br>
全部python代码为：<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHTMLText</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.get(url, timeout=<span class="number">30</span>)</span><br><span class="line">        r.raise_for_status()</span><br><span class="line">        r.encoding=<span class="string">'utf-8'</span></span><br><span class="line">        <span class="keyword">return</span> r.text</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_tencent_danmu</span>(<span class="params">url</span>):</span></span><br><span class="line">    video_info = json.loads(<span class="built_in">str</span>([s <span class="keyword">for</span> s <span class="keyword">in</span> getHTMLText(url).split(<span class="string">'\n'</span>) <span class="keyword">if</span> <span class="string">'VIDEO_INFO'</span> <span class="keyword">in</span> <span class="built_in">str</span>(s)]).strip(<span class="string">'[\'var VIDEO_INFO = '</span>).strip(<span class="string">'\']'</span>))</span><br><span class="line">    duration = video_info[<span class="string">'duration'</span>]</span><br><span class="line">    title = video_info[<span class="string">'title'</span>]</span><br><span class="line">    vid = video_info[<span class="string">'vid'</span>]</span><br><span class="line">    targetid = json.loads(getHTMLText(<span class="string">'http://bullet.video.qq.com/fcgi-bin/target/regist?otype=json&amp;vid='</span> + vid).strip(<span class="string">'QZOutputJson='</span>).strip(<span class="string">';'</span>))[<span class="string">'targetid'</span>]</span><br><span class="line">    filename = <span class="string">'XML/'</span> + title + <span class="string">'.xml'</span></span><br><span class="line">    contents = []</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'\n'</span> + title + <span class="string">': '</span>, end=<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fout:</span><br><span class="line">        fout.write(<span class="string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n'</span>)</span><br><span class="line">        fout.write(<span class="string">'&lt;i&gt;\n'</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(duration) // <span class="number">30</span> + <span class="number">1</span>):</span><br><span class="line">            timestamp = i*<span class="number">30</span></span><br><span class="line">            <span class="built_in">print</span>(i/<span class="number">2</span>, end=<span class="string">'min, '</span>)</span><br><span class="line">            response = getHTMLText(<span class="string">'http://mfm.video.qq.com/danmu?timestamp='</span> + <span class="built_in">str</span>(timestamp) + <span class="string">'&amp;target_id='</span> + targetid)</span><br><span class="line">            <span class="keyword">if</span> response == <span class="string">''</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                danmu = json.loads(response, strict=<span class="literal">False</span>)</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> danmu[<span class="string">'comments'</span>]:</span><br><span class="line">                    illegal = <span class="literal">False</span> <span class="comment">#标志是否有非法XML字符</span></span><br><span class="line">                    <span class="keyword">for</span> char <span class="keyword">in</span> [<span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>, <span class="string">'&amp;'</span>, <span class="string">'\u0000'</span>, <span class="string">'\b'</span>]:</span><br><span class="line">                        <span class="keyword">if</span> char <span class="keyword">in</span> j[<span class="string">'content'</span>]:</span><br><span class="line">                            illegal = <span class="literal">True</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">if</span> illegal:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    timepoint = j[<span class="string">'timepoint'</span>]  <span class="comment">#弹幕发送时间</span></span><br><span class="line">                    ct = <span class="number">1</span>              <span class="comment">#弹幕样式</span></span><br><span class="line">                    size = <span class="number">20</span>           <span class="comment">#字体大小</span></span><br><span class="line">                    <span class="comment"># 获取颜色</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="string">'color'</span> <span class="keyword">in</span> j[<span class="string">'content_style'</span>]:</span><br><span class="line">                        content_style = json.loads(j[<span class="string">'content_style'</span>])</span><br><span class="line">                        color = <span class="built_in">int</span>(content_style[<span class="string">'color'</span>], <span class="number">16</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        color = <span class="number">16777215</span></span><br><span class="line">                    content = j[<span class="string">'content'</span>] <span class="comment">#弹幕内容</span></span><br><span class="line">                    black_list = [<span class="string">'word'</span>]</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">':'</span> <span class="keyword">in</span> content:</span><br><span class="line">                        content = content.split(<span class="string">':'</span>)[<span class="number">1</span>].strip(<span class="string">'&nbsp;'</span>).strip(<span class="string">' '</span>)</span><br><span class="line">                    <span class="keyword">if</span> content <span class="keyword">not</span> <span class="keyword">in</span> contents <span class="keyword">and</span> <span class="built_in">all</span>(word <span class="keyword">not</span> <span class="keyword">in</span> content <span class="keyword">for</span> word <span class="keyword">in</span> black_list):</span><br><span class="line">                        contents.append(content.strip(<span class="string">' '</span>).strip(<span class="string">'&nbsp;'</span>))</span><br><span class="line">                        fout.write(<span class="string">'&lt;d p="'</span> + <span class="built_in">str</span>(timepoint) + <span class="string">','</span> + <span class="built_in">str</span>(ct) +<span class="string">','</span> + <span class="built_in">str</span>(size) + <span class="string">','</span> + <span class="built_in">str</span>(color) + <span class="string">'"&gt;'</span> + content + <span class="string">'&lt;/d&gt;\n'</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        fout.write(<span class="string">'&lt;/i&gt;'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="爱奇艺视频弹幕下载">爱奇艺视频弹幕下载</h1>
<p>打开一个爱奇艺视频 PC 网页端，其源码中的 page-info 字段：<br>
</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"albumId"</span>:,</span><br><span class="line">    <span class="attr">"albumName"</span>:,</span><br><span class="line">    <span class="attr">"imageUrl"</span>:,</span><br><span class="line">    <span class="attr">"tvId"</span>:,</span><br><span class="line">    <span class="attr">"vid"</span>:,</span><br><span class="line">    <span class="attr">"cid"</span>:,</span><br><span class="line">    <span class="attr">"isSource"</span>:,</span><br><span class="line">    <span class="attr">"contentType"</span>:,</span><br><span class="line">    <span class="attr">"vType"</span>:,</span><br><span class="line">    <span class="attr">"pType"</span>:,</span><br><span class="line">    <span class="attr">"pageNo"</span>:,</span><br><span class="line">    <span class="attr">"pageType"</span>:,</span><br><span class="line">    <span class="attr">"userId"</span>:,</span><br><span class="line">    <span class="attr">"pageUrl"</span>:,</span><br><span class="line">    <span class="attr">"tvName"</span>:,</span><br><span class="line">    <span class="attr">"isfeizhengpian"</span>:,</span><br><span class="line">    <span class="attr">"categoryName"</span>:,</span><br><span class="line">    <span class="attr">"categories"</span>:,</span><br><span class="line">    <span class="attr">"downloadAllowed"</span>:,</span><br><span class="line">    <span class="attr">"publicLevel"</span>:,</span><br><span class="line">    <span class="attr">"payMark"</span>:,</span><br><span class="line">    <span class="attr">"payMarkUrl"</span>:,</span><br><span class="line">    <span class="attr">"vipType"</span>:[</span><br><span class="line">        </span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"qiyiProduced"</span>:,</span><br><span class="line">    <span class="attr">"exclusive"</span>:,</span><br><span class="line">    <span class="attr">"tvYear"</span>:,</span><br><span class="line">    <span class="attr">"duration"</span>:<span class="string">"::"</span>,</span><br><span class="line">    <span class="attr">"wallId"</span>:,</span><br><span class="line">    <span class="attr">"rewardAllowed"</span>:,</span><br><span class="line">    <span class="attr">"commentAllowed"</span>:,</span><br><span class="line">    <span class="attr">"heatShowTypes"</span>:,</span><br><span class="line">    <span class="attr">"videoTemplate"</span>:,</span><br><span class="line">    <span class="attr">"issueTime"</span>:</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>
其中所需的字段是duration、tvName、albumId、tvId、cid。<br>
duration由‘时：分：秒’格式转为秒：<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">duration_str = page_info[<span class="string">'duration'</span>].split(<span class="string">':'</span>)</span><br><span class="line">duration = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(duration_str)-<span class="number">1</span>):</span><br><span class="line">    duration = (duration + <span class="built_in">int</span>(duration_str[i])) * <span class="number">60</span></span><br><span class="line">duration = duration + <span class="built_in">int</span>(duration_str[-<span class="number">1</span>])</span><br></pre></td></tr></tbody></table></figure><br>
然后就可以通过albumId、tvId、cid得到弹幕：<code>http://cmts.iqiyi.com/bullet/(%tvId[-4:-2]%)/(%tvId[-2:]%)/(%tvId%)_300_(%page%).z?rn=0.(%16位随机数%)&amp;business=danmu&amp;is_iqiyi=true&amp;is_video_page=true&amp;tvid=(%tvid%)&amp;albumid=(%albumid%)&amp;categoryid=(%cid%)&amp;qypid=01010021010000000000</code>，其中tvId需要分割出倒数4-3位和倒数2-1位，page从1开始并且以1为增量，打开此链接得到(%tvId%)_300_(%page%).z的文件，这个文件是压缩的字节流需要解压。<br>
Python中利用zlib库，<code>dec = zlib.decompressobj(32 + zlib.MAX_WBITS)</code> 和 <code>b = dec.decompress('z文件').decode("utf-8")</code> 得到XML格式的弹幕（只截取了第一条弹幕）：<br>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">danmu</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">data</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">int</span>&gt;</span><span class="tag">&lt;/<span class="name">int</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">list</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">bulletInfo</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">contentId</span>&gt;</span><span class="tag">&lt;/<span class="name">contentId</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">content</span>&gt;</span><span class="tag">&lt;/<span class="name">content</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">showTime</span>&gt;</span>1<span class="tag">&lt;/<span class="name">showTime</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">font</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">color</span>&gt;</span><span class="tag">&lt;/<span class="name">color</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">opacity</span>&gt;</span><span class="tag">&lt;/<span class="name">opacity</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">position</span>&gt;</span><span class="tag">&lt;/<span class="name">position</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">background</span>&gt;</span><span class="tag">&lt;/<span class="name">background</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">contentType</span>&gt;</span><span class="tag">&lt;/<span class="name">contentType</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">isReply</span>&gt;</span><span class="tag">&lt;/<span class="name">isReply</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">likeCount</span>&gt;</span><span class="tag">&lt;/<span class="name">likeCount</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">plusCount</span>&gt;</span><span class="tag">&lt;/<span class="name">plusCount</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">dissCount</span>&gt;</span><span class="tag">&lt;/<span class="name">dissCount</span>&gt;</span>  </span><br><span class="line">          <span class="tag">&lt;<span class="name">userInfo</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">senderAvatar</span>&gt;</span><span class="tag">&lt;/<span class="name">senderAvatar</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">uid</span>&gt;</span><span class="tag">&lt;/<span class="name">uid</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">udid</span>&gt;</span><span class="tag">&lt;/<span class="name">udid</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;/<span class="name">userInfo</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">bulletInfo</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">list</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">entry</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">data</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">sum</span>&gt;</span><span class="tag">&lt;/<span class="name">sum</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">validSum</span>&gt;</span><span class="tag">&lt;/<span class="name">validSum</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">duration</span>&gt;</span><span class="tag">&lt;/<span class="name">duration</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">ts</span>&gt;</span><span class="tag">&lt;/<span class="name">ts</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">danmu</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><br>
其中showTime、color、content字段可以组成xml弹幕格式（color需要从16进制转换成10进制）。<br>
全部python代码为：<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHTMLText</span>(<span class="params">url, encode</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.get(url, timeout=<span class="number">30</span>)</span><br><span class="line">        r.raise_for_status()</span><br><span class="line">        <span class="keyword">if</span> encode == <span class="string">'utf-8'</span>:</span><br><span class="line">            r.encoding=<span class="string">'utf-8'</span></span><br><span class="line">            <span class="keyword">return</span> r.text</span><br><span class="line">        <span class="keyword">elif</span> encode == <span class="string">'byte'</span>:</span><br><span class="line">            <span class="keyword">return</span> r.content</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_iqiyi_danmu</span>(<span class="params">url</span>):</span></span><br><span class="line">    page_info = json.loads(re.search(<span class="string">r'page-info=\'(.*)\'( *):video-info'</span>, getHTMLText(url, <span class="string">'utf-8'</span>)).group(<span class="number">1</span>))</span><br><span class="line">    duration_str = page_info[<span class="string">'duration'</span>].split(<span class="string">':'</span>)</span><br><span class="line">    duration = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(duration_str)-<span class="number">1</span>):</span><br><span class="line">        duration = (duration + <span class="built_in">int</span>(duration_str[i])) * <span class="number">60</span></span><br><span class="line">    duration = duration + <span class="built_in">int</span>(duration_str[-<span class="number">1</span>])</span><br><span class="line">    title = page_info[<span class="string">'tvName'</span>]</span><br><span class="line">    albumid = page_info[<span class="string">'albumId'</span>]</span><br><span class="line">    tvid = page_info[<span class="string">'tvId'</span>]</span><br><span class="line">    categoryid = page_info[<span class="string">'cid'</span>]</span><br><span class="line">    page = duration // (<span class="number">60</span> * <span class="number">5</span>) + <span class="number">1</span></span><br><span class="line">    filename = <span class="string">'XML/'</span> + title + <span class="string">'.xml'</span></span><br><span class="line">    contents = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fout:</span><br><span class="line">        fout.write(<span class="string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n'</span>)</span><br><span class="line">        fout.write(<span class="string">'&lt;i&gt;\n'</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(duration // (<span class="number">60</span> * <span class="number">5</span>) + <span class="number">1</span>):</span><br><span class="line">            dec = zlib.decompressobj(<span class="number">32</span> + zlib.MAX_WBITS)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                b = dec.decompress(getHTMLText(<span class="string">'http://cmts.iqiyi.com/bullet/'</span> + <span class="built_in">str</span>(tvid)[-<span class="number">4</span>:-<span class="number">2</span>] + <span class="string">'/'</span> + <span class="built_in">str</span>(tvid)[-<span class="number">2</span>:] + <span class="string">'/'</span> + <span class="built_in">str</span>(tvid) + <span class="string">'_300_'</span> + <span class="built_in">str</span>(i+<span class="number">1</span>) + <span class="string">'.z?rn=0.'</span> + <span class="string">''</span>.join([<span class="string">'%s'</span> % randint(<span class="number">0</span>, <span class="number">9</span>) <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>)]) + <span class="string">'&amp;business=danmu&amp;is_iqiyi=true&amp;is_video_page=true&amp;tvid='</span> + <span class="built_in">str</span>(tvid) + <span class="string">'&amp;albumid='</span> + <span class="built_in">str</span>(albumid) + <span class="string">'&amp;categoryid='</span> + <span class="built_in">str</span>(categoryid) + <span class="string">'&amp;qypid=01010021010000000000'</span>, <span class="string">'byte'</span>))</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">'page: '</span> + <span class="built_in">str</span>(i))</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">print</span>(<span class="string">'page not found: '</span> + <span class="built_in">str</span>(i)))</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                root = ET.fromstring(b.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(e)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> bulletInfo <span class="keyword">in</span> root.<span class="built_in">iter</span>(<span class="string">'bulletInfo'</span>):</span><br><span class="line">                timepoint = bulletInfo[<span class="number">3</span>].text      <span class="comment">#弹幕发送时间</span></span><br><span class="line">                ct = <span class="number">1</span>                              <span class="comment">#弹幕样式</span></span><br><span class="line">                size = <span class="number">20</span>                           <span class="comment">#字体大小</span></span><br><span class="line">                color = <span class="built_in">int</span>(bulletInfo[<span class="number">5</span>].text, <span class="number">16</span>) <span class="comment">#颜色</span></span><br><span class="line">                content = bulletInfo[<span class="number">1</span>].text        <span class="comment">#弹幕内容</span></span><br><span class="line">                black_list = [<span class="string">'word'</span>]</span><br><span class="line">                <span class="keyword">if</span> content <span class="keyword">not</span> <span class="keyword">in</span> contents <span class="keyword">and</span> <span class="built_in">all</span>(word <span class="keyword">not</span> <span class="keyword">in</span> content <span class="keyword">for</span> word <span class="keyword">in</span> black_list):</span><br><span class="line">                    contents.append(content)</span><br><span class="line">                    fout.write(<span class="string">'&lt;d p="'</span> + <span class="built_in">str</span>(timepoint) + <span class="string">','</span> + <span class="built_in">str</span>(ct) +<span class="string">','</span> + <span class="built_in">str</span>(size) + <span class="string">','</span> + <span class="built_in">str</span>(color) + <span class="string">'"&gt;'</span> + content + <span class="string">'&lt;/d&gt;\n'</span>)</span><br><span class="line">        fout.write(<span class="string">'&lt;/i&gt;'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="优酷视频弹幕下载">优酷视频弹幕下载</h1>
<p>打开一个优酷视频 PC 网页端，其源码中的 window.PageConfig 字段：<br>
</p><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.PageConfig = {</span><br><span class="line">    <span class="attr">transfer_mode</span>: ,</span><br><span class="line">    isDRM: ,</span><br><span class="line">    videoCategoryId: ,</span><br><span class="line">    isSimple: ,</span><br><span class="line">    videoId: ,</span><br><span class="line">    newVersion: ,</span><br><span class="line">    isDebug: ,</span><br><span class="line">    pid: ,</span><br><span class="line">    homeHost: ,</span><br><span class="line">    youku_homeurl: ,</span><br><span class="line">    catId: ,</span><br><span class="line">    playmode: ,</span><br><span class="line">    videoOwner: ,</span><br><span class="line">    videoOwner_en: ,</span><br><span class="line">    videoId2: ,</span><br><span class="line">    currentEncodeVid: ,</span><br><span class="line">    catName: ,</span><br><span class="line">    seconds: ,</span><br><span class="line">    bullet: ,</span><br><span class="line">    transfer: ,</span><br><span class="line">    panorama: ,</span><br><span class="line">    folderId: ,</span><br><span class="line">    fpos: ,</span><br><span class="line">    forder: ,</span><br><span class="line">    ftotalpos: ,</span><br><span class="line">    showid_en: ,</span><br><span class="line">    showid: ,</span><br><span class="line">    cp: ,</span><br><span class="line">    paid: ,</span><br><span class="line">    showtype: ,</span><br><span class="line">    tabs: ,</span><br><span class="line">    singerId: ,</span><br><span class="line">    loadinglogo: ,</span><br><span class="line">    lottery_open_sidetool: ,</span><br><span class="line">    lottery_id_sidetool: ,</span><br><span class="line">    lottery_sidetool: ,</span><br><span class="line">    page: {</span><br><span class="line">        <span class="attr">type</span>: ,</span><br><span class="line">        isdatetype: ,</span><br><span class="line">        year: ,</span><br><span class="line">        firstMon: ,</span><br><span class="line">        lastMon: ,</span><br><span class="line">        currMon: ,</span><br><span class="line">        episodeLast: ,</span><br><span class="line">        parentvideoid: ,</span><br><span class="line">        compeleted:</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">copytoclip</span>: ,</span><br><span class="line">    playerUrl: </span><br><span class="line">};</span><br><span class="line"><span class="keyword">var</span> str = <span class="string">"&amp;ct=c&amp;cs=&amp;td=&amp;s=&amp;v=&amp;u=&amp;paid=&amp;tt="</span>;</span><br></pre></td></tr></tbody></table></figure><br>
其中所需的字段是seconds、tt、videoId。<br>
然后就可以通过videoId得到弹幕：<code>https://service.danmu.youku.com/list?mat=(%mat%)&amp;ct=1001&amp;iid=(%videoId%)</code>，其中mat从0开始并且以1为增量，打开此链接得到（只截取了第一条弹幕）：<br>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"count"</span>: ,</span><br><span class="line">    <span class="attr">"filtered"</span>: ,</span><br><span class="line">    <span class="attr">"result"</span>: [{</span><br><span class="line">        <span class="attr">"aid"</span>: ,</span><br><span class="line">        <span class="attr">"content"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"createtime"</span>: ,</span><br><span class="line">        <span class="attr">"ct"</span>: ,</span><br><span class="line">        <span class="attr">"extFields"</span>: {</span><br><span class="line">            <span class="attr">"voteUp"</span>: </span><br><span class="line">        },</span><br><span class="line">        <span class="attr">"id"</span>: ,</span><br><span class="line">        <span class="attr">"iid"</span>: ,</span><br><span class="line">        <span class="attr">"ipaddr"</span>: ,</span><br><span class="line">        <span class="attr">"level"</span>: ,</span><br><span class="line">        <span class="attr">"lid"</span>: ,</span><br><span class="line">        <span class="attr">"mat"</span>: ,</span><br><span class="line">        <span class="attr">"ouid"</span>: ,</span><br><span class="line">        <span class="attr">"playat"</span>: ,</span><br><span class="line">        <span class="attr">"propertis"</span>: <span class="string">"{\"pos\":,\"size\":,\"effect\":,\"color\":,\"dmfid\":}"</span>,</span><br><span class="line">        <span class="attr">"status"</span>: ,</span><br><span class="line">        <span class="attr">"type"</span>: ,</span><br><span class="line">        <span class="attr">"uid"</span>: ,</span><br><span class="line">        <span class="attr">"ver"</span>: </span><br><span class="line">    }],</span><br><span class="line">    <span class="attr">"scm"</span>: <span class="string">"0"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>
其中playat、propertis中的color、content字段可以组成xml弹幕格式。<br>
全部python代码为：<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_response</span>(<span class="params">url</span>):</span></span><br><span class="line">    req = urllib.request.Request(url)</span><br><span class="line">    req.add_header(<span class="string">'User-Agent'</span>, <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36'</span>)</span><br><span class="line">    response = urllib.request.urlopen(req).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_youku_danmu</span>(<span class="params">url</span>):</span></span><br><span class="line">    res = get_response(url)</span><br><span class="line">    title = re.search(<span class="string">r'&lt;title&gt;(.*)&lt;/title&gt;'</span>, res).group(<span class="number">1</span>).split(<span class="string">'—'</span>)[<span class="number">0</span>]</span><br><span class="line">    iid = re.search(<span class="string">r'videoId: \'(\d*)\''</span>, res).group(<span class="number">1</span>)</span><br><span class="line">    duration = <span class="built_in">float</span>(re.search(<span class="string">r'seconds: \'(.*)\','</span>, res).group(<span class="number">1</span>))</span><br><span class="line">    filename = <span class="string">'XML/'</span> + title.split(<span class="string">'集 '</span>)[<span class="number">0</span>] + <span class="string">'.xml'</span></span><br><span class="line">    contents = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fout:</span><br><span class="line">        fout.write(<span class="string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n'</span>)</span><br><span class="line">        fout.write(<span class="string">'&lt;i&gt;\n'</span>)</span><br><span class="line">        <span class="keyword">for</span> mat <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(duration) // <span class="number">60</span> + <span class="number">1</span>):</span><br><span class="line">            response = get_response(<span class="string">'https://service.danmu.youku.com/list?mat='</span> + <span class="built_in">str</span>(mat) + <span class="string">'&amp;ct=1001&amp;iid='</span> + iid)</span><br><span class="line">            danmu = json.loads(response)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(mat) + <span class="string">'\tresult:'</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(danmu[<span class="string">'result'</span>])))</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(danmu[<span class="string">'result'</span>])):</span><br><span class="line">                illegal = <span class="literal">False</span> <span class="comment">#标志是否有非法XML字符</span></span><br><span class="line">                <span class="keyword">for</span> char <span class="keyword">in</span> [<span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>, <span class="string">'&amp;'</span>, <span class="string">'\u0000'</span>, <span class="string">'\b'</span>]:</span><br><span class="line">                    <span class="keyword">if</span> char <span class="keyword">in</span> danmu[<span class="string">'result'</span>][i][<span class="string">'content'</span>]:</span><br><span class="line">                        illegal = <span class="literal">True</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> illegal:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                playat = danmu[<span class="string">'result'</span>][i][<span class="string">'playat'</span>]/<span class="number">1000</span>  <span class="comment">#弹幕发送时间</span></span><br><span class="line">                ct = <span class="number">1</span>      <span class="comment">#弹幕样式</span></span><br><span class="line">                size = <span class="number">20</span>   <span class="comment">#字体大小</span></span><br><span class="line">                <span class="comment"># 获取颜色</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">'color'</span> <span class="keyword">in</span> danmu[<span class="string">'result'</span>][i][<span class="string">'propertis'</span>]:</span><br><span class="line">                    propertis = json.loads(danmu[<span class="string">'result'</span>][i][<span class="string">'propertis'</span>])</span><br><span class="line">                    color = propertis[<span class="string">'color'</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    color = <span class="number">16777215</span></span><br><span class="line">                content = danmu[<span class="string">'result'</span>][i][<span class="string">'content'</span>] <span class="comment">#弹幕内容</span></span><br><span class="line">                black_list = [<span class="string">'word'</span>]</span><br><span class="line">                <span class="keyword">if</span> content <span class="keyword">not</span> <span class="keyword">in</span> contents <span class="keyword">and</span> <span class="built_in">all</span>(word <span class="keyword">not</span> <span class="keyword">in</span> content <span class="keyword">for</span> word <span class="keyword">in</span> black_list):</span><br><span class="line">                	contents.append(content)</span><br><span class="line">                	fout.write(<span class="string">'&lt;d p="'</span> + <span class="built_in">str</span>(playat) + <span class="string">','</span> + <span class="built_in">str</span>(ct) +<span class="string">','</span> + <span class="built_in">str</span>(size) + <span class="string">','</span> + <span class="built_in">str</span>(color) + <span class="string">'"&gt;'</span> + content + <span class="string">'&lt;/d&gt;\n'</span>)</span><br><span class="line">        fout.write(<span class="string">'&lt;/i&gt;'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="芒果视频弹幕下载">芒果视频弹幕下载</h1>
<p>打开一个芒果视频 PC 网页端，其网址（以 <code>https://www.mgtv.com/b/9015/4828668.html</code> 为例）中以 <code>/</code> 分割，倒数第二位是 cid，倒数第一位是 vid。<br>
从源码中 <code>&lt;title&gt;霸王别姬 - 视频在线观看 - 霸王别姬 - 芒果TV&lt;/title&gt;</code> 可获得 title。<br>
然后就可以通过 cid 和 vid 得到弹幕：<code>https://galaxy.bz.mgtv.com/rdbarrage?vid=(%vid%)&amp;cid=(%cid%)&amp;time=(%time%)</code>，其中 time 从 0 开始并且下一个 time 的值可从弹幕中得到，打开此链接得到（只截取了第一条弹幕）：<br>
</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"status"</span>:,</span><br><span class="line">    <span class="attr">"msg"</span>:<span class="string">"操作成功"</span>,</span><br><span class="line">    <span class="attr">"seq"</span>:<span class="string">""</span>,</span><br><span class="line">    <span class="attr">"data"</span>:{</span><br><span class="line">        <span class="attr">"next"</span>:,</span><br><span class="line">        <span class="attr">"interval"</span>:,</span><br><span class="line">        <span class="attr">"items"</span>:[</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"id"</span>:,</span><br><span class="line">                <span class="attr">"type"</span>:,</span><br><span class="line">                <span class="attr">"uid"</span>:,</span><br><span class="line">                <span class="attr">"content"</span>:,</span><br><span class="line">                <span class="attr">"time"</span>:</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>
其中time、content字段可以组成xml弹幕格式。<br>
全部python代码为：<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">sys.stdout = io.TextIOWrapper(sys.stdout.buffer,encoding=<span class="string">'utf8'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_response</span>(<span class="params">url</span>):</span></span><br><span class="line">    req = urllib.request.Request(url)</span><br><span class="line">    req.add_header(<span class="string">'User-Agent'</span>, <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36'</span>)</span><br><span class="line">    response = urllib.request.urlopen(req).read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mangguo_danmu</span>(<span class="params">url</span>):</span></span><br><span class="line">    cid = url.split(<span class="string">'/'</span>)[<span class="number">4</span>]</span><br><span class="line">    vid = url.split(<span class="string">'/'</span>)[<span class="number">5</span>].strip(<span class="string">'.html'</span>)</span><br><span class="line">    video_info = json.loads(get_response(<span class="string">'https://pcweb.api.mgtv.com/video/info?vid=8244411&amp;cid=335811'</span>))</span><br><span class="line">    title = video_info[<span class="string">'data'</span>][<span class="string">'info'</span>][<span class="string">'videoName'</span>]</span><br><span class="line">    filename = <span class="string">'XML/'</span> + title + <span class="string">'.xml'</span></span><br><span class="line">    contents = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fout:</span><br><span class="line">        fout.write(<span class="string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n'</span>)</span><br><span class="line">        fout.write(<span class="string">'&lt;i&gt;\n'</span>)</span><br><span class="line">        time = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'https://galaxy.bz.mgtv.com/rdbarrage?version=2.0.0&amp;vid='</span> + vid + <span class="string">'&amp;cid='</span> + cid + <span class="string">'&amp;time='</span> + <span class="built_in">str</span>(time))</span><br><span class="line">            danmu = json.loads(get_response(<span class="string">'https://galaxy.bz.mgtv.com/rdbarrage?version=2.0.0&amp;vid='</span> + vid + <span class="string">'&amp;cid='</span> + cid + <span class="string">'&amp;time='</span> + <span class="built_in">str</span>(time)))</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(time))</span><br><span class="line">            <span class="keyword">if</span> danmu[<span class="string">'data'</span>][<span class="string">'items'</span>] == <span class="literal">None</span>:</span><br><span class="line">            	<span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> danmu[<span class="string">'data'</span>][<span class="string">'items'</span>]:</span><br><span class="line">                illegal = <span class="literal">False</span> <span class="comment">#标志是否有非法XML字符</span></span><br><span class="line">                <span class="keyword">for</span> char <span class="keyword">in</span> [<span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>, <span class="string">'&amp;'</span>, <span class="string">'\u0000'</span>, <span class="string">'\b'</span>]:</span><br><span class="line">                    <span class="keyword">if</span> char <span class="keyword">in</span> j[<span class="string">'content'</span>]:</span><br><span class="line">                        illegal = <span class="literal">True</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> illegal:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                timepoint = j[<span class="string">'time'</span>]/<span class="number">1000</span>  <span class="comment">#弹幕发送时间</span></span><br><span class="line">                ct = <span class="number">1</span>                      <span class="comment">#弹幕样式</span></span><br><span class="line">                size = <span class="number">20</span>                   <span class="comment">#字体大小</span></span><br><span class="line">                color = <span class="number">16777215</span>            <span class="comment">#弹幕颜色</span></span><br><span class="line">                content = j[<span class="string">'content'</span>]         <span class="comment">#弹幕内容</span></span><br><span class="line">                black_list = [<span class="string">'word'</span>]</span><br><span class="line">                <span class="keyword">if</span> content <span class="keyword">not</span> <span class="keyword">in</span> contents <span class="keyword">and</span> <span class="built_in">all</span>(word <span class="keyword">not</span> <span class="keyword">in</span> content <span class="keyword">for</span> word <span class="keyword">in</span> black_list):</span><br><span class="line">                    contents.append(content)</span><br><span class="line">                    fout.write(<span class="string">'&lt;d p="'</span> + <span class="built_in">str</span>(timepoint) + <span class="string">','</span> + <span class="built_in">str</span>(ct) +<span class="string">','</span> + <span class="built_in">str</span>(size) + <span class="string">','</span> + <span class="built_in">str</span>(color) + <span class="string">'"&gt;'</span> + content + <span class="string">'&lt;/d&gt;\n'</span>)</span><br><span class="line">            time = danmu[<span class="string">'data'</span>][<span class="string">'next'</span>]</span><br><span class="line">        fout.write(<span class="string">'&lt;/i&gt;'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="视频下载">视频下载</h1>
<p><a href="https://github.com/soimort/you-get">You-Get</a> 是一个命令行程序，提供便利的方式来下载网络上的媒体信息。<br>
you-get 的功用:<br>
1. 下载流行网站的音频、视频 (<a href="https://github.com/soimort/you-get/wiki/中文说明#支持网站">查看完整支持列表</a>)<br>
2. 在媒体播放器中观看在线视频，脱离浏览器与广告<br>
3. 下载喜欢的网页上的图片<br>
4. 下载任何非 HTML 内容，例如二进制文件</p>
<p>you-get 主要在 linux 等开源平台上运行，由于家用电脑大多为 windows 系统，安装方法如下：</p>
<h2 id="下载相关安装包">下载相关安装包</h2>
<p>以下是必要依赖，需要单独安装，除非于 Windows 下使用预包装包:<br>
<a href="https://www.python.org/downloads/">Python 3</a><br>
<a href="https://www.ffmpeg.org/">FFmpeg</a> 或者 [Libav] https://libav.org/</p>
<ol type="1">
<li><p>通过 pip 安装<br>
you-get 的官方版本通过 <a href="https://pypi.python.org/pypi/you-get">PyPI</a> 分发，可从 PyPI 镜像中通过 <a href="https://en.wikipedia.org/wiki/Pip_(package_manager)">pip</a> 包管理器安装。务必使用版本 3 的 pip:<br>
<code>$ pip3 install you-get</code></p></li>
<li><p>Git clone<br>
<code>$ git clone git://github.com/soimort/you-get.git</code><br>
将源码解压到任意目录即可</p></li>
</ol>
<p>升级<br>
考虑到 you-get 安装方法的差异，请使用:<br>
<code>$ pip3 install --upgrade you-get</code><br>
或下载最新更新:<br>
<code>$ you-get https://github.com/soimort/you-get/archive/master.zip</code></p>
<h2 id="使用you-get">使用 you-get</h2>
<p>进入解压文件夹 you-get-develop 下，在该目录下打开 Windows Powershell。<br>
<img src="/images/%E4%B8%BB%E6%B5%81%E8%A7%86%E9%A2%91%E7%BD%91%E7%AB%99%E5%BC%B9%E5%B9%95%E4%B8%8B%E8%BD%BD/Windows" class="" title="Powershell.png 710 330"><br>
输入 <code>python you-get 视频网址</code>即可使用下载功能（视频保存在 you-get-develop 目录下）。</p>
<h1 id="腾讯视频下载">腾讯视频下载</h1>
<p>打开腾讯视频播放页，打开控制台（F12），Network 选项下搜索 "ts.m3u8" 字段，找到类似下面的网址：<br>
<code>https://apd-(32位字符串).v.smtcdns.com/moviets.tc.qq.com/(44位字符串)/uwMROfz0r5xgoaQXGdGnC2df64hwtZlCglRDKOjEZ_qQW-eC/(160位字符串)/(vid).(数字).ts.m3u8?ver=4</code></p>
<p>此 m3u8 文件存有 ts 索引相对地址：<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">#EXTM3U</span><br><span class="line">#EXT-X-VERSION:</span><br><span class="line">#EXT-X-MEDIA-SEQUENCE:</span><br><span class="line">#EXT-X-TARGETDURATION:</span><br><span class="line">#EXT-X-PLAYLIST-TYPE:</span><br><span class="line">#EXTINF:(时长),</span><br><span class="line">0(#)_(vid).(数字).(#).ts?index=(数字)&amp;start=(数字)&amp;end=(数字)&amp;brs=(数字)&amp;bre=(数字)&amp;ver=4</span><br></pre></td></tr></tbody></table></figure><br>
可以利用如下代码下载并且合并ts文件：<br>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_response</span>(<span class="params">url</span>):</span></span><br><span class="line">    req = urllib.request.Request(url)</span><br><span class="line">    req.add_header(<span class="string">'User-Agent'</span>, <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36'</span>)</span><br><span class="line">    response = urllib.request.urlopen(req).read()</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">url_m3u8 = <span class="string">'(m3u8地址)'</span></span><br><span class="line">EXTM3U = get_response(url_m3u8).decode(<span class="string">'utf-8'</span>).split(<span class="string">'\n'</span>)</span><br><span class="line">ts = [i <span class="keyword">for</span> i <span class="keyword">in</span> EXTM3U <span class="keyword">if</span> <span class="string">'ts'</span> <span class="keyword">in</span> i]</span><br><span class="line">url_header = url_m3u8[::-<span class="number">1</span>].split(<span class="string">'/'</span>, <span class="number">1</span>)[<span class="number">1</span>][::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ts:</span><br><span class="line">    url_ts = url_header + <span class="string">'/'</span> + i</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'(文件名).ts'</span>, <span class="string">'ab'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(get_response(url_ts))</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="批量进行弹幕ass转换">批量进行弹幕 ASS 转换</h1>
<p>安装 selenium<br>
pip install selenium</p>
<p>如果用 chrome<br>
查看 chrome 的版本号 (Chromium 72.0.3626.121)<br>
https://chromedriver.storage.googleapis.com/LATEST_RELEASE_72.0.3626<br>
https://chromedriver.storage.googleapis.com/index.html?path=72.0.3626.69/<br>
下载相应 win32 版本<br>
解压放入 python 根目录<br>
修改 common.js<br>
<code>startDownload('\ufeff' + ass, name.replace(/\.[^.]*$/, '') + '.ass');</code><br>
改为 <code>return ass;</code></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Python</tag>
        <tag>Crawler</tag>
      </tags>
  </entry>
  <entry>
    <title>搭建个人博客教程</title>
    <url>/contents/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B.html</url>
    <content><![CDATA[<p>本文参考知乎专栏<a href="https://zhuanlan.zhihu.com/p/25471760">《教你免费搭建个人博客，Hexo&amp;Github》</a>，感谢作者。<br>
但在实践搭建博客过程中稍有不同。<br>
系统：Windows 7/10 64 位，MacOS；编辑器：sublime text3, Typora；控制台：CMD, Git Bash, Terminal；搭建博客：Hexo+GitHub<br>
用户名：lxmymjr<br>
<span id="more"></span></p>
<h1 id="安装">安装</h1>
<ol type="1">
<li>进入个人 GitHub 主页，右上角 + 号，选择 new repository，Repository name 填用户名。</li>
<li>安装 <a href="https://nodejs.org/en/">Node.js</a>。<br>
Windows 系统直接官网下载安装。<br>
MacOS 系统推荐使用 <a href="https://github.com/Homebrew/install">Homebrew</a> 安装：在 Terminal 中输入 <code>brew install node</code>。<br>
安装 <a href="https://github.com/Homebrew/install">Homebrew</a>：在 Terminal 中输入 <code>/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"</code>。</li>
<li>安装 <a href="https://git-scm.com">Git</a>。<br>
Windows 系统直接官网下载安装。<br>
MacOS 系统在 Terminal 中输入 <code>brew install git</code>（一般系统自带，可省略此步）。</li>
<li>安装完成后，在开始菜单里找到 "Git"-&gt;"Git Bash"，输入：<br>
<code>$ git config --global user.name "用户名"</code> （不要引号）<br>
<code>$ git config --global user.email "注册邮箱"</code> （不要引号）<br>
名称和注册邮箱是 GitHub 上的（MacOS 无需此步）。</li>
<li>安装 <a href="https://hexo.io/zh-cn/">Hexo</a>：输入 <code>$(sudo) npm install -g hexo-cli</code>。</li>
<li>安装 <a href="https://github.com/jgm/pandoc/blob/master/INSTALL.md">pandoc</a>（MacOS 需要安装）：输入 <code>$ brew install pandoc</code>。</li>
</ol>
<h1 id="更新">更新</h1>
<ol type="1">
<li>更新 Node.js 版本：在<a href="https://nodejs.org/en/download/current/">官网</a>上下载安装包覆盖安装。</li>
<li>更新 npm 版本：在命令行或终端中输入 <code>(sudo) npm install npm@latest -g</code> 进行更新，输入 <code>npm -v</code> 查看版本号，在<a href="https://github.com/npm/cli">官网</a>中查看最新版本号。</li>
<li>更新 npm package 版本：<br>
命令行或终端中输入 <code>npm outdated</code> 和 <code>npm -g outdated</code> 列出需要更新的版本。<br>
命令行或终端中输入 <code>npm update</code> 和 <code>npm -g update</code> 更新到 outdated 列出 wanted 的版本。<br>
命令行或终端中输入 <code>npm install package-name@latest</code> 强制更新到最新版本。</li>
<li>更新 Hexo 版本：在 Hexo 博客的根目录右键运行 Git Bash 并输入 <code>npm outdated</code> 检查最新版本的模块，确认根目录下有 package.json 文件。根据最新版本的模块检查结果修改 package.json 文件中对应的版本号。删除根目录下的 node_modules 文件夹，然后输入 <code>npm install --save</code> 更新模块。输入 <code>hexo version</code> 检查版本信息。输入 <code>npm outdated -g</code> 检查 Hexo CLI 是否有新版本，如有则输入 <code>npm install -g hexo-cli</code> 进行升级。</li>
</ol>
<h1 id="配置">配置</h1>
<ol type="1">
<li>新建文件夹 "Blog" 作为 Hexo 博客的根目录。</li>
<li>在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ hexo i "文件夹名"</code>，此处起名为 "Blog"。</li>
<li>在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ hexo g</code>，生成文章；输入 <code>$ hexo s</code>，启动本地服务器。访问 http://localhost:4000/ 即可查看博客效果。</li>
<li>打开 Git Bash（Windows）/Terminal（MacOS），输入 <code>$(sudo) ssh-keygen -t rsa -C "GitHub的注册邮箱地址"</code>，一直回车直到出现信息 <code>Your public key has been saved in /path/to/id_rsa.pub</code><br>
MacOS：先检查 SSH Key 是否已经生成，在 Terminal 上输入 <code>ls -al ~/.ssh</code></li>
<li>根据路径找到 id_rsa.pub，用 sublime 打开，复制全部内容，然后打开<a href="https://github.com/settings/keys">网址</a>（GitHub -&gt;Setting -&gt; SSH and GPG keys），点击 New SSH key 按钮，Title 填写 "Blog"，Key 填写刚刚复制的内容，完成后点击 Add SSH key 按钮。</li>
<li>在 Blog 目录下，用 sublime 打开站点配置文件（_config.yml 文件），修改网站相关信息：<br>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="comment">#网站标题</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="comment">#副标题</span></span><br><span class="line"><span class="attr">description:</span> <span class="comment">#网页描述</span></span><br><span class="line"><span class="attr">author:</span> <span class="comment">#作者名</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/"用户名"/"用户名".github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span> <span class="comment">#配置部署</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h1 id="发表文章">发表文章</h1>
<ol type="1">
<li>在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ hexo n "文章标题"</code>。</li>
<li>在 "Blog\_posts" 目录下找到文章 "文章标题.md"，用 sublime 打开，使用 Markdown 语法写文章。</li>
<li>在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ hexo g</code>，生成文章。</li>
<li>在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ hexo d</code>，会弹出 GitHub Login 窗口，输入你的 GitHub 账号和密码。</li>
<li>然后打开<a href="https://lxmymjr.github.io/">网址</a>："用户名".github.io 就可以看到已经发布的文章了。</li>
</ol>
<h1 id="删除文章">删除文章</h1>
<ol type="1">
<li>在 "Blog\_posts" 目录下找到要删除的文章，直接删除。</li>
<li>如果需要删除文章中的本地资源（图片，视频，音频等），需删除 "Blog" 目录下的资源，<strong>并且</strong>删除 "Blog" 目录下的资源。</li>
<li>在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ hexo g</code>，重新生成文章。</li>
<li>在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ hexo d</code>，重新发表文章。</li>
</ol>
<h1 id="加密访问">加密访问</h1>
<ol type="1">
<li>使用插件 <a href="https://github.com/MikeCoder/hexo-blog-encrypt">hexo-blog-encrypt</a></li>
<li> 在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ npm install hexo-blog-encrypt --save</code>。</li>
<li>在 Hexo 博客的根目录下的站点配置文件中启用该插件:<br>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Security</span></span><br><span class="line"><span class="attr">encrypt:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>在每篇需要加密的文章配置<br>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">password:</span> <span class="comment">#设置密码</span></span><br><span class="line"><span class="attr">abstract:</span> <span class="string">Enter</span> <span class="string">the</span> <span class="string">password</span> <span class="string">to</span> <span class="string">read.</span> <span class="comment">#设置预览内容</span></span><br><span class="line"><span class="attr">message:</span> <span class="string">Enter</span> <span class="string">the</span> <span class="string">password</span> <span class="string">to</span> <span class="string">read.</span> <span class="comment">#设置提示框内容</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h1 id="定制主题">定制主题</h1>
<p>本博客使用 NexT 主题：详见 <a href="https://github.com/next-theme/hexo-theme-next">GitHub</a>，<a href="https://theme-next.js.org/">官网</a>。</p>
<ol type="1">
<li>安装 NexT: 在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ git clone https://github.com/next-theme/hexo-theme-next themes/next</code>。<br>
如果 hexo 是 5.0.0 以上，则可以直接输入 <code>npm install hexo-theme-next</code></li>
<li>启用主题：与所有 Hexo 主题启用的模式一样。当安装完成后，打开 Hexo 博客的根目录下的站点配置文件，找到 theme 字段，并将其值更改为 next。在切换主题之后或者更改样式后，最好使用 <code>$ hexo clean</code> 来清除 Hexo 的缓存。</li>
<li>选择 Scheme：Scheme 是 NexT 提供的一种特性，借助于 Scheme，NexT 为你提供多种不同的外观。同时，几乎所有的配置都可以在 Scheme 之间共用。<br>
Scheme 的切换通过更改主题配置文件，搜索 scheme 关键字。你会看到有三行 scheme 的配置，将你需用启用的 scheme 前面注释 #去除即可。</li>
<li>设置菜单：NexT 默认的菜单项有（标注<i class="fa fa-exclamation-circle"></i>的项表示需要手动创建这个页面）：</li>
</ol>
<table>
<thead>
<tr class="header">
<th>键值</th>
<th>设定值</th>
<th>显示文本</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td> home</td>
<td><code>home: /</code></td>
<td>主页</td>
</tr>
<tr class="even">
<td> archives</td>
<td><code>archives: /archives</code></td>
<td>归档页</td>
</tr>
<tr class="odd">
<td> categories</td>
<td><code>categories: /categories</code></td>
<td>分类页 <i class="fa fa-exclamation-circle"></i></td>
</tr>
<tr class="even">
<td>tags</td>
<td><code>tags: /tags</code></td>
<td>标签页 <i class="fa fa-exclamation-circle"></i></td>
</tr>
<tr class="odd">
<td>about</td>
<td><code>about: /about</code></td>
<td>关于页面 <i class="fa fa-exclamation-circle"></i></td>
</tr>
<tr class="even">
<td>commonweal</td>
<td><code>commonweal: /404.html</code></td>
<td>公益 404 <i class="fa fa-exclamation-circle"></i></td>
</tr>
</tbody>
</table>
<p>　添加「标签 / 分类」页面：在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ hexo new page tags或者categories</code>。<br>
　编辑刚新建的页面，将页面的 type 设置为 tags，主题将自动为这个页面显示分类。页面内容如下：<br>
</p><figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">title: 标签/分类</span></span><br><span class="line"><span class="section">date: yyyy-mm-dd hh:mm:ss</span></span><br><span class="line"><span class="section">type: "tags"或者type: "categories"</span></span><br><span class="line">---</span><br></pre></td></tr></tbody></table></figure><br>
　将post_meta的updated_at字段的值改为true以启动文章修改时间显示。<p></p>
<ol start="5" type="1">
<li>设置头像：编辑主题配置文件，修改字段 avatar，值设置成头像的链接地址（完整的互联网 URI 或者站点内的地址）。</li>
<li>字数统计：在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ npm install hexo-word-counter --save</code>。编辑 Hexo 博客的根目录下的站点配置文件，新增以下内容到任意位置，然后在主题配置文件中配置 symbols_count_time 项目：<br>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># in _config.yml</span></span><br><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">symbols:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">time:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_symbols:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_time:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">exclude_codeblock:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">awl:</span> <span class="number">4</span></span><br><span class="line">  <span class="attr">wpm:</span> <span class="number">275</span></span><br><span class="line">  <span class="attr">suffix:</span> <span class="string">"mins."</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># in _config.next.yml</span></span><br><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">separated_meta:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">item_text_post:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">item_text_total:</span> <span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>本地搜索功能：在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ npm install hexo-generator-searchdb --save</code>。编辑 Hexo 博客的根目录下的站点配置文件，新增以下内容到任意位置，然后在主题配置文件中配置 local_search 项目：<br>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10000</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>新建 Blog/source/_data/styles.styl 文件：<br>
<figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">// Custom styles.</span><br><span class="line">//修改右上角xmliu's blog颜色及高度</span><br><span class="line"><span class="selector-class">.site-brand-container</span> {</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#0080FF</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.site-meta</span> {</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#0080FF</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">5px</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//扩大左侧栏</span><br><span class="line"><span class="selector-class">.sidebar</span> {</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//去掉目录中Home和Search上下的空白</span><br><span class="line"><span class="selector-class">.menu</span> {</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0em</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//减少主界面文章标题和预览之间距离</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-header</span> {</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span> <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//减少主界面文章预览和Read more按钮之间距离</span><br><span class="line"><span class="selector-class">.post-button</span> {</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//将<span class="attribute">background</span><span class="selector-class">.jpg</span>放在node_modules\hexo-theme-next\source\images目录下</span><br><span class="line"><span class="selector-tag">body</span> {</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">/images/background.jpg</span>);</span><br><span class="line">  <span class="attribute">background-attachment</span>: fixed;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//页面底部文字变白色</span><br><span class="line"><span class="selector-class">.footer</span> {</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//Archive界面</span><br><span class="line">//去掉title</span><br><span class="line"><span class="selector-class">.posts-collapse</span> <span class="selector-class">.collection-title</span> {</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//去掉年份上下空白</span><br><span class="line"><span class="selector-class">.posts-collapse</span> <span class="selector-class">.post-content</span> <span class="selector-class">.collection-year</span> {</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//去掉标题上下空白</span><br><span class="line"><span class="selector-class">.posts-collapse</span> <span class="selector-class">.post-content</span> <span class="selector-class">.post-header</span> {</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//减少左边距</span><br><span class="line"><span class="selector-class">.posts-collapse</span> <span class="selector-class">.post-content</span> {</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//取消整栏上下空白</span><br><span class="line"><span class="selector-class">.post-block</span> {</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">20px</span></span><br><span class="line">    padding-bottom: <span class="number">20px</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-width</span>: <span class="number">1200px</span>) {</span><br><span class="line">  //缩小两边距离</span><br><span class="line">  <span class="selector-class">.main</span> {</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1360px</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  //扩大主内容栏</span><br><span class="line">  <span class="selector-class">.main-inner</span> {</span><br><span class="line">      <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">312px</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  //扩大左侧栏</span><br><span class="line">  <span class="selector-class">.header-inner</span> {</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h1 id="seo优化指南">SEO 优化指南</h1>
<p>方便搜索引擎收录本博客，参考文章<a href="http://blog.mobing.net/content/hexo/hexo-next-seo.html">基于 Hexo 中 Next 主题的 SEO 优化指南</a>，<a href="http://hui-wang.info/2016/10/23/Hexo插件之百度主动提交链接/">Hexo 插件之百度主动提交链接</a></p>
<h2 id="生成站点地图提交到google">生成站点地图提交到 Google</h2>
<p>需要先安装 hexo-generator-sitemap 插件，在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ npm install hexo-generator-sitemap --save</code>。<br>
然后编辑 Hexo 博客的根目录下的站点配置文件，新增以下内容到任意位置：<br>
</p><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">sitemap:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">sitemap.xml</span></span><br></pre></td></tr></tbody></table></figure><br>
安装完这个插件，再重启hexo（<code>hexo g</code>），就能生成sitemap.xml文件了。<br>
进入<a href="https://search.google.com/search-console/welcome">Google Search Console</a>的网址前缀，输入本博客的网址，选择“其他验证方法”中的“HTML标记”，复制其中的元标记到your-hexo-site\themes\next\layout\_partials\head\head.swig中的line5或者将验证码复制到主题配置文件中的google_site_verification字段中。<br>
然后进行验证，然后在控制台中提交站点地图文件。<p></p>
<h2 id="生成网址提交到百度">生成网址提交到百度</h2>
<p>因为 GitHub 禁止百度爬虫访问博客，导致博客无法被百度收录。<br>
注册<a href="http://zhanzhang.baidu.com">百度站长工具</a>，提交你的站点网址，即网站的根地址。然后在工具 -&gt; 网页抓取 -&gt; 链接提交里找到密钥。<br>
格式：<code>http://data.zz.baidu.com/urls?site=&lt;your website&gt;&amp;token=&lt;your token&gt;</code><br>
接下来需要安装 hexo-baidu-url-submit 插件：在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>$ npm install hexo-baidu-url-submit --save</code>。<br>
然后编辑 Hexo 博客的根目录下的站点配置文件，新增以下内容到任意位置：</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">baidu_url_submit:</span></span><br><span class="line">  <span class="attr">count:</span> <span class="string">n</span> <span class="comment"># 提交最新的n个链接</span></span><br><span class="line">  <span class="attr">host:</span> <span class="comment"># &lt;你的网站根地址&gt;</span></span><br><span class="line">  <span class="attr">token:</span> <span class="string">your_token</span> <span class="comment"># 上述获得的密钥</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">baidu_urls.txt</span> <span class="comment"># 所需提交的网址的存放文件</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意，此插件的配置文件中包含密钥，请妥善管理好博客源码。<br>
可以把源码<strong>保存在本地</strong>，如果要托管在 git 仓库里，请选择<strong>私有仓库</strong>。<br>
最后，加入新的 deployer:<br>
</p><figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/&lt;username&gt;/&lt;username&gt;.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">baidu_url_submitter</span></span><br></pre></td></tr></tbody></table></figure><br>
注意type前面一定有一个短横线。<br>
<code>hexo generate</code> 会产生一个文本文件，里面包含所需百度检索的链接。<br>
<code>hexo deploy</code> 会从上述文件中读取链接，提交至百度搜索引擎。<p></p>
<h2 id="添加蜘蛛协议">添加蜘蛛协议</h2>
<p>在站点 source 文件夹下新建 robots.txt 文件，文件内容如下：<br>
</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"># hexo robots.txt</span><br><span class="line">User-agent: * </span><br><span class="line">Allow: /</span><br><span class="line">Allow: /archives/</span><br><span class="line">Allow: /tags/</span><br><span class="line">Allow: /categories/</span><br><span class="line">Disallow: /vendors/</span><br><span class="line">Disallow: /js/</span><br><span class="line">Disallow: /css/</span><br><span class="line">Disallow: /fonts/</span><br><span class="line">Disallow: /vendors/</span><br><span class="line">Disallow: /fancybox/</span><br><span class="line">Sitemap: https://lxmymjr.github.io/sitemap.xml #改成你自己的网址</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="网站结构优化">网站结构优化</h2>
<h3 id="keywords和description">keywords 和 description</h3>
<p>在.md 中添加如下代码，用于生成的文章中添加关键字和描述。<br>
<code>keywords:</code><br>
<code>description:</code></p>
<h3 id="修改文章链接">修改文章链接</h3>
<p>Hexo 默认的文章链接形式为 domain/year/month/day/postname，即一个四级 url，可能造成 url 过长，对搜索引擎十分不友好。<br>
所以需要改成 domain/postname 的形式。编辑站点配置文件，修改其中的 permalink 字段，改为 permalink: :title.html 即可。</p>
<h1 id="不同电脑维护博客">不同电脑维护博客</h1>
<p>使用第三方 git 服务进行博客的备份。可以用 GitHub 的私有仓库。<br>
在 GitHub 网站创建一个新的 repository，我们在这里给新创建的 repository 命名为 Blog。</p>
<h2 id="在原电脑中从本地上传hexo到github仓库">在原电脑中从本地上传 Hexo 到 GitHub 仓库</h2>
<ol type="1">
<li>初始化仓库。<br>
在 Hexo 博客的根目录右键运行 Git Bash 并输入以下命令：<br>
<code>$ git init</code><br>
<code>$ git remote add origin &lt;server address&gt; #server address为备份仓库的地址（https://github.com/"用户名"/Blog)</code></li>
<li>把主题配置文件 Blog/node_modules/hexo-theme-next/_config.yml 复制到 Blog/source/_data/ 文件夹里面。</li>
<li>把本地文件同步到 GitHub 上面。<br>
分别输入执行以下命令：<br>
<code>$ git add .  #添加所有目录，注意add后面有个点</code><br>
<code>$ git commit -m "add to GitHub" #引号内为提交说明，每次提交都需要</code><br>
<code>$ git push origin master   #把更新推送到云端</code><br>
可以登录 GitHub 账户查看刚创建的 blog 仓库中是否上传成功。<br>
windows 平台 push 过程中会提示输入 GitHub 的用户名和的密码。</li>
</ol>
<h2 id="在新电脑中从github仓库取回hexo到本地">在新电脑中从 GitHub 仓库取回 Hexo 到本地。</h2>
<ol type="1">
<li><p>安装 Git 和 Node.js（见上）。</p></li>
<li><p>把文件取回本地。<br>
安装环境完成后，在新 Blog 文件夹下运行 Git Bash 并分别执行以下几条命令：<br>
<code>$ git init</code><br>
<code>$ git remote add origin &lt;server address&gt; #server address为备份仓库的地址（https://github.com/"用户名"/Blog)</code><br>
<code>$ git pull origin master</code><br>
运行完 pull 命令后你会发现文件夹中就会出现刚刚上传的内容。</p></li>
<li><p>配置新的 Hexo。<br>
3.1. 在刚才的目录下执行以下命令以在新电脑中安装 Hexo。<br>
<code>$ (sudo) npm install -g hexo-cli</code><br>
3.2. 初始化 Hexo 并安装相应依赖包。<br>
<code>$ (sudo) npm install #会根据package.json文件中的依赖列表安装相应依赖包</code><br>
3.3. 将 Blog/source/_data/background.jpg 复制到 Blog/node_modules-theme-next。<br>
3.4. 输入命令 <code>$ hexo g</code> 和命令 <code>$ hexo s</code>，然后在浏览器输入 <code>localhost:4000</code> 中进行预览。如果没有问题那么新电脑上就配置成功了。<br>
3.5. 发表文章的操作同原电脑（见上）。</p></li>
<li><p>把新电脑上的 Hexo 从本地同步到 GitHub 仓库。<br>
当发表完文章，我们还需要把 Hexo 程序同步到我们 GitHub 的 blog 仓库。执行下面指令：<br>
<code>$ git add .</code><br>
这时候可以输入命令 $ git status 查看状态，回显示刚才编辑过的文件的信息。<br>
之后分别输入下面指令完成上传：<br>
<code>$ git commit -m "add to GitHub"</code><br>
<code>$ git push origin master</code><br>
成功后，我们再次把程序同步更新到了我们的 GitHub 仓库 Blog。</p></li>
</ol>
<h2 id="新旧电脑继续维护博客">新旧电脑继续维护博客</h2>
<ol type="1">
<li>如果再想用旧电脑更新博客，只需要在执行添加文章之前先把程序从 Blog 仓库拉取下来便可。输入命令：<br>
<code>$ git pull</code></li>
<li>现在无论用哪台电脑进行修改等操作，都需先输入命令 <code>$ git pull</code>，然后再进行修改等操作，修改等操作完成后，输入执行以下命令：<code>$ git add .</code> 和 <code>$ git commit -m "add to GitHub"</code> 和 <code>$ git push origin master</code> 来更新远程仓库。</li>
</ol>
<h1 id="markdown基本语法">Markdown 基本语法</h1>
<ol type="1">
<li>一个井号<code>#</code>一级标题，n 个井号 n 级标题，注意：<strong>井号和标题名之间一定要有一个空格</strong>。</li>
<li>代码，一对 `表示行内代码，一对``` 表示行间代码，第一个 ``` 后可加上语言名。</li>
<li><em>一对星号表示斜体</em>，<strong>两对星号表示加粗</strong>，<strong><em>三对星号表示斜体加粗</em></strong>，<em>一对下划线表示斜体</em>，<strong>两对下划线表示加粗</strong>，<strong><em>三对下划线表示斜体加粗</em></strong>。</li>
<li>[链接名称](链接地址) 插入链接。</li>
<li><blockquote>
<p>&gt; 表示引用。</p>
</blockquote></li>
<li>用全角空格表示缩进，搜狗输入法中 <code>shift+空格</code>切换全角半角。</li>
<li><font color="red">字体颜色：</font><code>&lt;font color=颜色&gt;内容&lt;/font&gt;</code>。</li>
<li>一行中用三个以上的星号、减号、下划线来建立一个分隔线，行内不能有其他东西。也可以在星号、减号、下划线中间插入空格。</li>
</ol>
<hr>
<h1 id="插入图片">插入图片</h1>
<ol type="1">
<li>在 Hexo 博客的根目录下的 source 文件夹中新建文件夹 image。</li>
<li>在 Markdown 中写：<code>!["图片描述"](\image\图片名字.图片格式)</code> 或者 <code>!["图片描述"](外链网址)</code>。</li>
<li>或者在 Markdown 中写：<br>
<figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">{% img /image/图片名字.图片格式 图片宽度 图片高度 %}</span><br></pre></td></tr></tbody></table></figure><br>
或者<br>
<figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">{% img 外链网址 图片宽度 图片高度 %}</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h1 id="插入视频">插入视频</h1>
<ol type="1">
<li>在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>npm install hexo-tag-dplayer --save</code>。</li>
<li>在 Markdown 中写：<br>
<figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">{% dplayer "url="视频网址" "theme=#FADFA3" "autoplay=false" %}</span><br></pre></td></tr></tbody></table></figure><br>
如果插入本地视频，则先在 Hexo 博客的根目录下的 source 文件夹中新建文件夹 video，然后在 Markdown 中视频地址为。视频格式。</li>
</ol>
<h1 id="插入公式">插入公式</h1>
<ol type="1">
<li>在 Markdown 中写：<code>&lt;img src="http://chart.googleapis.com/chart?cht=tx&amp;chl=\Large "LaTeX格式的公式代码"" style="border:none;"&gt;</code>。</li>
<li>NexT 主题自带 MathJax 功能，在主题配置文件中配置 math 项目。<br>
如果启用了 per_page 功能，则需要在每篇需要 MathJax 的文章配置 mathjax : true。<br>
如果插入行内公式，在 Markdown 中写：<code>$LaTeX格式的公式代码$</code>。如果插入行间公式，在 Markdown 中写：<code>$$LaTeX格式的公式代码$$</code>。</li>
<li>打开 hexo 渲染器。<br>
在 Hexo 博客的根目录右键运行 Git Bash 并输入：<code>npm un hexo-renderer-marked --save</code> 和 <code>npm i hexo-renderer-pandoc --save # 或者 hexo-renderer-kramed</code><br>
如果用 hexo-renderer-pandoc 则需要在系统里提前安装好 <a href="https://pandoc.org/installing.html">pandoc</a><br>
如果需要回车换行功能的话，则需要编辑 Hexo 博客的根目录下的站点配置文件，新增以下内容到任意位置：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">pandoc:</span><br><span class="line">  extensions:</span><br><span class="line">    - "+hard_line_breaks"</span><br></pre></td></tr></tbody></table></figure><br>
注意：如果 Windows 电脑安装了 Anaconda3 的话，因为 Anaconda3 自带了 pandoc（C:\ProgramData\Anaconda3\pkgs\pandoc-1.19.2.1-hb2460c7_1\Scripts\pandoc.exe）且版本落后，需要在系统 - 高级系统设置 - 环境变量 - 系统变量的 Path 变量中将新安装的 Pandoc 路径移到 Anaconda 路径上方，并通过 <code>pandoc --version</code> 进行验证。</li>
<li>让 Hexo 在使用 Mathjax 时支持多行公式：\\ 符号表示换行，&amp; 表示对齐，<code>\begin{split}</code> 表示等号对齐，<code>\begin{align}</code> 表示向左对齐，<code>\begin{gather}</code> 表示居中对齐。<br>
例：<br>
<code>$\begin{split}a&amp;=b+c-d\\&amp;\quad+e-f\\&amp;=g+h\\&amp;=i\end{split}$</code><br>
<span class="math inline">\(\begin{split}a&amp;=b+c-d\\&amp;\quad+e-f\\&amp;=g+h\\&amp;=i\end{split}\)</span><br>
<code>$\begin{align}a_{11}&amp;=b_{11}&amp;a_{12}&amp;=b_{12}\\a_{21}&amp;=b_{21}+c_{21}&amp;a_{22}&amp;=b_{22}\end{align}$</code><br>
<span class="math inline">\(\begin{align}a_{11}&amp;=b_{11}&amp;a_{12}&amp;=b_{12}\\a_{21}&amp;=b_{21}+c_{21}&amp;a_{22}&amp;=b_{22}\end{align}\)</span><br>
<code>$\begin{gather}a_{11}=b_{11}&amp;a_{12}=b_{12}\\a_{21}=b_{21}+c_{21}&amp;a_{22}=b_{22}\end{gather}$</code><br>
<span class="math inline">\(\begin{gather}a_{11}=b_{11}&amp;a_{12}=b_{12}\\a_{21}=b_{21}+c_{21}&amp;a_{22}=b_{22}\end{gather}\)</span></li>
<li> 看到别的网站上有 MathJax 解析的公式时，可以通过右键菜单 “Show Math As&gt; TeX Commands” 查看 LaTex 格式。</li>
<li>希腊字母表示方法：<br>
部分字母变体 <code>\epsilon \varepsilon \phi \varphi</code>：<span class="math inline">\(\epsilon \varepsilon \phi \varphi\)</span>。</li>
<li>上标和下标：<br>
使用符号 ^（上标）和_（下标），如 <code>x_i^j</code>：<span class="math inline">\(x_i^j\)</span>。<br>
如果上标或者下标包含不止一个字符，则需要用括号 {} 括起来。<br>
在 markdown 中书写，因为 <code>\, $, {, }, _</code>都是有特殊含义的，所以需要加 <code>\</code> 转义。</li>
<li>括号：<br>
小括号与中括号：使用原始的<span class="math inline"> \(()\)</span>，<span class="math inline">\([]\)</span> 即可。<br>
大括号：由于大括号<span class="math inline"> \(\{\}\)</span> 被用来分组，因此需要使用 <code>\{</code>和 <code>\}</code> 表示大括号，还可以使用 <code>\lbrace</code> 和 <code>\rbrace</code> 来表示。<br>
尖括号：使用 <code>\langle</code> 和 <code>\rangle</code> 表示<span class="math inline"> \(\langle\)</span> 左尖括号和<span class="math inline"> \(\rangle\)</span> 右尖括号。<br>
上取整：使用<span class="math inline"> \(\lceil \rceil\)</span>。<br>
下取整：使用<span class="math inline"> \(\lfloor \rfloor\)</span>。<br>
需要注意的是，原始符号并不会随着公式大小缩放，可以使用 <code>\left(…\right)</code> 来自适应的调整括号大小。</li>
<li>分式与根式 (分号与开方)：<br>
<code>\frac ab</code> 显示为<span class="math inline"> \(\frac ab\)</span>，而 <code>\frac{a+b}{c+d}</code> 显示为<span class="math inline"> \(\frac{a+b}{c+d}\)</span>。<br>
或者用 <code>{a+b\over c+d}</code> 为<span class="math inline"> \({a+b\over c+d}\)</span>。<br>
<code>\sqrt[y]{x}</code> 表示开方<span class="math inline"> \(\sqrt[y]{x}\)</span>。</li>
<li>字体：<br>
mathbb 和 Bbb：<span class="math inline">\(\mathbb {ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz}\)</span> 黑板体<br>
mathbf：<span class="math inline">\(\mathbf {ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz}\)</span> 粗体<br>
mathtt：<span class="math inline">\(\mathtt {ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz}\)</span> 打印体<br>
mathrm：<span class="math inline">\(\mathrm {ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz}\)</span> 罗马体<br>
mathcal：<span class="math inline">\(\mathcal {ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz}\)</span> 花体<br>
mathscr：<span class="math inline">\(\mathscr {ABCDEFGHIJKLMNOPQRSTUVWXYZ}\)</span> 手写体<br>
mathfrak：<span class="math inline">\(\mathfrak {ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz}\)</span> 德国体</li>
<li>数学符号：<br>
求和：<code>\sum</code> <span class="math inline">\(\sum\)</span>，可使用上下标。<br>
积分：<code>\int</code><span class="math inline">\(\int\)</span>，可使用上下限。<br>
连乘：<code>\prod</code><span class="math inline">\(\prod\)</span><br>
二重积分：<code>\iint</code><span class="math inline">\(\iint\)</span><br>
极限：<code>\lim</code><span class="math inline">\(\lim\)</span>，可以使用下标。<br>
比较：<code>\lt \gt \le \ge \neq</code><span class="math inline">\(\lt \gt \le \ge \neq\)</span>。可以前面加 <code>\not</code> 否定<span class="math inline"> \(\not\lt \not\gt \not\le \not\ge \not\neq\)</span>。<br>
运算：<code>\times \div \pm \mp</code><span class="math inline">\(\times \div \pm \mp\)</span>，<code>\cdot</code><span class="math inline">\(\cdot\)</span> 点乘。<br>
集合：<code>\cup \cap \bigcup \bigcap \setminus \subset \subseteq \subsetneq \supset \in \notin \emptyset \varnothing</code><span class="math inline">\(\cup \cap \bigcup \bigcap \setminus \subset \subseteq \subsetneq \supset \in \notin \emptyset \varnothing\)</span><br>
排列：<code>\choose</code> 或 <code>\binom</code>,<code>{x \choose y}</code><span class="math inline">\({x \choose y}\)</span> 或者 <code>\binom{x}{y}</code><span class="math inline">\(\binom{x}{y}\)</span><br>
箭头：<code>\to \rightarrow \leftarrow \Rightarrow \Leftarrow \mapsto \implies \iff \longrightarrow</code><span class="math inline">\(\to \rightarrow \leftarrow \Rightarrow \Leftarrow \mapsto \implies \iff \longrightarrow\)</span><br>
逻辑：<code>\land \lor \lnot \forall \exists \top \bot \vdash \vDash</code><span class="math inline">\(\land \lor \lnot \forall \exists \top \bot \vdash \vDash\)</span><br>
空格：<code>\quad</code> 和 <code>\qquad</code>，MathJax 自己决定是否增加空格，所以一般的空格是没用的。<br>
特殊点号：<code>\star \ast \oplus \circ \bullet</code><span class="math inline">\(\star \ast \oplus \circ \bullet\)</span><br>
等号：<code>\approx \sim \cong \equiv \prec</code><span class="math inline">\(\approx \sim \cong \equiv \prec\)</span><br>
特殊算符：<code>\infty \aleph_0 \nabla \partial \Im \Re</code><span class="math inline">\(\infty \aleph_0 \nabla \partial \Im \Re\)</span><br>
模运算：<code>a\equiv b\pmod n</code><span class="math inline">\(a\equiv b\pmod n\)</span><br>
加多个数：<code>\cdots</code><span class="math inline">\(a_1+a_2+\cdots+a_n\)</span><br>
分隔多个数：<code>\ldots</code><span class="math inline">\(a_1, a_2, \ldots ,a_n\)</span><br>
头部标：<code>\hat \widehat \bar \overline \vec \overrightarrow \dot \ddot</code><span class="math inline">\(\hat x \widehat x \bar x \overline{xyz} \vec x \overrightarrow{xyz} \dot x \ddot x\)</span></li>
<li> 表格：<br>
使用 <code>\begin{array}{列样式}…\end{array}</code> 的形式来创建表格，列样式可以是 <code>c,l,r</code> 表示居中，左，右对齐，还可以使用 | 表示一条竖线。表格中各行使用 <code>\</code> 分隔 (hexo markdown 中，需要使用 <code>\\</code>)，各列使用 &amp; 分隔。使用。<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">\begin{array}{c|lcr}</span><br><span class="line">n &amp; \text{Left} &amp; \text{Center} &amp; \text{Right} \\\hline</span><br><span class="line">1 &amp; 1 &amp; 2 &amp; 3 \\</span><br><span class="line">2 &amp; 4 &amp; 5 &amp; 6 \\</span><br><span class="line">3 &amp; 7 &amp; 8 &amp; 9 \\</span><br><span class="line">\end{array}</span><br></pre></td></tr></tbody></table></figure><br>
<span class="math display">\[\begin{array}{c|lcr} n &amp; \text{Left} &amp; \text{Center} &amp; \text{Right} \\ \hline 1 &amp; 1 &amp; 2 &amp; 3 \\ 2 &amp; 4 &amp; 5 &amp; 6 \\ 3 &amp; 7 &amp; 8 &amp; 9 \\ \end{array}\]</span></li>
<li> 矩阵：<br>
使用 <code>\begin{matrix}…\end{matrix}</code> 的形式来表示矩阵，在 <code>\begin</code> 与 <code>\end</code> 之间加入矩阵中的元素即可。矩阵的行之间使用 <code>\</code> 分隔 (hexo markdown 中，需要使用 <code>\\</code>)，列之间使用 &amp; 分隔。<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">\begin{matrix}</span><br><span class="line">1 &amp; 2 &amp; 3 \\</span><br><span class="line">4 &amp; 5 &amp; 6 \\</span><br><span class="line">7 &amp; 8 &amp; 9 \\</span><br><span class="line">\end{matrix}</span><br></pre></td></tr></tbody></table></figure><br>
<span class="math display">\[\begin{matrix} 1 &amp; 2 &amp; 3 \\ 4 &amp; 5 &amp; 6 \\ 7 &amp; 8 &amp; 9 \\ \end{matrix}\]</span><br>
如果要对矩阵加括号，可以像上文中提到的一样，使用 <code>\left</code> 与 <code>\right</code> 配合表示括号符号。也可以使用特殊的 matrix。即替换 <code>begin{matrix}…end{matrix}</code> 中的 matrix 为 pmatrix，bmatrix，Bmatrix，vmatrix,Vmatrix。<br>
内联矩阵：<code>\bigl(\begin{smallmatrix} ... \end{smallmatrix}\bigr)</code><span class="math inline">\(\bigl( \begin{smallmatrix} a &amp; b \\ c &amp; d \end{smallmatrix} \bigr)\)</span><br>
可以使用<span class="math inline"> \(\cdots\)</span><span class="math inline">\(\ddots\)</span><span class="math inline">\(\vdots\)</span> 来省略矩阵中的元素，如：<br>
<span class="math display">\[\begin{pmatrix}      1 &amp; a_1 &amp; a_1^2 &amp; \cdots &amp; a_1^n \\      1 &amp; a_2 &amp; a_2^2 &amp; \cdots &amp; a_2^n \\      \vdots  &amp; \vdots&amp; \vdots &amp; \ddots &amp; \vdots \\      1 &amp; a_m &amp; a_m^2 &amp; \cdots &amp; a_m^n \end{pmatrix}\]</span></li>
<li> 分类表达式：<br>
定义函数的时候经常需要分情况给出表达式，可使用 <code>\begin{cases}…\end{cases}</code>。其中，使用 <code>\</code> 来分类，使用 &amp; 指示需要对齐的位置。如：<br>
<span class="math display">\[f(n) = \begin{cases} a, &amp; \text{if $n$ is even} \\ b, &amp; \text{if $n$ is odd} \\ \end{cases}\]</span></li>
<li> 空间问题：<br>
不要在指数或者积分中使用 <code>\frac</code>：<br>
在指数或者积分表达式中使用 <code>\frac</code> 会使表达式看起来不清晰，因此在专业的数学排版中很少被使用。应该使用一个水平的 <code>/</code> 来代替，效果如下：<br>
<span class="math display">\[\begin{array}{cc} \mathrm{Bad} &amp; \mathrm{Better} \\ \hline \\ e^{i\frac{\pi}2} \quad e^{\frac{i\pi}2}&amp; e^{i\pi/2} \\ \int_{-\frac\pi2}^\frac\pi2 \sin x\,dx &amp; \int_{-\pi/2}^{\pi/2}\sin x\,dx \\ \end{array}\]</span><br>
使用 <code>\mid</code> 代替 <code>|</code> 作为分隔符：<br>
符号 | 作为分隔符时有排版空间大小的问题，应该使用 <code>\mid</code> 代替。效果如下：<br>
<span class="math display">\[\begin{array}{cc} \mathrm{Bad} &amp; \mathrm{Better} \\ \hline \\ {x|x^2\in\Bbb Z} &amp; {x\mid x^2\in\Bbb Z} \\ \end{array}\]</span><br>
此外，在微分前应该使用 <code>\,</code> 来增加些许空间，否则 LaTex 会将微分紧凑地排列在一起。如下：<br>
<span class="math display">\[\begin{array}{cc} \mathrm{Bad} &amp; \mathrm{Better} \\ \hline \\ \iiint_V f(x)dz dy dx &amp; \iiint_V f(x)\,dz\,dy\,dx \end{array}\]</span></li>
<li> 连分数：<br>
书写连分数表达式时，请使用 <code>\cfrac</code> 代替 <code>\frac</code> 或者 <code>\over</code> 两者效果对比如下：<br>
<span class="math display">\[x = a_0 + \frac{1^2}{a_1 + \frac{2^2}{a_2 + \frac{3^2}{a_3 + \frac{4^4}{a_4 + \cdots}}}} \tag{\frac}\]</span><br>
<span class="math display">\[x = a_0 + \cfrac{1^2}{a_1 + \cfrac{2^2}{a_2 + \cfrac{3^2}{a_3 + \cfrac{4^4}{a_4 + \cdots}}}} \tag{\cfrac}\]</span></li>
<li> 方程组：<br>
使用 <code>\begin{array} … \end{array}</code> 与 <code>\left{…\right.</code> 配合，表示方程组，如：<br>
<span class="math display">\[\begin{array}{c} a_1x+b_1y+c_1z=d_1 \\ a_2x+b_2y+c_2z=d_2 \\ a_3x+b_3y+c_3z=d_3 \end{array}\]</span><br>
同时，还可以使用 <code>\begin{cases}…\end{cases}</code> 表达同样的方程组，如：<br>
<span class="math display">\[\begin{cases} a_1x+b_1y+c_1z=d_1 \\ a_2x+b_2y+c_2z=d_2 \\ a_3x+b_3y+c_3z=d_3 \end{cases}\]</span><br>
对齐方程组中的 = 号，可以使用 <code>\being{aligned} .. \end{aligned}</code>，如：<br>
<span class="math display">\[\begin{aligned} a_1x+b_1y+c_1z &amp;=d_1+e_1 \\ a_2x+b_2y&amp;=d_2 \\ a_3x+b_3y+c_3z &amp;=d_3 \end{aligned}\]</span><br>
如果要对齐 = 号和项，可以使用 <code>\being{array}{列样式} .. \end{array}</code>，如：<br>
<span class="math display">\[\begin{array}{ll} a_1x+b_1y+c_1z &amp;=d_1+e_1 \\ a_2x+b_2y &amp;=d_2 \\ a_3x+b_3y+c_3z &amp;=d_3 \end{array}\]</span></li>
<li> 颜色：<br>
命名颜色是浏览器相关的，如果浏览器没有定义相关的颜色名称，则相关文本将被渲染为黑色。以下颜色是 HTML4 与 CSS2 标准中定义的一些颜色，其应该被大多数浏览器定义了。<br>
<span class="math display">\[\begin{array}{|rc|} \hline \verb+\color{black}{text}+ &amp; \color{black}{text} \\ \verb+\color{gray}{text}+ &amp; \color{gray}{text} \\ \verb+\color{silver}{text}+ &amp; \color{silver}{text} \\ \verb+\color{white}{text}+ &amp; \color{white}{text} \\ \hline \verb+\color{maroon}{text}+ &amp; \color{maroon}{text} \\ \verb+\color{red}{text}+ &amp; \color{red}{text} \\ \verb+\color{yellow}{text}+ &amp; \color{yellow}{text} \\ \verb+\color{lime}{text}+ &amp; \color{lime}{text} \\ \verb+\color{olive}{text}+ &amp; \color{olive}{text} \\ \verb+\color{green}{text}+ &amp; \color{green}{text} \\ \verb+\color{teal}{text}+ &amp; \color{teal}{text} \\ \verb+\color{aqua}{text}+ &amp; \color{aqua}{text} \\ \verb+\color{blue}{text}+ &amp; \color{blue}{text} \\ \verb+\color{navy}{text}+ &amp; \color{navy}{text} \\ \verb+\color{purple}{text}+ &amp; \color{purple}{text} \\ \verb+\color{fuchsia}{text}+ &amp; \color{magenta}{text} \\ \hline \end{array}\]</span><br>
此外，HTML5 与 CSS3 也定义了一些颜色名称。同时，颜色也可以使用 #rgb 的形式来表示，r、g、b 分别表示代表颜色值得 16 进制数，如：<code>\color{\#0F0}{text}</code>。更多点击 <a href="https://www.w3schools.com/html/html_colors.asp">HTML 色彩快速参考手册</a>或 <a href="https://www.w3.org/TR/css3-color/#">CSS 色彩快速参考手册</a>。</li>
<li>删除线：<br>
<span class="math display">\[\require{cancel}\begin{array}{rl} \verb|y+\cancel{x}| &amp; y+\cancel{x}\\ \verb|\cancel{y+x}| &amp; \cancel{y+x}\\ \verb|y+\bcancel{x}| &amp; y+\bcancel{x}\\ \verb|y+\xcancel{x}| &amp; y+\xcancel{x}\\ \verb|y+\cancelto{0}{x}| &amp; y+\cancelto{0}{x}\\ \verb+\frac{1\cancel9}{\cancel95} = \frac15+&amp; \frac{1\cancel9}{\cancel95} = \frac15 \\ \end{array}\]</span><br>
<span class="math display">\[\require{enclose}\begin{array}{rl} \verb|\enclose{horizontalstrike}{x+y}| &amp; \enclose{horizontalstrike}{x+y}\\ \verb|\enclose{verticalstrike}{\frac xy}| &amp; \enclose{verticalstrike}{\frac xy}\\ \verb|\enclose{updiagonalstrike}{x+y}| &amp; \enclose{updiagonalstrike}{x+y}\\ \verb|\enclose{downdiagonalstrike}{x+y}| &amp; \enclose{downdiagonalstrike}{x+y}\\ \verb|\enclose{horizontalstrike,updiagonalstrike}{x+y}| &amp; \enclose{horizontalstrike,updiagonalstrike}{x+y}\\ \end{array}\]</span></li>
<li> 参考资料：<br>
<a href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/MATH.md">在 Hexo 中使用 MathJax 插入数学公式</a><br>
<a href="http://meta.math.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">MathJax basic tutorial and quick reference - StackExchange</a><br>
<a href="http://docs.mathjax.org/en/latest/start.html">MathJax Docs</a><br>
<a href="http://easy-copy-mathjax.xxxx7.com/">Easy Copy MathJax</a><br>
<a href="http://mohu.org/info/symbols/symbols.htm">常用数学符号的 LaTeX 表示方法</a></li>
</ol>
<h1 id="some-tips">Some Tips</h1>
<ol type="1">
<li><code>$ hexo g</code> 和 <code>$ hexo d</code> 可以合写为 <code>$ hexo g -d</code>。</li>
<li><code>$ git add .</code> 和 <code>$ git commit -m "add to GitHub"</code> 可以合写为 <code>$ git commit -a -m "add to GitHub"</code>（简写后不会提交新建的文件，只会更新旧文件的修改）。</li>
<li>如果不改变本地和远程仓库的结构且 push 的源仓库、分支与目的仓库、分支相同，push 后面的变量均可省略，<code>$ git push</code> 即可。</li>
</ol>
]]></content>
      <categories>
        <category>Tutorial</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
      </tags>
  </entry>
  <entry>
    <title>极光推送 JPush 教程</title>
    <url>/contents/%E6%9E%81%E5%85%89%E6%8E%A8%E9%80%81JPush%E6%95%99%E7%A8%8B.html</url>
    <content><![CDATA[<p>现在很多 Android 或者 iOS 应用都需要服务器推送，有很多第三方应用可以实现此功能，如 Firebase Cloud Messaging (原 Google Cloud Messaging) 和 Apple Push Notifications。由于 Google 官方的推送服务 Firebase Cloud Messaging 不能再中国使用，所以在此介绍极光推送的使用。<br>
<span id="more"></span></p>
<h1 id="准备工作">准备工作</h1>
<ol type="1">
<li>注册成为 JPush 开发者<br>
在 <a href="https://www.jiguang.cn/accounts/login/form">JPush 开发者服务</a>注册账号并登陆。</li>
<li>创建应用<br>
点击 “应用管理” 页面的 “创建应用” 按钮。填写应用名称，应用图标，Android 应用包名（不可更改），iOS 开发证书及密码，iOS 生产证书及密码。</li>
<li>记录 APPKey 和 Master Secret<br>
点击刚创建的应用详情页面，记录 APPKey 和 Master Secret</li>
</ol>
<h1 id="服务器端">服务器端</h1>
<p>本文使用 Python 作为服务器脚本语言。<br>
官方文档：<a href="https://docs.jiguang.cn/jpush/server/3rd/python_sdk/">Python SDK</a><br>
SDK 下载：<a href="https://sdkfiledl.jiguang.cn/jpush-api-python-client-3.2.4.zip">Python SDK v3.2.4</a><br>
官方源码：<a href="https://github.com/jpush/jpush-api-python-client">jpush-api-python-client</a><br>
官方 API：<a href="https://github.com/jpush/jpush-api-python-client/blob/master/docs/push/push.md">jpush python api</a><br>
官方 API：<a href="https://docs.jiguang.cn/jpush/server/push/rest_api_v3_push/">REST Push API</a></p>
<h2 id="环境配置">环境配置</h2>
<p>pip 方式：<code>pip install jpush</code><br>
easy_install 方式：<code>easy_install jpush</code><br>
使用源码方式：<code>python setup.py install</code></p>
<h2 id="服务器设置">服务器设置</h2>
<p>新建 conf.py 文件：<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># please put your app_key and master_secret here</span></span><br><span class="line">app_key = <span class="string">u'your app_key'</span></span><br><span class="line">master_secret = <span class="string">u'your master_secret'</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="服务端主函数">服务端主函数</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> conf <span class="keyword">import</span> app_key, master_secret</span><br><span class="line">_jpush = jpush.JPush(app_key, master_secret) <span class="comment">#初始化jpush</span></span><br><span class="line">_jpush.set_logging(<span class="string">"DEBUG"</span>) <span class="comment">#设置日志</span></span><br><span class="line">push = _jpush.create_push() <span class="comment">#初始化push</span></span><br><span class="line">push.platform = jpush.all_ <span class="comment">#设置推送所有平台</span></span><br><span class="line">push.platform = jpush.platform(*types) <span class="comment">#设置推送指定平台，关键字为"android", "ios","winphone"</span></span><br><span class="line">push.audience = jpush.registration_id(*reg_ids) <span class="comment">#根据注册id指定推送设备</span></span><br><span class="line">push.audience = jpush.alias(*alias) <span class="comment">#根据别名指定推送设备，别名在开发者服务平台中设置</span></span><br><span class="line">push.audience = jpush.tag(*tag) <span class="comment">#根据标签指定推送设备，标签在开发者服务平台中设置，多个标签之间是 OR 的关系，即取并集。</span></span><br><span class="line">push.audience = jpush.tag_and(*tag_ands) <span class="comment">#根据标签指定推送设备，标签在开发者服务平台中设置，多个标签之间是 AND 关系，即取交集。</span></span><br><span class="line">push.notification = jpush.notification(alert=<span class="literal">None</span>, ios=<span class="literal">None</span>, android=<span class="literal">None</span>, winphone=<span class="literal">None</span>) <span class="comment">#指定通知内容，如果下方各平台定义了alert，则覆盖这里的定义</span></span><br><span class="line">ios = jpush.ios(alert=<span class="literal">None</span>, badge=<span class="literal">None</span>, sound=<span class="literal">None</span>, content_available=<span class="literal">False</span>, extras=<span class="literal">None</span>, sound_disable=<span class="literal">False</span>) <span class="comment">#指定通知内容，声音，角标，唤醒，扩展字段</span></span><br><span class="line">android = jpush.android(alert, title=<span class="literal">None</span>, builder_id=<span class="literal">None</span>, extras=<span class="literal">None</span>) <span class="comment">#指定通知内容，标题，样式，扩展字段</span></span><br><span class="line">push.message = jpush.message(msg_content, title=<span class="literal">None</span>, content_type=<span class="literal">None</span>, extras=<span class="literal">None</span>) <span class="comment">#指定消息内容</span></span><br><span class="line">push.smsmessage = jpush.smsmessage(content,delay_time) <span class="comment">#指定短信内容和延迟时间（单位为秒，不能超过24小时。设置为0，表示立即发送短信。该参数仅对android平台有效，iOS 和 Winphone平台则会立即发送短信）</span></span><br><span class="line">result = push.send() <span class="comment">#执行推送</span></span><br></pre></td></tr></tbody></table></figure>
<h1 id="android客户端">Android 客户端</h1>
<p>官方集成文档：<a href="https://docs.jiguang.cn/jpush/client/Android/android_guide/">Android SDK 集成指南</a><br>
官方 API：<a href="https://docs.jiguang.cn/jpush/client/Android/android_api/">Android SDK API</a><br>
SDK 下载：<a href="https://www.jiguang.cn/downloads/sdk/android/">Android SDK</a><br>
目前 SDK 只支持 Android 2.3 或以上版本的手机系统。富媒体信息流功能则需 Android3.0 或以上版本的系统。</p>
<h2 id="jcenter自动集成步骤">jcenter 自动集成步骤</h2>
<p>说明：使用 jcenter 自动集成的开发者，不需要在项目中添加 jar 和 so，jcenter 会自动完成依赖；在 AndroidManifest.xml 中不需要添加任何 JPush SDK 相关的配置，jcenter 会自动导入。</p>
<ol type="1">
<li>确认 android studio 的 Project 根目录的主 gradle 中配置了 jcenter 支持。（新建 project 默认配置就支持）<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">buildscript {</span><br><span class="line">    repositories {</span><br><span class="line">        jcenter()</span><br><span class="line">    }</span><br><span class="line">    ......</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">allprojects {</span><br><span class="line">    repositories {</span><br><span class="line">        jcenter()</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li>在 module 的 gradle 中添加依赖和 AndroidManifest 的替换变量。<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">android {</span><br><span class="line">    ......</span><br><span class="line">    defaultConfig {</span><br><span class="line">        applicationId "com.xxx.xxx" //JPush上注册的包名.</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        ndk {</span><br><span class="line">            //选择要添加的对应cpu类型的.so库。</span><br><span class="line">            abiFilters 'armeabi', 'armeabi-v7a', 'arm64-v8a'</span><br><span class="line">            // 还可以添加 'x86', 'x86_64', 'mips', 'mips64'</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        manifestPlaceholders = [</span><br><span class="line">            JPUSH_PKGNAME : applicationId,</span><br><span class="line">            JPUSH_APPKEY : "你的appkey", //JPush上注册的包名对应的appkey.</span><br><span class="line">            JPUSH_CHANNEL : "自定义渠道名称", //用户渠道统计的渠道名称</span><br><span class="line">        ]</span><br><span class="line">        ......</span><br><span class="line">    }</span><br><span class="line">    ......</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    compile 'cn.jiguang.sdk:jpush:x.x.x'  // 此处为JPush的版本号</span><br><span class="line">    compile 'cn.jiguang.sdk:jcore:x.x.x'  // 此处为JCore的版本号</span><br><span class="line">    ......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>
注：如果在添加以上 abiFilter 配置之后 android Studio 出现以下提示：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">NDK integration is deprecated in the current plugin. Consider trying the new experimental plugin.</span><br></pre></td></tr></tbody></table></figure><br>
则在 Project 根目录的 gradle.properties 文件中添加：<br>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">android.useDeprecatedNdk=true</span><br></pre></td></tr></tbody></table></figure><br>
说明：若没有 res/drawable-xxxx/jpush_notification_icon 这个资源默认使用应用图标作为通知 icon，在 5.0 以上系统将应用图标作为 statusbar icon 可能显示不正常，用户可定义没有阴影和渐变色的 icon 替换这个文件，文件名不要变。</li>
</ol>
<h2 id="初始化sdk">初始化 SDK</h2>
<p>在主 activity 中：</p>
<ol type="1">
<li>import cn.jpush.android.api.JPushInterface;</li>
<li> 在 onCreate 函数中<br>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">JPushInterface.setDebugMode(<span class="keyword">true</span>); <span class="comment">//开启调试</span></span><br><span class="line">JPushInterface.init(<span class="keyword">this</span>); <span class="comment">//初始化</span></span><br><span class="line">rid = JPushInterface.getRegistrationID(getApplicationContext()); <span class="comment">//获取Registration ID</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h2 id="接收推送消息receiver">接收推送消息 Receiver</h2>
<p>JPush SDK 收到推送，通过广播的方式，转发给开发者 App，这样开发者就可以灵活地进行处理。<br>
这个动作不是必须的。用户有需要才定义 Receiver 类来处理 SDK 过来的广播。<br>
如果不做这个动作，即不写自定义 Receiver，也不在 AndroidManifest.xml 里配置这个 Receiver，则默认的行为是：</p>
<ol type="1">
<li>接收到推送的自定义消息，则没有被处理</li>
<li>可以正常收到通知，用户点击打开应用主界面<br>
### 接受广播<br>
如果全部类型的广播都接收，则需要在 AndroidManifest.xml 里添加如下的配置信息：<br>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"Your Receiver"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"cn.jpush.android.intent.REGISTRATION"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"cn.jpush.android.intent.MESSAGE_RECEIVED"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"cn.jpush.android.intent.NOTIFICATION_RECEIVED"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"cn.jpush.android.intent.NOTIFICATION_OPENED"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"cn.jpush.android.intent.NOTIFICATION_CLICK_ACTION"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"cn.jpush.android.intent.CONNECTION"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"You package Name"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><br>
### 开发者自定义 Receiver 代码示例<br>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.BroadcastReceiver;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.jpush.android.api.JPushInterface;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"JPush"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">        Bundle bundle = intent.getExtras();</span><br><span class="line">        Log.d(TAG, <span class="string">"[MyReceiver] onReceive - "</span> + intent.getAction());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (JPushInterface.ACTION_REGISTRATION_ID.equals(intent.getAction())) {</span><br><span class="line">            String regId = bundle.getString(JPushInterface.EXTRA_REGISTRATION_ID);</span><br><span class="line">            Log.d(TAG, <span class="string">"[MyReceiver] 接收Registration Id : "</span> + regId);</span><br><span class="line">            <span class="comment">//send the Registration Id to your server...</span></span><br><span class="line"></span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (JPushInterface.ACTION_MESSAGE_RECEIVED.equals(intent.getAction())) {</span><br><span class="line">            Log.d(TAG, <span class="string">"[MyReceiver] 接收到推送下来的自定义消息: "</span> + bundle.getString(JPushInterface.EXTRA_MESSAGE));</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (JPushInterface.ACTION_NOTIFICATION_RECEIVED.equals(intent.getAction())) {</span><br><span class="line">            Log.d(TAG, <span class="string">"[MyReceiver] 接收到推送下来的通知: "</span> + bundle.getString(JPushInterface.EXTRA_ALERT) +</span><br><span class="line">                    <span class="string">", extras: "</span> + bundle.getString(JPushInterface.EXTRA_EXTRA));</span><br><span class="line">            <span class="keyword">int</span> notifactionId = bundle.getInt(JPushInterface.EXTRA_NOTIFICATION_ID);</span><br><span class="line">            Log.d(TAG, <span class="string">"[MyReceiver] 接收到推送下来的通知的ID: "</span> + notifactionId);</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (JPushInterface.ACTION_NOTIFICATION_OPENED.equals(intent.getAction())) {</span><br><span class="line">            Log.d(TAG, <span class="string">"[MyReceiver] 用户点击打开了通知"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//打开自定义的Activity</span></span><br><span class="line">            Intent i = <span class="keyword">new</span> Intent(context, 需要跳转的activity名称.class);</span><br><span class="line">            i.putExtras(bundle);</span><br><span class="line">            <span class="comment">//i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span></span><br><span class="line">            i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP );</span><br><span class="line">            context.startActivity(i);</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (JPushInterface.ACTION_RICHPUSH_CALLBACK.equals(intent.getAction())) {</span><br><span class="line">            Log.d(TAG, <span class="string">"[MyReceiver] 用户收到到RICH PUSH CALLBACK: "</span> + bundle.getString(JPushInterface.EXTRA_EXTRA));</span><br><span class="line">            <span class="comment">//在这里根据 JPushInterface.EXTRA_EXTRA 的内容处理代码，比如打开新的Activity， 打开一个网页等..</span></span><br><span class="line"></span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span>(JPushInterface.ACTION_CONNECTION_CHANGE.equals(intent.getAction())) {</span><br><span class="line">            <span class="keyword">boolean</span> connected = intent.getBooleanExtra(JPushInterface.EXTRA_CONNECTION_CHANGE, <span class="keyword">false</span>);</span><br><span class="line">            Log.w(TAG, <span class="string">"[MyReceiver]"</span> + intent.getAction() +<span class="string">" connected state change to "</span>+connected);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            Log.d(TAG, <span class="string">"[MyReceiver] Unhandled intent - "</span> + intent.getAction());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>解锁网易云音乐客户端变灰歌曲</title>
    <url>/contents/%E8%A7%A3%E9%94%81%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%98%E7%81%B0%E6%AD%8C%E6%9B%B2.html</url>
    <content><![CDATA[<p>网易云音乐现如今很多音乐涉及到版权的问题无法播放，即使开了 VIP 也不行。<br>
下面介绍一个开源项目，来解决这个问题！亲测有效！推荐大家本机部署！<br>
<span id="more"></span></p>
<h1 id="项目地址">项目地址</h1>
<p>解锁网易云音乐客户端变灰歌曲 <a href="https://github.com/nondanee/UnblockNeteaseMusic">github</a> <pangu> </pangu><a href="https://soga.ee/285.html">参考教程</a></p>
<h1 id="功能特点">功能特点</h1>
<p>使用网易云旧链 / QQ / 虾米 / 百度 / 酷狗 / 酷我 / 咕咪 / JOOX 音源替换变灰歌曲链接 (默认仅启用前四)。<br>
为请求增加 X-Real-IP 参数解锁海外限制，支持指定网易云服务器 IP，支持设置上游 HTTP / HTTPS 代理。<br>
完整的流量代理功能 (HTTP / HTTPS)，可直接作为系统代理 (同时支持 PAC)。</p>
<h1 id="windows安装">Windows 安装</h1>
<ol type="1">
<li>下载安装 <a href="https://nodejs.org/en/">Node.js</a>。</li>
<li>下载<a href="https://github.com/nondanee/UnblockNeteaseMusic/archive/master.zip">项目源码</a>到本地，并解压到 / UnblockNeteaseMusic 目录。</li>
<li>以<strong>管理员</strong>身份运行 CMD，切换到 / UnblockNeteaseMusic 目录，然后安装依赖库 <code>npm install</code></li>
<li>打开网易客户端，点击右上角【设置】 – 【工具】 – 【Http 代理】 – 点击【自定义代理】 – 下拉框选择【HTTP 代理】，输入服务器地址 <code>127.0.0.1</code> 和端口 <code>18080</code>，重启客户端。</li>
</ol>
<h1 id="使用">使用</h1>
<p>打开命令行，切换到 / UnblockNeteaseMusic 目录，输入 <code>node app.js –p 18080</code>，然后再打开网易云音乐客户端即可。</p>
]]></content>
      <categories>
        <category>Tutorial</category>
      </categories>
      <tags>
        <tag>Tutorial</tag>
      </tags>
  </entry>
  <entry>
    <title>豆瓣爬虫实例</title>
    <url>/contents/%E8%B1%86%E7%93%A3%E7%88%AC%E8%99%AB%E5%AE%9E%E4%BE%8B.html</url>
    <content><![CDATA[<p>本文提供 3 个例子来说明如何利用 Python 爬取豆瓣的数据。<br>
<span id="more"></span></p>
<h1 id="用requests获取页面">用 requests 获取页面</h1>
<p>三个实例都要用到 request 库来获取页面资源。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHTMLText</span>(<span class="params">url</span>):</span> <span class="comment"># 获取网页的HTML源码</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 设置响应等待时间为30秒</span></span><br><span class="line">        r = requests.get(url, timeout=<span class="number">30</span>)</span><br><span class="line">        <span class="comment"># 检查状态码是否为200，否则抛出异常。</span></span><br><span class="line">        r.raise_for_status()</span><br><span class="line">        <span class="comment"># 返回请求的相应内容。</span></span><br><span class="line">        <span class="keyword">return</span> r.text</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># 抛出异常则重试</span></span><br><span class="line">        <span class="keyword">return</span> getHTMLText(url)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h1 id="实例一豆瓣国产电视剧爬虫">实例一：豆瓣国产电视剧爬虫</h1>
<h2 id="观察所需爬取的页面">观察所需爬取的页面</h2>
<p>所需爬取的页面为<a href="https://movie.douban.com/tv/#!type=tv&amp;tag=%E5%9B%BD%E4%BA%A7%E5%89%A7&amp;sort=time&amp;page_limit=20&amp;page_start=0">按时间排序的国产电视剧评分等信息</a>。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E8%B1%86%E7%93%A3%E7%94%B5%E8%A7%86%E5%89%A7.png" class=""><br>
查看其源代码发现电视剧列表内容是由 js 加载的。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%BA%90%E7%A0%811.png" class=""></p>
<h2 id="获取电视剧豆瓣地址列表">获取电视剧豆瓣地址列表</h2>
<p>打开控制台，观察一下 network 中往返的数据。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%8E%A7%E5%88%B6%E5%8F%B01.png" class=""><br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%8E%A7%E5%88%B6%E5%8F%B02.png" class=""><br>
观察到网页通过查询 <code>https://movie.douban.com/j/search_subjects?type=tv&amp;tag=国产剧&amp;sort=time&amp;page_limit=20&amp;page_start=0</code><br>
其中 type 是分类（movie，tv）；tag 是小分类（热门，美剧，英剧，韩剧，日剧，国产剧，港剧，日本动画，综艺）；sort 是排序（recommend，time，rank）；page_limit 是每页展示的电视剧数量（不可修改）；page_start 是起始页面，为 20 的倍数（例如，第一页是 0，第二页是 20 等等）。<br>
返回的是 json 数据，直接读取其 url 字段即可。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTVdramalist</span>(<span class="params">url, Numofpage</span>):</span></span><br><span class="line">    <span class="comment"># 电视剧豆瓣地址列表</span></span><br><span class="line">    TVdramalist = []</span><br><span class="line">    <span class="comment"># Numofpage为爬取页面数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(Numofpage)):</span><br><span class="line">        <span class="comment"># 获取第i页网页的资源，20为每页的电视剧记录数</span></span><br><span class="line">        text = getHTMLText(url+<span class="built_in">str</span>(i*<span class="number">20</span>))</span><br><span class="line">        <span class="comment"># 由于此url返回json对象，所以将获取到的资源转换为json格式</span></span><br><span class="line">        json_text = json.loads(text)</span><br><span class="line">        <span class="comment"># 获取json中的url字段，存入TVdramalist列表</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">            dic = json_text[<span class="string">'subjects'</span>][j]</span><br><span class="line">            TVdramalist.append(dic[<span class="string">'url'</span>])</span><br><span class="line">    <span class="keyword">return</span> TVdramalist</span><br><span class="line"></span><br><span class="line">moivelist_url = <span class="string">'https://movie.douban.com/j/search_subjects?type=tv&amp;tag=国产剧&amp;sort=time&amp;page_limit=20&amp;page_start='</span></span><br><span class="line">Numofpage = <span class="number">5</span></span><br><span class="line"><span class="comment"># 获取最新5*20条电视剧的详情页链接</span></span><br><span class="line">moivelist = getTVdramalist(moivelist_url, Numofpage)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="分析电视剧详情页">分析电视剧详情页</h2>
<p>对于上面获取的每一个 url 对应一个电视剧详情页。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E8%AF%A6%E6%83%85%E9%A1%B5.png" class=""><br>
查看其源代码发现电视剧详情内容是由 HTML 加载的。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%BA%90%E7%A0%812.png" class=""><br>
则用 beautifulsoup 库结合正则表达式 re 库分析并获取所需字段。<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTVdramainfo</span>(<span class="params">url, writer</span>):</span></span><br><span class="line">    text = getHTMLText(url)</span><br><span class="line">    <span class="comment"># 将获取到的资源转换为soup对象</span></span><br><span class="line">    soup = BeautifulSoup(text)</span><br><span class="line">    <span class="comment"># 找到所需字段</span></span><br><span class="line">    name = soup.find(<span class="built_in">property</span>=<span class="string">"v:itemreviewed"</span>).string</span><br><span class="line">    rating = <span class="built_in">float</span>(soup.find(<span class="built_in">property</span>=<span class="string">"v:average"</span>).string)</span><br><span class="line">    votes = <span class="built_in">int</span>(soup.find(<span class="built_in">property</span>=<span class="string">"v:votes"</span>).string)</span><br><span class="line">    episode = <span class="built_in">int</span>(re.search(<span class="string">u'集数:&lt;/span&gt; (\d+)&lt;br/&gt;'</span>, text).group(<span class="number">1</span>))</span><br><span class="line">    duration = <span class="built_in">int</span>(re.search(<span class="string">u'单集片长:&lt;/span&gt; (\d+)分钟&lt;br/&gt;'</span>, text).group(<span class="number">1</span>))</span><br></pre></td></tr></tbody></table></figure><br>
从property为v:itemreviewed的标签可以得到电视剧名。<br>
从property为v:average的标签可以得到评分。<br>
从property为v:votes的标签可以得到评分人数。<br>
<code>&lt;span class="pl"&gt;集数:&lt;/span&gt; 12&lt;br/&gt;</code> 和 <code>&lt;span class="pl"&gt;单集片长:&lt;/span&gt; 55分钟&lt;br/&gt;</code> 的标签属性和其他标签的属性都一样，这里直接用正则表达式进行查找反而更方便。<p></p>
<h2 id="存储所爬信息到数据库">存储所爬信息到数据库</h2>
<p>这里使用 sqlite3 库实现<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbtablecreate</span>():</span></span><br><span class="line">    <span class="comment"># 执行一条SQL语句，创建ChineseTVdrama表</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'CREATE TABLE ChineseTVdrama (name TEXT PRIMARY KEY, rating REAL, votes INT, episode INT, duration INT)'</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'Table created successfully'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbinsertorupdate</span>(<span class="params">name, rating, votes, episode, duration</span>):</span></span><br><span class="line">    <span class="comment"># 执行一条SQL语句，插入一条记录</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'INSERT INTO ChineseTVdrama (name, rating, votes, episode, duration) VALUES (?, ?, ?, ?, ?)'</span>, (name, rating, votes, episode, duration))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'data insert successfully'</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># 如果该数据已经存在，则插入异常，改用更新数据</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cursor.execute(<span class="string">'UPDATE ChineseTVdrama SET rating = ?, votes = ?, episode = ?, duration = ? WHERE name = ?'</span>, (rating, votes, episode, duration, name))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'data update successfully'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'update: '</span> + <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbquery</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="comment"># 以电视剧名称为关键词查询数据库</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'SELECT name, rating, votes, episode, duration FROM ChineseTVdrama WHERE name = ?'</span>, (name))</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">            <span class="keyword">return</span> row</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'query: '</span> + <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line">moivelist_url = <span class="string">'https://movie.douban.com/j/search_subjects?type=tv&amp;tag=国产剧&amp;sort=time&amp;page_limit=20&amp;page_start='</span></span><br><span class="line">Numofpage = <span class="number">5</span></span><br><span class="line"><span class="comment"># 获取最新5*20条电视剧的详情页链接</span></span><br><span class="line">moivelist = getTVdramalist(moivelist_url, Numofpage)</span><br><span class="line"><span class="comment"># 连接到SQLite数据库</span></span><br><span class="line"><span class="comment"># 如果文件不存在，会自动在当前目录创建</span></span><br><span class="line">doubandatabase = sqlite3.connect(<span class="string">'豆瓣.db'</span>)</span><br><span class="line"><span class="comment"># 创建一个Cursor</span></span><br><span class="line">cursor = doubandatabase.cursor()</span><br><span class="line"><span class="comment"># 创建一个数据库表</span></span><br><span class="line">dbtablecreate()</span><br><span class="line"><span class="comment"># 从每个电视剧的详情页中获取所需字段存入数据库</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> moivelist:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        getTVdramainfo(i, cursor)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"><span class="comment"># 关闭Cursor</span></span><br><span class="line">cursor.close()</span><br><span class="line"><span class="comment"># 提交事务</span></span><br><span class="line">doubandatabase.commit()</span><br><span class="line"><span class="comment"># 关闭Connection</span></span><br><span class="line">doubandatabase.close()</span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(<span class="string">'豆瓣.db'</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">cursor.execute(<span class="string">"SELECT name FROM sqlite_master WHERE type = 'table'"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    tablename = i[<span class="number">0</span>]</span><br><span class="line">    cursor.execute(<span class="string">"SELECT * FROM '{}'"</span>.<span class="built_in">format</span>(tablename))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(tablename + <span class="string">'.csv'</span>, <span class="string">'w'</span>, newline=<span class="string">''</span>, encoding=<span class="string">'utf_8_sig'</span>) <span class="keyword">as</span> csv_file: </span><br><span class="line">        csv_writer = csv.writer(csv_file)</span><br><span class="line">        csv_writer.writerow([j[<span class="number">0</span>] <span class="keyword">for</span> j <span class="keyword">in</span> cursor.description])</span><br><span class="line">        csv_writer.writerows(cursor)</span><br></pre></td></tr></tbody></table></figure><br>
可以用SQLiteSpy.exe查看数据库。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%95%B0%E6%8D%AE%E5%BA%931.png" class=""><p></p>
<h1 id="实例二豆瓣正在上映电影爬虫">实例二：豆瓣正在上映电影爬虫</h1>
<h2 id="观察所需爬取的页面-1">观察所需爬取的页面</h2>
<p>所需爬取的页面为<a href="https://movie.douban.com/cinema/nowplaying/wuhan/">正在上映电影</a>。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E8%B1%86%E7%93%A3%E6%AD%A3%E5%9C%A8%E4%B8%8A%E6%98%A0%E7%94%B5%E5%BD%B1.png" class=""><br>
查看其源代码。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%BA%90%E7%A0%813.png" class=""></p>
<h2 id="获取电影信息">获取电影信息</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getnowshowing</span>(<span class="params">url, city</span>):</span></span><br><span class="line">    text = getHTMLText(url + city)</span><br><span class="line">    <span class="comment"># 将获取到的资源转换为soup对象</span></span><br><span class="line">    soup = BeautifulSoup(text)</span><br><span class="line">    <span class="comment"># 找到所有样式为lists的标签</span></span><br><span class="line">    lists = soup.find(class_=<span class="string">"lists"</span>)</span><br><span class="line">    <span class="comment"># 遍历其儿子节点</span></span><br><span class="line">    <span class="keyword">for</span> eachmoive <span class="keyword">in</span> lists.children:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(eachmoive) == bs4.element.Tag:</span><br><span class="line">            <span class="comment"># 找到所需字段</span></span><br><span class="line">            name = eachmoive[<span class="string">'data-title'</span>]</span><br><span class="line">            rating = <span class="built_in">float</span>(eachmoive[<span class="string">'data-score'</span>])</span><br><span class="line">            votes = <span class="built_in">int</span>(eachmoive[<span class="string">'data-votecount'</span>])</span><br><span class="line">            <span class="keyword">if</span> eachmoive[<span class="string">'data-duration'</span>].encode(<span class="string">'utf-8'</span>) == <span class="string">''</span>:</span><br><span class="line">                duration = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                duration = <span class="built_in">int</span>(<span class="built_in">str</span>(eachmoive[<span class="string">'data-duration'</span>].encode(<span class="string">'utf-8'</span>)).split(<span class="string">'\\'</span>)[<span class="number">0</span>].split(<span class="string">'\''</span>)[<span class="number">1</span>])</span><br></pre></td></tr></tbody></table></figure>
<p>从源码发现电影列表内容分为正在上映和即将上映两块，<code>soup.find(class_="lists")</code> 只返回第一个符合条件的标签。<br>
其每一个孩子节点包含每一个电影信息。所有信息都存在孩子节点的 <code>&lt;li&gt;</code> 标签内，所以只取 Tag 对象，Tag 对象的属性访问与字典一样。<br>
注意 data-duration 的值有可能为空，所以要单独判断。<br>
eachmoive ['data-duration'] 返回 'xxx 分钟 ' 的 Unicode 对象，<code>.encode('utf-8')</code> 将 Unicode 对象转换成 string 对象。<code>filter(str.isdigit, str)</code> 提取 str 中数字。</p>
<h2 id="存储所爬信息到数据库-1">存储所爬信息到数据库</h2>
<p>这里使用 sqlite3 库实现<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbtablecreate</span>():</span></span><br><span class="line">    <span class="comment"># 执行一条SQL语句，创建NowShowingMoive表</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'CREATE TABLE NowShowingMoive (name TEXT PRIMARY KEY, rating REAL, votes INT, duration INT)'</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'Table created successfully'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbinsert</span>(<span class="params">name, rating, votes, duration</span>):</span></span><br><span class="line">    <span class="comment"># 执行一条SQL语句，插入一条记录</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'INSERT INTO NowShowingMoive (name, rating, votes, duration) VALUES (?, ?, ?, ?)'</span>, (name, rating, votes, duration))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'data insert successfully'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'insert: '</span> + <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbquery</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="comment"># 以电影名称为关键词查询数据库</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'SELECT name, rating, votes, duration FROM NowShowingMoive WHERE name = ?'</span>, (name))</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">            <span class="keyword">return</span> row</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'query: '</span> + <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到SQLite数据库</span></span><br><span class="line"><span class="comment"># 如果文件不存在，会自动在当前目录创建</span></span><br><span class="line">doubandatabase = sqlite3.connect(<span class="string">'豆瓣.db'</span>)</span><br><span class="line"><span class="comment"># 创建一个Cursor</span></span><br><span class="line">cursor = doubandatabase.cursor()</span><br><span class="line"><span class="comment"># 如果数据库表已经存在，则删除</span></span><br><span class="line">cursor.execute(<span class="string">'DROP TABLE IF EXISTS NowShowingMoive'</span>)</span><br><span class="line"><span class="comment"># 创建一个数据库表</span></span><br><span class="line">dbtablecreate()</span><br><span class="line">nowshowing_url = <span class="string">'https://movie.douban.com/cinema/nowplaying/'</span></span><br><span class="line">city = <span class="string">'wuhan'</span></span><br><span class="line">nowshowing = getnowshowing(nowshowing_url, city)</span><br><span class="line"><span class="comment"># 关闭Cursor</span></span><br><span class="line">cursor.close()</span><br><span class="line"><span class="comment"># 提交事务</span></span><br><span class="line">doubandatabase.commit()</span><br><span class="line"><span class="comment"># 关闭Connection</span></span><br><span class="line">doubandatabase.close()</span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(<span class="string">'豆瓣.db'</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">cursor.execute(<span class="string">"SELECT name FROM sqlite_master WHERE type = 'table'"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    tablename = i[<span class="number">0</span>]</span><br><span class="line">    cursor.execute(<span class="string">"SELECT * FROM '{}'"</span>.<span class="built_in">format</span>(tablename))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(tablename + <span class="string">'.csv'</span>, <span class="string">'w'</span>, newline=<span class="string">''</span>, encoding=<span class="string">'utf_8_sig'</span>) <span class="keyword">as</span> csv_file: </span><br><span class="line">        csv_writer = csv.writer(csv_file)</span><br><span class="line">        csv_writer.writerow([j[<span class="number">0</span>] <span class="keyword">for</span> j <span class="keyword">in</span> cursor.description])</span><br><span class="line">        csv_writer.writerows(cursor)</span><br></pre></td></tr></tbody></table></figure><br>
可以用SQLiteSpy.exe查看数据库。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%95%B0%E6%8D%AE%E5%BA%932.png" class=""><p></p>
<h1 id="实例三豆瓣电影top250爬虫">实例三：豆瓣电影 TOP250 爬虫</h1>
<h2 id="观察所需爬取的页面-2">观察所需爬取的页面</h2>
<p>所需爬取的页面为<a href="https://movie.douban.com/top250?start=0">豆瓣电影 Top250</a>。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1Top250.png" class=""><br>
查看其源代码。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%BA%90%E7%A0%814.png" class=""></p>
<h2 id="获取电影信息-1">获取电影信息</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTop250moive</span>(<span class="params">url, Numofpage</span>):</span></span><br><span class="line">    <span class="comment"># Numofpage为爬取页面数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Numofpage):</span><br><span class="line">        <span class="comment"># 获取第i页网页的资源，25为每页的电影记录数</span></span><br><span class="line">        text = getHTMLText(url+<span class="built_in">str</span>(i*<span class="number">25</span>))</span><br><span class="line">        <span class="comment"># 将获取到的资源转换为soup对象</span></span><br><span class="line">        soup = BeautifulSoup(text)</span><br><span class="line">        <span class="comment"># 找到所有样式为info的标签</span></span><br><span class="line">        lists = soup.find_all(class_=<span class="string">"info"</span>)</span><br><span class="line">        <span class="comment"># 找到所需字段</span></span><br><span class="line">        <span class="keyword">for</span> eachmoive <span class="keyword">in</span> lists:</span><br><span class="line">            name = eachmoive.find(class_=<span class="string">"title"</span>).string</span><br><span class="line">            year = <span class="built_in">int</span>(eachmoive.find(<span class="string">'p'</span>).get_text().split(<span class="string">'\n'</span>)[<span class="number">2</span>].strip()[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">            country = eachmoive.find(<span class="string">'p'</span>).get_text().split(<span class="string">'\n'</span>)[<span class="number">2</span>].split(<span class="string">'/'</span>)[<span class="number">1</span>].strip()</span><br><span class="line">            rating = <span class="built_in">float</span>(eachmoive.find(<span class="built_in">property</span>=<span class="string">"v:average"</span>).string)</span><br><span class="line">            <span class="comment"># 两种方法都可以</span></span><br><span class="line">            votes = <span class="built_in">int</span>(<span class="built_in">str</span>(eachmoive.find(<span class="built_in">property</span>=<span class="string">"v:best"</span>).next_sibling.next_sibling.string.encode(<span class="string">'utf-8'</span>)).split(<span class="string">'\\'</span>)[<span class="number">0</span>].split(<span class="string">'\''</span>)[<span class="number">1</span>])</span><br><span class="line">            votes = <span class="built_in">int</span>(<span class="built_in">str</span>(eachmoive.find(text=re.<span class="built_in">compile</span>(<span class="string">u"人评价"</span>)).encode(<span class="string">'utf-8'</span>)).split(<span class="string">'\\'</span>)[<span class="number">0</span>].split(<span class="string">'\''</span>)[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">if</span> eachmoive.find(class_=<span class="string">"inq"</span>) == <span class="literal">None</span>:</span><br><span class="line">                comment = <span class="string">''</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                comment = eachmoive.find(class_=<span class="string">"inq"</span>).string</span><br></pre></td></tr></tbody></table></figure>
<p>从网址发现，Top250 的电影分别展示在 10 个页面，每个页面展示 25 条电影信息，所以 url 的 start 参数为 25 的倍数，值为 0-9。<br>
从源码发现 <code>soup.find(class_="info")</code> 返回每一个电影的信息所在的标签如图。<br>
从样式为 title 的标签可以得到电影名。<br>
从第一个 p 标签可以返回导演、主演、上映年份、国家、类型等信息，并且是分列 2 行，<br>
用<code>.split('\n')[2]</code> 得到第 2 行的字符串，<code>.strip()[0:4])</code> 去掉空格并取前 4 个字符作为年份。<br>
<code>.split('/')[1].strip()</code> 以斜线分隔符分割字符串并取出第二段字符串并去掉前后空格，即国家信息。<br>
从 property 为 v:average 的标签可以得到评分。<br>
由于评分人数从 <code>&lt;span&gt;878960人评价&lt;/span&gt;</code> 标签中获取，但是 span 标签没有任何属性。<br>
所以有两种方法：<br>
1. 通过 <code>find(property="v:best")</code> 找到上一个平行节点，然后通过<code>.next_sibling.next_sibling.string</code> 访问。<br>
2. 通过 <code>eachmoive.find(text=re.compile(u"人评价"))</code> 直接用正则表达式查找相应的字符串。<br>
最后通过 <code>filter(str.isdigit, str)</code> 提取 str 中数字。<br>
从样式为 inq 的标签可以得到电影评论，注意电影可能没有评论，所以要单独判断。</p>
<h2 id="存储所爬信息到数据库-2">存储所爬信息到数据库</h2>
<p>这里使用 sqlite3 库实现<br>
</p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbtablecreate</span>():</span></span><br><span class="line">    <span class="comment"># 执行一条SQL语句，创建Top250movie表</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'CREATE TABLE Top250movie (name TEXT PRIMARY KEY, year INT, country TEXT, rating REAL, votes INT, comment TEXT)'</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'Table created successfully'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbinsert</span>(<span class="params">name, year, country, rating, votes, comment</span>):</span></span><br><span class="line">    <span class="comment"># 执行一条SQL语句，插入一条记录</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'INSERT INTO Top250movie (name, year, country, rating, votes, comment) VALUES (?, ?, ?, ?, ?, ?)'</span>, (name, year, country, rating, votes, comment))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'data insert successfully'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'insert: '</span> + <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbquery</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="comment"># 以电影名称为关键词查询数据库</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cursor.execute(<span class="string">'SELECT name, year, country, rating, votes, comment FROM Top250movie WHERE name = ?'</span>, (name))</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> cursor:</span><br><span class="line">            <span class="keyword">return</span> row</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'query: '</span> + <span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到SQLite数据库</span></span><br><span class="line"><span class="comment"># 如果文件不存在，会自动在当前目录创建</span></span><br><span class="line">doubandatabase = sqlite3.connect(<span class="string">'豆瓣.db'</span>)</span><br><span class="line"><span class="comment"># 创建一个Cursor</span></span><br><span class="line">cursor = doubandatabase.cursor()</span><br><span class="line"><span class="comment"># 如果数据库表已经存在，则删除</span></span><br><span class="line">cursor.execute(<span class="string">'DROP TABLE IF EXISTS Top250movie'</span>)</span><br><span class="line"><span class="comment"># 创建一个数据库表</span></span><br><span class="line">dbtablecreate()</span><br><span class="line">moivelist_url = <span class="string">'https://movie.douban.com/top250?start='</span></span><br><span class="line">Numofpage = <span class="number">10</span></span><br><span class="line"><span class="comment"># 获取最新10*25条电影信息</span></span><br><span class="line">getTop250moive(moivelist_url, Numofpage)</span><br><span class="line"><span class="comment"># 关闭Cursor</span></span><br><span class="line">cursor.close()</span><br><span class="line"><span class="comment"># 提交事务</span></span><br><span class="line">doubandatabase.commit()</span><br><span class="line"><span class="comment"># 关闭Connection</span></span><br><span class="line">doubandatabase.close()</span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(<span class="string">'豆瓣.db'</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">cursor.execute(<span class="string">"SELECT name FROM sqlite_master WHERE type = 'table'"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    tablename = i[<span class="number">0</span>]</span><br><span class="line">    cursor.execute(<span class="string">"SELECT * FROM '{}'"</span>.<span class="built_in">format</span>(tablename))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(tablename + <span class="string">'.csv'</span>, <span class="string">'w'</span>, newline=<span class="string">''</span>, encoding=<span class="string">'utf_8_sig'</span>) <span class="keyword">as</span> csv_file: </span><br><span class="line">        csv_writer = csv.writer(csv_file)</span><br><span class="line">        csv_writer.writerow([j[<span class="number">0</span>] <span class="keyword">for</span> j <span class="keyword">in</span> cursor.description])</span><br><span class="line">        csv_writer.writerows(cursor)</span><br></pre></td></tr></tbody></table></figure><br>
可以用SQLiteSpy.exe查看数据库。<br>
<img src="/images/Python%E7%88%AC%E8%99%AB/%E6%95%B0%E6%8D%AE%E5%BA%933.png" class=""><p></p>
<h1 id="其他">其他</h1>
<p><a href="/assets/codes/豆瓣/douban_TV_drama.py">实例一源码</a><br>
<a href="/assets/codes/豆瓣/douban_nowshowing_movie.py">实例二源码</a><br>
<a href="/assets/codes/豆瓣/douban_top250_movie.py">实例三源码</a><br>
<a href="/assets/codes/豆瓣/SQLiteSpy.zip">SQLiteSpy 数据库查看器下载</a><br>
<a href="/assets/codes/豆瓣/豆瓣.db">豆瓣爬虫结果下载</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Crawler</tag>
        <tag>Examples</tag>
      </tags>
  </entry>
</search>
